{
	"info": {
		"_postman_id": "9a4c5ff9-8324-48ee-80cc-1292c01e25b2",
		"name": "Ora19 Etrade API's service/process [JSON]",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "39962775",
		"_collection_link": "https://api444-0813.postman.co/workspace/Test-API~be5f61cb-b341-4e43-b16c-fc596e4ceb7b/collection/39962775-9a4c5ff9-8324-48ee-80cc-1292c01e25b2?action=share&source=collection_link&creator=39962775"
	},
	"item": [
		{
			"name": "Error handling",
			"item": [
				{
					"name": "Wrong Login credentials",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"/**\r",
									" * Login – Error handling: wrong username or password\r",
									" * Expected:\r",
									" * {\r",
									" *   \"responseStatus\": {\r",
									" *     \"resCode\":  \"4\",\r",
									" *     \"resDesc\":  \"خطأ في أسم المستخدم أو كلمة السر\",\r",
									" *     \"source\":   \"LOGIN\",\r",
									" *     \"resCode1\": \"4\",\r",
									" *     \"resDesc1\": \"خطأ في أسم المستخدم أو كلمة السر\"\r",
									" *   }\r",
									" * }\r",
									" */\r",
									"\r",
									"let json;\r",
									"\r",
									"// --- HTTP + Content-Type (tolerant for gateways that return 200 or 4xx) ---\r",
									"pm.test(\"HTTP 200\", function () {\r",
									"  pm.response.to.have.status(200);\r",
									"});\r",
									"\r",
									"pm.test(\"Content-Type is JSON\", function () {\r",
									"  pm.response.to.have.header(\"Content-Type\");\r",
									"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
									"});\r",
									"\r",
									"// --- Parse JSON safely ---\r",
									"pm.test(\"Response is valid JSON\", function () {\r",
									"  json = pm.response.json();\r",
									"  pm.expect(json).to.be.an(\"object\");\r",
									"});\r",
									"\r",
									"// --- Core error contract ---\r",
									"pm.test(\"responseStatus indicates wrong username/password\", function () {\r",
									"  const rs = json.responseStatus || {};\r",
									"  const allowedDescs = [\r",
									"    \"خطأ في أسم المستخدم أو كلمة السر\",\r",
									"    \"خطأ في اسم المستخدم أو كلمة السر\",\r",
									"    \"خطأ في اسم المستخدم أو كلمة المرور\",\r",
									"    \"خطأ في أسم المستخدم أو كلمة المرور\"\r",
									"  ];\r",
									"\r",
									"  pm.expect(rs.resCode,  \"resCode\").to.eql(\"4\");\r",
									"  pm.expect(rs.resCode1, \"resCode1\").to.eql(\"4\");\r",
									"  pm.expect(rs.source,   \"source\").to.eql(\"LOGIN\");\r",
									"\r",
									"  pm.expect(allowedDescs, \"resDesc in allowed Arabic variants\")\r",
									"    .to.include(rs.resDesc);\r",
									"  pm.expect(allowedDescs, \"resDesc1 in allowed Arabic variants\")\r",
									"    .to.include(rs.resDesc1);\r",
									"});\r",
									"\r",
									"// --- Negative contract: no business payload expected ---\r",
									"pm.test(\"No business payload present\", function () {\r",
									"  pm.expect(json.message, \"message should be absent on auth error\")\r",
									"    .to.satisfy(v => v === undefined || v === null || (typeof v === \"object\" && Object.keys(v).length === 0));\r",
									"});\r",
									"\r",
									"// --- Security hygiene: ensure no sensitive internals leaked ---\r",
									"pm.test(\"No stack traces or internal exception details leaked\", function () {\r",
									"  const text = pm.response.text();\r",
									"  pm.expect(text.toLowerCase()).to.not.include(\"stack\");\r",
									"  pm.expect(text.toLowerCase()).to.not.include(\"exception\");\r",
									"  pm.expect(text.toLowerCase()).to.not.include(\"trace\");\r",
									"});\r",
									"\r",
									"// --- Optional JSON Schema check (minimal) ---\r",
									"pm.test(\"Error schema (minimal) is valid\", function () {\r",
									"  const schema = {\r",
									"    type: \"object\",\r",
									"    required: [\"responseStatus\"],\r",
									"    properties: {\r",
									"      responseStatus: {\r",
									"        type: \"object\",\r",
									"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
									"        properties: {\r",
									"          resCode:  { const: \"4\" },\r",
									"          resCode1: { const: \"4\" },\r",
									"          source:   { const: \"LOGIN\" },\r",
									"          resDesc:  { type: \"string\" },\r",
									"          resDesc1: { type: \"string\" }\r",
									"        }\r",
									"      }\r",
									"    },\r",
									"    additionalProperties: true\r",
									"  };\r",
									"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
									"});\r",
									"\r",
									"// --- Diagnostics ---\r",
									"console.log(\"❌ LOGIN error: wrong username or password\");\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Get current timestamp in ISO format\r",
									"var timestamp = new Date().toISOString();\r",
									"\r",
									"// Store timestamp in Postman environment\r",
									"pm.environment.set(\"currentTimestamp\", timestamp);\r",
									"\r",
									"// Log the timestamp\r",
									"console.log(\"Timestamp Set:\", timestamp);\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"Srv\": \"Login\",\r\n    \"Message\": {\r\n        \"Login\": {\r\n            \"UserName\": \"80509X\",\r\n            \"Password\": \"12345X\",\r\n            \"Lang\": \"ARB\"\r\n        }\r\n    },\r\n    \"Version\": \"1.0\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"08-07-2015\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{BaseURL}}{{Oracle19}}",
							"host": [
								"{{BaseURL}}{{Oracle19}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Wrong Srv name",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"/**\r",
									" * Negative: wrong service name (\"CustomerAssetsX\")\r",
									" * Expected payload shows resCode/resCode1 = \"17\", source = \"DEFAULT\"\r",
									" */\r",
									"\r",
									"let json;\r",
									"\r",
									"// --- HTTP + Content-Type (tolerant: allow 200..499) ---\r",
									"pm.test(\"Status code is 200\", function () {\r",
									"    pm.response.to.have.status(200);\r",
									"});\r",
									"\r",
									"pm.test(\"Content-Type is JSON\", function () {\r",
									"  pm.response.to.have.header(\"Content-Type\");\r",
									"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
									"});\r",
									"\r",
									"\r",
									"// --- Parse JSON safely ---\r",
									"pm.test(\"Response is valid JSON\", function () {\r",
									"  json = pm.response.json();\r",
									"  pm.expect(json).to.be.an(\"object\");\r",
									"});\r",
									"\r",
									"// --- Core error contract ---\r",
									"pm.test(\"responseStatus indicates 'Operation Not Allowed' (wrong Srv)\", function () {\r",
									"  const rs = json.responseStatus || {};\r",
									"  pm.expect(rs.resCode, \"resCode\").to.eql(\"17\");\r",
									"  pm.expect(rs.resDesc, \"resDesc\").to.eql(\"Operation Not Allowed\");\r",
									"  pm.expect(rs.source, \"source\").to.eql(\"DEFAULT\");\r",
									"  pm.expect(rs.resCode1, \"resCode1\").to.eql(\"17\");\r",
									"  pm.expect(rs.resDesc1, \"resDesc1\").to.eql(\"Operation Not Allowed\");\r",
									"});\r",
									"\r",
									"// --- Negative contract: no business payload expected ---\r",
									"pm.test(\"No business payload (message/custAssetRes) returned\", function () {\r",
									"  pm.expect(json.message, \"message should be absent in error\").to.satisfy(v => v === undefined || v === null || (typeof v === \"object\" && Object.keys(v).length === 0));\r",
									"});\r",
									"\r",
									"// --- (Request-side) guardrail: verify we really sent the wrong Srv ---\r",
									"pm.test(\"Request body contains wrong Srv (CustomerAssetsX)\", function () {\r",
									"  try {\r",
									"    const body = pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {};\r",
									"    pm.expect(body.Srv, \"Srv\").to.eql(\"CustomerAssetsX\");\r",
									"  } catch (e) {\r",
									"    // If body isn't raw JSON (e.g., pre-request script injects it), just warn.\r",
									"    console.warn(\"Could not parse request body to verify Srv:\", e.message);\r",
									"  }\r",
									"});\r",
									"\r",
									"// --- Optional schema check for error body ---\r",
									"pm.test(\"Error schema (minimal) is valid\", function () {\r",
									"  const schema = {\r",
									"    type: \"object\",\r",
									"    required: [\"responseStatus\"],\r",
									"    properties: {\r",
									"      responseStatus: {\r",
									"        type: \"object\",\r",
									"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
									"        properties: {\r",
									"          resCode:  { const: \"17\" },\r",
									"          resDesc:  { const: \"Operation Not Allowed\" },\r",
									"          source:   { const: \"DEFAULT\" },\r",
									"          resCode1: { const: \"17\" },\r",
									"          resDesc1: { const: \"Operation Not Allowed\" }\r",
									"        }\r",
									"      }\r",
									"    },\r",
									"    additionalProperties: true\r",
									"  };\r",
									"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
									"});\r",
									"\r",
									"// --- Diagnostics ---\r",
									"console.log(\"❌ CustomerAssets error (Wrong Srv)\");\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"Srv\": \"CustomerAssetsX\",\r\n    \"Message\": {\r\n        \"CustReq\": {\r\n            \"NIN\": \"{{NIN}}\",\r\n            \"UserId\": \"{{UserID}}\",\r\n            \"UserType\": \"INVESTOR\",\r\n            \"Lang\": \"ARB\",\r\n            \"IsAddBuyBal\": \"F\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"30-04-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{BaseURL}}{{Oracle19}}",
							"host": [
								"{{BaseURL}}{{Oracle19}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Wrong SessionID",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"/**\r",
									" * Negative: wrong/invalid sessionId\r",
									" * Same expected error envelope: resCode/resCode1 = \"17\", source = \"DEFAULT\"\r",
									" */\r",
									"\r",
									"let json;\r",
									"\r",
									"// --- HTTP + Content-Type (tolerant) ---\r",
									"pm.test(\"Status code is 200\", function () {\r",
									"    pm.response.to.have.status(200);\r",
									"});\r",
									"\r",
									"pm.test(\"Content-Type is JSON\", function () {\r",
									"  pm.response.to.have.header(\"Content-Type\");\r",
									"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
									"});\r",
									"\r",
									"// --- Parse JSON safely ---\r",
									"pm.test(\"Response is valid JSON\", function () {\r",
									"  json = pm.response.json();\r",
									"  pm.expect(json).to.be.an(\"object\");\r",
									"});\r",
									"\r",
									"// --- Core error contract ---\r",
									"pm.test(\"responseStatus indicates 'Operation Not Allowed' (wrong session)\", function () {\r",
									"  const rs = json.responseStatus || {};\r",
									"  pm.expect(rs.resCode, \"resCode\").to.eql(\"17\");\r",
									"  pm.expect(rs.resDesc, \"resDesc\").to.eql(\"Operation Not Allowed\");\r",
									"  pm.expect(rs.source, \"source\").to.eql(\"DEFAULT\");\r",
									"  pm.expect(rs.resCode1, \"resCode1\").to.eql(\"17\");\r",
									"  pm.expect(rs.resDesc1, \"resDesc1\").to.eql(\"Operation Not Allowed\");\r",
									"});\r",
									"\r",
									"// --- Negative contract: no business payload expected ---\r",
									"pm.test(\"No business payload (message/custAssetRes) returned\", function () {\r",
									"  pm.expect(json.message, \"message should be absent in error\").to.satisfy(v => v === undefined || v === null || (typeof v === \"object\" && Object.keys(v).length === 0));\r",
									"});\r",
									"\r",
									"// --- (Request-side) guardrails: sessionId must be present, non-empty ---\r",
									"pm.test(\"Request contains a sessionId (even if wrong)\", function () {\r",
									"  try {\r",
									"    const body = pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {};\r",
									"    pm.expect(body.sessionId, \"sessionId present\").to.be.a(\"string\").and.not.empty;\r",
									"  } catch (e) {\r",
									"    console.warn(\"Could not parse request body to verify sessionId:\", e.message);\r",
									"  }\r",
									"});\r",
									"\r",
									"// --- Optional schema check for error body ---\r",
									"pm.test(\"Error schema (minimal) is valid\", function () {\r",
									"  const schema = {\r",
									"    type: \"object\",\r",
									"    required: [\"responseStatus\"],\r",
									"    properties: {\r",
									"      responseStatus: {\r",
									"        type: \"object\",\r",
									"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
									"        properties: {\r",
									"          resCode:  { const: \"17\" },\r",
									"          resDesc:  { const: \"Operation Not Allowed\" },\r",
									"          source:   { const: \"DEFAULT\" },\r",
									"          resCode1: { const: \"17\" },\r",
									"          resDesc1: { const: \"Operation Not Allowed\" }\r",
									"        }\r",
									"      }\r",
									"    },\r",
									"    additionalProperties: true\r",
									"  };\r",
									"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
									"});\r",
									"\r",
									"// --- Diagnostics ---\r",
									"console.log(\"❌ CustomerAssets error (Wrong sessionId)\");\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"Srv\": \"CustomerAssetsX\",\r\n    \"Message\": {\r\n        \"CustReq\": {\r\n            \"NIN\": \"{{NIN}}\",\r\n            \"UserId\": \"{{UserID}}\",\r\n            \"UserType\": \"INVESTOR\",\r\n            \"Lang\": \"ARB\",\r\n            \"IsAddBuyBal\": \"F\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"30-04-2025\",\r\n    \"sessionId\": \"534B6855626A564675552B33315664364235644B354F66676E6933763272672B566975385A6141696C4B3647536D50376D4E3244643674776959787A474C5461\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{BaseURL}}{{Oracle19}}",
							"host": [
								"{{BaseURL}}{{Oracle19}}"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "1. System Config",
			"item": [
				{
					"name": "System Config",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"/**\r",
									" * SYSTEM_CONFIG – Validate Commission & PrefixName params\r",
									" * - HTTP 200 (business req)\r",
									" * - responseStatus.* == \"0\", source=\"SYSTEM_CONFIG\"\r",
									" * - Must include COMMISSION and PREFIXNAME\r",
									" * - COMMISSION: numeric strings, 0 <= from < to (optionally <= 1)\r",
									" * - PREFIXNAME: CSV string -> array (no empties/dups)\r",
									" * - Saves: COMMISSION_MIN, COMMISSION_MAX, PREFIX_LIST, PREFIX_COUNT\r",
									" * - Honors STRICT_PARAMS (Y/N) and ENFORCE_PERCENT_LE_1 (Y/N) from env/globals\r",
									" */\r",
									"\r",
									"pm.test(\"HTTP 200\", () => pm.response.to.have.status(200));\r",
									"\r",
									"pm.test(\"Content-Type is JSON\", function () {\r",
									"  pm.response.to.have.header(\"Content-Type\");\r",
									"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
									"});\r",
									"\r",
									"let json;\r",
									"pm.test(\"Body is valid JSON\", function () {\r",
									"  json = pm.response.json();\r",
									"  pm.expect(json).to.be.an(\"object\");\r",
									"});\r",
									"\r",
									"// ---------- Envelope ----------\r",
									"pm.test(\"responseStatus OK (SYSTEM_CONFIG)\", function () {\r",
									"  const rs = json.responseStatus || {};\r",
									"  pm.expect(rs.resCode).to.eql(\"0\");\r",
									"  pm.expect(rs.resDesc).to.eql(\"Successful Operation\");\r",
									"  pm.expect(rs.source).to.eql(\"SYSTEM_CONFIG\");\r",
									"  pm.expect(rs.resCode1).to.eql(\"0\");\r",
									"  pm.expect(rs.resDesc1).to.eql(\"Successful Operation\");\r",
									"});\r",
									"\r",
									"// ---------- Pull params array ----------\r",
									"const params = ((((json || {}).message || {}).params || {}).param) || [];\r",
									"pm.test(\"Params array present\", function () {\r",
									"  pm.expect(params).to.be.an(\"array\").that.is.not.empty;\r",
									"});\r",
									"\r",
									"// Helpers\r",
									"const isNumericStr = v => typeof v === \"string\" && /^-?\\d+(\\.\\d+)?$/.test(v);\r",
									"const uppercase = s => String(s || \"\").trim().toUpperCase();\r",
									"const asMapByName = (arr) => {\r",
									"  const m = {};\r",
									"  arr.forEach(p => { const k = uppercase(p.paramName); if (k) m[k] = p; });\r",
									"  return m;\r",
									"};\r",
									"const pmap = asMapByName(params);\r",
									"\r",
									"// ---------- Request/response alignment ----------\r",
									"(function checkRequestNames() {\r",
									"  let requested = [];\r",
									"  try {\r",
									"    const body = pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {};\r",
									"    const s = (((body || {}).Message || {}).paramReq || {}).paramName || \"\";\r",
									"    requested = String(s).split(\",\").map(uppercase).filter(Boolean);\r",
									"  } catch (e) {\r",
									"    console.warn(\"Could not parse request body to read paramName:\", e.message);\r",
									"  }\r",
									"\r",
									"  // Every requested name should exist in response\r",
									"  pm.test(\"All requested paramName entries are present in response\", function () {\r",
									"    const missing = requested.filter(k => !(k in pmap));\r",
									"    pm.expect(missing, \"Missing params: \" + missing.join(\", \")).to.eql([]);\r",
									"  });\r",
									"\r",
									"  // Optional strictness: response must not include unexpected params\r",
									"  const strict = (pm.environment.get(\"STRICT_PARAMS\") || pm.globals.get(\"STRICT_PARAMS\") || \"N\").toUpperCase() === \"Y\";\r",
									"  if (strict && requested.length) {\r",
									"    pm.test(\"No extra params returned (STRICT_PARAMS=Y)\", function () {\r",
									"      const extras = Object.keys(pmap).filter(k => !requested.includes(k));\r",
									"      pm.expect(extras, \"Unexpected params: \" + extras.join(\", \")).to.eql([]);\r",
									"    });\r",
									"  }\r",
									"})();\r",
									"\r",
									"// ---------- Validate COMMISSION ----------\r",
									"pm.test(\"COMMISSION param present & valid\", function () {\r",
									"  const c = pmap[\"COMMISSION\"];\r",
									"  pm.expect(c, \"COMMISSION missing\").to.be.an(\"object\");\r",
									"\r",
									"  // paramCode optional check (enable via EXPECT_COMMISSION_CODE)\r",
									"  const expectCode = pm.environment.get(\"EXPECT_COMMISSION_CODE\") || pm.globals.get(\"EXPECT_COMMISSION_CODE\");\r",
									"  if (expectCode) {\r",
									"    pm.expect(String(c.paramCode)).to.eql(String(expectCode));\r",
									"  } else {\r",
									"    // paramCode at least looks like digits (not required, but nice to have)\r",
									"    pm.expect(String(c.paramCode || \"\")).to.match(/^\\d*$/);\r",
									"  }\r",
									"\r",
									"  pm.expect(isNumericStr(c.valueFrom), \"COMMISSION.valueFrom numeric string\").to.be.true;\r",
									"  pm.expect(isNumericStr(c.valueTo), \"COMMISSION.valueTo numeric string\").to.be.true;\r",
									"\r",
									"  const from = Number(c.valueFrom);\r",
									"  const to   = Number(c.valueTo);\r",
									"\r",
									"  pm.expect(from, \"COMMISSION.valueFrom >= 0\").to.be.at.least(0);\r",
									"  pm.expect(to,   \"COMMISSION.valueTo > 0\").to.be.above(0);\r",
									"  pm.expect(from, \"COMMISSION.valueFrom < valueTo\").to.be.below(to);\r",
									"\r",
									"  // Optional: enforce ≤ 1 (i.e., percentage in [0,1])\r",
									"  const enforcePct = (pm.environment.get(\"ENFORCE_PERCENT_LE_1\") || pm.globals.get(\"ENFORCE_PERCENT_LE_1\") || \"Y\").toUpperCase() === \"Y\";\r",
									"  if (enforcePct) {\r",
									"    pm.expect(to, \"COMMISSION.valueTo <= 1 (percent sanity)\").to.be.at.most(1);\r",
									"  }\r",
									"\r",
									"  // Save to env\r",
									"  pm.environment.set(\"COMMISSION_MIN\", String(from));\r",
									"  pm.environment.set(\"COMMISSION_MAX\", String(to));\r",
									"});\r",
									"\r",
									"// ---------- Validate PREFIXNAME ----------\r",
									"pm.test(\"PREFIXNAME param present & valid\", function () {\r",
									"  const p = pmap[\"PREFIXNAME\"];\r",
									"  pm.expect(p, \"PREFIXNAME missing\").to.be.an(\"object\");\r",
									"  pm.expect(typeof p.valueFrom, \"PREFIXNAME.valueFrom must be string\").to.eql(\"string\");\r",
									"  pm.expect(p.valueFrom.trim().length, \"PREFIXNAME.valueFrom not empty\").to.be.greaterThan(0);\r",
									"\r",
									"  // Parse CSV -> array\r",
									"  const raw = p.valueFrom;\r",
									"  const items = raw.split(\",\").map(s => s.trim()).filter(Boolean);\r",
									"\r",
									"  pm.expect(items.length, \"PREFIXNAME list has entries\").to.be.greaterThan(0);\r",
									"\r",
									"  // No duplicates (case-insensitive)\r",
									"  const seen = new Set(), dups = [];\r",
									"  items.forEach(x => {\r",
									"    const key = x.toLowerCase();\r",
									"    if (seen.has(key)) dups.push(x);\r",
									"    else seen.add(key);\r",
									"  });\r",
									"  pm.expect(dups, \"Duplicate prefixes (case-insensitive): \" + [...new Set(dups)].join(\", \")).to.eql([]);\r",
									"\r",
									"  // Optional: minimal token sanity (>=1 char)\r",
									"  const bad = items.filter(x => x.length === 0);\r",
									"  pm.expect(bad, \"Empty tokens found\").to.eql([]);\r",
									"\r",
									"  // Save to env\r",
									"  pm.environment.set(\"PREFIX_LIST\", JSON.stringify(items));\r",
									"  pm.environment.set(\"PREFIX_COUNT\", String(items.length));\r",
									"});\r",
									"\r",
									"// ---------- Minimal schema (tv4) ----------\r",
									"pm.test(\"Schema (minimal) validates\", function () {\r",
									"  const schema = {\r",
									"    type: \"object\",\r",
									"    required: [\"message\", \"responseStatus\"],\r",
									"    properties: {\r",
									"      responseStatus: {\r",
									"        type: \"object\",\r",
									"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
									"        properties: {\r",
									"          resCode:  { const: \"0\" },\r",
									"          resDesc:  { const: \"Successful Operation\" },\r",
									"          source:   { const: \"SYSTEM_CONFIG\" },\r",
									"          resCode1: { const: \"0\" },\r",
									"          resDesc1: { const: \"Successful Operation\" }\r",
									"        }\r",
									"      },\r",
									"      message: {\r",
									"        type: \"object\",\r",
									"        required: [\"params\"],\r",
									"        properties: {\r",
									"          params: {\r",
									"            type: \"object\",\r",
									"            required: [\"param\"],\r",
									"            properties: {\r",
									"              param: {\r",
									"                type: \"array\",\r",
									"                items: {\r",
									"                  type: \"object\",\r",
									"                  required: [\"paramName\",\"valueFrom\"],\r",
									"                  properties: {\r",
									"                    paramCode:  { type: [\"string\",\"null\"] },\r",
									"                    paramName:  { type: \"string\" },\r",
									"                    valueFrom:  { type: \"string\" },\r",
									"                    valueTo:    { type: [\"string\",\"null\"] }\r",
									"                  }\r",
									"                }\r",
									"              }\r",
									"            }\r",
									"          }\r",
									"        }\r",
									"      }\r",
									"    }\r",
									"  };\r",
									"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
									"});\r",
									"\r",
									"// ---------- Visualizer ----------\r",
									"(function render() {\r",
									"  const template = `\r",
									"  <style>\r",
									"    .t {font-family:system-ui,Segoe UI,Roboto,Arial; font-size:14px; color:#333; width:100%; border-collapse:collapse}\r",
									"    .t th,.t td {border:1px solid #87ceeb; padding:8px; text-align:left}\r",
									"    .t th {background:#87ceeb}\r",
									"    .ok {color:#0a8f08} .warn {color:#b26a00}\r",
									"  </style>\r",
									"  <h3>SYSTEM_CONFIG</h3>\r",
									"  <table class=\"t\">\r",
									"    <thead><tr><th>paramCode</th><th>paramName</th><th>valueFrom</th><th>valueTo</th><th>Notes</th></tr></thead>\r",
									"    <tbody>\r",
									"      {{#rows}}\r",
									"        <tr>\r",
									"          <td>{{paramCode}}</td>\r",
									"          <td>{{paramName}}</td>\r",
									"          <td>{{valueFrom}}</td>\r",
									"          <td>{{valueTo}}</td>\r",
									"          <td class=\"{{cls}}\">{{note}}</td>\r",
									"        </tr>\r",
									"      {{/rows}}\r",
									"    </tbody>\r",
									"  </table>\r",
									"  `;\r",
									"\r",
									"  const rows = params.map(p => {\r",
									"    const name = uppercase(p.paramName);\r",
									"    let note = \"\", cls = \"ok\";\r",
									"    if (name === \"COMMISSION\") {\r",
									"      note = \"Commission range\";\r",
									"    } else if (name === \"PREFIXNAME\") {\r",
									"      const cnt = String(p.valueFrom || \"\").split(\",\").filter(Boolean).length;\r",
									"      note = `Prefixes: ${cnt}`;\r",
									"    } else {\r",
									"      cls = \"warn\";\r",
									"      note = \"Unrequested parameter\";\r",
									"    }\r",
									"    return {\r",
									"      paramCode: String(p.paramCode || \"\"),\r",
									"      paramName: name,\r",
									"      valueFrom: String(p.valueFrom || \"\"),\r",
									"      valueTo:   String(p.valueTo || \"\"),\r",
									"      note, cls\r",
									"    };\r",
									"  });\r",
									"\r",
									"  pm.visualizer.set(template, { rows });\r",
									"})();\r",
									"\r",
									"// ---------- Console diagnostics ----------\r",
									"console.log(\"✅ SYSTEM_CONFIG validated.\");\r",
									"console.log(\"Saved COMMISSION_MIN:\", pm.environment.get(\"COMMISSION_MIN\"), \"COMMISSION_MAX:\", pm.environment.get(\"COMMISSION_MAX\"));\r",
									"console.log(\"Saved PREFIX_COUNT:\", pm.environment.get(\"PREFIX_COUNT\"));\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"Srv\": \"SYSTEM_CONFIG\",\r\n    \"Message\": {\r\n        \"paramReq\": {\r\n            \"nin\": \"\",\r\n            \"paramName\": \"Commission,prefixname\"\r\n        }\r\n    }\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{BaseURL}}{{Oracle19}}",
							"host": [
								"{{BaseURL}}{{Oracle19}}"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "2. Login",
			"item": [
				{
					"name": "Login - Normal",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Check if the status code is 200\r",
									"pm.test(\"Status code is 200\", function () {\r",
									"    pm.response.to.have.status(200);\r",
									"});\r",
									" \r",
									"// Check if response code is 0\r",
									"pm.test(\"Response code is 0\", function () {\r",
									"    var jsonData = pm.response.json(); // Parse JSON response\r",
									"    pm.expect(jsonData.responseStatus.resCode).to.equal(\"0\");\r",
									"});\r",
									" \r",
									"// Check if response description is \"Successful Operation\"\r",
									"pm.test(\"Response description is 'Successful Operation'\", function () {\r",
									"    var jsonData = pm.response.json();\r",
									"    pm.expect(jsonData.responseStatus.resDesc).to.equal(\"Successful Operation\");\r",
									"});\r",
									" \r",
									"// Check if login is successful and capture NIN\r",
									"pm.test(\"Login successful and NIN captured\", function () {\r",
									"    var jsonData = pm.response.json();\r",
									"    var accounts = jsonData.message.logResponse.accounts.account;\r",
									" \r",
									"    if (accounts.length > 0) {\r",
									"        var nin = accounts[0].nin; // Extract NIN\r",
									"        pm.expect(nin).to.not.be.undefined; // Ensure it's not empty\r",
									" \r",
									"        // Store in environment variables\r",
									"        pm.environment.set(\"NIN\", nin);\r",
									"        pm.environment.set(\"UserID\", nin); // Store the same value in UserID\r",
									" \r",
									"        console.log(\"Captured NIN/UserID:\", nin);\r",
									"    } else {\r",
									"        pm.expect.fail(\"NIN not found in the response.\");\r",
									"    }\r",
									"});\r",
									" \r",
									"// Check if login is successful and SessionID is created\r",
									"pm.test(\"Login successful and SessionID created\", function () {\r",
									"    var jsonData = pm.response.json();\r",
									"    var sessionID = jsonData.message.logResponse.sessionID;\r",
									" \r",
									"    pm.expect(sessionID).to.not.be.undefined; // Assert SessionID exists\r",
									"});\r",
									" \r",
									"// Verify Content-Type header is 'application/json'\r",
									"pm.test(\"Content-Type header is 'application/json'\", function () {\r",
									"    pm.expect(pm.response.headers.get(\"Content-Type\")).to.include(\"application/json\");\r",
									"});\r",
									" \r",
									"// Check if login is successful and capture SessionID\r",
									"pm.test(\"Login successful and SessionID captured\", function () {\r",
									"    var jsonData = pm.response.json();\r",
									"    var sessionID = jsonData.message.logResponse.sessionID;\r",
									" \r",
									"    pm.expect(sessionID).to.not.be.undefined; // Assert SessionID exists\r",
									"    pm.environment.set(\"SessionID\", sessionID); // Save SessionID to environment\r",
									"});\r",
									" \r",
									"// Parse the response JSON\r",
									"var jsonData = pm.response.json();\r",
									" \r",
									"// Verify that the response contains the expected roles\r",
									"pm.test(\"Verify roles in response\", function () {\r",
									"    var roles = jsonData.message.logResponse.roles.role;\r",
									" \r",
									"    // Define expected roles\r",
									"    var expectedRoles = [\"UPDATE_ORDER\", \"SAVE_ORDER\", \"REPORTS\", \"CANCEL_ORDER\"];\r",
									" \r",
									"    // Ensure roles exist in the response\r",
									"    pm.expect(roles).to.be.an(\"array\").that.is.not.empty;\r",
									" \r",
									"    // Check that all expected roles exist in the response\r",
									"    expectedRoles.forEach(role => {\r",
									"        pm.expect(roles).to.include(role, `Missing role: ${role}`);\r",
									"    });\r",
									" \r",
									"    console.log(\"✅ Roles verified successfully:\", roles);\r",
									"});"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Get current timestamp in ISO format\r",
									"var timestamp = new Date().toISOString();\r",
									"\r",
									"// Store timestamp in Postman environment\r",
									"pm.environment.set(\"currentTimestamp\", timestamp);\r",
									"\r",
									"// Log the timestamp\r",
									"console.log(\"Timestamp Set:\", timestamp);\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"Srv\": \"Login\",\r\n    \"Message\": {\r\n        \"Login\": {\r\n            \"UserName\": \"80509\",\r\n            \"Password\": \"{{Password}}\",\r\n            \"Lang\": \"ARB\"\r\n        }\r\n    },\r\n    \"Version\": \"1.0\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"08-07-2015\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{BaseURL}}{{Oracle19}}",
							"host": [
								"{{BaseURL}}{{Oracle19}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Login - Margin",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Check if the status code is 200\r",
									"pm.test(\"Status code is 200\", function () {\r",
									"    pm.response.to.have.status(200);\r",
									"});\r",
									"\r",
									"// Check if response code is 0\r",
									"pm.test(\"Response code is 0\", function () {\r",
									"    var jsonData = pm.response.json(); // Parse JSON response\r",
									"    pm.expect(jsonData.responseStatus.resCode).to.equal(\"0\");\r",
									"});\r",
									"\r",
									"// Check if response description is \"Successful Operation\"\r",
									"pm.test(\"Response description is 'Successful Operation'\", function () {\r",
									"    var jsonData = pm.response.json();\r",
									"    pm.expect(jsonData.responseStatus.resDesc).to.equal(\"Successful Operation\");\r",
									"});\r",
									"\r",
									"// Check if login is successful and capture NIN\r",
									"pm.test(\"Login successful and NIN captured\", function () {\r",
									"    var jsonData = pm.response.json();\r",
									"    var accounts = jsonData.message.logResponse.accounts.account;\r",
									"\r",
									"    if (accounts.length > 0) {\r",
									"        var nin = accounts[0].nin; // Extract NIN\r",
									"        pm.expect(nin).to.not.be.undefined; // Ensure it's not empty\r",
									"\r",
									"        // Store in environment variables\r",
									"        pm.environment.set(\"NIN\", nin);\r",
									"        pm.environment.set(\"UserID\", nin); // Store the same value in UserID\r",
									"\r",
									"        console.log(\"Captured NIN/UserID:\", nin);\r",
									"    } else {\r",
									"        pm.expect.fail(\"NIN not found in the response.\");\r",
									"    }\r",
									"});\r",
									"\r",
									"// Check if login is successful and SessionID is created\r",
									"pm.test(\"Login successful and SessionID created\", function () {\r",
									"    var jsonData = pm.response.json();\r",
									"    var sessionID = jsonData.message.logResponse.sessionID;\r",
									"\r",
									"    pm.expect(sessionID).to.not.be.undefined; // Assert SessionID exists\r",
									"});\r",
									"\r",
									"// Verify Content-Type header is 'application/json'\r",
									"pm.test(\"Content-Type header is 'application/json'\", function () {\r",
									"    pm.expect(pm.response.headers.get(\"Content-Type\")).to.include(\"application/json\");\r",
									"});\r",
									"\r",
									"// Check if login is successful and capture SessionID\r",
									"pm.test(\"Login successful and SessionID captured\", function () {\r",
									"    var jsonData = pm.response.json();\r",
									"    var sessionID = jsonData.message.logResponse.sessionID;\r",
									"\r",
									"    pm.expect(sessionID).to.not.be.undefined; // Assert SessionID exists\r",
									"    pm.environment.set(\"SessionID\", sessionID); // Save SessionID to environment\r",
									"});\r",
									"\r",
									"// Parse the response JSON\r",
									"var jsonData = pm.response.json();\r",
									"\r",
									"// Verify that the response contains the expected roles\r",
									"pm.test(\"Verify roles in response\", function () {\r",
									"    var roles = jsonData.message.logResponse.roles.role;\r",
									"\r",
									"    // Define expected roles\r",
									"    var expectedRoles = [\"UPDATE_ORDER\", \"SAVE_ORDER\", \"REPORTS\", \"CANCEL_ORDER\"];\r",
									"\r",
									"    // Ensure roles exist in the response\r",
									"    pm.expect(roles).to.be.an(\"array\").that.is.not.empty;\r",
									"\r",
									"    // Check that all expected roles exist in the response\r",
									"    expectedRoles.forEach(role => {\r",
									"        pm.expect(roles).to.include(role, `Missing role: ${role}`);\r",
									"    });\r",
									"\r",
									"    console.log(\"✅ Roles verified successfully:\", roles);\r",
									"});\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Get current timestamp in ISO format\r",
									"var timestamp = new Date().toISOString();\r",
									"\r",
									"// Store timestamp in Postman environment\r",
									"pm.environment.set(\"currentTimestamp\", timestamp);\r",
									"\r",
									"// Log the timestamp\r",
									"console.log(\"Timestamp Set:\", timestamp);\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"Srv\": \"Login\",\r\n    \"Message\": {\r\n        \"Login\": {\r\n            \"UserName\": \"1218\",\r\n            \"Password\": \"{{Password}}\",\r\n            \"Lang\": \"ARB\"\r\n        }\r\n    },\r\n    \"Version\": \"1.0\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"08-07-2015\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{BaseURL}}{{Oracle19}}",
							"host": [
								"{{BaseURL}}{{Oracle19}}"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "3. Get Companies",
			"item": [
				{
					"name": "Get Companies",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"/**\r",
									" * GET_COMPS – Positive contract & deep validation\r",
									" * - HTTP 200 always (business req)\r",
									" * - responseStatus.* == \"0\", source=\"GET_COMPS\"\r",
									" * - comps length >= MIN_COMPS (default 56)\r",
									" * - For each company: cmparbName, cmpengName, compCode, closePrc, limmitUp, limmitDown, codeType present\r",
									" * - Numeric strings validated; limits sanity; unique compCode\r",
									" * - Saves codes & prices to env for chaining\r",
									" */\r",
									"\r",
									"pm.test(\"HTTP 200\", () => pm.response.to.have.status(200));\r",
									"\r",
									"pm.test(\"Content-Type is JSON\", function () {\r",
									"  pm.response.to.have.header(\"Content-Type\");\r",
									"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
									"});\r",
									"\r",
									"let json;\r",
									"pm.test(\"Body is valid JSON\", function () {\r",
									"  json = pm.response.json();\r",
									"  pm.expect(json).to.be.an(\"object\");\r",
									"});\r",
									"\r",
									"// ---------- Envelope ----------\r",
									"pm.test(\"responseStatus OK (GET_COMPS)\", function () {\r",
									"  const rs = json.responseStatus || {};\r",
									"  pm.expect(rs.resCode).to.eql(\"0\");\r",
									"  pm.expect(rs.resDesc).to.eql(\"Successful Operation\");\r",
									"  pm.expect(rs.source).to.eql(\"GET_COMPS\");\r",
									"  pm.expect(rs.resCode1).to.eql(\"0\");\r",
									"  pm.expect(rs.resDesc1).to.eql(\"Successful Operation\");\r",
									"});\r",
									"\r",
									"// ---------- Extract comps ----------\r",
									"const comps = ((((json || {}).message || {}).cmpdetailsResponse || {}).comps || {}).comp || [];\r",
									"const minComps = Number(pm.environment.get(\"MIN_COMPS\") || pm.globals.get(\"MIN_COMPS\") || 56);\r",
									"\r",
									"pm.test(`Comps array length >= ${minComps}`, function () {\r",
									"  pm.expect(comps).to.be.an(\"array\");\r",
									"  pm.expect(comps.length, `Expected at least ${minComps} companies`).to.be.at.least(minComps);\r",
									"});\r",
									"\r",
									"// ---------- Helpers ----------\r",
									"const isNumericStr = v => typeof v === \"string\" && /^-?\\d+(\\.\\d+)?$/.test(v);\r",
									"const isNonEmpty = v => typeof v === \"string\" && v.trim().length > 0;\r",
									"const pick = (obj, ...keys) => {\r",
									"  for (const k of keys) {\r",
									"    if (obj && obj[k] !== undefined && obj[k] !== null && String(obj[k]).trim() !== \"\") {\r",
									"      return String(obj[k]);\r",
									"    }\r",
									"  }\r",
									"  return \"\";\r",
									"};\r",
									"\r",
									"// Optional allowed code types: set env ALLOWED_CODE_TYPES = \"SHRS,BND,ETF\"\r",
									"const allowedTypes = (pm.environment.get(\"ALLOWED_CODE_TYPES\") || pm.globals.get(\"ALLOWED_CODE_TYPES\") || \"\")\r",
									"  .split(\",\")\r",
									"  .map(s => s.trim())\r",
									"  .filter(Boolean);\r",
									"\r",
									"// ---------- Per-company validations ----------\r",
									"pm.test(\"Each company has required fields & valid values\", function () {\r",
									"  comps.forEach((c, i) => {\r",
									"    // Names (handle provider variations)\r",
									"    const nameAr = pick(c, \"cmparbName\", \"cmpArbName\");   // payload shows both in wild\r",
									"    const nameEn = pick(c, \"cmpengName\", \"cmpEngName\");\r",
									"\r",
									"    pm.expect(isNonEmpty(nameAr), `cmparbName/cmpArbName missing @index ${i}`).to.be.true;\r",
									"    pm.expect(isNonEmpty(nameEn), `cmpengName/cmpEngName missing @index ${i}`).to.be.true;\r",
									"\r",
									"    // compCode\r",
									"    pm.expect(isNonEmpty(c.compCode), `compCode missing @index ${i}`).to.be.true;\r",
									"\r",
									"    // codeType\r",
									"    pm.expect(isNonEmpty(c.codeType), `codeType missing @index ${i}`).to.be.true;\r",
									"    if (allowedTypes.length) {\r",
									"      pm.expect(allowedTypes, `codeType '${c.codeType}' not in allowed set`).to.include(c.codeType);\r",
									"    }\r",
									"\r",
									"    // Numeric strings\r",
									"    [\"closePrc\", \"limmitUp\", \"limmitDown\"].forEach(k => {\r",
									"      pm.expect(isNumericStr(c[k]), `${k} must be numeric string @${c.compCode || i}`).to.be.true;\r",
									"      pm.expect(Number(c[k]), `${k} must be >= 0 @${c.compCode || i}`).to.be.at.least(0);\r",
									"    });\r",
									"\r",
									"    // margin (optional but often present)\r",
									"    if (c.margin !== undefined) {\r",
									"      pm.expect(isNumericStr(c.margin), `margin must be numeric string @${c.compCode || i}`).to.be.true;\r",
									"      const m = Number(c.margin);\r",
									"      pm.expect(m, `margin out of [0,1] @${c.compCode || i}`).to.be.at.least(0).and.at.most(1);\r",
									"    }\r",
									"\r",
									"    // Limits sanity (skip if noLimit === \"Y\")\r",
									"    const noLimit = String(c.noLimit || \"N\").toUpperCase();\r",
									"    if (noLimit !== \"Y\") {\r",
									"      const cp = Number(c.closePrc);\r",
									"      const up = Number(c.limmitUp);\r",
									"      const dn = Number(c.limmitDown);\r",
									"      pm.expect(dn, `limmitDown <= closePrc @${c.compCode || i}`).to.be.at.most(cp);\r",
									"      pm.expect(up, `limmitUp >= closePrc @${c.compCode || i}`).to.be.at.least(cp);\r",
									"      pm.expect(up, `limmitUp >= limmitDown @${c.compCode || i}`).to.be.at.least(dn);\r",
									"    }\r",
									"  });\r",
									"});\r",
									"\r",
									"// ---------- Uniqueness ----------\r",
									"pm.test(\"compCode values are unique\", function () {\r",
									"  const codes = comps.map(c => String(c.compCode || \"\")).filter(Boolean);\r",
									"  const uniq = new Set(codes);\r",
									"  pm.expect(uniq.size, \"Duplicate compCode detected\").to.eql(codes.length);\r",
									"});\r",
									"\r",
									"// ---------- Optional schema per company (loose, tv4 draft v4) ----------\r",
									"pm.test(\"Company schema (loose) valid for all\", function () {\r",
									"  const compSchema = {\r",
									"    type: \"object\",\r",
									"    required: [\"compCode\", \"codeType\", \"closePrc\", \"limmitUp\", \"limmitDown\"],\r",
									"    properties: {\r",
									"      compCode: { type: \"string\", minLength: 1 },\r",
									"      codeType: { type: \"string\", minLength: 1 },\r",
									"      closePrc: { type: \"string\" },\r",
									"      limmitUp: { type: \"string\" },\r",
									"      limmitDown: { type: \"string\" },\r",
									"      noLimit: { type: \"string\" },\r",
									"      margin: { type: [\"string\", \"null\"] },\r",
									"      // Accept either key variant for Arabic & English names\r",
									"      cmparbName: { type: \"string\" },\r",
									"      cmpArbName: { type: \"string\" },\r",
									"      cmpengName: { type: \"string\" },\r",
									"      cmpEngName: { type: \"string\" }\r",
									"    },\r",
									"    anyOf: [\r",
									"      { required: [\"cmparbName\"] },\r",
									"      { required: [\"cmpArbName\"] }\r",
									"    ],\r",
									"    // and also require at least one of English name variants\r",
									"    allOf: [{\r",
									"      anyOf: [\r",
									"        { required: [\"cmpengName\"] },\r",
									"        { required: [\"cmpEngName\"] }\r",
									"      ]\r",
									"    }]\r",
									"  };\r",
									"\r",
									"  const failures = [];\r",
									"  comps.forEach((c, i) => {\r",
									"    if (!tv4.validate(c, compSchema)) {\r",
									"      failures.push({ index: i, compCode: c.compCode, error: tv4.error });\r",
									"    }\r",
									"  });\r",
									"  pm.expect(failures, \"Schema violations\").to.eql([]); // will print failures if any\r",
									"  if (failures.length) console.log(\"Schema failures:\", failures);\r",
									"});\r",
									"\r",
									"// ---------- Save for chaining ----------\r",
									"pm.test(\"Store comps meta to environment\", function () {\r",
									"  pm.environment.set(\"COMPS_COUNT\", String(comps.length));\r",
									"  const codes = comps.map(c => c.compCode).filter(Boolean);\r",
									"  pm.environment.set(\"COMPS_CODES\", JSON.stringify(codes));\r",
									"  pm.environment.set(\"COMPS_FIRST_CODE\", comps[0] ? String(comps[0].compCode || \"\") : \"\");\r",
									"  // Map code -> closePrc (string), handy for later checks\r",
									"  const priceMap = {};\r",
									"  comps.forEach(c => { if (c.compCode) priceMap[c.compCode] = String(c.closePrc || \"\"); });\r",
									"  pm.environment.set(\"COMPS_PRICE_MAP\", JSON.stringify(priceMap));\r",
									"});\r",
									"\r",
									"// ---------- Diagnostics ----------\r",
									"console.log(`✅ GET_COMPS validated. count=${comps.length}, minRequired=${minComps}`);\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "GET",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "    {\r\n        \"Srv\": \"GET_COMPS\",\r\n        \"Message\": {},\r\n        \"Version\": \"1.0\",\r\n        \"AppId\": \"WEB_ORDERS.25\",\r\n        \"LstLogin\": \"08-07-2015\"\r\n    }",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{BaseURL}}{{Oracle19}}",
							"host": [
								"{{BaseURL}}{{Oracle19}}"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "4. Preferred Companies",
			"item": [
				{
					"name": "Preferred Companies",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"/**\r",
									" * PREFERRED_COMPANIES – Positive contract & deep validation\r",
									" * - HTTP 200 (business req)\r",
									" * - responseStatus.* == \"0\", source=\"PREFERRED_COMPANIES\"\r",
									" * - Parse preferredCompanies.comps (string or array)\r",
									" * - Count >= MIN_PREFS (env/global; default 1)\r",
									" * - Code format: /^[A-Z0-9]{3,6}$/ ; no duplicates\r",
									" * - Cross-check: every preferred code exists in GET_COMPS (env COMPS_CODES), if available\r",
									" * - Save PREF_CODES & PREF_COUNT to env\r",
									" * - Visualizer shows details + mismatches\r",
									" */\r",
									"\r",
									"pm.test(\"HTTP 200\", () => pm.response.to.have.status(200));\r",
									"\r",
									"pm.test(\"Content-Type is JSON\", function () {\r",
									"  pm.response.to.have.header(\"Content-Type\");\r",
									"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
									"});\r",
									"\r",
									"let json;\r",
									"pm.test(\"Body is valid JSON\", function () {\r",
									"  json = pm.response.json();\r",
									"  pm.expect(json).to.be.an(\"object\");\r",
									"});\r",
									"\r",
									"// ---- Envelope ----\r",
									"pm.test(\"responseStatus OK (PREFERRED_COMPANIES)\", function () {\r",
									"  const rs = json.responseStatus || {};\r",
									"  pm.expect(rs.resCode).to.eql(\"0\");\r",
									"  pm.expect(rs.resDesc).to.eql(\"Successful Operation\");\r",
									"  pm.expect(rs.source).to.eql(\"PREFERRED_COMPANIES\");\r",
									"  pm.expect(rs.resCode1).to.eql(\"0\");\r",
									"  pm.expect(rs.resDesc1).to.eql(\"Successful Operation\");\r",
									"});\r",
									"\r",
									"// ---- Extract & normalize comps ----\r",
									"function parsePreferred(payload) {\r",
									"  const node = (((payload || {}).message || {}).preferredCompanies || {}).comps;\r",
									"  if (Array.isArray(node)) {\r",
									"    return node.map(String).map(s => s.trim()).filter(Boolean);\r",
									"  }\r",
									"  if (typeof node === \"string\") {\r",
									"    return node.split(\",\").map(s => s.trim()).filter(Boolean);\r",
									"  }\r",
									"  return [];\r",
									"}\r",
									"\r",
									"const prefCodes = parsePreferred(json);\r",
									"const minPrefs = Number(pm.environment.get(\"MIN_PREFS\") || pm.globals.get(\"MIN_PREFS\") || 1);\r",
									"\r",
									"pm.test(`Preferred codes array length >= ${minPrefs}`, function () {\r",
									"  pm.expect(prefCodes.length, `Expected at least ${minPrefs} preferred codes`).to.be.at.least(minPrefs);\r",
									"});\r",
									"\r",
									"// ---- Format & duplicates ----\r",
									"pm.test(\"All codes well-formed (A–Z0–9, length 3–6)\", function () {\r",
									"  const bad = prefCodes.filter(c => !/^[A-Z0-9]{3,6}$/.test(c));\r",
									"  pm.expect(bad, `Bad codes: ${bad.join(\", \")}`).to.eql([]);\r",
									"});\r",
									"\r",
									"pm.test(\"No duplicate preferred codes\", function () {\r",
									"  const seen = new Set(), dups = [];\r",
									"  prefCodes.forEach(c => (seen.has(c) ? dups.push(c) : seen.add(c)));\r",
									"  pm.expect(dups, `Duplicates: ${[...new Set(dups)].join(\", \")}`).to.eql([]);\r",
									"});\r",
									"\r",
									"// ---- Cross-API consistency with GET_COMPS (if available) ----\r",
									"pm.test(\"All preferred codes exist in GET_COMPS (when COMPS_CODES is available)\", function () {\r",
									"  let compsCodes = [];\r",
									"  try {\r",
									"    compsCodes = JSON.parse(pm.environment.get(\"COMPS_CODES\") || \"[]\");\r",
									"  } catch (e) {\r",
									"    // if parsing fails, we just skip the strict check\r",
									"  }\r",
									"  if (Array.isArray(compsCodes) && compsCodes.length > 0) {\r",
									"    const missing = prefCodes.filter(c => !compsCodes.includes(c));\r",
									"    pm.expect(missing, `Codes not found in GET_COMPS: ${missing.join(\", \")}`).to.eql([]);\r",
									"  } else {\r",
									"    console.warn(\"COMPS_CODES not found in env — membership check skipped.\");\r",
									"  }\r",
									"});\r",
									"\r",
									"// ---- Optional schema (minimal) ----\r",
									"pm.test(\"Schema (minimal) validates\", function () {\r",
									"  const schema = {\r",
									"    type: \"object\",\r",
									"    required: [\"responseStatus\", \"message\"],\r",
									"    properties: {\r",
									"      responseStatus: {\r",
									"        type: \"object\",\r",
									"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
									"        properties: {\r",
									"          resCode:  { const: \"0\" },\r",
									"          resDesc:  { const: \"Successful Operation\" },\r",
									"          source:   { const: \"PREFERRED_COMPANIES\" },\r",
									"          resCode1: { const: \"0\" },\r",
									"          resDesc1: { const: \"Successful Operation\" }\r",
									"        }\r",
									"      },\r",
									"      message: {\r",
									"        type: \"object\",\r",
									"        required: [\"preferredCompanies\"],\r",
									"        properties: {\r",
									"          preferredCompanies: {\r",
									"            type: \"object\",\r",
									"            required: [\"comps\"],\r",
									"            properties: {\r",
									"              comps: { anyOf: [{ type: \"string\" }, { type: \"array\", items: { type: \"string\"} }] }\r",
									"            }\r",
									"          }\r",
									"        }\r",
									"      }\r",
									"    }\r",
									"  };\r",
									"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
									"});\r",
									"\r",
									"// ---- Save to env for chaining ----\r",
									"pm.environment.set(\"PREF_CODES\", JSON.stringify(prefCodes));\r",
									"pm.environment.set(\"PREF_COUNT\", String(prefCodes.length));\r",
									"\r",
									"// ---- Visualizer: show list & GET_COMPS membership ----\r",
									"(function render() {\r",
									"  let compsCodes = [];\r",
									"  try { compsCodes = JSON.parse(pm.environment.get(\"COMPS_CODES\") || \"[]\"); } catch(e) {}\r",
									"\r",
									"  const rows = prefCodes.map((code, idx) => ({\r",
									"    index: idx + 1,\r",
									"    code,\r",
									"    inGetComps: (Array.isArray(compsCodes) && compsCodes.includes(code)) ? \"Yes\" : \"No\"\r",
									"  }));\r",
									"\r",
									"  const template = `\r",
									"  <style>\r",
									"    .tftable {font-family:system-ui,Segoe UI,Roboto,Arial; font-size:14px; color:#333; width:100%; border-collapse:collapse}\r",
									"    .tftable th, .tftable td {border:1px solid #87ceeb; padding:8px; text-align:left}\r",
									"    .tftable th {background:#87ceeb}\r",
									"    .bad {background:#ffe6e6}\r",
									"  </style>\r",
									"  <h3>PREFERRED_COMPANIES</h3>\r",
									"  <p><b>Total:</b> {{count}} {{#hasMin}}(min required: {{min}}){{/hasMin}}</p>\r",
									"  <table class=\"tftable\">\r",
									"    <thead><tr><th>#</th><th>Code</th><th>In GET_COMPS?</th></tr></thead>\r",
									"    <tbody>\r",
									"      {{#rows}}\r",
									"        <tr class=\"{{#isBad}}bad{{/isBad}}\">\r",
									"          <td>{{index}}</td>\r",
									"          <td>{{code}}</td>\r",
									"          <td>{{inGetComps}}</td>\r",
									"        </tr>\r",
									"      {{/rows}}\r",
									"    </tbody>\r",
									"  </table>\r",
									"  {{#missing.length}}\r",
									"    <p style=\"color:#b00020\"><b>Missing in GET_COMPS:</b> {{missingCSV}}</p>\r",
									"  {{/missing.length}}\r",
									"  `;\r",
									"\r",
									"  const missing = rows.filter(r => r.inGetComps === \"No\").map(r => r.code);\r",
									"  const data = {\r",
									"    rows: rows.map(r => Object.assign({}, r, { isBad: r.inGetComps === \"No\" })),\r",
									"    count: prefCodes.length,\r",
									"    min: minPrefs,\r",
									"    hasMin: true,\r",
									"    missing,\r",
									"    missingCSV: missing.join(\", \")\r",
									"  };\r",
									"\r",
									"  pm.visualizer.set(template, data);\r",
									"})();\r",
									"\r",
									"console.log(`✅ PREFERRED_COMPANIES validated. count=${prefCodes.length}, min=${minPrefs}`);\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Ensure NIN and SessionID are set before making the request\r",
									"if (!pm.variables.get(\"NIN\")) {\r",
									"    pm.environment.set(\"NIN\", \"PLACEHOLDER_NIN\"); // Set a default NIN if not already set\r",
									"    console.warn(\"NIN was missing! A default value has been set.\");\r",
									"}\r",
									"\r",
									"if (!pm.variables.get(\"SessionID\")) {\r",
									"    pm.environment.set(\"SessionID\", \"PLACEHOLDER_SESSION_ID\"); // Set a placeholder session ID\r",
									"    console.warn(\"SessionID was missing! A placeholder value has been set.\");\r",
									"}\r",
									"\r",
									"// Log current values\r",
									"console.log(\"NIN:\", pm.variables.get(\"NIN\"));\r",
									"console.log(\"SessionID:\", pm.variables.get(\"SessionID\"));\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"Srv\": \"PREFERRED_COMPANIES\",\r\n    \"Message\": {\r\n        \"CompaniesRequest\": {\r\n            \"NIN\": \"{{NIN}}\"\r\n        }\r\n    },\r\n    \"Version\": \"1.0\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"25-02-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}\r\n/*{\r\n    \"Srv\": \"PREFERRED_COMPANIES\",\r\n    \"Message\": {\r\n        \"companiesRequest\": {\r\n            \"userId\": \"80509\",\r\n            \"userType\": \"CUSTOMER\",\r\n            \"lang\": \"ARB\",\r\n            \"NIN\": \"{{NIN}}\"\r\n        }\r\n    },\r\n    \"Lang\": \"en\",\r\n    \"sessionId\": \"{{SessionID}}\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"25-02-2025\",\r\n    \"Version\": \"1\"\r\n}\r\n*/",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{BaseURL}}{{Oracle19}}",
							"host": [
								"{{BaseURL}}{{Oracle19}}"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "5. CustomerAssets",
			"item": [
				{
					"name": "CustomerAssets - Normal",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"/**\r",
									" * CustomerAssets – Normal NIN Tests (Postman-compatible)\r",
									" * Works in Postman Sandbox (no console.table)\r",
									" */\r",
									"\r",
									"pm.test(\"HTTP 200 & JSON\", function () {\r",
									"  pm.response.to.have.status(200);\r",
									"  pm.response.to.have.header(\"Content-Type\");\r",
									"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
									"});\r",
									"\r",
									"let json;\r",
									"pm.test(\"Response is valid JSON\", function () {\r",
									"  json = pm.response.json();\r",
									"  pm.expect(json).to.be.an(\"object\");\r",
									"});\r",
									"\r",
									"// ---------- Helpers ----------\r",
									"const isYN = v => v === \"Y\" || v === \"N\";\r",
									"const isNumericStr = v => typeof v === \"string\" && /^-?\\d+(\\.\\d+)?$/.test(v);\r",
									"const isIntStr = v => typeof v === \"string\" && /^-?\\d+$/.test(v);\r",
									"const get = (obj, path) => path.split(\".\").reduce((o, k) => (o && k in o ? o[k] : undefined), obj);\r",
									"\r",
									"// ---------- Base structure ----------\r",
									"pm.test(\"responseStatus base fields OK\", function () {\r",
									"  const rs = json.responseStatus || {};\r",
									"  pm.expect(rs.resCode).to.eql(\"0\");\r",
									"  pm.expect(rs.resDesc).to.eql(\"Successful Operation\");\r",
									"  pm.expect(rs.source).to.eql(\"CustomerAssets\");\r",
									"  pm.expect(rs.resCode1).to.eql(\"0\");\r",
									"  pm.expect(rs.resDesc1).to.eql(\"Successful Operation\");\r",
									"});\r",
									"\r",
									"pm.test(\"message.custAssetRes exists\", function () {\r",
									"  pm.expect(get(json, \"message.custAssetRes\")).to.be.an(\"object\");\r",
									"});\r",
									"\r",
									"// ---------- Common fields ----------\r",
									"pm.test(\"Common numeric-string fields present & valid\", function () {\r",
									"  const r = get(json, \"message.custAssetRes\");\r",
									"  pm.expect(isIntStr(r.minDiscloseVolume)).to.be.true;\r",
									"  pm.expect(isNumericStr(r.currentBal)).to.be.true;\r",
									"  pm.expect(isNumericStr(r.buyBal)).to.be.true;\r",
									"  pm.expect(Number(r.minDiscloseVolume)).to.be.at.least(0);\r",
									"  pm.expect(Number(r.currentBal)).to.be.at.least(0);\r",
									"  pm.expect(Number(r.buyBal)).to.be.at.least(0);\r",
									"  pm.expect(isNumericStr(r.fundCredit)).to.be.true;\r",
									"  pm.expect(Number(r.fundCredit)).to.be.at.least(0);\r",
									"  pm.expect(r.fundErrorCode).to.be.a(\"string\");\r",
									"  pm.expect(r.fundMsg).to.be.a(\"string\").and.not.empty;\r",
									"});\r",
									"\r",
									"// ---------- Normal-specific ----------\r",
									"pm.test(\"Normal account fundInfo only has isFundClient='N'\", function () {\r",
									"  const fi = get(json, \"message.custAssetRes.fundInfo\");\r",
									"  pm.expect(fi).to.be.an(\"object\");\r",
									"  pm.expect(fi.isFundClient).to.eql(\"N\");\r",
									"});\r",
									"\r",
									"pm.test(\"Normal account fundErrorCode/message indicate non-margin\", function () {\r",
									"  const r = get(json, \"message.custAssetRes\");\r",
									"  pm.expect(r.fundErrorCode).to.eql(\"0\");\r",
									"  pm.expect(r.fundMsg).to.eql(\"OK\");\r",
									"});\r",
									"\r",
									"// ---------- Cross-field sanity ----------\r",
									"pm.test(\"Buy balance sanity for normal account\", function () {\r",
									"  const r = get(json, \"message.custAssetRes\");\r",
									"  const available = Number(r.currentBal) + Number(r.fundCredit);\r",
									"  pm.expect(Number(r.buyBal)).to.be.at.most(available);\r",
									"});\r",
									"\r",
									"// ---------- Optional: JSON Schema ----------\r",
									"pm.test(\"Schema (loose) validates\", function () {\r",
									"  const schema = {\r",
									"    type: \"object\",\r",
									"    required: [\"responseStatus\", \"message\"],\r",
									"    properties: {\r",
									"      responseStatus: {\r",
									"        type: \"object\",\r",
									"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
									"        properties: {\r",
									"          resCode: { type: \"string\" },\r",
									"          resDesc: { type: \"string\" },\r",
									"          source:  { type: \"string\" },\r",
									"          resCode1:{ type: \"string\" },\r",
									"          resDesc1:{ type: \"string\" }\r",
									"        }\r",
									"      },\r",
									"      message: {\r",
									"        type: \"object\",\r",
									"        required: [\"custAssetRes\"],\r",
									"        properties: {\r",
									"          custAssetRes: {\r",
									"            type: \"object\",\r",
									"            required: [\"minDiscloseVolume\",\"currentBal\",\"buyBal\",\"fundInfo\",\"fundCredit\",\"fundErrorCode\",\"fundMsg\"],\r",
									"            properties: {\r",
									"              minDiscloseVolume: { type: \"string\" },\r",
									"              currentBal: { type: \"string\" },\r",
									"              buyBal: { type: \"string\" },\r",
									"              fundInfo: {\r",
									"                type: \"object\",\r",
									"                required: [\"isFundClient\"],\r",
									"                properties: { isFundClient: { const: \"N\" } }\r",
									"              },\r",
									"              fundCredit: { type: \"string\" },\r",
									"              fundErrorCode: { const: \"0\" },\r",
									"              fundMsg: { const: \"OK\" }\r",
									"            }\r",
									"          }\r",
									"        }\r",
									"      }\r",
									"    }\r",
									"  };\r",
									"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
									"});\r",
									"\r",
									"// ---------- Simple console output (safe) ----------\r",
									"console.log(\"✅ CustomerAssets Normal NIN\");\r",
									"console.log(\"NIN:\", pm.environment.get(\"NIN\"));\r",
									"console.log(\"SessionID:\", pm.environment.get(\"SessionID\"));\r",
									"console.log(\r",
									"  \"minDiscloseVolume:\", get(json,\"message.custAssetRes.minDiscloseVolume\"),\r",
									"  \"| currentBal:\", get(json,\"message.custAssetRes.currentBal\"),\r",
									"  \"| buyBal:\", get(json,\"message.custAssetRes.buyBal\"),\r",
									"  \"| fundCredit:\", get(json,\"message.custAssetRes.fundCredit\"),\r",
									"  \"| fundErrorCode:\", get(json,\"message.custAssetRes.fundErrorCode\"),\r",
									"  \"| fundMsg:\", get(json,\"message.custAssetRes.fundMsg\")\r",
									");\r",
									"\r",
									"// Verify Content-Type header is 'application/json'\r",
									"pm.test(\"Content-Type header is 'application/json'\", function () {\r",
									"    pm.expect(pm.response.headers.get(\"Content-Type\")).to.include(\"application/json\");\r",
									"});"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "POST",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"Srv\": \"CustomerAssets\",\r\n    \"Message\": {\r\n        \"CustReq\": {\r\n            \"NIN\": \"80509\",\r\n            \"UserId\": \"80509\",\r\n            \"UserType\": \"INVESTOR\",\r\n            \"Lang\": \"ARB\",\r\n            \"IsAddBuyBal\": \"F\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"30-04-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{BaseURL}}{{Oracle19}}",
							"host": [
								"{{BaseURL}}{{Oracle19}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "CustomerAssets - Margin",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"/**\r",
									" * CustomerAssets – Margin NIN Tests (Postman-compatible)\r",
									" * Assumes fundInfo.isFundClient === \"Y\"\r",
									" */\r",
									"\r",
									"pm.test(\"HTTP 200 & JSON\", function () {\r",
									"  pm.response.to.have.status(200);\r",
									"  pm.response.to.have.header(\"Content-Type\");\r",
									"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
									"});\r",
									"\r",
									"let json;\r",
									"pm.test(\"Response is valid JSON\", function () {\r",
									"  json = pm.response.json();\r",
									"  pm.expect(json).to.be.an(\"object\");\r",
									"});\r",
									"\r",
									"// ---------- Helpers ----------\r",
									"const isYN = v => v === \"Y\" || v === \"N\";\r",
									"const isNumericStr = v => typeof v === \"string\" && /^-?\\d+(\\.\\d+)?$/.test(v);\r",
									"const isIntStr = v => typeof v === \"string\" && /^-?\\d+$/.test(v);\r",
									"const get = (obj, path) => path.split(\".\").reduce((o, k) => (o && k in o ? o[k] : undefined), obj);\r",
									"\r",
									"// ---------- Base structure ----------\r",
									"pm.test(\"responseStatus base fields OK\", function () {\r",
									"  const rs = json.responseStatus || {};\r",
									"  pm.expect(rs.resCode, \"resCode\").to.eql(\"0\");\r",
									"  pm.expect(rs.resDesc, \"resDesc\").to.eql(\"Successful Operation\");\r",
									"  pm.expect(rs.source, \"source\").to.eql(\"CustomerAssets\");\r",
									"  pm.expect(rs.resCode1, \"resCode1\").to.eql(\"0\");\r",
									"  pm.expect(rs.resDesc1, \"resDesc1\").to.eql(\"Successful Operation\");\r",
									"});\r",
									"\r",
									"pm.test(\"message.custAssetRes exists\", function () {\r",
									"  pm.expect(get(json, \"message.custAssetRes\")).to.be.an(\"object\");\r",
									"});\r",
									"\r",
									"// ---------- Common fields ----------\r",
									"pm.test(\"Common numeric-string fields present & valid\", function () {\r",
									"  const r = get(json, \"message.custAssetRes\");\r",
									"  pm.expect(isIntStr(r.minDiscloseVolume), \"minDiscloseVolume integer string\").to.be.true;\r",
									"  pm.expect(isNumericStr(r.currentBal), \"currentBal numeric string\").to.be.true;\r",
									"  pm.expect(isNumericStr(r.buyBal), \"buyBal numeric string\").to.be.true;\r",
									"\r",
									"  pm.expect(Number(r.minDiscloseVolume)).to.be.at.least(0);\r",
									"  pm.expect(Number(r.currentBal)).to.be.at.least(0);\r",
									"  pm.expect(Number(r.buyBal)).to.be.at.least(0);\r",
									"\r",
									"  pm.expect(isNumericStr(r.fundCredit), \"fundCredit numeric string\").to.be.true;\r",
									"  pm.expect(Number(r.fundCredit)).to.be.at.least(0);\r",
									"\r",
									"  pm.expect(r.fundErrorCode, \"fundErrorCode present\").to.be.a(\"string\");\r",
									"  pm.expect(r.fundMsg, \"fundMsg present\").to.be.a(\"string\").and.not.empty;\r",
									"});\r",
									"\r",
									"// ---------- Margin-specific (isFundClient = Y) ----------\r",
									"pm.test(\"Margin fundInfo required fields present & valid\", function () {\r",
									"  const fi = get(json, \"message.custAssetRes.fundInfo\");\r",
									"  pm.expect(fi, \"fundInfo\").to.be.an(\"object\");\r",
									"\r",
									"  pm.expect(fi.isFundClient, \"isFundClient\").to.eql(\"Y\");\r",
									"  pm.expect(isYN(fi.isActiveFundClient), \"isActiveFundClient Y/N\").to.be.true;\r",
									"  pm.expect(isNumericStr(fi.fundDebt), \"fundDebt\").to.be.true;\r",
									"  pm.expect(isNumericStr(fi.fundAvailableCredit), \"fundAvailableCredit\").to.be.true;\r",
									"  pm.expect(isNumericStr(fi.cashBalanceNotCollected), \"cashBalanceNotCollected\").to.be.true;\r",
									"  pm.expect(isNumericStr(fi.fundedAmountInMarket), \"fundedAmountInMarket\").to.be.true;\r",
									"  pm.expect(isNumericStr(fi.creditRatio), \"creditRatio\").to.be.true;\r",
									"  pm.expect(isNumericStr(fi.collectedBalance), \"collectedBalance\").to.be.true;\r",
									"  pm.expect(isNumericStr(fi.actualFunded), \"actualFunded\").to.be.true;\r",
									"  pm.expect(fi.companyCode, \"companyCode exists\").to.be.a(\"string\"); // may be \"\"\r",
									"  pm.expect(isNumericStr(fi.shareAvCredit), \"shareAvCredit\").to.be.true;\r",
									"\r",
									"  pm.expect([\"0\",\"1\",\"2\",\"3\"]).to.include(fi.riskFeesType, \"riskFeesType in allowed set (0/1/2/3)\");\r",
									"  pm.expect(isNumericStr(fi.riskFeesValue), \"riskFeesValue\").to.be.true;\r",
									"\r",
									"  pm.expect(isYN(fi.isFinActive), \"isFinActive Y/N\").to.be.true;\r",
									"  pm.expect(isYN(fi.isFinOrdsActive), \"isFinOrdsActive Y/N\").to.be.true;\r",
									"  pm.expect(isIntStr(fi.finAllowancePeriod), \"finAllowancePeriod int string\").to.be.true;\r",
									"\r",
									"  [\r",
									"    \"fundDebt\",\r",
									"    \"fundAvailableCredit\",\r",
									"    \"cashBalanceNotCollected\",\r",
									"    \"fundedAmountInMarket\",\r",
									"    \"creditRatio\",\r",
									"    \"collectedBalance\",\r",
									"    \"actualFunded\",\r",
									"    \"shareAvCredit\",\r",
									"    \"riskFeesValue\",\r",
									"    \"finAllowancePeriod\"\r",
									"  ].forEach(k => pm.expect(Number(fi[k]), k + \" non-negative\").to.be.at.least(0));\r",
									"});\r",
									"\r",
									"pm.test(\"Margin-specific fundErrorCode indicates margin state and message not 'OK'\", function () {\r",
									"  const r = get(json, \"message.custAssetRes\");\r",
									"  pm.expect(r.fundErrorCode, \"fundErrorCode for margin should not be '0'\").to.not.eql(\"0\");\r",
									"  pm.expect(r.fundMsg, \"fundMsg for margin should not be 'OK'\").to.not.eql(\"OK\");\r",
									"});\r",
									"\r",
									"// ---------- Cross-field sanity checks ----------\r",
									"pm.test(\"Buy balance does not exceed available sources (sanity)\", function () {\r",
									"  const r = get(json, \"message.custAssetRes\");\r",
									"  const fi = r.fundInfo || {};\r",
									"  const available = Number(r.currentBal) + Number(r.fundCredit) + Number(fi.fundAvailableCredit || \"0\");\r",
									"  pm.expect(Number(r.buyBal)).to.be.at.most(available);\r",
									"});\r",
									"\r",
									"// ---------- Optional: JSON Schema (loose) ----------\r",
									"pm.test(\"Schema (loose) validates\", function () {\r",
									"  const schema = {\r",
									"    type: \"object\",\r",
									"    required: [\"responseStatus\", \"message\"],\r",
									"    properties: {\r",
									"      responseStatus: {\r",
									"        type: \"object\",\r",
									"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
									"        properties: {\r",
									"          resCode: { type: \"string\" },\r",
									"          resDesc: { type: \"string\" },\r",
									"          source:  { type: \"string\" },\r",
									"          resCode1:{ type: \"string\" },\r",
									"          resDesc1:{ type: \"string\" }\r",
									"        }\r",
									"      },\r",
									"      message: {\r",
									"        type: \"object\",\r",
									"        required: [\"custAssetRes\"],\r",
									"        properties: {\r",
									"          custAssetRes: {\r",
									"            type: \"object\",\r",
									"            required: [\"minDiscloseVolume\",\"currentBal\",\"buyBal\",\"fundInfo\",\"fundCredit\",\"fundErrorCode\",\"fundMsg\"],\r",
									"            properties: {\r",
									"              minDiscloseVolume: { type: \"string\" },\r",
									"              currentBal: { type: \"string\" },\r",
									"              buyBal: { type: \"string\" },\r",
									"              fundInfo: { type: \"object\" },\r",
									"              fundCredit: { type: \"string\" },\r",
									"              fundErrorCode: { type: \"string\" },\r",
									"              fundMsg: { type: \"string\" }\r",
									"            }\r",
									"          }\r",
									"        }\r",
									"      }\r",
									"    }\r",
									"  };\r",
									"\r",
									"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
									"});\r",
									"\r",
									"// ---------- Simple console output (safe) ----------\r",
									"console.log(\"✅ CustomerAssets Margin NIN\");\r",
									"console.log(\"NIN:\", pm.environment.get(\"NIN\"));\r",
									"console.log(\"SessionID:\", pm.environment.get(\"SessionID\"));\r",
									"console.log(\r",
									"  \"minDiscloseVolume:\", get(json,\"message.custAssetRes.minDiscloseVolume\"),\r",
									"  \"| currentBal:\", get(json,\"message.custAssetRes.currentBal\"),\r",
									"  \"| buyBal:\", get(json,\"message.custAssetRes.buyBal\"),\r",
									"  \"| fundCredit:\", get(json,\"message.custAssetRes.fundCredit\"),\r",
									"  \"| fundErrorCode:\", get(json,\"message.custAssetRes.fundErrorCode\"),\r",
									"  \"| fundMsg:\", get(json,\"message.custAssetRes.fundMsg\")\r",
									");\r",
									"\r",
									"// Verify Content-Type header is 'application/json'\r",
									"pm.test(\"Content-Type header is 'application/json'\", function () {\r",
									"    pm.expect(pm.response.headers.get(\"Content-Type\")).to.include(\"application/json\");\r",
									"});"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "POST",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"Srv\": \"CustomerAssets\",\r\n    \"Message\": {\r\n        \"CustReq\": {\r\n            \"NIN\": \"1218\",\r\n            \"UserId\": \"1218\",\r\n            \"UserType\": \"INVESTOR\",\r\n            \"Lang\": \"ARB\",\r\n            \"IsAddBuyBal\": \"F\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"30-04-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{BaseURL}}{{Oracle19}}",
							"host": [
								"{{BaseURL}}{{Oracle19}}"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "6. Bank Balance",
			"item": [
				{
					"name": "BNKBAL",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"/**\r",
									" * BNKBAL – Bank balances & info (ES5)\r",
									" * Validates:\r",
									" *  - HTTP 200, JSON, envelope codes 0/0, source=\"BNKBAL\"\r",
									" *  - bnkInfoResponse existence and key formats\r",
									" *  - Balance fields are numeric strings; negatives allowed by default (toggle strict)\r",
									" *  - banksInfo.bnkInfoRec / bnkTransfers.bnkTransferRec array shapes\r",
									" *  - financierInfo & fundInfo consistency; creditRatio accepts ratio or percent\r",
									" * Keeps your extracts:\r",
									" *  - accountSeq_i, bnkCode_i, accountCode_i, transferTimeId_i, bankCount\r",
									" *\r",
									" * Optional toggles (Env/Globals):\r",
									" *  - ENFORCE_NON_NEG_BALANCES = Y|N (default N) -> force balances >= 0\r",
									" */\r",
									"\r",
									"// 1) Status code\r",
									"pm.test(\"Status code is 200\", function () {\r",
									"  pm.response.to.have.status(200);\r",
									"});\r",
									"\r",
									"// 2) Envelope base checks\r",
									"pm.test(\"resCode is 0 and resDesc is Successful Operation\", function () {\r",
									"  var resStatus = (pm.response.json() || {}).responseStatus || {};\r",
									"  pm.expect(resStatus.resCode).to.eql(\"0\");\r",
									"  pm.expect(resStatus.resDesc).to.eql(\"Successful Operation\");\r",
									"});\r",
									"\r",
									"// 3) Extract and set bank info (kept as-is)\r",
									"var __json_for_extract = pm.response.json() || {};\r",
									"var __bnkInfoList = ((((__json_for_extract.message || {}).bnkInfoResponse || {}).banksInfo || {}).bnkInfoRec);\r",
									"\r",
									"if (Array.isArray(__bnkInfoList)) {\r",
									"  // Clear previous values\r",
									"  pm.environment.unset(\"bankCount\");\r",
									"\r",
									"  for (var i = 0; i < __bnkInfoList.length; i++) {\r",
									"    var bnk = __bnkInfoList[i] || {};\r",
									"    pm.environment.set(\"accountSeq_\" + (i + 1), String(bnk.accountSeq || \"\"));\r",
									"    pm.environment.set(\"bnkCode_\" + (i + 1), String(bnk.bnkCode || \"\"));\r",
									"    pm.environment.set(\"accountCode_\" + (i + 1), String(bnk.accountCode || \"\"));\r",
									"    pm.environment.set(\"transferTimeId_\" + (i + 1), String(bnk.transferTimeId || \"\"));\r",
									"  }\r",
									"  pm.environment.set(\"bankCount\", String(__bnkInfoList.length));\r",
									"} else {\r",
									"  console.warn(\"banksInfo.bnkInfoRec not found or invalid\");\r",
									"}\r",
									"\r",
									"// Basic header check\r",
									"pm.test(\"Content-Type is JSON\", function () {\r",
									"  pm.response.to.have.header(\"Content-Type\");\r",
									"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
									"});\r",
									"\r",
									"// Parse once & helpers\r",
									"var json = pm.response.json() || {};\r",
									"var rs   = json.responseStatus || {};\r",
									"var bnr  = (json.message || {}).bnkInfoResponse || {};\r",
									"\r",
									"function isNumericStr(v) { return typeof v === \"string\" && /^-?\\d+(\\.\\d+)?$/.test(v); }\r",
									"function isIntStr(v)     { return typeof v === \"string\" && /^-?\\d+$/.test(v); }\r",
									"function isYN(v)         { return v === \"Y\" || v === \"N\"; }\r",
									"\r",
									"// Envelope completeness\r",
									"pm.test(\"Envelope complete (BNKBAL)\", function () {\r",
									"  pm.expect(rs.resCode).to.eql(\"0\");\r",
									"  pm.expect(rs.resDesc).to.eql(\"Successful Operation\");\r",
									"  pm.expect(rs.source).to.eql(\"BNKBAL\");\r",
									"  pm.expect(rs.resCode1).to.eql(\"0\");\r",
									"  pm.expect(rs.resDesc1).to.eql(\"Successful Operation\");\r",
									"});\r",
									"\r",
									"// Core node exists\r",
									"pm.test(\"bnkInfoResponse exists\", function () {\r",
									"  pm.expect(bnr).to.be.an(\"object\");\r",
									"});\r",
									"\r",
									"// Name (if provided)\r",
									"pm.test(\"Customer name (if present) is a non-empty string\", function () {\r",
									"  if (typeof bnr.name !== \"undefined\") {\r",
									"    pm.expect(bnr.name).to.be.a(\"string\").and.to.not.equal(\"\");\r",
									"  }\r",
									"});\r",
									"\r",
									"// Balance fields – allow negatives by default (set ENFORCE_NON_NEG_BALANCES=Y to force >=0)\r",
									"pm.test(\"All balance fields are numeric strings (with optional non-negative enforcement)\", function () {\r",
									"  var keys = [\r",
									"    \"buybal1\",\"currentBal\",\"buyBal\",\"buyBal1\",\"onLineBal1\",\"maxBalance1\",\"unclearedBal\",\r",
									"    \"tradeBal\",\"t3Bal\",\"chqColl\",\"onlineBal\",\"todayDepo\",\"todayDepos\",\"allowedBal\",\r",
									"    \"postponed\",\"reservedFawriBalance\",\"maxbalance\",\"newMaxBalance\"\r",
									"  ];\r",
									"  var enforce = String(pm.environment.get(\"ENFORCE_NON_NEG_BALANCES\") || pm.globals.get(\"ENFORCE_NON_NEG_BALANCES\") || \"N\").toUpperCase() === \"Y\";\r",
									"\r",
									"  for (var i=0;i<keys.length;i++){\r",
									"    var k = keys[i];\r",
									"    if (typeof bnr[k] !== \"undefined\") {\r",
									"      pm.expect(isNumericStr(bnr[k]), k + \" must be numeric string\").to.be.true;\r",
									"      if (enforce) {\r",
									"        pm.expect(Number(bnr[k]), k + \" must be >= 0 (strict mode)\").to.be.at.least(0);\r",
									"      }\r",
									"    }\r",
									"  }\r",
									"});\r",
									"\r",
									"// banksInfo array and each record format\r",
									"pm.test(\"banksInfo.bnkInfoRec is array (can be empty)\", function () {\r",
									"  var arr = (((bnr || {}).banksInfo || {}).bnkInfoRec);\r",
									"  pm.expect(arr, \"bnkInfoRec\").to.be.an(\"array\");\r",
									"});\r",
									"\r",
									"(function validateBankRecords(){\r",
									"  var arr = (((bnr || {}).banksInfo || {}).bnkInfoRec) || [];\r",
									"  if (!Array.isArray(arr) || arr.length === 0) return;\r",
									"\r",
									"  for (var i=0;i<arr.length;i++){\r",
									"    var rec = arr[i] || {};\r",
									"\r",
									"    pm.expect(String(rec.accountSeq || \"\"), \"accountSeq\").to.match(/^\\d+$/);\r",
									"    if (typeof rec.bankCode !== \"undefined\") {\r",
									"      pm.expect(String(rec.bankCode), \"bankCode\").to.match(/^[A-Z]{2,5}$/);\r",
									"    }\r",
									"    pm.expect(String(rec.bnkCode || \"\"), \"bnkCode (SWIFT/BIC)\").to.match(/^[A-Z0-9]{8}([A-Z0-9]{3})?$/);\r",
									"    pm.expect(rec.bnkName, \"bnkName\").to.be.a(\"string\").and.not.empty;\r",
									"    pm.expect(rec.accountCode, \"accountCode\").to.be.a(\"string\").and.not.empty;\r",
									"\r",
									"    if (typeof rec.accountType !== \"undefined\") {\r",
									"      pm.expect([\"BOTH\",\"DEBIT\",\"CREDIT\"], \"accountType\").to.include(String(rec.accountType));\r",
									"    }\r",
									"\r",
									"    // status\r",
									"    pm.expect(String(rec.accountStatus || \"\"), \"accountStatus\").to.match(/^\\d+$/);\r",
									"    pm.expect(rec.accountStatusDesc, \"accountStatusDesc\").to.be.a(\"string\").and.not.empty;\r",
									"\r",
									"    if (typeof rec.isSahlPlus !== \"undefined\") {\r",
									"      pm.expect(isYN(String(rec.isSahlPlus)), \"isSahlPlus\").to.be.true;\r",
									"    }\r",
									"\r",
									"    // transferTimeId can be long token; just ensure string & non-empty\r",
									"    pm.expect(rec.transferTimeId, \"transferTimeId\").to.be.a(\"string\").and.not.empty;\r",
									"  }\r",
									"})();\r",
									"\r",
									"// bnkTransfers shape\r",
									"pm.test(\"bnkTransfers.bnkTransferRec is array (may be empty)\", function () {\r",
									"  var tr = (((bnr || {}).bnkTransfers || {}).bnkTransferRec);\r",
									"  pm.expect(tr, \"bnkTransferRec\").to.be.an(\"array\");\r",
									"});\r",
									"\r",
									"// financierInfo (if present)\r",
									"pm.test(\"financierInfo (if present) has valid fields\", function () {\r",
									"  var fi = bnr.financierInfo;\r",
									"  if (fi && typeof fi === \"object\") {\r",
									"    if (typeof fi.financierID !== \"undefined\") pm.expect(String(fi.financierID)).to.match(/^\\d+$/);\r",
									"    if (typeof fi.isActive !== \"undefined\") pm.expect(isYN(String(fi.isActive))).to.be.true;\r",
									"    if (typeof fi.isOrdersEnabled !== \"undefined\") pm.expect(isYN(String(fi.isOrdersEnabled))).to.be.true;\r",
									"    if (typeof fi.riskFeesType !== \"undefined\") pm.expect([\"0\",\"1\",\"2\",\"3\"]).to.include(String(fi.riskFeesType));\r",
									"    if (typeof fi.riskFeesValue !== \"undefined\") {\r",
									"      pm.expect(isNumericStr(String(fi.riskFeesValue))).to.be.true;\r",
									"      pm.expect(Number(fi.riskFeesValue)).to.be.at.least(0);\r",
									"    }\r",
									"    if (typeof fi.financierAllowancePeriod !== \"undefined\") {\r",
									"      pm.expect(isIntStr(String(fi.financierAllowancePeriod))).to.be.true;\r",
									"      pm.expect(Number(fi.financierAllowancePeriod)).to.be.at.least(0);\r",
									"    }\r",
									"  }\r",
									"});\r",
									"\r",
									"// fundInfo (margin block; can be N or Y)\r",
									"pm.test(\"fundInfo (if present) is consistent\", function () {\r",
									"  var f = bnr.fundInfo;\r",
									"  if (f && typeof f === \"object\") {\r",
									"    pm.expect(isYN(String(f.isFundClient)), \"isFundClient Y/N\").to.be.true;\r",
									"\r",
									"    if (f.isFundClient === \"Y\") {\r",
									"      var numKeys = [\r",
									"        \"fundDebt\",\"fundAvailableCredit\",\"cashBalanceNotCollected\",\"fundedAmountInMarket\",\r",
									"        \"creditRatio\",\"collectedBalance\",\"actualFunded\",\"shareAvCredit\"\r",
									"      ];\r",
									"      for (var i=0;i<numKeys.length;i++){\r",
									"        var k = numKeys[i];\r",
									"        pm.expect(isNumericStr(String(f[k])), \"fundInfo.\"+k+\" numeric string\").to.be.true;\r",
									"        // All provided examples for these are >= 0\r",
									"        pm.expect(Number(f[k]), \"fundInfo.\"+k+\" >= 0\").to.be.at.least(0);\r",
									"      }\r",
									"\r",
									"      // creditRatio sanity: accept ratio [0..1] OR percent [0..100]\r",
									"      if (typeof f.creditRatio !== \"undefined\") {\r",
									"        var cr = Number(f.creditRatio);\r",
									"        if (cr > 1) {\r",
									"          pm.expect(cr, \"creditRatio% in [0, 100]\").to.be.at.least(0).and.at.most(100);\r",
									"          pm.environment.set(\"CREDIT_RATIO\", String(cr / 100));   // normalized 0..1\r",
									"          pm.environment.set(\"CREDIT_RATIO_PCT\", String(cr));     // as percent\r",
									"        } else {\r",
									"          pm.expect(cr, \"creditRatio in [0, 1]\").to.be.at.least(0).and.at.most(1);\r",
									"          pm.environment.set(\"CREDIT_RATIO\", String(cr));         // normalized 0..1\r",
									"          pm.environment.set(\"CREDIT_RATIO_PCT\", String(cr * 100)); // as percent\r",
									"        }\r",
									"      }\r",
									"\r",
									"      if (typeof f.isActiveFundClient !== \"undefined\") pm.expect(isYN(String(f.isActiveFundClient))).to.be.true;\r",
									"    }\r",
									"  }\r",
									"});\r",
									"\r",
									"// resType should reflect request's AccRegisterType (when provided)\r",
									"pm.test(\"resType matches AccRegisterType from request (when provided)\", function () {\r",
									"  var reqBody;\r",
									"  try { reqBody = pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {}; } catch(e){}\r",
									"  var accType = (((reqBody || {}).Message || {}).BalDlsRequest || {}).AccRegisterType;\r",
									"  if (accType) {\r",
									"    pm.expect(bnr.resType, \"resType\").to.eql(String(accType));\r",
									"  }\r",
									"});\r",
									"\r",
									"// Guardrails: request Srv should be BNKBAL\r",
									"pm.test(\"Request Srv is BNKBAL\", function () {\r",
									"  var reqBody;\r",
									"  try { reqBody = pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {}; } catch(e){}\r",
									"  pm.expect((reqBody || {}).Srv).to.eql(\"BNKBAL\");\r",
									"});\r",
									"\r",
									"// Minimal schema (tv4)\r",
									"pm.test(\"Schema (minimal) validates\", function () {\r",
									"  var schema = {\r",
									"    type: \"object\",\r",
									"    required: [\"responseStatus\",\"message\"],\r",
									"    properties: {\r",
									"      responseStatus: {\r",
									"        type: \"object\",\r",
									"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
									"        properties: {\r",
									"          resCode:  { \"const\": \"0\" },\r",
									"          resDesc:  { \"const\": \"Successful Operation\" },\r",
									"          source:   { \"const\": \"BNKBAL\" },\r",
									"          resCode1: { \"const\": \"0\" },\r",
									"          resDesc1: { \"const\": \"Successful Operation\" }\r",
									"        }\r",
									"      },\r",
									"      message: {\r",
									"        type: \"object\",\r",
									"        required: [\"bnkInfoResponse\"],\r",
									"        properties: {\r",
									"          bnkInfoResponse: { type: \"object\" }\r",
									"        }\r",
									"      }\r",
									"    }\r",
									"  };\r",
									"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
									"});\r",
									"\r",
									"// Extra: store a few more env helpers (without touching your extract keys)\r",
									"(function storeExtras(){\r",
									"  var arr = (((bnr || {}).banksInfo || {}).bnkInfoRec) || [];\r",
									"  if (arr.length > 0) {\r",
									"    pm.environment.set(\"firstBankCode\", String(arr[0].bankCode || \"\"));\r",
									"    pm.environment.set(\"firstBankSwift\", String(arr[0].bnkCode || \"\"));\r",
									"    pm.environment.set(\"firstAccountStatus\", String(arr[0].accountStatus || \"\"));\r",
									"  }\r",
									"  pm.environment.set(\"bnkTransfersCount\", String(((((bnr || {}).bnkTransfers || {}).bnkTransferRec) || []).length));\r",
									"})();\r",
									"\r",
									"console.log(\"✅ BNKBAL validated.\",\r",
									"            \"bankCount:\", pm.environment.get(\"bankCount\"),\r",
									"            \"transfers:\", pm.environment.get(\"bnkTransfersCount\"),\r",
									"            \"creditRatio(norm):\", pm.environment.get(\"CREDIT_RATIO\"),\r",
									"            \"creditRatio(%) \", pm.environment.get(\"CREDIT_RATIO_PCT\"));\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "POST",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"Srv\": \"BNKBAL\",\r\n    \"Message\": {\r\n        \"BalDlsRequest\": {\r\n            \"NIN\": \"{{NIN}}\",\r\n            \"UserId\": \"{{UserID}}\",\r\n            \"UserType\": \"INVESTOR\",\r\n            \"AccRegisterType\": \"ALL\",\r\n            \"Lang\": \"ARB\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"30-04-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}\r\n\r\n\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{BaseURL}}{{Oracle19}}",
							"host": [
								"{{BaseURL}}{{Oracle19}}"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "7. Manage Contact Allowance",
			"item": [
				{
					"name": "Manage Contact Allowance",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"/**\r",
									" * MARGIN_CONTACT_ALLOWANCE – Success & values validation (ES5)\r",
									" * - HTTP 200 (business req)\r",
									" * - responseStatus.* == \"0\", source=\"MARGIN_CONTACT_ALLOWANCE\"\r",
									" * - message.marginContractAllowanceMessage fields:\r",
									" *    - gracePeriod: e.g., \"1 يوم \" → extract days >= 0\r",
									" *    - maintenanceMargin: \"33.00%\" → 0..100\r",
									" *    - marginPercentage: \"100%\"    → 0..100\r",
									" * - Sanity: marginPercentage >= maintenanceMargin\r",
									" * - Saves: MARGIN_GRACE_DAYS, MAINTENANCE_MARGIN_PCT, MARGIN_PCT\r",
									" */\r",
									"\r",
									"pm.test(\"HTTP 200\", function () {\r",
									"  pm.response.to.have.status(200);\r",
									"});\r",
									"\r",
									"pm.test(\"Content-Type is JSON\", function () {\r",
									"  pm.response.to.have.header(\"Content-Type\");\r",
									"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
									"});\r",
									"\r",
									"// Parse body\r",
									"var json;\r",
									"pm.test(\"Body is valid JSON\", function () {\r",
									"  json = pm.response.json();\r",
									"  pm.expect(json).to.be.an(\"object\");\r",
									"});\r",
									"\r",
									"// Envelope checks\r",
									"pm.test(\"responseStatus OK (MARGIN_CONTACT_ALLOWANCE)\", function () {\r",
									"  var rs = json.responseStatus || {};\r",
									"  pm.expect(rs.resCode, \"resCode\").to.eql(\"0\");\r",
									"  pm.expect(rs.resDesc, \"resDesc\").to.eql(\"Successful Operation\");\r",
									"  pm.expect(rs.source,  \"source\").to.eql(\"MARGIN_CONTACT_ALLOWANCE\");\r",
									"  pm.expect(rs.resCode1,\"resCode1\").to.eql(\"0\");\r",
									"  pm.expect(rs.resDesc1,\"resDesc1\").to.eql(\"Successful Operation\");\r",
									"});\r",
									"\r",
									"// Grab node\r",
									"var msg = (((json || {}).message || {}).marginContractAllowanceMessage) || {};\r",
									"pm.test(\"marginContractAllowanceMessage exists\", function () {\r",
									"  pm.expect(msg).to.be.an(\"object\");\r",
									"  pm.expect(msg).to.have.property(\"gracePeriod\");\r",
									"  pm.expect(msg).to.have.property(\"maintenanceMargin\");\r",
									"  pm.expect(msg).to.have.property(\"marginPercentage\");\r",
									"});\r",
									"\r",
									"// ----- Helpers (ES5) -----\r",
									"function normalizeDigits(s) {\r",
									"  // Convert Arabic-Indic (٠١٢٣٤٥٦٧٨٩) and Extended Arabic-Indic (۰۱۲۳۴۵۶۷۸۹) to ASCII 0-9\r",
									"  if (typeof s !== \"string\") s = String(s || \"\");\r",
									"  return s\r",
									"    .replace(/[\\u0660-\\u0669]/g, function (ch) { return String.fromCharCode(ch.charCodeAt(0) - 0x0660 + 48); })\r",
									"    .replace(/[\\u06F0-\\u06F9]/g, function (ch) { return String.fromCharCode(ch.charCodeAt(0) - 0x06F0 + 48); });\r",
									"}\r",
									"function parsePercentToNumber(s) {\r",
									"  // Accept \"%\", \"٪\", spaces; accept comma/point decimals\r",
									"  s = normalizeDigits(String(s || \"\")).replace(/\\s+/g, \"\");\r",
									"  s = s.replace(/[%\\u066A]/g, \"\"); // remove % and Arabic percent sign\r",
									"  s = s.replace(\",\", \".\"); // decimal comma → dot\r",
									"  var n = parseFloat(s);\r",
									"  return isNaN(n) ? NaN : n;\r",
									"}\r",
									"function extractLeadingInt(s) {\r",
									"  // Extract leading integer from a string like \"1 يوم\"\r",
									"  s = normalizeDigits(String(s || \"\"));\r",
									"  var m = s.match(/^\\s*(\\d+)/);\r",
									"  if (!m) return NaN;\r",
									"  return parseInt(m[1], 10);\r",
									"}\r",
									"\r",
									"// ----- Validate gracePeriod -----\r",
									"pm.test(\"gracePeriod is a non-empty string and days >= 0\", function () {\r",
									"  pm.expect(msg.gracePeriod).to.be.a(\"string\");\r",
									"  pm.expect(msg.gracePeriod.replace(/^\\s+|\\s+$/g, \"\")).to.not.equal(\"\");\r",
									"  var days = extractLeadingInt(msg.gracePeriod);\r",
									"  pm.expect(isNaN(days), \"Could not parse gracePeriod days\").to.eql(false);\r",
									"  pm.expect(days, \"gracePeriod days >= 0\").to.be.at.least(0);\r",
									"  pm.environment.set(\"MARGIN_GRACE_DAYS\", String(days));\r",
									"});\r",
									"\r",
									"// ----- Validate maintenanceMargin -----\r",
									"pm.test(\"maintenanceMargin is a valid percent (0..100)\", function () {\r",
									"  pm.expect(msg.maintenanceMargin).to.be.a(\"string\");\r",
									"  var mm = parsePercentToNumber(msg.maintenanceMargin);\r",
									"  pm.expect(isNaN(mm), \"maintenanceMargin not a number\").to.eql(false);\r",
									"  pm.expect(mm, \"maintenanceMargin in [0,100]\").to.be.at.least(0).and.at.most(100);\r",
									"  pm.environment.set(\"MAINTENANCE_MARGIN_PCT\", String(mm));\r",
									"});\r",
									"\r",
									"// ----- Validate marginPercentage -----\r",
									"pm.test(\"marginPercentage is a valid percent (0..100)\", function () {\r",
									"  pm.expect(msg.marginPercentage).to.be.a(\"string\");\r",
									"  var mp = parsePercentToNumber(msg.marginPercentage);\r",
									"  pm.expect(isNaN(mp), \"marginPercentage not a number\").to.eql(false);\r",
									"  pm.expect(mp, \"marginPercentage in [0,100]\").to.be.at.least(0).and.at.most(100);\r",
									"  pm.environment.set(\"MARGIN_PCT\", String(mp));\r",
									"});\r",
									"\r",
									"// ----- Sanity relation -----\r",
									"pm.test(\"Sanity: marginPercentage ≥ maintenanceMargin\", function () {\r",
									"  var mm = parsePercentToNumber(msg.maintenanceMargin);\r",
									"  var mp = parsePercentToNumber(msg.marginPercentage);\r",
									"  if (!isNaN(mm) && !isNaN(mp)) {\r",
									"    pm.expect(mp, \"Expected marginPercentage ≥ maintenanceMargin\").to.be.at.least(mm);\r",
									"  }\r",
									"});\r",
									"\r",
									"// ----- Minimal schema (tv4) -----\r",
									"pm.test(\"Schema (minimal) validates\", function () {\r",
									"  var schema = {\r",
									"    type: \"object\",\r",
									"    required: [\"responseStatus\",\"message\"],\r",
									"    properties: {\r",
									"      responseStatus: {\r",
									"        type: \"object\",\r",
									"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
									"        properties: {\r",
									"          resCode:  { \"const\": \"0\" },\r",
									"          resDesc:  { \"const\": \"Successful Operation\" },\r",
									"          source:   { \"const\": \"MARGIN_CONTACT_ALLOWANCE\" },\r",
									"          resCode1: { \"const\": \"0\" },\r",
									"          resDesc1: { \"const\": \"Successful Operation\" }\r",
									"        }\r",
									"      },\r",
									"      message: {\r",
									"        type: \"object\",\r",
									"        required: [\"marginContractAllowanceMessage\"],\r",
									"        properties: {\r",
									"          marginContractAllowanceMessage: {\r",
									"            type: \"object\",\r",
									"            required: [\"gracePeriod\",\"maintenanceMargin\",\"marginPercentage\"],\r",
									"            properties: {\r",
									"              gracePeriod:       { type: \"string\" },\r",
									"              maintenanceMargin: { type: \"string\" },\r",
									"              marginPercentage:  { type: \"string\" }\r",
									"            }\r",
									"          }\r",
									"        }\r",
									"      }\r",
									"    }\r",
									"  };\r",
									"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
									"});\r",
									"\r",
									"// Diagnostics\r",
									"console.log(\"✅ MARGIN_CONTACT_ALLOWANCE validated. Saved:\",\r",
									"  \"MARGIN_GRACE_DAYS=\", pm.environment.get(\"MARGIN_GRACE_DAYS\"),\r",
									"  \"MAINTENANCE_MARGIN_PCT=\", pm.environment.get(\"MAINTENANCE_MARGIN_PCT\"),\r",
									"  \"MARGIN_PCT=\", pm.environment.get(\"MARGIN_PCT\")\r",
									");\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"Srv\": \"MARGIN_CONTACT_ALLOWANCE\",\r\n    \"Message\": {\r\n        \"MarginContractAllowanceRequest\": {\r\n            \"nin\": \"{{NIN}}\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"30-04-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{BaseURL}}{{Oracle19}}",
							"host": [
								"{{BaseURL}}{{Oracle19}}"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "8. Manage Alerts",
			"item": [
				{
					"name": "Get Alert",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Parse the response body\r",
									"let response = pm.response.json();\r",
									"\r",
									"// Test 1: Verify the status code is 200\r",
									"pm.test(\"Status Code is 200\", function () {\r",
									"    pm.response.to.have.status(200);\r",
									"});\r",
									"\r",
									"// Test 2: Validate response structure\r",
									"pm.test(\"Response has correct structure\", function () {\r",
									"    pm.expect(response).to.have.property(\"responseStatus\");\r",
									"    pm.expect(response).to.have.property(\"message\");\r",
									"    pm.expect(response.message).to.have.property(\"alertResponseMessage\");\r",
									"    pm.expect(response.message.alertResponseMessage).to.have.property(\"clientAlerts\");\r",
									"    pm.expect(response.message.alertResponseMessage.clientAlerts).to.have.property(\"clientAlert\");\r",
									"});\r",
									"\r",
									"// Test 3: Ensure response status is successful\r",
									"pm.test(\"Operation is successful\", function () {\r",
									"    pm.expect(response.responseStatus).to.have.property(\"resCode\", \"0\");\r",
									"    pm.expect(response.responseStatus).to.have.property(\"resDesc\", \"Successful Operation\");\r",
									"});\r",
									"\r",
									"// Test 4: Check if alerts exist\r",
									"let alerts = response.message.alertResponseMessage.clientAlerts.clientAlert;\r",
									"if (alerts.length === 0) {\r",
									"    pm.test(\"No alerts exist for this NIN\", function () {\r",
									"        pm.expect(alerts).to.be.an('array').that.is.empty;\r",
									"    });\r",
									"} else {\r",
									"    pm.test(\"Alerts exist and are valid\", function () {\r",
									"        pm.expect(alerts).to.be.an('array').that.is.not.empty;\r",
									"\r",
									"        alerts.forEach(alert => {\r",
									"            pm.expect(alert).to.have.property(\"alertId\").that.is.a(\"string\");\r",
									"            pm.expect(alert).to.have.property(\"nin\").that.is.a(\"string\");\r",
									"            pm.expect(alert).to.have.property(\"alertInterestId\").that.is.a(\"string\");\r",
									"            pm.expect(alert).to.have.property(\"interestName\").that.is.a(\"string\");\r",
									"            pm.expect(alert).to.have.property(\"alertCriteriaId\").that.is.a(\"string\");\r",
									"            pm.expect(alert).to.have.property(\"criteriaName\").that.is.a(\"string\");\r",
									"            pm.expect(alert).to.have.property(\"alertStatusCode\").that.is.a(\"string\");\r",
									"            pm.expect(alert).to.have.property(\"statusId\").that.is.a(\"string\");\r",
									"            pm.expect(alert).to.have.property(\"statusName\").that.is.a(\"string\");\r",
									"            pm.expect(alert).to.have.property(\"alertValue\").that.is.a(\"string\");\r",
									"        });\r",
									"    });\r",
									"\r",
									"    // Test 5: Ensure active alerts have a valid status\r",
									"    pm.test(\"Active alerts are in market\", function () {\r",
									"        let activeAlerts = alerts.filter(alert => alert.alertStatusCode === \"PROC\");\r",
									"        activeAlerts.forEach(alert => {\r",
									"            pm.expect(alert.statusName).to.eql(\"IN MARKET\");\r",
									"        });\r",
									"    });\r",
									"\r",
									"    // Test 6: Ensure canceled alerts are correctly marked\r",
									"    pm.test(\"Canceled alerts are marked correctly\", function () {\r",
									"        let canceledAlerts = alerts.filter(alert => alert.alertStatusCode === \"CAN\");\r",
									"        canceledAlerts.forEach(alert => {\r",
									"            pm.expect(alert.statusName).to.eql(\"Canceled\");\r",
									"            pm.expect(alert.alertActionDate).to.not.eql(\"--\");\r",
									"        });\r",
									"    });\r",
									"}\r",
									"\r",
									"// Postman Test Script to save alertId and symbolId from Get Alert API\r",
									"pm.test(\"Extract alertId, symbolId and save to environment variables\", function () {\r",
									"    let jsonData = pm.response.json();\r",
									"\r",
									"    // Check if there are any alerts in the response\r",
									"    if (jsonData.message.alertResponseMessage.clientAlerts.clientAlert.length > 0) {\r",
									"        // Save the first alertId and symbolId to environment variables\r",
									"        pm.environment.set(\"alertId\", jsonData.message.alertResponseMessage.clientAlerts.clientAlert[0].alertId);\r",
									"        pm.environment.set(\"symbolId\", jsonData.message.alertResponseMessage.clientAlerts.clientAlert[0].symbolId);\r",
									"        \r",
									"        console.log(\"Saved alertId: \" + jsonData.message.alertResponseMessage.clientAlerts.clientAlert[0].alertId);\r",
									"        console.log(\"Saved symbolId: \" + jsonData.message.alertResponseMessage.clientAlerts.clientAlert[0].symbolId);\r",
									"    } else {\r",
									"        pm.environment.set(\"alertId\", null); // No alerts found\r",
									"        pm.environment.set(\"symbolId\", null); // No symbolId found\r",
									"        console.log(\"No alerts found.\");\r",
									"    }\r",
									"});\r",
									"\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"Srv\": \"MNGALERT\",\r\n    \"Message\": {\r\n        \"AlertRequest\": {\r\n            \"ReqOpCode\": \"GETDATA\",\r\n            \"ReqAlertNin\": \"{{NIN}}\",\r\n            \"ReqAlertSource\": \"\",\r\n            \"Lang\": \"en\",\r\n            \"UserId\": \"{{NIN}}\",\r\n            \"UserType\": \"INVESTOR\"\r\n        }\r\n    },\r\n    \"Version\": 1,\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"2025-01-07\",\r\n    \"SessionID\": \"{{SessionID}}\"\r\n}\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{BaseURL}}{{Oracle19}}",
							"host": [
								"{{BaseURL}}{{Oracle19}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Add Alert",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Postman Test Script for \"Add Alert\" API\r",
									"pm.test(\"Validate Add Alert Response\", function () {\r",
									"    let jsonData = pm.response.json();\r",
									"    \r",
									"    // Validate response status code\r",
									"    pm.response.to.have.status(200);\r",
									"    \r",
									"    if (jsonData.responseStatus.resCode === \"0\") {\r",
									"        // Successful Alert Addition\r",
									"        pm.expect(jsonData.responseStatus.resDesc).to.eql(\"Successful Operation\");\r",
									"    } else if (jsonData.responseStatus.resCode === \"411\") {\r",
									"        // Alert already exists\r",
									"        pm.expect(jsonData.responseStatus.resDesc).to.eql(\"Active alerts exist in same symbol\");\r",
									"    } else {\r",
									"        // Unexpected response\r",
									"        pm.fail(\"Unexpected response received: \" + jsonData.responseStatus.resDesc);\r",
									"    }\r",
									"});\r",
									"\r",
									"// Parse the request body\r",
									"const requestBody = pm.request.body.raw;\r",
									"try {\r",
									"    const jsonBody = JSON.parse(requestBody);\r",
									"    const value = jsonBody?.Message?.AlertRequest?.ReqAlertCurrentValue;\r",
									"\r",
									"    if (value) {\r",
									"        pm.environment.set(\"CurrentAlertValue\", value);\r",
									"        console.log(\"✅ Captured ReqAlertCurrentValue from request body:\", value);\r",
									"    } else {\r",
									"        console.warn(\"⚠️ ReqAlertCurrentValue not found in request body.\");\r",
									"    }\r",
									"} catch (e) {\r",
									"    console.error(\"❌ Failed to parse request body:\", e);\r",
									"}\r",
									"\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"Srv\": \"MNGALERT\",\r\n    \"Message\": {\r\n        \"AlertRequest\": {\r\n            \"ReqAlertTitle\": \"Add New Alert\",\r\n            \"ReqAlertSymbolId\": \"10\",\r\n            \"ReqAlertInterestId\": \"62\",\r\n            \"ReqAlertCriteriaId\": \"\",\r\n            \"ReqAlertCurrentValue\": \"10\",\r\n            \"ReqAlertValue\": \"11\",\r\n            \"ReqValueFrom\": \"\",\r\n            \"ReqValueTo\": \"\",\r\n            \"ReqDateFrom\": \"2\",\r\n            \"ReqDateTo\": \"\",\r\n            \"ReqAlertType\": \"CMP\",\r\n            \"ReqAlertSingleDate\": \"Y\",\r\n            \"ReqOpCode\": \"NEW\",\r\n            \"ReqAlertNin\": \"{{NIN}}\",\r\n            \"ReqAlertSource\": \"\",\r\n            \"Lang\": \"EN\",\r\n            \"UserId\": \"{{NIN}}\",\r\n            \"UserType\": \"INVESTOR\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"2023-09-26\",\r\n    \"SessionID\": \"{{SessionID}}\"\r\n}\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{BaseURL}}{{Oracle19}}",
							"host": [
								"{{BaseURL}}{{Oracle19}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Update Alert",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Update Alert API Test\", function () {\r",
									"    let jsonData = pm.response.json();\r",
									"\r",
									"    // Check if the operation was successful\r",
									"    if (jsonData.responseStatus.resCode === \"0\") {\r",
									"        pm.test(\"Alert updated successfully\", function () {\r",
									"            pm.expect(jsonData.responseStatus.resDesc).to.eql(\"Successful Operation\");\r",
									"        });\r",
									"    }\r",
									"    // Handle case when alert is not active\r",
									"    else if (jsonData.responseStatus.resCode === \"414\") {\r",
									"        pm.test(\"Alert not active\", function () {\r",
									"            pm.expect(jsonData.responseStatus.resDesc).to.eql(\"Alert Not Active\");\r",
									"        });\r",
									"    }\r",
									"    // Handle case when no alert is found\r",
									"    else if (jsonData.responseStatus.resCode === \"410\") {\r",
									"        pm.test(\"No alerts found\", function () {\r",
									"            pm.expect(jsonData.responseStatus.resDesc).to.eql(\"No alerts found\");\r",
									"        });\r",
									"    }\r",
									"    else {\r",
									"        pm.test(\"Unexpected response code\", function () {\r",
									"            pm.expect(jsonData.responseStatus.resCode).to.eql(\"0\");\r",
									"        });\r",
									"    }\r",
									"});\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"protocolProfileBehavior": {
						"disabledSystemHeaders": {}
					},
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"Srv\": \"MNGALERT\",\r\n    \"Message\": {\r\n        \"AlertRequest\": {\r\n            \"ReqAlertId\": \"{{alertId}}\",\r\n            \"ReqAlertTitle\": \"Edit Alert\",\r\n            \"ReqAlertSymbolId\": \"{{symbolId}}\",\r\n            \"ReqAlertInterestId\": \"62\",\r\n            \"ReqAlertCriteriaId\": \"\",\r\n            \"ReqAlertCurrentValue\": \"{{CurrentAlertValue}}\",\r\n            \"ReqAlertValue\": \"9\",\r\n            \"ReqValueFrom\": \"\",\r\n            \"ReqValueTo\": \"\",\r\n            \"ReqDateFrom\": \"\",\r\n            \"ReqDateTo\": \"\",\r\n            \"ReqAlertType\": \"\",\r\n            \"ReqAlertSingleDate\": \"Y\",\r\n            \"ReqOpCode\": \"UPDATE\",\r\n            \"ReqAlertNin\": \"{{NIN}}\",\r\n            \"ReqAlertSource\": \"\",\r\n            \"Lang\": \"EN\",\r\n            \"UserId\": \"{{NIN}}\",\r\n            \"UserType\": \"INVESTOR\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"2025-01-07\",\r\n    \"SessionID\": \"{{SessionID}}\"\r\n}\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{BaseURL}}{{Oracle19}}",
							"host": [
								"{{BaseURL}}{{Oracle19}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Remove Alert",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Remove Alert API Test\", function () {\r",
									"    let jsonData = pm.response.json();\r",
									"\r",
									"    // Check if the operation was successful\r",
									"    if (jsonData.responseStatus.resCode === \"0\") {\r",
									"        pm.test(\"Alert removed successfully\", function () {\r",
									"            pm.expect(jsonData.responseStatus.resDesc).to.eql(\"Successful Operation\");\r",
									"        });\r",
									"    }\r",
									"    // Handle case when alert is not active\r",
									"    else if (jsonData.responseStatus.resCode === \"414\") {\r",
									"        pm.test(\"Alert not active\", function () {\r",
									"            pm.expect(jsonData.responseStatus.resDesc).to.eql(\"Alert Not Active\");\r",
									"        });\r",
									"    }\r",
									"    // Handle case when no matching alert is found\r",
									"    else if (jsonData.responseStatus.resCode === \"408\") {\r",
									"        pm.test(\"No matching alerts\", function () {\r",
									"            pm.expect(jsonData.responseStatus.resDesc).to.eql(\"No matching alerts\");\r",
									"        });\r",
									"    }\r",
									"    else {\r",
									"        pm.test(\"Unexpected response code\", function () {\r",
									"            pm.expect(jsonData.responseStatus.resCode).to.eql(\"0\");\r",
									"        });\r",
									"    }\r",
									"});\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"Srv\": \"MNGALERT\",\r\n    \"Message\": {\r\n        \"AlertRequest\": {\r\n            \"ReqAlertId\": \"{{alertId}}\",\r\n            \"ReqOpCode\": \"REMOVE\",\r\n            \"ReqAlertNin\": \"{{NIN}}\",\r\n            \"ReqAlertSource\": \"\",\r\n            \"Lang\": \"EN\",\r\n            \"UserId\": \"{{NIN}}\",\r\n            \"UserType\": \"INVESTOR\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"2025-01-07\",\r\n    \"SessionID\": \"{{SessionID}}\"\r\n}\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{BaseURL}}{{Oracle19}}",
							"host": [
								"{{BaseURL}}{{Oracle19}}"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "9. Banks Info",
			"item": [
				{
					"name": "Banks Info",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"/**\r",
									" * BNKINFO – Banks Info validation (ES5)\r",
									" * Required per-country keys (non-empty strings):\r",
									" *   countryId, countryArName, countryEnName, countryIsoCode, countryIBANLength, showOrder, defaultCurrencyNo\r",
									" * Extra checks:\r",
									" *   - countryId, countryIBANLength, showOrder, defaultCurrencyNo: numeric strings (>=0 for numeric sanity)\r",
									" *   - countryIsoCode: 2 uppercase letters (A–Z)\r",
									" *   - countryIBANLength: 15..34 (IBAN standard length range)\r",
									" * Uniqueness: countryId, countryIsoCode\r",
									" * Optional env controls:\r",
									" *   - EXPECT_ISOS=\"QA,SA,BH\"  -> all must be present\r",
									" *   - EXPECT_IBAN_LEN_MAP='{\"QA\":29,\"SA\":24,\"BH\":22}' -> exact IBAN lengths per ISO\r",
									" */\r",
									"\r",
									"pm.test(\"HTTP 200\", function () {\r",
									"  pm.response.to.have.status(200);\r",
									"});\r",
									"\r",
									"pm.test(\"Content-Type is JSON\", function () {\r",
									"  pm.response.to.have.header(\"Content-Type\");\r",
									"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
									"});\r",
									"\r",
									"var json;\r",
									"pm.test(\"Body is valid JSON\", function () {\r",
									"  json = pm.response.json();\r",
									"  pm.expect(json).to.be.an(\"object\");\r",
									"});\r",
									"\r",
									"// Envelope\r",
									"pm.test(\"responseStatus OK (BNKINFO)\", function () {\r",
									"  var rs = json.responseStatus || {};\r",
									"  pm.expect(rs.resCode).to.eql(\"0\");\r",
									"  pm.expect(rs.resDesc).to.eql(\"Successful Operation\");\r",
									"  pm.expect(rs.source).to.eql(\"BNKINFO\");\r",
									"  pm.expect(rs.resCode1).to.eql(\"0\");\r",
									"  pm.expect(rs.resDesc1).to.eql(\"Successful Operation\");\r",
									"});\r",
									"\r",
									"// Extract countries\r",
									"var countries = ((((json || {}).message || {}).banksInformationResponse || {}).countryList || {}).country || [];\r",
									"pm.test(\"countryList.country is an array with entries\", function () {\r",
									"  pm.expect(countries).to.be.an(\"array\");\r",
									"  pm.expect(countries.length, \"No countries returned\").to.be.greaterThan(0);\r",
									"});\r",
									"\r",
									"// Helpers (ES5)\r",
									"function trimStr(s) { return String(s == null ? \"\" : s).replace(/^\\s+|\\s+$/g, \"\"); }\r",
									"function isNonEmptyString(s) { return typeof s === \"string\" && trimStr(s).length > 0; }\r",
									"function isNumericStr(v) { return typeof v === \"string\" && /^-?\\d+(\\.\\d+)?$/.test(v); }\r",
									"function isIntStr(v) { return typeof v === \"string\" && /^-?\\d+$/.test(v); }\r",
									"\r",
									"\r",
									"// Uniqueness checks\r",
									"pm.test(\"countryId values are unique\", function () {\r",
									"  var seen = {}, dups = [];\r",
									"  for (var i=0;i<countries.length;i++){\r",
									"    var id = String(countries[i].countryId);\r",
									"    if (seen[id]) dups.push(id); else seen[id] = true;\r",
									"  }\r",
									"  pm.expect(dups, \"Duplicate countryId(s): \" + dups.join(\", \")).to.eql([]);\r",
									"});\r",
									"\r",
									"pm.test(\"countryIsoCode values are unique\", function () {\r",
									"  var seen = {}, dups = [];\r",
									"  for (var i=0;i<countries.length;i++){\r",
									"    var iso = String(countries[i].countryIsoCode);\r",
									"    if (seen[iso]) dups.push(iso); else seen[iso] = true;\r",
									"  }\r",
									"  pm.expect(dups, \"Duplicate countryIsoCode(s): \" + dups.join(\", \")).to.eql([]);\r",
									"});\r",
									"\r",
									"// Optional: enforce a required ISO set from env (EXPECT_ISOS=\"QA,SA,BH\")\r",
									"pm.test(\"All expected ISO codes are present (if EXPECT_ISOS provided)\", function () {\r",
									"  var expected = trimStr(pm.environment.get(\"EXPECT_ISOS\") || pm.globals.get(\"EXPECT_ISOS\") || \"\");\r",
									"  if (expected) {\r",
									"    var exp = expected.split(\",\").map(function(x){return trimStr(x).toUpperCase();}).filter(function(x){return x;});\r",
									"    var have = {};\r",
									"    for (var i=0;i<countries.length;i++){ have[String(countries[i].countryIsoCode)] = true; }\r",
									"    var missing = [];\r",
									"    for (var j=0;j<exp.length;j++){ if (!have[exp[j]]) missing.push(exp[j]); }\r",
									"    pm.expect(missing, \"Missing ISO(s): \" + missing.join(\", \")).to.eql([]);\r",
									"  }\r",
									"});\r",
									"\r",
									"// Optional: enforce exact IBAN lengths per ISO (EXPECT_IBAN_LEN_MAP='{\"QA\":29,\"SA\":24}')\r",
									"pm.test(\"IBAN length matches expected map (if provided)\", function () {\r",
									"  var raw = pm.environment.get(\"EXPECT_IBAN_LEN_MAP\") || pm.globals.get(\"EXPECT_IBAN_LEN_MAP\") || \"\";\r",
									"  if (!raw) return;\r",
									"  var map = {};\r",
									"  try { map = JSON.parse(raw); } catch(e) { console.warn(\"Invalid EXPECT_IBAN_LEN_MAP JSON:\", e.message); return; }\r",
									"  var wrong = [];\r",
									"  for (var i=0;i<countries.length;i++){\r",
									"    var iso = String(countries[i].countryIsoCode);\r",
									"    if (map.hasOwnProperty(iso)) {\r",
									"      var expectedLen = Number(map[iso]);\r",
									"      var actualLen = Number(countries[i].countryIBANLength);\r",
									"      if (expectedLen !== actualLen) wrong.push(iso + \" expected \" + expectedLen + \" got \" + actualLen);\r",
									"    }\r",
									"  }\r",
									"  pm.expect(wrong, \"IBAN length mismatches: \" + wrong.join(\" | \")).to.eql([]);\r",
									"});\r",
									"\r",
									"// Save to environment for chaining\r",
									"(function saveEnv(){\r",
									"  pm.environment.set(\"BNKINFO_COUNTRY_COUNT\", String(countries.length));\r",
									"  var isos = [];\r",
									"  var ibanMap = {};\r",
									"  for (var i=0;i<countries.length;i++){\r",
									"    isos.push(String(countries[i].countryIsoCode));\r",
									"    ibanMap[String(countries[i].countryIsoCode)] = String(countries[i].countryIBANLength);\r",
									"  }\r",
									"  pm.environment.set(\"BNKINFO_ISOS\", JSON.stringify(isos));\r",
									"  pm.environment.set(\"BNKINFO_IBAN_MAP\", JSON.stringify(ibanMap));\r",
									"})();\r",
									"\r",
									"// Minimal schema (tv4)\r",
									"pm.test(\"Schema (minimal) validates\", function () {\r",
									"  var schema = {\r",
									"    type: \"object\",\r",
									"    required: [\"responseStatus\",\"message\"],\r",
									"    properties: {\r",
									"      responseStatus: {\r",
									"        type: \"object\",\r",
									"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
									"        properties: {\r",
									"          resCode:  { \"const\": \"0\" },\r",
									"          resDesc:  { \"const\": \"Successful Operation\" },\r",
									"          source:   { \"const\": \"BNKINFO\" },\r",
									"          resCode1: { \"const\": \"0\" },\r",
									"          resDesc1: { \"const\": \"Successful Operation\" }\r",
									"        }\r",
									"      },\r",
									"      message: {\r",
									"        type: \"object\",\r",
									"        required: [\"banksInformationResponse\"],\r",
									"        properties: {\r",
									"          banksInformationResponse: {\r",
									"            type: \"object\",\r",
									"            required: [\"countryList\"],\r",
									"            properties: {\r",
									"              countryList: {\r",
									"                type: \"object\",\r",
									"                required: [\"country\"],\r",
									"                properties: {\r",
									"                  country: { type: \"array\" }\r",
									"                }\r",
									"              }\r",
									"            }\r",
									"          }\r",
									"        }\r",
									"      }\r",
									"    }\r",
									"  };\r",
									"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
									"});\r",
									"\r",
									"// Visualizer (compact table)\r",
									"(function render(){\r",
									"  var template =\r",
									"    '<style>.t{font-family:system-ui,Segoe UI,Roboto,Arial;font-size:14px;color:#333;width:100%;border-collapse:collapse}' +\r",
									"    '.t th,.t td{border:1px solid #87ceeb;padding:6px;text-align:left}.t th{background:#87ceeb}' +\r",
									"    '.bad{background:#ffe6e6}</style>' +\r",
									"    '<h3>Banks Info – Countries ({{count}})</h3>' +\r",
									"    '<table class=\"t\"><thead><tr>' +\r",
									"    '<th>#</th><th>countryId</th><th>countryIsoCode</th><th>countryArName</th><th>countryEnName</th>' +\r",
									"    '<th>IBAN Len</th><th>showOrder</th><th>defaultCurrencyNo</th></tr></thead><tbody>' +\r",
									"    '{{#rows}}<tr class=\"{{cls}}\"><td>{{idx}}</td><td>{{countryId}}</td><td>{{countryIsoCode}}</td>' +\r",
									"    '<td>{{countryArName}}</td><td>{{countryEnName}}</td><td>{{countryIBANLength}}</td>' +\r",
									"    '<td>{{showOrder}}</td><td>{{defaultCurrencyNo}}</td></tr>{{/rows}}</tbody></table>';\r",
									"\r",
									"  var rows = [];\r",
									"  for (var i=0;i<countries.length;i++){\r",
									"    var c = countries[i];\r",
									"    var bad = !(isNonEmptyString(c.countryId) && isNonEmptyString(c.countryIsoCode) && isNonEmptyString(c.countryArName) &&\r",
									"                isNonEmptyString(c.countryEnName) && isNonEmptyString(c.countryIBANLength) &&\r",
									"                isNonEmptyString(c.showOrder) && isNonEmptyString(c.defaultCurrencyNo));\r",
									"    rows.push({\r",
									"      idx: i+1,\r",
									"      countryId: String(c.countryId || \"\"),\r",
									"      countryIsoCode: String(c.countryIsoCode || \"\"),\r",
									"      countryArName: String(c.countryArName || \"\"),\r",
									"      countryEnName: String(c.countryEnName || \"\"),\r",
									"      countryIBANLength: String(c.countryIBANLength || \"\"),\r",
									"      showOrder: String(c.showOrder || \"\"),\r",
									"      defaultCurrencyNo: String(c.defaultCurrencyNo || \"\"),\r",
									"      cls: bad ? \"bad\" : \"\"\r",
									"    });\r",
									"  }\r",
									"\r",
									"  pm.visualizer.set(template, { count: countries.length, rows: rows });\r",
									"})();\r",
									"\r",
									"console.log(\"✅ BNKINFO validated. countries=\", countries.length);\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"Srv\": \"BNKINFO\",\r\n    \"Message\": {\r\n        \"BanksInformationRequest\": {\r\n            \"NIN\": \"{{NIN}}\",\r\n            \"UserId\": \"{{UserID}}\",\r\n            \"UserType\": \"INVESTOR\",\r\n            \"Lang\": \"ARB\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"30-04-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{BaseURL}}{{Oracle19}}",
							"host": [
								"{{BaseURL}}{{Oracle19}}"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "10. Banks Transfer",
			"item": [
				{
					"name": "Transfer to The Group",
					"item": [
						{
							"name": "1. Get Banks info",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"/**\r",
											" * BNKBAL – Bank balances & info (ES5)\r",
											" * Validates:\r",
											" *  - HTTP 200, JSON, envelope codes 0/0, source=\"BNKBAL\"\r",
											" *  - bnkInfoResponse existence and key formats\r",
											" *  - Balance fields are numeric strings; negatives allowed by default (toggle strict)\r",
											" *  - banksInfo.bnkInfoRec / bnkTransfers.bnkTransferRec array shapes\r",
											" *  - financierInfo & fundInfo consistency; creditRatio accepts ratio or percent\r",
											" *  - financierInfo fields accept null/\"null\"/\"\" gracefully\r",
											" * Keeps your extracts:\r",
											" *  - accountSeq_i, bnkCode_i, accountCode_i, transferTimeId_i, bankCount\r",
											" *\r",
											" * Optional toggles (Env/Globals):\r",
											" *  - ENFORCE_NON_NEG_BALANCES = Y|N (default N) -> force balances >= 0\r",
											" */\r",
											"\r",
											"// 1) Status code\r",
											"pm.test(\"Status code is 200\", function () {\r",
											"  pm.response.to.have.status(200);\r",
											"});\r",
											"\r",
											"// 2) Envelope base checks\r",
											"pm.test(\"resCode is 0 and resDesc is Successful Operation\", function () {\r",
											"  var resStatus = (pm.response.json() || {}).responseStatus || {};\r",
											"  pm.expect(resStatus.resCode).to.eql(\"0\");\r",
											"  pm.expect(resStatus.resDesc).to.eql(\"Successful Operation\");\r",
											"});\r",
											"\r",
											"// 3) Extract and set bank info (kept as-is)\r",
											"var __json_for_extract = pm.response.json() || {};\r",
											"var __bnkInfoList = ((((__json_for_extract.message || {}).bnkInfoResponse || {}).banksInfo || {}).bnkInfoRec);\r",
											"\r",
											"if (Array.isArray(__bnkInfoList)) {\r",
											"  // Clear previous values\r",
											"  pm.environment.unset(\"bankCount\");\r",
											"\r",
											"  for (var i = 0; i < __bnkInfoList.length; i++) {\r",
											"    var bnk = __bnkInfoList[i] || {};\r",
											"    pm.environment.set(\"accountSeq_\" + (i + 1), String(bnk.accountSeq || \"\"));\r",
											"    pm.environment.set(\"bnkCode_\" + (i + 1), String(bnk.bnkCode || \"\"));\r",
											"    pm.environment.set(\"accountCode_\" + (i + 1), String(bnk.accountCode || \"\"));\r",
											"    pm.environment.set(\"transferTimeId_\" + (i + 1), String(bnk.transferTimeId || \"\"));\r",
											"  }\r",
											"  pm.environment.set(\"bankCount\", String(__bnkInfoList.length));\r",
											"} else {\r",
											"  console.warn(\"banksInfo.bnkInfoRec not found or invalid\");\r",
											"}\r",
											"\r",
											"// Basic header check\r",
											"pm.test(\"Content-Type is JSON\", function () {\r",
											"  pm.response.to.have.header(\"Content-Type\");\r",
											"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
											"});\r",
											"\r",
											"// Parse once & helpers\r",
											"var json = pm.response.json() || {};\r",
											"var rs   = json.responseStatus || {};\r",
											"var bnr  = (json.message || {}).bnkInfoResponse || {};\r",
											"\r",
											"function isNumericStr(v) {\r",
											"  if (typeof v === \"number\") return isFinite(v);\r",
											"  return typeof v === \"string\" && /^-?\\d+(\\.\\d+)?$/.test(v);\r",
											"}\r",
											"function isIntStr(v) {\r",
											"  if (typeof v === \"number\") return Number.isInteger(v);\r",
											"  return typeof v === \"string\" && /^-?\\d+$/.test(v);\r",
											"}\r",
											"function isYN(v)  { return String(v) === \"Y\" || String(v) === \"N\"; }\r",
											"function isNullish(v) {\r",
											"  return v === null || typeof v === \"undefined\" || String(v).trim().toUpperCase() === \"NULL\" || String(v).trim() === \"\";\r",
											"}\r",
											"\r",
											"// Envelope completeness\r",
											"pm.test(\"Envelope complete (BNKBAL)\", function () {\r",
											"  pm.expect(rs.resCode).to.eql(\"0\");\r",
											"  pm.expect(rs.resDesc).to.eql(\"Successful Operation\");\r",
											"  pm.expect(rs.source).to.eql(\"BNKBAL\");\r",
											"  pm.expect(rs.resCode1).to.eql(\"0\");\r",
											"  pm.expect(rs.resDesc1).to.eql(\"Successful Operation\");\r",
											"});\r",
											"\r",
											"// Core node exists\r",
											"pm.test(\"bnkInfoResponse exists\", function () {\r",
											"  pm.expect(bnr).to.be.an(\"object\");\r",
											"});\r",
											"\r",
											"// Name (if provided)\r",
											"pm.test(\"Customer name (if present) is a non-empty string\", function () {\r",
											"  if (typeof bnr.name !== \"undefined\") {\r",
											"    pm.expect(bnr.name).to.be.a(\"string\").and.to.not.equal(\"\");\r",
											"  }\r",
											"});\r",
											"\r",
											"// Balance fields – allow negatives by default (set ENFORCE_NON_NEG_BALANCES=Y to force >=0)\r",
											"pm.test(\"All balance fields are numeric strings (with optional non-negative enforcement)\", function () {\r",
											"  var keys = [\r",
											"    \"buybal1\",\"currentBal\",\"buyBal\",\"buyBal1\",\"onLineBal1\",\"maxBalance1\",\"unclearedBal\",\r",
											"    \"tradeBal\",\"t3Bal\",\"chqColl\",\"onlineBal\",\"todayDepo\",\"todayDepos\",\"allowedBal\",\r",
											"    \"postponed\",\"reservedFawriBalance\",\"maxbalance\",\"newMaxBalance\"\r",
											"  ];\r",
											"  var enforce = String(pm.environment.get(\"ENFORCE_NON_NEG_BALANCES\") || pm.globals.get(\"ENFORCE_NON_NEG_BALANCES\") || \"N\").toUpperCase() === \"Y\";\r",
											"\r",
											"  for (var i=0;i<keys.length;i++){\r",
											"    var k = keys[i];\r",
											"    if (typeof bnr[k] !== \"undefined\") {\r",
											"      pm.expect(isNumericStr(bnr[k]), k + \" must be numeric\").to.be.true;\r",
											"      if (enforce) {\r",
											"        pm.expect(Number(bnr[k]), k + \" must be >= 0 (strict mode)\").to.be.at.least(0);\r",
											"      }\r",
											"    }\r",
											"  }\r",
											"});\r",
											"\r",
											"// banksInfo array and each record format\r",
											"pm.test(\"banksInfo.bnkInfoRec is array (can be empty)\", function () {\r",
											"  var arr = (((bnr || {}).banksInfo || {}).bnkInfoRec);\r",
											"  pm.expect(arr, \"bnkInfoRec\").to.be.an(\"array\");\r",
											"});\r",
											"\r",
											"(function validateBankRecords(){\r",
											"  var arr = (((bnr || {}).banksInfo || {}).bnkInfoRec) || [];\r",
											"  if (!Array.isArray(arr) || arr.length === 0) return;\r",
											"\r",
											"  for (var i=0;i<arr.length;i++){\r",
											"    var rec = arr[i] || {};\r",
											"\r",
											"    pm.expect(String(rec.accountSeq || \"\"), \"accountSeq\").to.match(/^\\d+$/);\r",
											"\r",
											"    // bankCode: allow alphanumeric 2–10 chars (covers \"QNB\" and \"535\")\r",
											"    if (typeof rec.bankCode !== \"undefined\") {\r",
											"      var bc = String(rec.bankCode || \"\").trim().toUpperCase();\r",
											"      pm.expect(bc, \"bankCode non-empty\").to.not.equal(\"\");\r",
											"      pm.expect(bc, \"bankCode format A–Z/0–9, len 2–10\").to.match(/^[A-Z0-9]{2,10}$/);\r",
											"    }\r",
											"\r",
											"    // SWIFT/BIC strict: 8 or 11 alnum\r",
											"    pm.expect(String(rec.bnkCode || \"\"), \"bnkCode (SWIFT/BIC)\").to.match(/^[A-Z0-9]{8}([A-Z0-9]{3})?$/);\r",
											"\r",
											"    pm.expect(rec.bnkName, \"bnkName\").to.be.a(\"string\").and.not.empty;\r",
											"    pm.expect(rec.accountCode, \"accountCode\").to.be.a(\"string\").and.not.empty;\r",
											"\r",
											"    // accountType: accept BOTH/DEBIT/CREDIT/NO/TOBNK\r",
											"    if (typeof rec.accountType !== \"undefined\") {\r",
											"      pm.expect([\"BOTH\",\"DEBIT\",\"CREDIT\",\"NO\",\"TOBNK\"], \"accountType\")\r",
											"        .to.include(String(rec.accountType).toUpperCase());\r",
											"    }\r",
											"\r",
											"    // status\r",
											"    pm.expect(String(rec.accountStatus || \"\"), \"accountStatus\").to.match(/^\\d+$/);\r",
											"    pm.expect(rec.accountStatusDesc, \"accountStatusDesc\").to.be.a(\"string\").and.not.empty;\r",
											"\r",
											"    if (typeof rec.isSahlPlus !== \"undefined\") {\r",
											"      pm.expect(isYN(String(rec.isSahlPlus)), \"isSahlPlus\").to.be.true;\r",
											"    }\r",
											"\r",
											"    // transferTimeId can be long token; just ensure string & non-empty\r",
											"    pm.expect(rec.transferTimeId, \"transferTimeId\").to.be.a(\"string\").and.not.empty;\r",
											"  }\r",
											"})();\r",
											"\r",
											"// bnkTransfers shape\r",
											"pm.test(\"bnkTransfers.bnkTransferRec is array (may be empty)\", function () {\r",
											"  var tr = (((bnr || {}).bnkTransfers || {}).bnkTransferRec);\r",
											"  pm.expect(tr, \"bnkTransferRec\").to.be.an(\"array\");\r",
											"});\r",
											"\r",
											"// financierInfo (if present) – tolerant of null/\"null\"/\"\"\r",
											"pm.test(\"financierInfo (if present) has valid fields\", function () {\r",
											"  var fi = bnr.financierInfo;\r",
											"  if (fi && typeof fi === \"object\") {\r",
											"    if (!isNullish(fi.financierID)) {\r",
											"      pm.expect(String(fi.financierID)).to.match(/^\\d+$/);\r",
											"    }\r",
											"\r",
											"    if (!isNullish(fi.isActive)) {\r",
											"      pm.expect(isYN(String(fi.isActive))).to.be.true;\r",
											"    }\r",
											"\r",
											"    if (!isNullish(fi.isOrdersEnabled)) {\r",
											"      pm.expect(isYN(String(fi.isOrdersEnabled))).to.be.true;\r",
											"    }\r",
											"\r",
											"    if (!isNullish(fi.riskFeesType)) {\r",
											"      pm.expect([\"0\",\"1\",\"2\",\"3\"]).to.include(String(fi.riskFeesType));\r",
											"    }\r",
											"    // riskFeesValue: validate only when present & not nullish\r",
											"    if (!isNullish(fi.riskFeesValue)) {\r",
											"      pm.expect(isNumericStr(fi.riskFeesValue)).to.be.true;\r",
											"      pm.expect(Number(fi.riskFeesValue)).to.be.at.least(0);\r",
											"    }\r",
											"\r",
											"    if (!isNullish(fi.financierAllowancePeriod)) {\r",
											"      pm.expect(isIntStr(fi.financierAllowancePeriod)).to.be.true;\r",
											"      pm.expect(Number(fi.financierAllowancePeriod)).to.be.at.least(0);\r",
											"    }\r",
											"  }\r",
											"});\r",
											"\r",
											"// fundInfo (margin block; can be N or Y)\r",
											"pm.test(\"fundInfo (if present) is consistent\", function () {\r",
											"  var f = bnr.fundInfo;\r",
											"  if (f && typeof f === \"object\") {\r",
											"    pm.expect(isYN(String(f.isFundClient)), \"isFundClient Y/N\").to.be.true;\r",
											"\r",
											"    if (f.isFundClient === \"Y\") {\r",
											"      var numKeys = [\r",
											"        \"fundDebt\",\"fundAvailableCredit\",\"cashBalanceNotCollected\",\"fundedAmountInMarket\",\r",
											"        \"creditRatio\",\"collectedBalance\",\"actualFunded\",\"shareAvCredit\"\r",
											"      ];\r",
											"      for (var i=0;i<numKeys.length;i++){\r",
											"        var k = numKeys[i];\r",
											"        pm.expect(isNumericStr(String(f[k])), \"fundInfo.\"+k+\" numeric\").to.be.true;\r",
											"        pm.expect(Number(f[k]), \"fundInfo.\"+k+\" >= 0\").to.be.at.least(0);\r",
											"      }\r",
											"\r",
											"      // creditRatio sanity: accept ratio [0..1] OR percent [0..100]\r",
											"      if (!isNullish(f.creditRatio)) {\r",
											"        var cr = Number(f.creditRatio);\r",
											"        if (cr > 1) {\r",
											"          pm.expect(cr, \"creditRatio% in [0, 100]\").to.be.at.least(0).and.at.most(100);\r",
											"          pm.environment.set(\"CREDIT_RATIO\", String(cr / 100));     // normalized 0..1\r",
											"          pm.environment.set(\"CREDIT_RATIO_PCT\", String(cr));       // as percent\r",
											"        } else {\r",
											"          pm.expect(cr, \"creditRatio in [0, 1]\").to.be.at.least(0).and.at.most(1);\r",
											"          pm.environment.set(\"CREDIT_RATIO\", String(cr));           // normalized 0..1\r",
											"          pm.environment.set(\"CREDIT_RATIO_PCT\", String(cr * 100)); // as percent\r",
											"        }\r",
											"      }\r",
											"\r",
											"      if (!isNullish(f.isActiveFundClient)) {\r",
											"        pm.expect(isYN(String(f.isActiveFundClient))).to.be.true;\r",
											"      }\r",
											"    }\r",
											"  }\r",
											"});\r",
											"\r",
											"// resType should reflect request's AccRegisterType (when provided)\r",
											"pm.test(\"resType matches AccRegisterType from request (when provided)\", function () {\r",
											"  var reqBody;\r",
											"  try { reqBody = pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {}; } catch(e){}\r",
											"  var accType = (((reqBody || {}).Message || {}).BalDlsRequest || {}).AccRegisterType;\r",
											"  if (accType) {\r",
											"    pm.expect(bnr.resType, \"resType\").to.eql(String(accType));\r",
											"  }\r",
											"});\r",
											"\r",
											"// Guardrails: request Srv should be BNKBAL\r",
											"pm.test(\"Request Srv is BNKBAL\", function () {\r",
											"  var reqBody;\r",
											"  try { reqBody = pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {}; } catch(e){}\r",
											"  pm.expect((reqBody || {}).Srv).to.eql(\"BNKBAL\");\r",
											"});\r",
											"\r",
											"// Minimal schema (tv4)\r",
											"pm.test(\"Schema (minimal) validates\", function () {\r",
											"  var schema = {\r",
											"    type: \"object\",\r",
											"    required: [\"responseStatus\",\"message\"],\r",
											"    properties: {\r",
											"      responseStatus: {\r",
											"        type: \"object\",\r",
											"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
											"        properties: {\r",
											"          resCode:  { \"const\": \"0\" },\r",
											"          resDesc:  { \"const\": \"Successful Operation\" },\r",
											"          source:   { \"const\": \"BNKBAL\" },\r",
											"          resCode1: { \"const\": \"0\" },\r",
											"          resDesc1: { \"const\": \"Successful Operation\" }\r",
											"        }\r",
											"      },\r",
											"      message: {\r",
											"        type: \"object\",\r",
											"        required: [\"bnkInfoResponse\"],\r",
											"        properties: {\r",
											"          bnkInfoResponse: { type: \"object\" }\r",
											"        }\r",
											"      }\r",
											"    }\r",
											"  };\r",
											"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
											"});\r",
											"\r",
											"// Extra: store a few more env helpers (without touching your extract keys)\r",
											"(function storeExtras(){\r",
											"  var arr = (((bnr || {}).banksInfo || {}).bnkInfoRec) || [];\r",
											"  if (arr.length > 0) {\r",
											"    pm.environment.set(\"firstBankCode\", String(arr[0].bankCode || \"\"));\r",
											"    pm.environment.set(\"firstBankSwift\", String(arr[0].bnkCode || \"\"));\r",
											"    pm.environment.set(\"firstAccountStatus\", String(arr[0].accountStatus || \"\"));\r",
											"  }\r",
											"  pm.environment.set(\"bnkTransfersCount\", String(((((bnr || {}).bnkTransfers || {}).bnkTransferRec) || []).length));\r",
											"})();\r",
											"\r",
											"console.log(\"✅ BNKBAL validated.\",\r",
											"            \"bankCount:\", pm.environment.get(\"bankCount\"),\r",
											"            \"transfers:\", pm.environment.get(\"bnkTransfersCount\"),\r",
											"            \"creditRatio(norm):\", pm.environment.get(\"CREDIT_RATIO\"),\r",
											"            \"creditRatio(%) \", pm.environment.get(\"CREDIT_RATIO_PCT\"));\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "noauth"
								},
								"method": "POST",
								"header": [
									{
										"key": "Accept",
										"value": "application/json",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\r\n    \"Srv\": \"BNKBAL\",\r\n    \"Message\": {\r\n        \"BalDlsRequest\": {\r\n            \"NIN\": \"{{NIN}}\",\r\n            \"UserId\": \"{{UserID}}\",\r\n            \"UserType\": \"INVESTOR\",\r\n            \"AccRegisterType\": \"ALL\",\r\n            \"Lang\": \"ARB\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"30-04-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}\r\n\r\n\r\n",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{BaseURL}}{{Oracle19}}",
									"host": [
										"{{BaseURL}}{{Oracle19}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "2. Confirm Deposit Transfer",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"/**\r",
											" * BNKCHKTRANSFERNEW – Confirm Transfer (Popup) validation (ES5)\r",
											" * Validates:\r",
											" *  - Envelope: resCode/resCode1=0, source=\"BNKCHKTRANSFERNEW\"\r",
											" *  - Fields: trnxFees, trnxIsPossible, maximumAmount, hintMessage, urgentFees\r",
											" *  - Numeric strings >= 0 (supports scientific notation); trnxIsPossible is Y/N\r",
											" *  - Optional business rules via env toggles (see header comment)\r",
											" * Saves to env:\r",
											" *  TRX_IS_POSSIBLE, TRX_MAX_AMOUNT, TRX_MAX_AMOUNT_NUM, TRX_FEES, TRX_FEES_NUM,\r",
											" *  TRX_URGENT_FEES, TRX_URGENT_FEES_NUM, TRX_HINT\r",
											" */\r",
											"\r",
											"pm.test(\"HTTP 200\", function () {\r",
											"  pm.response.to.have.status(200);\r",
											"});\r",
											"\r",
											"pm.test(\"Content-Type is JSON\", function () {\r",
											"  pm.response.to.have.header(\"Content-Type\");\r",
											"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
											"});\r",
											"\r",
											"// Parse\r",
											"var json;\r",
											"pm.test(\"Body is valid JSON\", function () {\r",
											"  json = pm.response.json();\r",
											"  pm.expect(json).to.be.an(\"object\");\r",
											"});\r",
											"\r",
											"// Envelope\r",
											"pm.test(\"responseStatus OK (BNKCHKTRANSFERNEW)\", function () {\r",
											"  var rs = json.responseStatus || {};\r",
											"  pm.expect(rs.resCode).to.eql(\"0\");\r",
											"  pm.expect(rs.resDesc).to.eql(\"Successful Operation\");\r",
											"  pm.expect(rs.source).to.eql(\"BNKCHKTRANSFERNEW\");\r",
											"  pm.expect(rs.resCode1).to.eql(\"0\");\r",
											"  pm.expect(rs.resDesc1).to.eql(\"Successful Operation\");\r",
											"});\r",
											"\r",
											"// Node\r",
											"var node = (((json || {}).message || {}).isBankTransferResponse) || {};\r",
											"pm.test(\"isBankTransferResponse exists\", function () {\r",
											"  pm.expect(node).to.be.an(\"object\");\r",
											"  pm.expect(node).to.have.property(\"trnxFees\");\r",
											"  pm.expect(node).to.have.property(\"trnxIsPossible\");\r",
											"  pm.expect(node).to.have.property(\"maximumAmount\");\r",
											"  pm.expect(node).to.have.property(\"hintMessage\");\r",
											"  pm.expect(node).to.have.property(\"urgentFees\");\r",
											"});\r",
											"\r",
											"// Helpers (ES5)\r",
											"// Accepts: integers, decimals, and scientific notation (e.g., 1.23E8, -4e-3)\r",
											"function isNumericStr(v) {\r",
											"  if (typeof v === \"number\") return isFinite(v);\r",
											"  var s = String(v || \"\").trim();\r",
											"  return /^-?(?:\\d+\\.?\\d*|\\d*\\.\\d+)(?:[eE][+\\-]?\\d+)?$/.test(s);\r",
											"}\r",
											"function toNumberSafe(v) { return Number(String(v || \"\").trim()); }\r",
											"function isYN(v) { return v === \"Y\" || v === \"N\"; }\r",
											"function getFlag(name, defVal) {\r",
											"  var v = pm.environment.get(name) || pm.globals.get(name);\r",
											"  v = (v == null ? \"\" : String(v)).toUpperCase();\r",
											"  if (v !== \"Y\" && v !== \"N\") return defVal;\r",
											"  return v;\r",
											"}\r",
											"\r",
											"// Field validations\r",
											"pm.test(\"trnxFees & urgentFees are numeric strings >= 0\", function () {\r",
											"  pm.expect(isNumericStr(node.trnxFees), \"trnxFees must be numeric string\").to.be.true;\r",
											"  pm.expect(isNumericStr(node.urgentFees), \"urgentFees must be numeric string\").to.be.true;\r",
											"  pm.expect(toNumberSafe(node.trnxFees), \"trnxFees >= 0\").to.be.at.least(0);\r",
											"  pm.expect(toNumberSafe(node.urgentFees), \"urgentFees >= 0\").to.be.at.least(0);\r",
											"});\r",
											"\r",
											"pm.test(\"trnxIsPossible is Y/N\", function () {\r",
											"  pm.expect(isYN(node.trnxIsPossible), \"trnxIsPossible must be 'Y' or 'N'\").to.be.true;\r",
											"});\r",
											"\r",
											"pm.test(\"maximumAmount is numeric string >= 0\", function () {\r",
											"  pm.expect(isNumericStr(node.maximumAmount), \"maximumAmount must be numeric string\").to.be.true;\r",
											"  pm.expect(toNumberSafe(node.maximumAmount), \"maximumAmount >= 0\").to.be.at.least(0);\r",
											"});\r",
											"\r",
											"pm.test(\"hintMessage is a string (may be empty on success)\", function () {\r",
											"  pm.expect(typeof node.hintMessage).to.eql(\"string\");\r",
											"});\r",
											"\r",
											"// Business rules (configurable)\r",
											"pm.test(\"Business rules for trnxIsPossible\", function () {\r",
											"  var requireMaxWhenY = getFlag(\"REQUIRE_MAX_GT_ZERO_WHEN_Y\", \"Y\") === \"Y\";\r",
											"  var requireHintOnFail = getFlag(\"REQUIRE_HINT_ON_FAIL\", \"Y\") === \"Y\";\r",
											"  var allowNonZeroWhenN = getFlag(\"ALLOW_NONZERO_MAX_WHEN_N\", \"N\") === \"N\" ? false : true;\r",
											"\r",
											"  var isPossible = node.trnxIsPossible === \"Y\";\r",
											"  var maxNum = toNumberSafe(node.maximumAmount);\r",
											"  var hint = String(node.hintMessage || \"\");\r",
											"\r",
											"  if (isPossible) {\r",
											"    if (requireMaxWhenY) {\r",
											"      pm.expect(maxNum, \"When possible=Y, maximumAmount must be > 0\").to.be.above(0);\r",
											"    }\r",
											"    if (hint && hint.replace(/\\s+/g,\"\").length > 0) {\r",
											"      console.warn(\"Hint provided even though trnxIsPossible=Y:\", hint);\r",
											"    }\r",
											"  } else {\r",
											"    if (requireHintOnFail) {\r",
											"      pm.expect(hint.replace(/\\s+/g,\"\").length, \"When possible=N, hintMessage should be non-empty\").to.be.greaterThan(0);\r",
											"    }\r",
											"    if (!allowNonZeroWhenN) {\r",
											"      pm.expect(maxNum, \"When possible=N, maximumAmount should be 0\").to.eql(0);\r",
											"    }\r",
											"  }\r",
											"});\r",
											"\r",
											"// Save to environment\r",
											"(function saveEnv(){\r",
											"  pm.environment.set(\"TRX_IS_POSSIBLE\", String(node.trnxIsPossible || \"\"));\r",
											"  pm.environment.set(\"TRX_MAX_AMOUNT\", String(node.maximumAmount || \"\"));\r",
											"  pm.environment.set(\"TRX_MAX_AMOUNT_NUM\", String(toNumberSafe(node.maximumAmount)));\r",
											"  pm.environment.set(\"TRX_FEES\", String(node.trnxFees || \"\"));\r",
											"  pm.environment.set(\"TRX_FEES_NUM\", String(toNumberSafe(node.trnxFees)));\r",
											"  pm.environment.set(\"TRX_URGENT_FEES\", String(node.urgentFees || \"\"));\r",
											"  pm.environment.set(\"TRX_URGENT_FEES_NUM\", String(toNumberSafe(node.urgentFees)));\r",
											"  pm.environment.set(\"TRX_HINT\", String(node.hintMessage || \"\"));\r",
											"})();\r",
											"\r",
											"// Minimal schema (tv4)\r",
											"pm.test(\"Schema (minimal) validates\", function () {\r",
											"  var schema = {\r",
											"    type: \"object\",\r",
											"    required: [\"responseStatus\",\"message\"],\r",
											"    properties: {\r",
											"      responseStatus: {\r",
											"        type: \"object\",\r",
											"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
											"        properties: {\r",
											"          resCode:  { \"const\": \"0\" },\r",
											"          resDesc:  { \"const\": \"Successful Operation\" },\r",
											"          source:   { \"const\": \"BNKCHKTRANSFERNEW\" },\r",
											"          resCode1: { \"const\": \"0\" },\r",
											"          resDesc1: { \"const\": \"Successful Operation\" }\r",
											"        }\r",
											"      },\r",
											"      message: {\r",
											"        type: \"object\",\r",
											"        required: [\"isBankTransferResponse\"],\r",
											"        properties: {\r",
											"          isBankTransferResponse: {\r",
											"            type: \"object\",\r",
											"            required: [\"trnxFees\",\"trnxIsPossible\",\"maximumAmount\",\"hintMessage\",\"urgentFees\"],\r",
											"            properties: {\r",
											"              trnxFees:       { type: \"string\" },\r",
											"              trnxIsPossible: { type: \"string\" },\r",
											"              maximumAmount:  { type: \"string\" },\r",
											"              hintMessage:    { type: \"string\" },\r",
											"              urgentFees:     { type: \"string\" }\r",
											"            }\r",
											"          }\r",
											"        }\r",
											"      }\r",
											"    }\r",
											"  };\r",
											"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
											"});\r",
											"\r",
											"// Visualizer (compact)\r",
											"(function render(){\r",
											"  var template =\r",
											"    '<style>.t{font-family:system-ui,Segoe UI,Roboto,Arial;font-size:14px;color:#333;width:100%;border-collapse:collapse}' +\r",
											"    '.t th,.t td{border:1px solid #87ceeb;padding:6px;text-align:left}.t th{background:#87ceeb}' +\r",
											"    '.good{color:#0a8f08}.bad{color:#b00020}</style>' +\r",
											"    '<h3>Confirm Transfer</h3>' +\r",
											"    '<table class=\"t\"><tbody>' +\r",
											"    '<tr><th>trnxIsPossible</th><td class=\"{{possibleCls}}\">{{trnxIsPossible}}</td></tr>' +\r",
											"    '<tr><th>maximumAmount</th><td>{{maximumAmount}}</td></tr>' +\r",
											"    '<tr><th>trnxFees</th><td>{{trnxFees}}</td></tr>' +\r",
											"    '<tr><th>urgentFees</th><td>{{urgentFees}}</td></tr>' +\r",
											"    '<tr><th>hintMessage</th><td>{{hintMessage}}</td></tr>' +\r",
											"    '</tbody></table>';\r",
											"\r",
											"  var possibleCls = (node.trnxIsPossible === \"Y\") ? \"good\" : \"bad\";\r",
											"  pm.visualizer.set(template, {\r",
											"    trnxIsPossible: String(node.trnxIsPossible || \"\"),\r",
											"    maximumAmount: String(node.maximumAmount || \"\"),\r",
											"    trnxFees: String(node.trnxFees || \"\"),\r",
											"    urgentFees: String(node.urgentFees || \"\"),\r",
											"    hintMessage: String(node.hintMessage || \"\"),\r",
											"    possibleCls: possibleCls\r",
											"  });\r",
											"})();\r",
											"\r",
											"console.log(\r",
											"  \"✅ BNKCHKTRANSFERNEW validated.\",\r",
											"  \"possible=\", node.trnxIsPossible,\r",
											"  \"max(raw)=\", node.maximumAmount,\r",
											"  \"max(num)=\", Number(String(node.maximumAmount || \"\").trim())\r",
											");\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Accept",
										"value": "application/json",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\r\n    \"Srv\": \"BNKCHKTRANSFERNEW\",\r\n    \"Message\": {\r\n        \"IsBankTransferRequest\": {\r\n            \"swiftCode\": \"{{bnkCode_1}}\",\r\n            \"accountNO\": \"{{accountSeq_1}}\",\r\n            \"amount\": \"555\",\r\n            \"nin\": \"{{NIN}}\",\r\n            \"userId\": \"{{UserID}}\",\r\n            \"userType\": \"INVESTOR\",\r\n            \"lang\": \"ARB\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"30-04-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{BaseURL}}{{Oracle19}}",
									"host": [
										"{{BaseURL}}{{Oracle19}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "3. Fire - Deposit in The Group",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"/**\r",
											" * BNKTRANSFERNEW – Bank transfer from (ES5)\r",
											" * Validates:\r",
											" *  - Envelope: resCode/resCode1=0, source=\"BNKTRANSFERNEW\"\r",
											" *  - Node: getBankTransferResponse with required keys (all strings)\r",
											" *  - showHint in {Y,N} and conditional rules\r",
											" *  - OTP config: otpLength=\"4\", otpExpiryPeriod=\"300\", otpResendPeriod=\"60\"\r",
											" * Saves env:\r",
											" *  BANK_TRANSFER_CODE, BANK_SHOW_HINT, BANK_HINT_MESSAGE,\r",
											" *  BANK_CONFIRM_MSG, BANK_TRN_GUID, BANK_OTP_TOKEN,\r",
											" *  resTrnGUID (direct alias)\r",
											" */\r",
											"\r",
											"pm.test(\"HTTP 200\", function () {\r",
											"  pm.response.to.have.status(200);\r",
											"});\r",
											"\r",
											"pm.test(\"Content-Type is JSON\", function () {\r",
											"  pm.response.to.have.header(\"Content-Type\");\r",
											"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
											"});\r",
											"\r",
											"// Parse\r",
											"var json;\r",
											"pm.test(\"Body is valid JSON\", function () {\r",
											"  json = pm.response.json();\r",
											"  pm.expect(json).to.be.an(\"object\");\r",
											"});\r",
											"\r",
											"// Envelope\r",
											"pm.test(\"responseStatus OK (BNKTRANSFERNEW)\", function () {\r",
											"  var rs = json.responseStatus || {};\r",
											"  pm.expect(rs.resCode).to.eql(\"0\");\r",
											"  pm.expect(rs.resDesc).to.eql(\"Successful Operation\");\r",
											"  pm.expect(rs.source).to.eql(\"BNKTRANSFERNEW\");\r",
											"  pm.expect(rs.resCode1).to.eql(\"0\");\r",
											"  pm.expect(rs.resDesc1).to.eql(\"Successful Operation\");\r",
											"});\r",
											"\r",
											"// Node\r",
											"var node = (((json || {}).message || {}).getBankTransferResponse) || {};\r",
											"pm.test(\"getBankTransferResponse exists & has required keys\", function () {\r",
											"  pm.expect(node).to.be.an(\"object\");\r",
											"  var keys = [\r",
											"    \"transferCode\",\"showHint\",\"hintMessage\",\"resConfirmMessage\",\"resTrnGUID\",\"otpToken\",\r",
											"    \"otpLength\",\"otpExpiryPeriod\",\"otpResendPeriod\"\r",
											"  ];\r",
											"  for (var i=0;i<keys.length;i++){\r",
											"    pm.expect(node, \"Missing key: \" + keys[i]).to.have.property(keys[i]);\r",
											"    pm.expect(typeof node[keys[i]], keys[i] + \" must be string\").to.eql(\"string\");\r",
											"  }\r",
											"});\r",
											"\r",
											"// Helpers\r",
											"function isYN(v){ return v === \"Y\" || v === \"N\"; }\r",
											"function getFlag(name, defVal){\r",
											"  var v = pm.environment.get(name) || pm.globals.get(name);\r",
											"  v = (v == null ? \"\" : String(v)).toUpperCase();\r",
											"  if (v !== \"Y\" && v !== \"N\") return defVal;\r",
											"  return v;\r",
											"}\r",
											"\r",
											"// showHint logic\r",
											"pm.test(\"showHint is Y/N\", function () {\r",
											"  pm.expect(isYN(node.showHint), \"showHint must be 'Y' or 'N'\").to.be.true;\r",
											"});\r",
											"\r",
											"// Confirm message (Arabic success text)\r",
											"pm.test(\"resConfirmMessage (required by policy or optional)\", function () {\r",
											"  var requireMsg = getFlag(\"REQUIRE_CONFIRM_MESSAGE\", \"Y\") === \"Y\";\r",
											"  var msg = String(node.resConfirmMessage || \"\");\r",
											"  if (requireMsg) {\r",
											"    pm.expect(msg.replace(/\\s+/g,\"\").length, \"resConfirmMessage should be non-empty\").to.be.greaterThan(0);\r",
											"    var ok =\r",
											"      /تم\\s*قبول\\s*طلب\\s*التحويل/.test(msg) ||\r",
											"      /تم\\s*قبول/.test(msg);\r",
											"    pm.expect(ok, \"resConfirmMessage should indicate success in Arabic\").to.be.true;\r",
											"  }\r",
											"});\r",
											"\r",
											"// OTP configuration checks (exact values)\r",
											"pm.test(\"OTP config: otpLength='4', otpExpiryPeriod='300', otpResendPeriod='60'\", function () {\r",
											"  pm.expect(String(node.otpLength)).to.eql(\"4\");\r",
											"  pm.expect(String(node.otpExpiryPeriod)).to.eql(\"300\");\r",
											"  pm.expect(String(node.otpResendPeriod)).to.eql(\"60\");\r",
											"});\r",
											"\r",
											"// Conditional rules for hint / otp\r",
											"pm.test(\"Hint & OTP conditional rules\", function () {\r",
											"  var requireHintOnY   = getFlag(\"REQUIRE_HINT_ON_Y\", \"N\") === \"Y\";\r",
											"  var requireOtpOnHint = getFlag(\"REQUIRE_OTP_WHEN_HINT\", \"N\") === \"Y\";\r",
											"  var requireEmptyOtpWhenNoHint = getFlag(\"REQUIRE_EMPTY_OTP_WHEN_NOHINT\", \"N\") === \"Y\";\r",
											"\r",
											"  var showHintY = node.showHint === \"Y\";\r",
											"  var hint = String(node.hintMessage || \"\");\r",
											"  var otp  = String(node.otpToken || \"\");\r",
											"\r",
											"  if (showHintY) {\r",
											"    if (requireHintOnY) {\r",
											"      pm.expect(hint.replace(/\\s+/g,\"\").length, \"showHint=Y -> hintMessage must be non-empty\").to.be.greaterThan(0);\r",
											"    }\r",
											"    if (requireOtpOnHint) {\r",
											"      pm.expect(otp.replace(/\\s+/g,\"\").length, \"showHint=Y -> otpToken must be non-empty\").to.be.greaterThan(0);\r",
											"    }\r",
											"  } else {\r",
											"    if (requireEmptyOtpWhenNoHint) {\r",
											"      pm.expect(otp.replace(/\\s+/g,\"\").length, \"showHint=N -> otpToken should be empty\").to.eql(0);\r",
											"    }\r",
											"  }\r",
											"});\r",
											"\r",
											"// Optional: require GUID when success (config)\r",
											"pm.test(\"Transaction GUID requirement (optional)\", function () {\r",
											"  var requireGuid = getFlag(\"REQUIRE_GUID_ON_SUCCESS\", \"N\") === \"Y\";\r",
											"  if (requireGuid) {\r",
											"    pm.expect(String(node.resTrnGUID || \"\").replace(/\\s+/g,\"\").length, \"resTrnGUID required\").to.be.greaterThan(0);\r",
											"  }\r",
											"});\r",
											"\r",
											"// Save to environment\r",
											"(function saveEnv(){\r",
											"  pm.environment.set(\"BANK_TRANSFER_CODE\", String(node.transferCode || \"\"));\r",
											"  pm.environment.set(\"BANK_SHOW_HINT\", String(node.showHint || \"\"));\r",
											"  pm.environment.set(\"BANK_HINT_MESSAGE\", String(node.hintMessage || \"\"));\r",
											"  pm.environment.set(\"BANK_CONFIRM_MSG\", String(node.resConfirmMessage || \"\"));\r",
											"  pm.environment.set(\"BANK_TRN_GUID\", String(node.resTrnGUID || \"\"));\r",
											"  pm.environment.set(\"BANK_OTP_TOKEN\", String(node.otpToken || \"\"));\r",
											"  // direct alias as requested\r",
											"  pm.environment.set(\"resTrnGUID\", String(node.resTrnGUID || \"\"));\r",
											"})();\r",
											"\r",
											"// Minimal schema (tv4)\r",
											"pm.test(\"Schema (minimal) validates\", function () {\r",
											"  var schema = {\r",
											"    type: \"object\",\r",
											"    required: [\"responseStatus\",\"message\"],\r",
											"    properties: {\r",
											"      responseStatus: {\r",
											"        type: \"object\",\r",
											"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
											"        properties: {\r",
											"          resCode:  { \"const\": \"0\" },\r",
											"          resDesc:  { \"const\": \"Successful Operation\" },\r",
											"          source:   { \"const\": \"BNKTRANSFERNEW\" },\r",
											"          resCode1: { \"const\": \"0\" },\r",
											"          resDesc1: { \"const\": \"Successful Operation\" }\r",
											"        }\r",
											"      },\r",
											"      message: {\r",
											"        type: \"object\",\r",
											"        required: [\"getBankTransferResponse\"],\r",
											"        properties: {\r",
											"          getBankTransferResponse: {\r",
											"            type: \"object\",\r",
											"            required: [\r",
											"              \"transferCode\",\"showHint\",\"hintMessage\",\"resConfirmMessage\",\"resTrnGUID\",\"otpToken\",\r",
											"              \"otpLength\",\"otpExpiryPeriod\",\"otpResendPeriod\"\r",
											"            ],\r",
											"            properties: {\r",
											"              transferCode:      { type: \"string\" },\r",
											"              showHint:          { type: \"string\" },\r",
											"              hintMessage:       { type: \"string\" },\r",
											"              resConfirmMessage: { type: \"string\" },\r",
											"              resTrnGUID:        { type: \"string\" },\r",
											"              otpToken:          { type: \"string\" },\r",
											"              otpLength:         { type: \"string\", \"const\": \"4\" },\r",
											"              otpExpiryPeriod:   { type: \"string\", \"const\": \"300\" },\r",
											"              otpResendPeriod:   { type: \"string\", \"const\": \"60\" }\r",
											"            }\r",
											"          }\r",
											"        }\r",
											"      }\r",
											"    }\r",
											"  };\r",
											"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
											"});\r",
											"\r",
											"// Visualizer (compact)\r",
											"(function render(){\r",
											"  var template =\r",
											"    '<style>.t{font-family:system-ui,Segoe UI,Roboto,Arial;font-size:14px;color:#333;width:100%;border-collapse:collapse}' +\r",
											"    '.t th,.t td{border:1px solid #87ceeb;padding:6px;text-align:left}.t th{background:#87ceeb}' +\r",
											"    '.flagY{color:#0a8f08}.flagN{color:#b00020}</style>' +\r",
											"    '<h3>Bank Transfer – Result</h3>' +\r",
											"    '<table class=\"t\"><tbody>' +\r",
											"    '<tr><th>resConfirmMessage</th><td>{{resConfirmMessage}}</td></tr>' +\r",
											"    '<tr><th>showHint</th><td class=\"{{showHintCls}}\">{{showHint}}</td></tr>' +\r",
											"    '<tr><th>hintMessage</th><td>{{hintMessage}}</td></tr>' +\r",
											"    '<tr><th>transferCode</th><td>{{transferCode}}</td></tr>' +\r",
											"    '<tr><th>resTrnGUID</th><td>{{resTrnGUID}}</td></tr>' +\r",
											"    '<tr><th>otpToken</th><td>{{otpToken}}</td></tr>' +\r",
											"    '<tr><th>otpLength</th><td>{{otpLength}}</td></tr>' +\r",
											"    '<tr><th>otpExpiryPeriod</th><td>{{otpExpiryPeriod}}</td></tr>' +\r",
											"    '<tr><th>otpResendPeriod</th><td>{{otpResendPeriod}}</td></tr>' +\r",
											"    '</tbody></table>';\r",
											"\r",
											"  pm.visualizer.set(template, {\r",
											"    resConfirmMessage: String(node.resConfirmMessage || \"\"),\r",
											"    showHint: String(node.showHint || \"\"),\r",
											"    hintMessage: String(node.hintMessage || \"\"),\r",
											"    transferCode: String(node.transferCode || \"\"),\r",
											"    resTrnGUID: String(node.resTrnGUID || \"\"),\r",
											"    otpToken: String(node.otpToken || \"\"),\r",
											"    otpLength: String(node.otpLength || \"\"),\r",
											"    otpExpiryPeriod: String(node.otpExpiryPeriod || \"\"),\r",
											"    otpResendPeriod: String(node.otpResendPeriod || \"\"),\r",
											"    showHintCls: (node.showHint === \"Y\") ? \"flagY\" : \"flagN\"\r",
											"  });\r",
											"})();\r",
											"\r",
											"console.log(\"✅ BNKTRANSFERNEW validated.\", \"showHint=\", node.showHint, \"resTrnGUID=\", node.resTrnGUID);\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Accept",
										"value": "application/json",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\r\n    \"Srv\": \"BNKTRANSFERNEW\",\r\n    \"Message\": {\r\n        \"BankTransferRequest\": {\r\n            \"nin\": \"{{NIN}}\",\r\n            \"userId\": \"{{UserID}}\",\r\n            \"userType\": \"INVESTOR\",\r\n            \"accountNO\": \"{{accountCode_1}}\",\r\n            \"amount\": 555,\r\n            \"swiftCode\": \"{{bnkCode_1}}\",\r\n            \"transferType\": \"FROM\",\r\n            \"accountStatus\": \"4\",\r\n            \"transferTimeId\": \"{{transferTimeId_1}}\",\r\n            \"lang\": \"ARB\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"30-04-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{BaseURL}}{{Oracle19}}",
									"host": [
										"{{BaseURL}}{{Oracle19}}"
									]
								}
							},
							"response": []
						}
					]
				},
				{
					"name": "Withdraw from the Group",
					"item": [
						{
							"name": "Error handling",
							"item": [
								{
									"name": "1. Get Banks info",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"/**\r",
													" * BNKBAL – Bank balances & info (ES5)\r",
													" * Validates:\r",
													" *  - HTTP 200, JSON, envelope codes 0/0, source=\"BNKBAL\"\r",
													" *  - bnkInfoResponse existence and key formats\r",
													" *  - Balance fields are numeric strings; negatives allowed by default (toggle strict)\r",
													" *  - banksInfo.bnkInfoRec / bnkTransfers.bnkTransferRec array shapes\r",
													" *  - financierInfo & fundInfo consistency; creditRatio accepts ratio or percent\r",
													" *  - financierInfo fields accept null/\"null\"/\"\" gracefully\r",
													" * Keeps your extracts:\r",
													" *  - accountSeq_i, bnkCode_i, accountCode_i, transferTimeId_i, bankCount\r",
													" *\r",
													" * Optional toggles (Env/Globals):\r",
													" *  - ENFORCE_NON_NEG_BALANCES = Y|N (default N) -> force balances >= 0\r",
													" */\r",
													"\r",
													"// 1) Status code\r",
													"pm.test(\"Status code is 200\", function () {\r",
													"  pm.response.to.have.status(200);\r",
													"});\r",
													"\r",
													"// 2) Envelope base checks\r",
													"pm.test(\"resCode is 0 and resDesc is Successful Operation\", function () {\r",
													"  var resStatus = (pm.response.json() || {}).responseStatus || {};\r",
													"  pm.expect(resStatus.resCode).to.eql(\"0\");\r",
													"  pm.expect(resStatus.resDesc).to.eql(\"Successful Operation\");\r",
													"});\r",
													"\r",
													"// 3) Extract and set bank info (kept as-is)\r",
													"var __json_for_extract = pm.response.json() || {};\r",
													"var __bnkInfoList = ((((__json_for_extract.message || {}).bnkInfoResponse || {}).banksInfo || {}).bnkInfoRec);\r",
													"\r",
													"if (Array.isArray(__bnkInfoList)) {\r",
													"  // Clear previous values\r",
													"  pm.environment.unset(\"bankCount\");\r",
													"\r",
													"  for (var i = 0; i < __bnkInfoList.length; i++) {\r",
													"    var bnk = __bnkInfoList[i] || {};\r",
													"    pm.environment.set(\"accountSeq_\" + (i + 1), String(bnk.accountSeq || \"\"));\r",
													"    pm.environment.set(\"bnkCode_\" + (i + 1), String(bnk.bnkCode || \"\"));\r",
													"    pm.environment.set(\"accountCode_\" + (i + 1), String(bnk.accountCode || \"\"));\r",
													"    pm.environment.set(\"transferTimeId_\" + (i + 1), String(bnk.transferTimeId || \"\"));\r",
													"  }\r",
													"  pm.environment.set(\"bankCount\", String(__bnkInfoList.length));\r",
													"} else {\r",
													"  console.warn(\"banksInfo.bnkInfoRec not found or invalid\");\r",
													"}\r",
													"\r",
													"// Basic header check\r",
													"pm.test(\"Content-Type is JSON\", function () {\r",
													"  pm.response.to.have.header(\"Content-Type\");\r",
													"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
													"});\r",
													"\r",
													"// Parse once & helpers\r",
													"var json = pm.response.json() || {};\r",
													"var rs   = json.responseStatus || {};\r",
													"var bnr  = (json.message || {}).bnkInfoResponse || {};\r",
													"\r",
													"function isNumericStr(v) {\r",
													"  if (typeof v === \"number\") return isFinite(v);\r",
													"  return typeof v === \"string\" && /^-?\\d+(\\.\\d+)?$/.test(v);\r",
													"}\r",
													"function isIntStr(v) {\r",
													"  if (typeof v === \"number\") return Number.isInteger(v);\r",
													"  return typeof v === \"string\" && /^-?\\d+$/.test(v);\r",
													"}\r",
													"function isYN(v)  { return String(v) === \"Y\" || String(v) === \"N\"; }\r",
													"function isNullish(v) {\r",
													"  return v === null || typeof v === \"undefined\" || String(v).trim().toUpperCase() === \"NULL\" || String(v).trim() === \"\";\r",
													"}\r",
													"\r",
													"// Envelope completeness\r",
													"pm.test(\"Envelope complete (BNKBAL)\", function () {\r",
													"  pm.expect(rs.resCode).to.eql(\"0\");\r",
													"  pm.expect(rs.resDesc).to.eql(\"Successful Operation\");\r",
													"  pm.expect(rs.source).to.eql(\"BNKBAL\");\r",
													"  pm.expect(rs.resCode1).to.eql(\"0\");\r",
													"  pm.expect(rs.resDesc1).to.eql(\"Successful Operation\");\r",
													"});\r",
													"\r",
													"// Core node exists\r",
													"pm.test(\"bnkInfoResponse exists\", function () {\r",
													"  pm.expect(bnr).to.be.an(\"object\");\r",
													"});\r",
													"\r",
													"// Name (if provided)\r",
													"pm.test(\"Customer name (if present) is a non-empty string\", function () {\r",
													"  if (typeof bnr.name !== \"undefined\") {\r",
													"    pm.expect(bnr.name).to.be.a(\"string\").and.to.not.equal(\"\");\r",
													"  }\r",
													"});\r",
													"\r",
													"// Balance fields – allow negatives by default (set ENFORCE_NON_NEG_BALANCES=Y to force >=0)\r",
													"pm.test(\"All balance fields are numeric strings (with optional non-negative enforcement)\", function () {\r",
													"  var keys = [\r",
													"    \"buybal1\",\"currentBal\",\"buyBal\",\"buyBal1\",\"onLineBal1\",\"maxBalance1\",\"unclearedBal\",\r",
													"    \"tradeBal\",\"t3Bal\",\"chqColl\",\"onlineBal\",\"todayDepo\",\"todayDepos\",\"allowedBal\",\r",
													"    \"postponed\",\"reservedFawriBalance\",\"maxbalance\",\"newMaxBalance\"\r",
													"  ];\r",
													"  var enforce = String(pm.environment.get(\"ENFORCE_NON_NEG_BALANCES\") || pm.globals.get(\"ENFORCE_NON_NEG_BALANCES\") || \"N\").toUpperCase() === \"Y\";\r",
													"\r",
													"  for (var i=0;i<keys.length;i++){\r",
													"    var k = keys[i];\r",
													"    if (typeof bnr[k] !== \"undefined\") {\r",
													"      pm.expect(isNumericStr(bnr[k]), k + \" must be numeric\").to.be.true;\r",
													"      if (enforce) {\r",
													"        pm.expect(Number(bnr[k]), k + \" must be >= 0 (strict mode)\").to.be.at.least(0);\r",
													"      }\r",
													"    }\r",
													"  }\r",
													"});\r",
													"\r",
													"// banksInfo array and each record format\r",
													"pm.test(\"banksInfo.bnkInfoRec is array (can be empty)\", function () {\r",
													"  var arr = (((bnr || {}).banksInfo || {}).bnkInfoRec);\r",
													"  pm.expect(arr, \"bnkInfoRec\").to.be.an(\"array\");\r",
													"});\r",
													"\r",
													"(function validateBankRecords(){\r",
													"  var arr = (((bnr || {}).banksInfo || {}).bnkInfoRec) || [];\r",
													"  if (!Array.isArray(arr) || arr.length === 0) return;\r",
													"\r",
													"  for (var i=0;i<arr.length;i++){\r",
													"    var rec = arr[i] || {};\r",
													"\r",
													"    pm.expect(String(rec.accountSeq || \"\"), \"accountSeq\").to.match(/^\\d+$/);\r",
													"\r",
													"    // bankCode: allow alphanumeric 2–10 chars (covers \"QNB\" and \"535\")\r",
													"    if (typeof rec.bankCode !== \"undefined\") {\r",
													"      var bc = String(rec.bankCode || \"\").trim().toUpperCase();\r",
													"      pm.expect(bc, \"bankCode non-empty\").to.not.equal(\"\");\r",
													"      pm.expect(bc, \"bankCode format A–Z/0–9, len 2–10\").to.match(/^[A-Z0-9]{2,10}$/);\r",
													"    }\r",
													"\r",
													"    // SWIFT/BIC strict: 8 or 11 alnum\r",
													"    pm.expect(String(rec.bnkCode || \"\"), \"bnkCode (SWIFT/BIC)\").to.match(/^[A-Z0-9]{8}([A-Z0-9]{3})?$/);\r",
													"\r",
													"    pm.expect(rec.bnkName, \"bnkName\").to.be.a(\"string\").and.not.empty;\r",
													"    pm.expect(rec.accountCode, \"accountCode\").to.be.a(\"string\").and.not.empty;\r",
													"\r",
													"    // accountType: accept BOTH/DEBIT/CREDIT/NO/TOBNK\r",
													"    if (typeof rec.accountType !== \"undefined\") {\r",
													"      pm.expect([\"BOTH\",\"DEBIT\",\"CREDIT\",\"NO\",\"TOBNK\"], \"accountType\")\r",
													"        .to.include(String(rec.accountType).toUpperCase());\r",
													"    }\r",
													"\r",
													"    // status\r",
													"    pm.expect(String(rec.accountStatus || \"\"), \"accountStatus\").to.match(/^\\d+$/);\r",
													"    pm.expect(rec.accountStatusDesc, \"accountStatusDesc\").to.be.a(\"string\").and.not.empty;\r",
													"\r",
													"    if (typeof rec.isSahlPlus !== \"undefined\") {\r",
													"      pm.expect(isYN(String(rec.isSahlPlus)), \"isSahlPlus\").to.be.true;\r",
													"    }\r",
													"\r",
													"    // transferTimeId can be long token; just ensure string & non-empty\r",
													"    pm.expect(rec.transferTimeId, \"transferTimeId\").to.be.a(\"string\").and.not.empty;\r",
													"  }\r",
													"})();\r",
													"\r",
													"// bnkTransfers shape\r",
													"pm.test(\"bnkTransfers.bnkTransferRec is array (may be empty)\", function () {\r",
													"  var tr = (((bnr || {}).bnkTransfers || {}).bnkTransferRec);\r",
													"  pm.expect(tr, \"bnkTransferRec\").to.be.an(\"array\");\r",
													"});\r",
													"\r",
													"// financierInfo (if present) – tolerant of null/\"null\"/\"\"\r",
													"pm.test(\"financierInfo (if present) has valid fields\", function () {\r",
													"  var fi = bnr.financierInfo;\r",
													"  if (fi && typeof fi === \"object\") {\r",
													"    if (!isNullish(fi.financierID)) {\r",
													"      pm.expect(String(fi.financierID)).to.match(/^\\d+$/);\r",
													"    }\r",
													"\r",
													"    if (!isNullish(fi.isActive)) {\r",
													"      pm.expect(isYN(String(fi.isActive))).to.be.true;\r",
													"    }\r",
													"\r",
													"    if (!isNullish(fi.isOrdersEnabled)) {\r",
													"      pm.expect(isYN(String(fi.isOrdersEnabled))).to.be.true;\r",
													"    }\r",
													"\r",
													"    if (!isNullish(fi.riskFeesType)) {\r",
													"      pm.expect([\"0\",\"1\",\"2\",\"3\"]).to.include(String(fi.riskFeesType));\r",
													"    }\r",
													"    // riskFeesValue: validate only when present & not nullish\r",
													"    if (!isNullish(fi.riskFeesValue)) {\r",
													"      pm.expect(isNumericStr(fi.riskFeesValue)).to.be.true;\r",
													"      pm.expect(Number(fi.riskFeesValue)).to.be.at.least(0);\r",
													"    }\r",
													"\r",
													"    if (!isNullish(fi.financierAllowancePeriod)) {\r",
													"      pm.expect(isIntStr(fi.financierAllowancePeriod)).to.be.true;\r",
													"      pm.expect(Number(fi.financierAllowancePeriod)).to.be.at.least(0);\r",
													"    }\r",
													"  }\r",
													"});\r",
													"\r",
													"// fundInfo (margin block; can be N or Y)\r",
													"pm.test(\"fundInfo (if present) is consistent\", function () {\r",
													"  var f = bnr.fundInfo;\r",
													"  if (f && typeof f === \"object\") {\r",
													"    pm.expect(isYN(String(f.isFundClient)), \"isFundClient Y/N\").to.be.true;\r",
													"\r",
													"    if (f.isFundClient === \"Y\") {\r",
													"      var numKeys = [\r",
													"        \"fundDebt\",\"fundAvailableCredit\",\"cashBalanceNotCollected\",\"fundedAmountInMarket\",\r",
													"        \"creditRatio\",\"collectedBalance\",\"actualFunded\",\"shareAvCredit\"\r",
													"      ];\r",
													"      for (var i=0;i<numKeys.length;i++){\r",
													"        var k = numKeys[i];\r",
													"        pm.expect(isNumericStr(String(f[k])), \"fundInfo.\"+k+\" numeric\").to.be.true;\r",
													"        pm.expect(Number(f[k]), \"fundInfo.\"+k+\" >= 0\").to.be.at.least(0);\r",
													"      }\r",
													"\r",
													"      // creditRatio sanity: accept ratio [0..1] OR percent [0..100]\r",
													"      if (!isNullish(f.creditRatio)) {\r",
													"        var cr = Number(f.creditRatio);\r",
													"        if (cr > 1) {\r",
													"          pm.expect(cr, \"creditRatio% in [0, 100]\").to.be.at.least(0).and.at.most(100);\r",
													"          pm.environment.set(\"CREDIT_RATIO\", String(cr / 100));     // normalized 0..1\r",
													"          pm.environment.set(\"CREDIT_RATIO_PCT\", String(cr));       // as percent\r",
													"        } else {\r",
													"          pm.expect(cr, \"creditRatio in [0, 1]\").to.be.at.least(0).and.at.most(1);\r",
													"          pm.environment.set(\"CREDIT_RATIO\", String(cr));           // normalized 0..1\r",
													"          pm.environment.set(\"CREDIT_RATIO_PCT\", String(cr * 100)); // as percent\r",
													"        }\r",
													"      }\r",
													"\r",
													"      if (!isNullish(f.isActiveFundClient)) {\r",
													"        pm.expect(isYN(String(f.isActiveFundClient))).to.be.true;\r",
													"      }\r",
													"    }\r",
													"  }\r",
													"});\r",
													"\r",
													"// resType should reflect request's AccRegisterType (when provided)\r",
													"pm.test(\"resType matches AccRegisterType from request (when provided)\", function () {\r",
													"  var reqBody;\r",
													"  try { reqBody = pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {}; } catch(e){}\r",
													"  var accType = (((reqBody || {}).Message || {}).BalDlsRequest || {}).AccRegisterType;\r",
													"  if (accType) {\r",
													"    pm.expect(bnr.resType, \"resType\").to.eql(String(accType));\r",
													"  }\r",
													"});\r",
													"\r",
													"// Guardrails: request Srv should be BNKBAL\r",
													"pm.test(\"Request Srv is BNKBAL\", function () {\r",
													"  var reqBody;\r",
													"  try { reqBody = pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {}; } catch(e){}\r",
													"  pm.expect((reqBody || {}).Srv).to.eql(\"BNKBAL\");\r",
													"});\r",
													"\r",
													"// Minimal schema (tv4)\r",
													"pm.test(\"Schema (minimal) validates\", function () {\r",
													"  var schema = {\r",
													"    type: \"object\",\r",
													"    required: [\"responseStatus\",\"message\"],\r",
													"    properties: {\r",
													"      responseStatus: {\r",
													"        type: \"object\",\r",
													"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
													"        properties: {\r",
													"          resCode:  { \"const\": \"0\" },\r",
													"          resDesc:  { \"const\": \"Successful Operation\" },\r",
													"          source:   { \"const\": \"BNKBAL\" },\r",
													"          resCode1: { \"const\": \"0\" },\r",
													"          resDesc1: { \"const\": \"Successful Operation\" }\r",
													"        }\r",
													"      },\r",
													"      message: {\r",
													"        type: \"object\",\r",
													"        required: [\"bnkInfoResponse\"],\r",
													"        properties: {\r",
													"          bnkInfoResponse: { type: \"object\" }\r",
													"        }\r",
													"      }\r",
													"    }\r",
													"  };\r",
													"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
													"});\r",
													"\r",
													"// Extra: store a few more env helpers (without touching your extract keys)\r",
													"(function storeExtras(){\r",
													"  var arr = (((bnr || {}).banksInfo || {}).bnkInfoRec) || [];\r",
													"  if (arr.length > 0) {\r",
													"    pm.environment.set(\"firstBankCode\", String(arr[0].bankCode || \"\"));\r",
													"    pm.environment.set(\"firstBankSwift\", String(arr[0].bnkCode || \"\"));\r",
													"    pm.environment.set(\"firstAccountStatus\", String(arr[0].accountStatus || \"\"));\r",
													"  }\r",
													"  pm.environment.set(\"bnkTransfersCount\", String(((((bnr || {}).bnkTransfers || {}).bnkTransferRec) || []).length));\r",
													"})();\r",
													"\r",
													"console.log(\"✅ BNKBAL validated.\",\r",
													"            \"bankCount:\", pm.environment.get(\"bankCount\"),\r",
													"            \"transfers:\", pm.environment.get(\"bnkTransfersCount\"),\r",
													"            \"creditRatio(norm):\", pm.environment.get(\"CREDIT_RATIO\"),\r",
													"            \"creditRatio(%) \", pm.environment.get(\"CREDIT_RATIO_PCT\"));\r",
													""
												],
												"type": "text/javascript",
												"packages": {},
												"requests": {}
											}
										}
									],
									"request": {
										"auth": {
											"type": "noauth"
										},
										"method": "POST",
										"header": [
											{
												"key": "Accept",
												"value": "application/json",
												"type": "text"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\r\n    \"Srv\": \"BNKBAL\",\r\n    \"Message\": {\r\n        \"BalDlsRequest\": {\r\n            \"NIN\": \"{{NIN}}\",\r\n            \"UserId\": \"{{UserID}}\",\r\n            \"UserType\": \"INVESTOR\",\r\n            \"AccRegisterType\": \"ALL\",\r\n            \"Lang\": \"ARB\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"30-04-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}\r\n\r\n\r\n",
											"options": {
												"raw": {
													"language": "json"
												}
											}
										},
										"url": {
											"raw": "{{BaseURL}}{{Oracle19}}",
											"host": [
												"{{BaseURL}}{{Oracle19}}"
											]
										}
									},
									"response": []
								},
								{
									"name": "2. Confirm Over Balance Withdraw Transfer",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"/**\r",
													" * BNKCHKTRANSFERNEW – Confirm Transfer (Popup) validation (ES5)\r",
													" * Validates:\r",
													" *  - Envelope: resCode/resCode1=0, source=\"BNKCHKTRANSFERNEW\"\r",
													" *  - Fields: trnxFees, trnxIsPossible, maximumAmount, hintMessage, urgentFees\r",
													" *  - Numeric strings >= 0 (supports scientific notation); trnxIsPossible is Y/N\r",
													" *  - Optional business rules via env toggles (see header comment)\r",
													" * Saves to env:\r",
													" *  TRX_IS_POSSIBLE, TRX_MAX_AMOUNT, TRX_MAX_AMOUNT_NUM, TRX_FEES, TRX_FEES_NUM,\r",
													" *  TRX_URGENT_FEES, TRX_URGENT_FEES_NUM, TRX_HINT\r",
													" */\r",
													"\r",
													"pm.test(\"HTTP 200\", function () {\r",
													"  pm.response.to.have.status(200);\r",
													"});\r",
													"\r",
													"pm.test(\"Content-Type is JSON\", function () {\r",
													"  pm.response.to.have.header(\"Content-Type\");\r",
													"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
													"});\r",
													"\r",
													"// Parse\r",
													"var json;\r",
													"pm.test(\"Body is valid JSON\", function () {\r",
													"  json = pm.response.json();\r",
													"  pm.expect(json).to.be.an(\"object\");\r",
													"});\r",
													"\r",
													"// Envelope\r",
													"pm.test(\"responseStatus OK (BNKCHKTRANSFERNEW)\", function () {\r",
													"  var rs = json.responseStatus || {};\r",
													"  pm.expect(rs.resCode).to.eql(\"0\");\r",
													"  pm.expect(rs.resDesc).to.eql(\"Successful Operation\");\r",
													"  pm.expect(rs.source).to.eql(\"BNKCHKTRANSFERNEW\");\r",
													"  pm.expect(rs.resCode1).to.eql(\"0\");\r",
													"  pm.expect(rs.resDesc1).to.eql(\"Successful Operation\");\r",
													"});\r",
													"\r",
													"// Node\r",
													"var node = (((json || {}).message || {}).isBankTransferResponse) || {};\r",
													"pm.test(\"isBankTransferResponse exists\", function () {\r",
													"  pm.expect(node).to.be.an(\"object\");\r",
													"  pm.expect(node).to.have.property(\"trnxFees\");\r",
													"  pm.expect(node).to.have.property(\"trnxIsPossible\");\r",
													"  pm.expect(node).to.have.property(\"maximumAmount\");\r",
													"  pm.expect(node).to.have.property(\"hintMessage\");\r",
													"  pm.expect(node).to.have.property(\"urgentFees\");\r",
													"});\r",
													"\r",
													"// Helpers (ES5)\r",
													"// Accepts: integers, decimals, and scientific notation (e.g., 1.23E8, -4e-3)\r",
													"function isNumericStr(v) {\r",
													"  if (typeof v === \"number\") return isFinite(v);\r",
													"  var s = String(v || \"\").trim();\r",
													"  return /^-?(?:\\d+\\.?\\d*|\\d*\\.\\d+)(?:[eE][+\\-]?\\d+)?$/.test(s);\r",
													"}\r",
													"function toNumberSafe(v) { return Number(String(v || \"\").trim()); }\r",
													"function isYN(v) { return v === \"Y\" || v === \"N\"; }\r",
													"function getFlag(name, defVal) {\r",
													"  var v = pm.environment.get(name) || pm.globals.get(name);\r",
													"  v = (v == null ? \"\" : String(v)).toUpperCase();\r",
													"  if (v !== \"Y\" && v !== \"N\") return defVal;\r",
													"  return v;\r",
													"}\r",
													"\r",
													"// Field validations\r",
													"pm.test(\"trnxFees & urgentFees are numeric strings >= 0\", function () {\r",
													"  pm.expect(isNumericStr(node.trnxFees), \"trnxFees must be numeric string\").to.be.true;\r",
													"  pm.expect(isNumericStr(node.urgentFees), \"urgentFees must be numeric string\").to.be.true;\r",
													"  pm.expect(toNumberSafe(node.trnxFees), \"trnxFees >= 0\").to.be.at.least(0);\r",
													"  pm.expect(toNumberSafe(node.urgentFees), \"urgentFees >= 0\").to.be.at.least(0);\r",
													"});\r",
													"\r",
													"pm.test(\"trnxIsPossible is Y/N\", function () {\r",
													"  pm.expect(isYN(node.trnxIsPossible), \"trnxIsPossible must be 'Y' or 'N'\").to.be.true;\r",
													"});\r",
													"\r",
													"pm.test(\"maximumAmount is numeric string >= 0\", function () {\r",
													"  pm.expect(isNumericStr(node.maximumAmount), \"maximumAmount must be numeric string\").to.be.true;\r",
													"  pm.expect(toNumberSafe(node.maximumAmount), \"maximumAmount >= 0\").to.be.at.least(0);\r",
													"});\r",
													"\r",
													"pm.test(\"hintMessage is a string (may be empty on success)\", function () {\r",
													"  pm.expect(typeof node.hintMessage).to.eql(\"string\");\r",
													"});\r",
													"\r",
													"// Business rules (configurable)\r",
													"pm.test(\"Business rules for trnxIsPossible\", function () {\r",
													"  var requireMaxWhenY = getFlag(\"REQUIRE_MAX_GT_ZERO_WHEN_Y\", \"Y\") === \"Y\";\r",
													"  var requireHintOnFail = getFlag(\"REQUIRE_HINT_ON_FAIL\", \"Y\") === \"Y\";\r",
													"  var allowNonZeroWhenN = getFlag(\"ALLOW_NONZERO_MAX_WHEN_N\", \"N\") === \"N\" ? false : true;\r",
													"\r",
													"  var isPossible = node.trnxIsPossible === \"Y\";\r",
													"  var maxNum = toNumberSafe(node.maximumAmount);\r",
													"  var hint = String(node.hintMessage || \"\");\r",
													"\r",
													"  if (isPossible) {\r",
													"    if (requireMaxWhenY) {\r",
													"      pm.expect(maxNum, \"When possible=Y, maximumAmount must be > 0\").to.be.above(0);\r",
													"    }\r",
													"    if (hint && hint.replace(/\\s+/g,\"\").length > 0) {\r",
													"      console.warn(\"Hint provided even though trnxIsPossible=Y:\", hint);\r",
													"    }\r",
													"  } else {\r",
													"    if (requireHintOnFail) {\r",
													"      pm.expect(hint.replace(/\\s+/g,\"\").length, \"When possible=N, hintMessage should be non-empty\").to.be.greaterThan(0);\r",
													"    }\r",
													"    if (!allowNonZeroWhenN) {\r",
													"      pm.expect(maxNum, \"When possible=N, maximumAmount should be 0\").to.eql(0);\r",
													"    }\r",
													"  }\r",
													"});\r",
													"\r",
													"// Save to environment\r",
													"(function saveEnv(){\r",
													"  pm.environment.set(\"TRX_IS_POSSIBLE\", String(node.trnxIsPossible || \"\"));\r",
													"  pm.environment.set(\"TRX_MAX_AMOUNT\", String(node.maximumAmount || \"\"));\r",
													"  pm.environment.set(\"TRX_MAX_AMOUNT_NUM\", String(toNumberSafe(node.maximumAmount)));\r",
													"  pm.environment.set(\"TRX_FEES\", String(node.trnxFees || \"\"));\r",
													"  pm.environment.set(\"TRX_FEES_NUM\", String(toNumberSafe(node.trnxFees)));\r",
													"  pm.environment.set(\"TRX_URGENT_FEES\", String(node.urgentFees || \"\"));\r",
													"  pm.environment.set(\"TRX_URGENT_FEES_NUM\", String(toNumberSafe(node.urgentFees)));\r",
													"  pm.environment.set(\"TRX_HINT\", String(node.hintMessage || \"\"));\r",
													"})();\r",
													"\r",
													"// Minimal schema (tv4)\r",
													"pm.test(\"Schema (minimal) validates\", function () {\r",
													"  var schema = {\r",
													"    type: \"object\",\r",
													"    required: [\"responseStatus\",\"message\"],\r",
													"    properties: {\r",
													"      responseStatus: {\r",
													"        type: \"object\",\r",
													"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
													"        properties: {\r",
													"          resCode:  { \"const\": \"0\" },\r",
													"          resDesc:  { \"const\": \"Successful Operation\" },\r",
													"          source:   { \"const\": \"BNKCHKTRANSFERNEW\" },\r",
													"          resCode1: { \"const\": \"0\" },\r",
													"          resDesc1: { \"const\": \"Successful Operation\" }\r",
													"        }\r",
													"      },\r",
													"      message: {\r",
													"        type: \"object\",\r",
													"        required: [\"isBankTransferResponse\"],\r",
													"        properties: {\r",
													"          isBankTransferResponse: {\r",
													"            type: \"object\",\r",
													"            required: [\"trnxFees\",\"trnxIsPossible\",\"maximumAmount\",\"hintMessage\",\"urgentFees\"],\r",
													"            properties: {\r",
													"              trnxFees:       { type: \"string\" },\r",
													"              trnxIsPossible: { type: \"string\" },\r",
													"              maximumAmount:  { type: \"string\" },\r",
													"              hintMessage:    { type: \"string\" },\r",
													"              urgentFees:     { type: \"string\" }\r",
													"            }\r",
													"          }\r",
													"        }\r",
													"      }\r",
													"    }\r",
													"  };\r",
													"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
													"});\r",
													"\r",
													"// Visualizer (compact)\r",
													"(function render(){\r",
													"  var template =\r",
													"    '<style>.t{font-family:system-ui,Segoe UI,Roboto,Arial;font-size:14px;color:#333;width:100%;border-collapse:collapse}' +\r",
													"    '.t th,.t td{border:1px solid #87ceeb;padding:6px;text-align:left}.t th{background:#87ceeb}' +\r",
													"    '.good{color:#0a8f08}.bad{color:#b00020}</style>' +\r",
													"    '<h3>Confirm Transfer</h3>' +\r",
													"    '<table class=\"t\"><tbody>' +\r",
													"    '<tr><th>trnxIsPossible</th><td class=\"{{possibleCls}}\">{{trnxIsPossible}}</td></tr>' +\r",
													"    '<tr><th>maximumAmount</th><td>{{maximumAmount}}</td></tr>' +\r",
													"    '<tr><th>trnxFees</th><td>{{trnxFees}}</td></tr>' +\r",
													"    '<tr><th>urgentFees</th><td>{{urgentFees}}</td></tr>' +\r",
													"    '<tr><th>hintMessage</th><td>{{hintMessage}}</td></tr>' +\r",
													"    '</tbody></table>';\r",
													"\r",
													"  var possibleCls = (node.trnxIsPossible === \"Y\") ? \"good\" : \"bad\";\r",
													"  pm.visualizer.set(template, {\r",
													"    trnxIsPossible: String(node.trnxIsPossible || \"\"),\r",
													"    maximumAmount: String(node.maximumAmount || \"\"),\r",
													"    trnxFees: String(node.trnxFees || \"\"),\r",
													"    urgentFees: String(node.urgentFees || \"\"),\r",
													"    hintMessage: String(node.hintMessage || \"\"),\r",
													"    possibleCls: possibleCls\r",
													"  });\r",
													"})();\r",
													"\r",
													"console.log(\r",
													"  \"✅ BNKCHKTRANSFERNEW validated.\",\r",
													"  \"possible=\", node.trnxIsPossible,\r",
													"  \"max(raw)=\", node.maximumAmount,\r",
													"  \"max(num)=\", Number(String(node.maximumAmount || \"\").trim())\r",
													");\r",
													""
												],
												"type": "text/javascript",
												"packages": {},
												"requests": {}
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Accept",
												"value": "application/json",
												"type": "text"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\r\n    \"Srv\": \"BNKCHKTRANSFERNEW\",\r\n    \"Message\": {\r\n        \"IsBankTransferRequest\": {\r\n            \"swiftCode\": \"{{bnkCode_1}}\",\r\n            \"accountNO\": \"{{accountSeq_1}}\",\r\n            \"amount\": \"100000000000000\",\r\n            \"nin\": \"{{NIN}}\",\r\n            \"userId\": \"{{UserID}}\",\r\n            \"userType\": \"INVESTOR\",\r\n            \"lang\": \"ARB\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"30-04-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}",
											"options": {
												"raw": {
													"language": "json"
												}
											}
										},
										"url": {
											"raw": "{{BaseURL}}{{Oracle19}}",
											"host": [
												"{{BaseURL}}{{Oracle19}}"
											]
										}
									},
									"response": []
								},
								{
									"name": "3. Fire - Withdraw over balance from The Group",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"/**\r",
													" * BNKTRANSFERNEW – Error: withdraw amount > available balance (ES5)\r",
													" * Validates:\r",
													" *  - HTTP 200, JSON Content-Type\r",
													" *  - responseStatus: resCode/resCode1 = \"20201\"; source = \"BNKTRANSFERNEW\"\r",
													" *  - Arabic message meaning “Not authorized to withdraw this amount” (whitespace/spelling tolerant)\r",
													" *  - No business payload under message (or empty)\r",
													" *  - Optional: if request *amount* and env TRX_MAX_AMOUNT_NUM exist -> amount > max\r",
													" */\r",
													"\r",
													"pm.test(\"HTTP 200\", function () {\r",
													"  pm.response.to.have.status(200);\r",
													"});\r",
													"\r",
													"pm.test(\"Content-Type is JSON\", function () {\r",
													"  pm.response.to.have.header(\"Content-Type\");\r",
													"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
													"});\r",
													"\r",
													"// Parse JSON\r",
													"var json;\r",
													"pm.test(\"Body is valid JSON\", function () {\r",
													"  json = pm.response.json();\r",
													"  pm.expect(json).to.be.an(\"object\");\r",
													"});\r",
													"\r",
													"// -------- Envelope --------\r",
													"pm.test(\"responseStatus indicates business error 20201 (BNKTRANSFERNEW)\", function () {\r",
													"  var rs = json.responseStatus || {};\r",
													"  pm.expect(rs.resCode,  \"resCode\").to.eql(\"20201\");\r",
													"  pm.expect(rs.resCode1, \"resCode1\").to.eql(\"20201\");\r",
													"  pm.expect(rs.source,   \"source\").to.eql(\"BNKTRANSFERNEW\");\r",
													"\r",
													"  // Arabic message check (tolerate whitespace and spelling صلاحية/صلاحيه + trailing space)\r",
													"  function norm(s){\r",
													"    s = String(s == null ? \"\" : s);\r",
													"    s = s.replace(/\\s+/g, \" \").replace(/^\\s+|\\s+$/g, \"\");\r",
													"    // unify \"صلاحية\" vs \"صلاحيه\" by removing dots on ي/ى differences loosely\r",
													"    return s.replace(/صلاحي[هة]/g, \"صلاحية\");\r",
													"  }\r",
													"  var expectedPhrase = \"لا توجد لديك صلاحية لسحب هذا المبلغ\";\r",
													"  pm.expect(norm(rs.resDesc)).to.include(\"سحب هذا المبلغ\");\r",
													"  pm.expect(norm(rs.resDesc1)).to.include(\"سحب هذا المبلغ\");\r",
													"  // soft assert the fuller phrase:\r",
													"  pm.expect(norm(rs.resDesc)).to.include(\"لا توجد لديك صلاحية\");\r",
													"  pm.expect(norm(rs.resDesc1)).to.include(\"لا توجد لديك صلاحية\");\r",
													"});\r",
													"\r",
													"// -------- No business payload on error --------\r",
													"pm.test(\"No business payload returned on error\", function () {\r",
													"  var msg = json.message;\r",
													"  var ok = (msg == null) ||\r",
													"           (typeof msg === \"object\" && Object.keys(msg).length === 0);\r",
													"  pm.expect(ok, \"message should be absent or empty for error\").to.be.true;\r",
													"});\r",
													"\r",
													"// -------- Optional: request amount > max allowed (if both known) --------\r",
													"pm.test(\"Requested amount exceeds maximum (if comparable)\", function () {\r",
													"  // Find a numeric amount in the request body by key name /amount/i\r",
													"  function parseBody() {\r",
													"    try {\r",
													"      return pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {};\r",
													"    } catch (e) {\r",
													"      return {};\r",
													"    }\r",
													"  }\r",
													"  function findFirstAmount(obj) {\r",
													"    if (!obj || typeof obj !== \"object\") return null;\r",
													"    for (var k in obj) {\r",
													"      if (!obj.hasOwnProperty(k)) continue;\r",
													"      var v = obj[k];\r",
													"      if (typeof k === \"string\" && /amount/i.test(k)) {\r",
													"        var s = String(v);\r",
													"        if (/^-?\\d+(\\.\\d+)?$/.test(s)) return Number(s);\r",
													"      }\r",
													"      if (v && typeof v === \"object\") {\r",
													"        var nested = findFirstAmount(v);\r",
													"        if (nested !== null) return nested;\r",
													"      }\r",
													"    }\r",
													"    return null;\r",
													"  }\r",
													"\r",
													"  var reqBody = parseBody();\r",
													"  var reqAmt = findFirstAmount(reqBody);\r",
													"  var maxStr = pm.environment.get(\"TRX_MAX_AMOUNT_NUM\");\r",
													"  var maxNum = (maxStr == null || maxStr === \"\") ? NaN : Number(maxStr);\r",
													"\r",
													"  if (reqAmt !== null && !isNaN(maxNum)) {\r",
													"    pm.expect(reqAmt, \"Requested amount should be > maximum allowed\").to.be.above(maxNum);\r",
													"  } else {\r",
													"    console.warn(\"Skipped comparison: request amount or TRX_MAX_AMOUNT_NUM not available.\",\r",
													"                 \"reqAmt=\", reqAmt, \"TRX_MAX_AMOUNT_NUM=\", maxStr);\r",
													"  }\r",
													"});\r",
													"\r",
													"// -------- Minimal schema (tv4) --------\r",
													"pm.test(\"Error schema (minimal) is valid\", function () {\r",
													"  var schema = {\r",
													"    type: \"object\",\r",
													"    required: [\"responseStatus\"],\r",
													"    properties: {\r",
													"      responseStatus: {\r",
													"        type: \"object\",\r",
													"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
													"        properties: {\r",
													"          resCode:  { \"const\": \"20201\" },\r",
													"          resDesc:  { \"type\": \"string\" },\r",
													"          source:   { \"const\": \"BNKTRANSFERNEW\" },\r",
													"          resCode1: { \"const\": \"20201\" },\r",
													"          resDesc1: { \"type\": \"string\" }\r",
													"        }\r",
													"      }\r",
													"    },\r",
													"    additionalProperties: true\r",
													"  };\r",
													"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
													"});\r",
													"\r",
													"// -------- Diagnostics --------\r",
													"console.log(\"❌ BNKTRANSFERNEW business error 20201 (amount > available).\");\r",
													""
												],
												"type": "text/javascript",
												"packages": {},
												"requests": {}
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Accept",
												"value": "application/json",
												"type": "text"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\r\n    \"Srv\": \"BNKTRANSFERNEW\",\r\n    \"Message\": {\r\n        \"BankTransferRequest\": {\r\n            \"nin\": \"{{NIN}}\",\r\n            \"userId\": \"{{UserID}}\",\r\n            \"userType\": \"INVESTOR\",\r\n            \"accountNO\": \"{{accountCode_1}}\",\r\n            \"amount\": 10000000,\r\n            \"swiftCode\": \"{{bnkCode_1}}\",\r\n            \"transferType\": \"TO\",\r\n            \"accountStatus\": \"4\",\r\n            \"transferTimeId\": \"{{transferTimeId_1}}\",\r\n            \"lang\": \"ARB\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"30-04-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}",
											"options": {
												"raw": {
													"language": "json"
												}
											}
										},
										"url": {
											"raw": "{{BaseURL}}{{Oracle19}}",
											"host": [
												"{{BaseURL}}{{Oracle19}}"
											]
										}
									},
									"response": []
								}
							]
						},
						{
							"name": "1. Get Banks info",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"/**\r",
											" * BNKBAL – Bank balances & info (ES5)\r",
											" * Validates:\r",
											" *  - HTTP 200, JSON, envelope codes 0/0, source=\"BNKBAL\"\r",
											" *  - bnkInfoResponse existence and key formats\r",
											" *  - Balance fields are numeric strings; negatives allowed by default (toggle strict)\r",
											" *  - banksInfo.bnkInfoRec / bnkTransfers.bnkTransferRec array shapes\r",
											" *  - financierInfo & fundInfo consistency; creditRatio accepts ratio or percent\r",
											" *  - financierInfo fields accept null/\"null\"/\"\" gracefully\r",
											" * Keeps your extracts:\r",
											" *  - accountSeq_i, bnkCode_i, accountCode_i, transferTimeId_i, bankCount\r",
											" *\r",
											" * Optional toggles (Env/Globals):\r",
											" *  - ENFORCE_NON_NEG_BALANCES = Y|N (default N) -> force balances >= 0\r",
											" */\r",
											"\r",
											"// 1) Status code\r",
											"pm.test(\"Status code is 200\", function () {\r",
											"  pm.response.to.have.status(200);\r",
											"});\r",
											"\r",
											"// 2) Envelope base checks\r",
											"pm.test(\"resCode is 0 and resDesc is Successful Operation\", function () {\r",
											"  var resStatus = (pm.response.json() || {}).responseStatus || {};\r",
											"  pm.expect(resStatus.resCode).to.eql(\"0\");\r",
											"  pm.expect(resStatus.resDesc).to.eql(\"Successful Operation\");\r",
											"});\r",
											"\r",
											"// 3) Extract and set bank info (kept as-is)\r",
											"var __json_for_extract = pm.response.json() || {};\r",
											"var __bnkInfoList = ((((__json_for_extract.message || {}).bnkInfoResponse || {}).banksInfo || {}).bnkInfoRec);\r",
											"\r",
											"if (Array.isArray(__bnkInfoList)) {\r",
											"  // Clear previous values\r",
											"  pm.environment.unset(\"bankCount\");\r",
											"\r",
											"  for (var i = 0; i < __bnkInfoList.length; i++) {\r",
											"    var bnk = __bnkInfoList[i] || {};\r",
											"    pm.environment.set(\"accountSeq_\" + (i + 1), String(bnk.accountSeq || \"\"));\r",
											"    pm.environment.set(\"bnkCode_\" + (i + 1), String(bnk.bnkCode || \"\"));\r",
											"    pm.environment.set(\"accountCode_\" + (i + 1), String(bnk.accountCode || \"\"));\r",
											"    pm.environment.set(\"transferTimeId_\" + (i + 1), String(bnk.transferTimeId || \"\"));\r",
											"  }\r",
											"  pm.environment.set(\"bankCount\", String(__bnkInfoList.length));\r",
											"} else {\r",
											"  console.warn(\"banksInfo.bnkInfoRec not found or invalid\");\r",
											"}\r",
											"\r",
											"// Basic header check\r",
											"pm.test(\"Content-Type is JSON\", function () {\r",
											"  pm.response.to.have.header(\"Content-Type\");\r",
											"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
											"});\r",
											"\r",
											"// Parse once & helpers\r",
											"var json = pm.response.json() || {};\r",
											"var rs   = json.responseStatus || {};\r",
											"var bnr  = (json.message || {}).bnkInfoResponse || {};\r",
											"\r",
											"function isNumericStr(v) {\r",
											"  if (typeof v === \"number\") return isFinite(v);\r",
											"  return typeof v === \"string\" && /^-?\\d+(\\.\\d+)?$/.test(v);\r",
											"}\r",
											"function isIntStr(v) {\r",
											"  if (typeof v === \"number\") return Number.isInteger(v);\r",
											"  return typeof v === \"string\" && /^-?\\d+$/.test(v);\r",
											"}\r",
											"function isYN(v)  { return String(v) === \"Y\" || String(v) === \"N\"; }\r",
											"function isNullish(v) {\r",
											"  return v === null || typeof v === \"undefined\" || String(v).trim().toUpperCase() === \"NULL\" || String(v).trim() === \"\";\r",
											"}\r",
											"\r",
											"// Envelope completeness\r",
											"pm.test(\"Envelope complete (BNKBAL)\", function () {\r",
											"  pm.expect(rs.resCode).to.eql(\"0\");\r",
											"  pm.expect(rs.resDesc).to.eql(\"Successful Operation\");\r",
											"  pm.expect(rs.source).to.eql(\"BNKBAL\");\r",
											"  pm.expect(rs.resCode1).to.eql(\"0\");\r",
											"  pm.expect(rs.resDesc1).to.eql(\"Successful Operation\");\r",
											"});\r",
											"\r",
											"// Core node exists\r",
											"pm.test(\"bnkInfoResponse exists\", function () {\r",
											"  pm.expect(bnr).to.be.an(\"object\");\r",
											"});\r",
											"\r",
											"// Name (if provided)\r",
											"pm.test(\"Customer name (if present) is a non-empty string\", function () {\r",
											"  if (typeof bnr.name !== \"undefined\") {\r",
											"    pm.expect(bnr.name).to.be.a(\"string\").and.to.not.equal(\"\");\r",
											"  }\r",
											"});\r",
											"\r",
											"// Balance fields – allow negatives by default (set ENFORCE_NON_NEG_BALANCES=Y to force >=0)\r",
											"pm.test(\"All balance fields are numeric strings (with optional non-negative enforcement)\", function () {\r",
											"  var keys = [\r",
											"    \"buybal1\",\"currentBal\",\"buyBal\",\"buyBal1\",\"onLineBal1\",\"maxBalance1\",\"unclearedBal\",\r",
											"    \"tradeBal\",\"t3Bal\",\"chqColl\",\"onlineBal\",\"todayDepo\",\"todayDepos\",\"allowedBal\",\r",
											"    \"postponed\",\"reservedFawriBalance\",\"maxbalance\",\"newMaxBalance\"\r",
											"  ];\r",
											"  var enforce = String(pm.environment.get(\"ENFORCE_NON_NEG_BALANCES\") || pm.globals.get(\"ENFORCE_NON_NEG_BALANCES\") || \"N\").toUpperCase() === \"Y\";\r",
											"\r",
											"  for (var i=0;i<keys.length;i++){\r",
											"    var k = keys[i];\r",
											"    if (typeof bnr[k] !== \"undefined\") {\r",
											"      pm.expect(isNumericStr(bnr[k]), k + \" must be numeric\").to.be.true;\r",
											"      if (enforce) {\r",
											"        pm.expect(Number(bnr[k]), k + \" must be >= 0 (strict mode)\").to.be.at.least(0);\r",
											"      }\r",
											"    }\r",
											"  }\r",
											"});\r",
											"\r",
											"// banksInfo array and each record format\r",
											"pm.test(\"banksInfo.bnkInfoRec is array (can be empty)\", function () {\r",
											"  var arr = (((bnr || {}).banksInfo || {}).bnkInfoRec);\r",
											"  pm.expect(arr, \"bnkInfoRec\").to.be.an(\"array\");\r",
											"});\r",
											"\r",
											"(function validateBankRecords(){\r",
											"  var arr = (((bnr || {}).banksInfo || {}).bnkInfoRec) || [];\r",
											"  if (!Array.isArray(arr) || arr.length === 0) return;\r",
											"\r",
											"  for (var i=0;i<arr.length;i++){\r",
											"    var rec = arr[i] || {};\r",
											"\r",
											"    pm.expect(String(rec.accountSeq || \"\"), \"accountSeq\").to.match(/^\\d+$/);\r",
											"\r",
											"    // bankCode: allow alphanumeric 2–10 chars (covers \"QNB\" and \"535\")\r",
											"    if (typeof rec.bankCode !== \"undefined\") {\r",
											"      var bc = String(rec.bankCode || \"\").trim().toUpperCase();\r",
											"      pm.expect(bc, \"bankCode non-empty\").to.not.equal(\"\");\r",
											"      pm.expect(bc, \"bankCode format A–Z/0–9, len 2–10\").to.match(/^[A-Z0-9]{2,10}$/);\r",
											"    }\r",
											"\r",
											"    // SWIFT/BIC strict: 8 or 11 alnum\r",
											"    pm.expect(String(rec.bnkCode || \"\"), \"bnkCode (SWIFT/BIC)\").to.match(/^[A-Z0-9]{8}([A-Z0-9]{3})?$/);\r",
											"\r",
											"    pm.expect(rec.bnkName, \"bnkName\").to.be.a(\"string\").and.not.empty;\r",
											"    pm.expect(rec.accountCode, \"accountCode\").to.be.a(\"string\").and.not.empty;\r",
											"\r",
											"    // accountType: accept BOTH/DEBIT/CREDIT/NO/TOBNK\r",
											"    if (typeof rec.accountType !== \"undefined\") {\r",
											"      pm.expect([\"BOTH\",\"DEBIT\",\"CREDIT\",\"NO\",\"TOBNK\"], \"accountType\")\r",
											"        .to.include(String(rec.accountType).toUpperCase());\r",
											"    }\r",
											"\r",
											"    // status\r",
											"    pm.expect(String(rec.accountStatus || \"\"), \"accountStatus\").to.match(/^\\d+$/);\r",
											"    pm.expect(rec.accountStatusDesc, \"accountStatusDesc\").to.be.a(\"string\").and.not.empty;\r",
											"\r",
											"    if (typeof rec.isSahlPlus !== \"undefined\") {\r",
											"      pm.expect(isYN(String(rec.isSahlPlus)), \"isSahlPlus\").to.be.true;\r",
											"    }\r",
											"\r",
											"    // transferTimeId can be long token; just ensure string & non-empty\r",
											"    pm.expect(rec.transferTimeId, \"transferTimeId\").to.be.a(\"string\").and.not.empty;\r",
											"  }\r",
											"})();\r",
											"\r",
											"// bnkTransfers shape\r",
											"pm.test(\"bnkTransfers.bnkTransferRec is array (may be empty)\", function () {\r",
											"  var tr = (((bnr || {}).bnkTransfers || {}).bnkTransferRec);\r",
											"  pm.expect(tr, \"bnkTransferRec\").to.be.an(\"array\");\r",
											"});\r",
											"\r",
											"// financierInfo (if present) – tolerant of null/\"null\"/\"\"\r",
											"pm.test(\"financierInfo (if present) has valid fields\", function () {\r",
											"  var fi = bnr.financierInfo;\r",
											"  if (fi && typeof fi === \"object\") {\r",
											"    if (!isNullish(fi.financierID)) {\r",
											"      pm.expect(String(fi.financierID)).to.match(/^\\d+$/);\r",
											"    }\r",
											"\r",
											"    if (!isNullish(fi.isActive)) {\r",
											"      pm.expect(isYN(String(fi.isActive))).to.be.true;\r",
											"    }\r",
											"\r",
											"    if (!isNullish(fi.isOrdersEnabled)) {\r",
											"      pm.expect(isYN(String(fi.isOrdersEnabled))).to.be.true;\r",
											"    }\r",
											"\r",
											"    if (!isNullish(fi.riskFeesType)) {\r",
											"      pm.expect([\"0\",\"1\",\"2\",\"3\"]).to.include(String(fi.riskFeesType));\r",
											"    }\r",
											"    // riskFeesValue: validate only when present & not nullish\r",
											"    if (!isNullish(fi.riskFeesValue)) {\r",
											"      pm.expect(isNumericStr(fi.riskFeesValue)).to.be.true;\r",
											"      pm.expect(Number(fi.riskFeesValue)).to.be.at.least(0);\r",
											"    }\r",
											"\r",
											"    if (!isNullish(fi.financierAllowancePeriod)) {\r",
											"      pm.expect(isIntStr(fi.financierAllowancePeriod)).to.be.true;\r",
											"      pm.expect(Number(fi.financierAllowancePeriod)).to.be.at.least(0);\r",
											"    }\r",
											"  }\r",
											"});\r",
											"\r",
											"// fundInfo (margin block; can be N or Y)\r",
											"pm.test(\"fundInfo (if present) is consistent\", function () {\r",
											"  var f = bnr.fundInfo;\r",
											"  if (f && typeof f === \"object\") {\r",
											"    pm.expect(isYN(String(f.isFundClient)), \"isFundClient Y/N\").to.be.true;\r",
											"\r",
											"    if (f.isFundClient === \"Y\") {\r",
											"      var numKeys = [\r",
											"        \"fundDebt\",\"fundAvailableCredit\",\"cashBalanceNotCollected\",\"fundedAmountInMarket\",\r",
											"        \"creditRatio\",\"collectedBalance\",\"actualFunded\",\"shareAvCredit\"\r",
											"      ];\r",
											"      for (var i=0;i<numKeys.length;i++){\r",
											"        var k = numKeys[i];\r",
											"        pm.expect(isNumericStr(String(f[k])), \"fundInfo.\"+k+\" numeric\").to.be.true;\r",
											"        pm.expect(Number(f[k]), \"fundInfo.\"+k+\" >= 0\").to.be.at.least(0);\r",
											"      }\r",
											"\r",
											"      // creditRatio sanity: accept ratio [0..1] OR percent [0..100]\r",
											"      if (!isNullish(f.creditRatio)) {\r",
											"        var cr = Number(f.creditRatio);\r",
											"        if (cr > 1) {\r",
											"          pm.expect(cr, \"creditRatio% in [0, 100]\").to.be.at.least(0).and.at.most(100);\r",
											"          pm.environment.set(\"CREDIT_RATIO\", String(cr / 100));     // normalized 0..1\r",
											"          pm.environment.set(\"CREDIT_RATIO_PCT\", String(cr));       // as percent\r",
											"        } else {\r",
											"          pm.expect(cr, \"creditRatio in [0, 1]\").to.be.at.least(0).and.at.most(1);\r",
											"          pm.environment.set(\"CREDIT_RATIO\", String(cr));           // normalized 0..1\r",
											"          pm.environment.set(\"CREDIT_RATIO_PCT\", String(cr * 100)); // as percent\r",
											"        }\r",
											"      }\r",
											"\r",
											"      if (!isNullish(f.isActiveFundClient)) {\r",
											"        pm.expect(isYN(String(f.isActiveFundClient))).to.be.true;\r",
											"      }\r",
											"    }\r",
											"  }\r",
											"});\r",
											"\r",
											"// resType should reflect request's AccRegisterType (when provided)\r",
											"pm.test(\"resType matches AccRegisterType from request (when provided)\", function () {\r",
											"  var reqBody;\r",
											"  try { reqBody = pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {}; } catch(e){}\r",
											"  var accType = (((reqBody || {}).Message || {}).BalDlsRequest || {}).AccRegisterType;\r",
											"  if (accType) {\r",
											"    pm.expect(bnr.resType, \"resType\").to.eql(String(accType));\r",
											"  }\r",
											"});\r",
											"\r",
											"// Guardrails: request Srv should be BNKBAL\r",
											"pm.test(\"Request Srv is BNKBAL\", function () {\r",
											"  var reqBody;\r",
											"  try { reqBody = pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {}; } catch(e){}\r",
											"  pm.expect((reqBody || {}).Srv).to.eql(\"BNKBAL\");\r",
											"});\r",
											"\r",
											"// Minimal schema (tv4)\r",
											"pm.test(\"Schema (minimal) validates\", function () {\r",
											"  var schema = {\r",
											"    type: \"object\",\r",
											"    required: [\"responseStatus\",\"message\"],\r",
											"    properties: {\r",
											"      responseStatus: {\r",
											"        type: \"object\",\r",
											"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
											"        properties: {\r",
											"          resCode:  { \"const\": \"0\" },\r",
											"          resDesc:  { \"const\": \"Successful Operation\" },\r",
											"          source:   { \"const\": \"BNKBAL\" },\r",
											"          resCode1: { \"const\": \"0\" },\r",
											"          resDesc1: { \"const\": \"Successful Operation\" }\r",
											"        }\r",
											"      },\r",
											"      message: {\r",
											"        type: \"object\",\r",
											"        required: [\"bnkInfoResponse\"],\r",
											"        properties: {\r",
											"          bnkInfoResponse: { type: \"object\" }\r",
											"        }\r",
											"      }\r",
											"    }\r",
											"  };\r",
											"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
											"});\r",
											"\r",
											"// Extra: store a few more env helpers (without touching your extract keys)\r",
											"(function storeExtras(){\r",
											"  var arr = (((bnr || {}).banksInfo || {}).bnkInfoRec) || [];\r",
											"  if (arr.length > 0) {\r",
											"    pm.environment.set(\"firstBankCode\", String(arr[0].bankCode || \"\"));\r",
											"    pm.environment.set(\"firstBankSwift\", String(arr[0].bnkCode || \"\"));\r",
											"    pm.environment.set(\"firstAccountStatus\", String(arr[0].accountStatus || \"\"));\r",
											"  }\r",
											"  pm.environment.set(\"bnkTransfersCount\", String(((((bnr || {}).bnkTransfers || {}).bnkTransferRec) || []).length));\r",
											"})();\r",
											"\r",
											"console.log(\"✅ BNKBAL validated.\",\r",
											"            \"bankCount:\", pm.environment.get(\"bankCount\"),\r",
											"            \"transfers:\", pm.environment.get(\"bnkTransfersCount\"),\r",
											"            \"creditRatio(norm):\", pm.environment.get(\"CREDIT_RATIO\"),\r",
											"            \"creditRatio(%) \", pm.environment.get(\"CREDIT_RATIO_PCT\"));\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "noauth"
								},
								"method": "POST",
								"header": [
									{
										"key": "Accept",
										"value": "application/json",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\r\n    \"Srv\": \"BNKBAL\",\r\n    \"Message\": {\r\n        \"BalDlsRequest\": {\r\n            \"NIN\": \"{{NIN}}\",\r\n            \"UserId\": \"{{UserID}}\",\r\n            \"UserType\": \"INVESTOR\",\r\n            \"AccRegisterType\": \"ALL\",\r\n            \"Lang\": \"ARB\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"30-04-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}\r\n\r\n\r\n",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{BaseURL}}{{Oracle19}}",
									"host": [
										"{{BaseURL}}{{Oracle19}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "2. Confirm Withdraw Transfer",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"/**\r",
											" * BNKCHKTRANSFERNEW – Confirm Transfer (Popup) validation (ES5)\r",
											" * Validates:\r",
											" *  - Envelope: resCode/resCode1=0, source=\"BNKCHKTRANSFERNEW\"\r",
											" *  - Fields: trnxFees, trnxIsPossible, maximumAmount, hintMessage, urgentFees\r",
											" *  - Numeric strings >= 0 (supports scientific notation); trnxIsPossible is Y/N\r",
											" *  - Optional business rules via env toggles (see header comment)\r",
											" * Saves to env:\r",
											" *  TRX_IS_POSSIBLE, TRX_MAX_AMOUNT, TRX_MAX_AMOUNT_NUM, TRX_FEES, TRX_FEES_NUM,\r",
											" *  TRX_URGENT_FEES, TRX_URGENT_FEES_NUM, TRX_HINT\r",
											" */\r",
											"\r",
											"pm.test(\"HTTP 200\", function () {\r",
											"  pm.response.to.have.status(200);\r",
											"});\r",
											"\r",
											"pm.test(\"Content-Type is JSON\", function () {\r",
											"  pm.response.to.have.header(\"Content-Type\");\r",
											"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
											"});\r",
											"\r",
											"// Parse\r",
											"var json;\r",
											"pm.test(\"Body is valid JSON\", function () {\r",
											"  json = pm.response.json();\r",
											"  pm.expect(json).to.be.an(\"object\");\r",
											"});\r",
											"\r",
											"// Envelope\r",
											"pm.test(\"responseStatus OK (BNKCHKTRANSFERNEW)\", function () {\r",
											"  var rs = json.responseStatus || {};\r",
											"  pm.expect(rs.resCode).to.eql(\"0\");\r",
											"  pm.expect(rs.resDesc).to.eql(\"Successful Operation\");\r",
											"  pm.expect(rs.source).to.eql(\"BNKCHKTRANSFERNEW\");\r",
											"  pm.expect(rs.resCode1).to.eql(\"0\");\r",
											"  pm.expect(rs.resDesc1).to.eql(\"Successful Operation\");\r",
											"});\r",
											"\r",
											"// Node\r",
											"var node = (((json || {}).message || {}).isBankTransferResponse) || {};\r",
											"pm.test(\"isBankTransferResponse exists\", function () {\r",
											"  pm.expect(node).to.be.an(\"object\");\r",
											"  pm.expect(node).to.have.property(\"trnxFees\");\r",
											"  pm.expect(node).to.have.property(\"trnxIsPossible\");\r",
											"  pm.expect(node).to.have.property(\"maximumAmount\");\r",
											"  pm.expect(node).to.have.property(\"hintMessage\");\r",
											"  pm.expect(node).to.have.property(\"urgentFees\");\r",
											"});\r",
											"\r",
											"// Helpers (ES5)\r",
											"// Accepts: integers, decimals, and scientific notation (e.g., 1.23E8, -4e-3)\r",
											"function isNumericStr(v) {\r",
											"  if (typeof v === \"number\") return isFinite(v);\r",
											"  var s = String(v || \"\").trim();\r",
											"  return /^-?(?:\\d+\\.?\\d*|\\d*\\.\\d+)(?:[eE][+\\-]?\\d+)?$/.test(s);\r",
											"}\r",
											"function toNumberSafe(v) { return Number(String(v || \"\").trim()); }\r",
											"function isYN(v) { return v === \"Y\" || v === \"N\"; }\r",
											"function getFlag(name, defVal) {\r",
											"  var v = pm.environment.get(name) || pm.globals.get(name);\r",
											"  v = (v == null ? \"\" : String(v)).toUpperCase();\r",
											"  if (v !== \"Y\" && v !== \"N\") return defVal;\r",
											"  return v;\r",
											"}\r",
											"\r",
											"// Field validations\r",
											"pm.test(\"trnxFees & urgentFees are numeric strings >= 0\", function () {\r",
											"  pm.expect(isNumericStr(node.trnxFees), \"trnxFees must be numeric string\").to.be.true;\r",
											"  pm.expect(isNumericStr(node.urgentFees), \"urgentFees must be numeric string\").to.be.true;\r",
											"  pm.expect(toNumberSafe(node.trnxFees), \"trnxFees >= 0\").to.be.at.least(0);\r",
											"  pm.expect(toNumberSafe(node.urgentFees), \"urgentFees >= 0\").to.be.at.least(0);\r",
											"});\r",
											"\r",
											"pm.test(\"trnxIsPossible is Y/N\", function () {\r",
											"  pm.expect(isYN(node.trnxIsPossible), \"trnxIsPossible must be 'Y' or 'N'\").to.be.true;\r",
											"});\r",
											"\r",
											"pm.test(\"maximumAmount is numeric string >= 0\", function () {\r",
											"  pm.expect(isNumericStr(node.maximumAmount), \"maximumAmount must be numeric string\").to.be.true;\r",
											"  pm.expect(toNumberSafe(node.maximumAmount), \"maximumAmount >= 0\").to.be.at.least(0);\r",
											"});\r",
											"\r",
											"pm.test(\"hintMessage is a string (may be empty on success)\", function () {\r",
											"  pm.expect(typeof node.hintMessage).to.eql(\"string\");\r",
											"});\r",
											"\r",
											"// Business rules (configurable)\r",
											"pm.test(\"Business rules for trnxIsPossible\", function () {\r",
											"  var requireMaxWhenY = getFlag(\"REQUIRE_MAX_GT_ZERO_WHEN_Y\", \"Y\") === \"Y\";\r",
											"  var requireHintOnFail = getFlag(\"REQUIRE_HINT_ON_FAIL\", \"Y\") === \"Y\";\r",
											"  var allowNonZeroWhenN = getFlag(\"ALLOW_NONZERO_MAX_WHEN_N\", \"N\") === \"N\" ? false : true;\r",
											"\r",
											"  var isPossible = node.trnxIsPossible === \"Y\";\r",
											"  var maxNum = toNumberSafe(node.maximumAmount);\r",
											"  var hint = String(node.hintMessage || \"\");\r",
											"\r",
											"  if (isPossible) {\r",
											"    if (requireMaxWhenY) {\r",
											"      pm.expect(maxNum, \"When possible=Y, maximumAmount must be > 0\").to.be.above(0);\r",
											"    }\r",
											"    if (hint && hint.replace(/\\s+/g,\"\").length > 0) {\r",
											"      console.warn(\"Hint provided even though trnxIsPossible=Y:\", hint);\r",
											"    }\r",
											"  } else {\r",
											"    if (requireHintOnFail) {\r",
											"      pm.expect(hint.replace(/\\s+/g,\"\").length, \"When possible=N, hintMessage should be non-empty\").to.be.greaterThan(0);\r",
											"    }\r",
											"    if (!allowNonZeroWhenN) {\r",
											"      pm.expect(maxNum, \"When possible=N, maximumAmount should be 0\").to.eql(0);\r",
											"    }\r",
											"  }\r",
											"});\r",
											"\r",
											"// Save to environment\r",
											"(function saveEnv(){\r",
											"  pm.environment.set(\"TRX_IS_POSSIBLE\", String(node.trnxIsPossible || \"\"));\r",
											"  pm.environment.set(\"TRX_MAX_AMOUNT\", String(node.maximumAmount || \"\"));\r",
											"  pm.environment.set(\"TRX_MAX_AMOUNT_NUM\", String(toNumberSafe(node.maximumAmount)));\r",
											"  pm.environment.set(\"TRX_FEES\", String(node.trnxFees || \"\"));\r",
											"  pm.environment.set(\"TRX_FEES_NUM\", String(toNumberSafe(node.trnxFees)));\r",
											"  pm.environment.set(\"TRX_URGENT_FEES\", String(node.urgentFees || \"\"));\r",
											"  pm.environment.set(\"TRX_URGENT_FEES_NUM\", String(toNumberSafe(node.urgentFees)));\r",
											"  pm.environment.set(\"TRX_HINT\", String(node.hintMessage || \"\"));\r",
											"})();\r",
											"\r",
											"// Minimal schema (tv4)\r",
											"pm.test(\"Schema (minimal) validates\", function () {\r",
											"  var schema = {\r",
											"    type: \"object\",\r",
											"    required: [\"responseStatus\",\"message\"],\r",
											"    properties: {\r",
											"      responseStatus: {\r",
											"        type: \"object\",\r",
											"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
											"        properties: {\r",
											"          resCode:  { \"const\": \"0\" },\r",
											"          resDesc:  { \"const\": \"Successful Operation\" },\r",
											"          source:   { \"const\": \"BNKCHKTRANSFERNEW\" },\r",
											"          resCode1: { \"const\": \"0\" },\r",
											"          resDesc1: { \"const\": \"Successful Operation\" }\r",
											"        }\r",
											"      },\r",
											"      message: {\r",
											"        type: \"object\",\r",
											"        required: [\"isBankTransferResponse\"],\r",
											"        properties: {\r",
											"          isBankTransferResponse: {\r",
											"            type: \"object\",\r",
											"            required: [\"trnxFees\",\"trnxIsPossible\",\"maximumAmount\",\"hintMessage\",\"urgentFees\"],\r",
											"            properties: {\r",
											"              trnxFees:       { type: \"string\" },\r",
											"              trnxIsPossible: { type: \"string\" },\r",
											"              maximumAmount:  { type: \"string\" },\r",
											"              hintMessage:    { type: \"string\" },\r",
											"              urgentFees:     { type: \"string\" }\r",
											"            }\r",
											"          }\r",
											"        }\r",
											"      }\r",
											"    }\r",
											"  };\r",
											"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
											"});\r",
											"\r",
											"// Visualizer (compact)\r",
											"(function render(){\r",
											"  var template =\r",
											"    '<style>.t{font-family:system-ui,Segoe UI,Roboto,Arial;font-size:14px;color:#333;width:100%;border-collapse:collapse}' +\r",
											"    '.t th,.t td{border:1px solid #87ceeb;padding:6px;text-align:left}.t th{background:#87ceeb}' +\r",
											"    '.good{color:#0a8f08}.bad{color:#b00020}</style>' +\r",
											"    '<h3>Confirm Transfer</h3>' +\r",
											"    '<table class=\"t\"><tbody>' +\r",
											"    '<tr><th>trnxIsPossible</th><td class=\"{{possibleCls}}\">{{trnxIsPossible}}</td></tr>' +\r",
											"    '<tr><th>maximumAmount</th><td>{{maximumAmount}}</td></tr>' +\r",
											"    '<tr><th>trnxFees</th><td>{{trnxFees}}</td></tr>' +\r",
											"    '<tr><th>urgentFees</th><td>{{urgentFees}}</td></tr>' +\r",
											"    '<tr><th>hintMessage</th><td>{{hintMessage}}</td></tr>' +\r",
											"    '</tbody></table>';\r",
											"\r",
											"  var possibleCls = (node.trnxIsPossible === \"Y\") ? \"good\" : \"bad\";\r",
											"  pm.visualizer.set(template, {\r",
											"    trnxIsPossible: String(node.trnxIsPossible || \"\"),\r",
											"    maximumAmount: String(node.maximumAmount || \"\"),\r",
											"    trnxFees: String(node.trnxFees || \"\"),\r",
											"    urgentFees: String(node.urgentFees || \"\"),\r",
											"    hintMessage: String(node.hintMessage || \"\"),\r",
											"    possibleCls: possibleCls\r",
											"  });\r",
											"})();\r",
											"\r",
											"console.log(\r",
											"  \"✅ BNKCHKTRANSFERNEW validated.\",\r",
											"  \"possible=\", node.trnxIsPossible,\r",
											"  \"max(raw)=\", node.maximumAmount,\r",
											"  \"max(num)=\", Number(String(node.maximumAmount || \"\").trim())\r",
											");\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Accept",
										"value": "application/json",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\r\n    \"Srv\": \"BNKCHKTRANSFERNEW\",\r\n    \"Message\": {\r\n        \"IsBankTransferRequest\": {\r\n            \"swiftCode\": \"{{bnkCode_1}}\",\r\n            \"accountNO\": \"{{accountSeq_1}}\",\r\n            \"amount\": \"200\",\r\n            \"nin\": \"{{NIN}}\",\r\n            \"userId\": \"{{UserID}}\",\r\n            \"userType\": \"INVESTOR\",\r\n            \"lang\": \"ARB\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"30-04-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{BaseURL}}{{Oracle19}}",
									"host": [
										"{{BaseURL}}{{Oracle19}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "3. Fire - Withdraw The Group",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"/**\r",
											" * BNKTRANSFERNEW – Bank transfer to (ES5)\r",
											" * Validates:\r",
											" *  - Envelope: resCode/resCode1=0, source=\"BNKTRANSFERNEW\"\r",
											" *  - Node: getBankTransferResponse with required keys (all strings)\r",
											" *  - showHint in {Y,N} and conditional rules\r",
											" * Saves env:\r",
											" *  BANK_TRANSFER_CODE, BANK_SHOW_HINT, BANK_HINT_MESSAGE,\r",
											" *  BANK_CONFIRM_MSG, BANK_TRN_GUID, BANK_OTP_TOKEN\r",
											" */\r",
											"\r",
											"pm.test(\"HTTP 200\", function () {\r",
											"  pm.response.to.have.status(200);\r",
											"});\r",
											"\r",
											"pm.test(\"Content-Type is JSON\", function () {\r",
											"  pm.response.to.have.header(\"Content-Type\");\r",
											"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
											"});\r",
											"\r",
											"// Parse\r",
											"var json;\r",
											"pm.test(\"Body is valid JSON\", function () {\r",
											"  json = pm.response.json();\r",
											"  pm.expect(json).to.be.an(\"object\");\r",
											"});\r",
											"\r",
											"// Envelope\r",
											"pm.test(\"responseStatus OK (BNKTRANSFERNEW)\", function () {\r",
											"  var rs = json.responseStatus || {};\r",
											"  pm.expect(rs.resCode).to.eql(\"0\");\r",
											"  pm.expect(rs.resDesc).to.eql(\"Successful Operation\");\r",
											"  pm.expect(rs.source).to.eql(\"BNKTRANSFERNEW\");\r",
											"  pm.expect(rs.resCode1).to.eql(\"0\");\r",
											"  pm.expect(rs.resDesc1).to.eql(\"Successful Operation\");\r",
											"});\r",
											"\r",
											"// Node\r",
											"var node = (((json || {}).message || {}).getBankTransferResponse) || {};\r",
											"pm.test(\"getBankTransferResponse exists & has required keys\", function () {\r",
											"  pm.expect(node).to.be.an(\"object\");\r",
											"  var keys = [\"transferCode\",\"showHint\",\"hintMessage\",\"resConfirmMessage\",\"resTrnGUID\",\"otpToken\"];\r",
											"  for (var i=0;i<keys.length;i++){\r",
											"    pm.expect(node, \"Missing key: \" + keys[i]).to.have.property(keys[i]);\r",
											"    pm.expect(typeof node[keys[i]], keys[i] + \" must be string\").to.eql(\"string\");\r",
											"  }\r",
											"});\r",
											"\r",
											"// Helpers\r",
											"function isYN(v){ return v === \"Y\" || v === \"N\"; }\r",
											"function getFlag(name, defVal){\r",
											"  var v = pm.environment.get(name) || pm.globals.get(name);\r",
											"  v = (v == null ? \"\" : String(v)).toUpperCase();\r",
											"  if (v !== \"Y\" && v !== \"N\") return defVal;\r",
											"  return v;\r",
											"}\r",
											"\r",
											"// showHint logic\r",
											"pm.test(\"showHint is Y/N\", function () {\r",
											"  pm.expect(isYN(node.showHint), \"showHint must be 'Y' or 'N'\").to.be.true;\r",
											"});\r",
											"\r",
											"// Confirm message (Arabic success text)\r",
											"pm.test(\"resConfirmMessage (required by policy or optional)\", function () {\r",
											"  var requireMsg = getFlag(\"REQUIRE_CONFIRM_MESSAGE\", \"Y\") === \"Y\";\r",
											"  var msg = String(node.resConfirmMessage || \"\");\r",
											"  if (requireMsg) {\r",
											"    pm.expect(msg.replace(/\\s+/g,\"\").length, \"resConfirmMessage should be non-empty\").to.be.greaterThan(0);\r",
											"    // Accept common Arabic phrasing variants\r",
											"    var ok =\r",
											"      /تم\\s*قبول\\s*طلب\\s*التحويل/.test(msg) ||\r",
											"      /تم\\s*قبول/.test(msg);\r",
											"    pm.expect(ok, \"resConfirmMessage should indicate success in Arabic\").to.be.true;\r",
											"  }\r",
											"});\r",
											"\r",
											"// Conditional rules for hint / otp\r",
											"pm.test(\"Hint & OTP conditional rules\", function () {\r",
											"  var requireHintOnY   = getFlag(\"REQUIRE_HINT_ON_Y\", \"N\") === \"Y\";\r",
											"  var requireOtpOnHint = getFlag(\"REQUIRE_OTP_WHEN_HINT\", \"N\") === \"Y\";\r",
											"  var requireEmptyOtpWhenNoHint = getFlag(\"REQUIRE_EMPTY_OTP_WHEN_NOHINT\", \"N\") === \"Y\";\r",
											"\r",
											"  var showHintY = node.showHint === \"Y\";\r",
											"  var hint = String(node.hintMessage || \"\");\r",
											"  var otp  = String(node.otpToken || \"\");\r",
											"\r",
											"  if (showHintY) {\r",
											"    if (requireHintOnY) {\r",
											"      pm.expect(hint.replace(/\\s+/g,\"\").length, \"showHint=Y -> hintMessage must be non-empty\").to.be.greaterThan(0);\r",
											"    }\r",
											"    if (requireOtpOnHint) {\r",
											"      pm.expect(otp.replace(/\\s+/g,\"\").length, \"showHint=Y -> otpToken must be non-empty\").to.be.greaterThan(0);\r",
											"    }\r",
											"  } else {\r",
											"    if (requireEmptyOtpWhenNoHint) {\r",
											"      pm.expect(otp.replace(/\\s+/g,\"\").length, \"showHint=N -> otpToken should be empty\").to.eql(0);\r",
											"    }\r",
											"  }\r",
											"});\r",
											"\r",
											"// Optional: require GUID when success (config)\r",
											"pm.test(\"Transaction GUID requirement (optional)\", function () {\r",
											"  var requireGuid = getFlag(\"REQUIRE_GUID_ON_SUCCESS\", \"N\") === \"Y\";\r",
											"  if (requireGuid) {\r",
											"    pm.expect(String(node.resTrnGUID || \"\").replace(/\\s+/g,\"\").length, \"resTrnGUID required\").to.be.greaterThan(0);\r",
											"  }\r",
											"});\r",
											"\r",
											"// Save to environment\r",
											"(function saveEnv(){\r",
											"  pm.environment.set(\"BANK_TRANSFER_CODE\", String(node.transferCode || \"\"));\r",
											"  pm.environment.set(\"BANK_SHOW_HINT\", String(node.showHint || \"\"));\r",
											"  pm.environment.set(\"BANK_HINT_MESSAGE\", String(node.hintMessage || \"\"));\r",
											"  pm.environment.set(\"BANK_CONFIRM_MSG\", String(node.resConfirmMessage || \"\"));\r",
											"  pm.environment.set(\"BANK_TRN_GUID\", String(node.resTrnGUID || \"\"));\r",
											"  pm.environment.set(\"BANK_OTP_TOKEN\", String(node.otpToken || \"\"));\r",
											"})();\r",
											"\r",
											"// Minimal schema (tv4)\r",
											"pm.test(\"Schema (minimal) validates\", function () {\r",
											"  var schema = {\r",
											"    type: \"object\",\r",
											"    required: [\"responseStatus\",\"message\"],\r",
											"    properties: {\r",
											"      responseStatus: {\r",
											"        type: \"object\",\r",
											"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
											"        properties: {\r",
											"          resCode:  { \"const\": \"0\" },\r",
											"          resDesc:  { \"const\": \"Successful Operation\" },\r",
											"          source:   { \"const\": \"BNKTRANSFERNEW\" },\r",
											"          resCode1: { \"const\": \"0\" },\r",
											"          resDesc1: { \"const\": \"Successful Operation\" }\r",
											"        }\r",
											"      },\r",
											"      message: {\r",
											"        type: \"object\",\r",
											"        required: [\"getBankTransferResponse\"],\r",
											"        properties: {\r",
											"          getBankTransferResponse: {\r",
											"            type: \"object\",\r",
											"            required: [\"transferCode\",\"showHint\",\"hintMessage\",\"resConfirmMessage\",\"resTrnGUID\",\"otpToken\"],\r",
											"            properties: {\r",
											"              transferCode:     { type: \"string\" },\r",
											"              showHint:         { type: \"string\" },\r",
											"              hintMessage:      { type: \"string\" },\r",
											"              resConfirmMessage:{ type: \"string\" },\r",
											"              resTrnGUID:       { type: \"string\" },\r",
											"              otpToken:         { type: \"string\" }\r",
											"            }\r",
											"          }\r",
											"        }\r",
											"      }\r",
											"    }\r",
											"  };\r",
											"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
											"});\r",
											"\r",
											"// Visualizer (compact)\r",
											"(function render(){\r",
											"  var template =\r",
											"    '<style>.t{font-family:system-ui,Segoe UI,Roboto,Arial;font-size:14px;color:#333;width:100%;border-collapse:collapse}' +\r",
											"    '.t th,.t td{border:1px solid #87ceeb;padding:6px;text-align:left}.t th{background:#87ceeb}' +\r",
											"    '.flagY{color:#0a8f08}.flagN{color:#b00020}</style>' +\r",
											"    '<h3>Bank Transfer – Result</h3>' +\r",
											"    '<table class=\"t\"><tbody>' +\r",
											"    '<tr><th>resConfirmMessage</th><td>{{resConfirmMessage}}</td></tr>' +\r",
											"    '<tr><th>showHint</th><td class=\"{{showHintCls}}\">{{showHint}}</td></tr>' +\r",
											"    '<tr><th>hintMessage</th><td>{{hintMessage}}</td></tr>' +\r",
											"    '<tr><th>transferCode</th><td>{{transferCode}}</td></tr>' +\r",
											"    '<tr><th>resTrnGUID</th><td>{{resTrnGUID}}</td></tr>' +\r",
											"    '<tr><th>otpToken</th><td>{{otpToken}}</td></tr>' +\r",
											"    '</tbody></table>';\r",
											"\r",
											"  pm.visualizer.set(template, {\r",
											"    resConfirmMessage: String(node.resConfirmMessage || \"\"),\r",
											"    showHint: String(node.showHint || \"\"),\r",
											"    hintMessage: String(node.hintMessage || \"\"),\r",
											"    transferCode: String(node.transferCode || \"\"),\r",
											"    resTrnGUID: String(node.resTrnGUID || \"\"),\r",
											"    otpToken: String(node.otpToken || \"\"),\r",
											"    showHintCls: (node.showHint === \"Y\") ? \"flagY\" : \"flagN\"\r",
											"  });\r",
											"})();\r",
											"\r",
											"console.log(\"✅ BNKTRANSFERNEW validated.\", \"showHint=\", node.showHint);\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Accept",
										"value": "application/json",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\r\n    \"Srv\": \"BNKTRANSFERNEW\",\r\n    \"Message\": {\r\n        \"BankTransferRequest\": {\r\n            \"nin\": \"{{NIN}}\",\r\n            \"userId\": \"{{UserID}}\",\r\n            \"userType\": \"INVESTOR\",\r\n            \"accountNO\": \"{{accountCode_1}}\",\r\n            \"amount\": 200,\r\n            \"swiftCode\": \"{{bnkCode_1}}\",\r\n            \"transferType\": \"TO\",\r\n            \"accountStatus\": \"4\",\r\n            \"transferTimeId\": \"{{transferTimeId_1}}\",\r\n            \"lang\": \"ARB\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"30-04-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{BaseURL}}{{Oracle19}}",
									"host": [
										"{{BaseURL}}{{Oracle19}}"
									]
								}
							},
							"response": []
						}
					]
				}
			]
		},
		{
			"name": "11. Add New Bank",
			"item": [
				{
					"name": "Error handling",
					"item": [
						{
							"name": "Same existing bank",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"/**\r",
											" * REGBNKACCNEW – \"Add Bank\" outcome validator (ES5)\r",
											" * Handles BOTH:\r",
											" *  A) Duplicate existing bank (negative)\r",
											" *     - registerCode \"16112\"\r",
											" *     - needActivation \"N\"\r",
											" *     - bnkActivationSeq empty/\"null\"\r",
											" *     - Arabic message contains \"حساب بنكي\" and \"بنفس البيانات\"\r",
											" *  B) Exists, needs activation (prompt)\r",
											" *     - registerCode \"52\"\r",
											" *     - needActivation \"Y\"\r",
											" *     - bnkActivationSeq is digits > 0\r",
											" *     - Arabic message contains \"تفعيله\"\r",
											" *\r",
											" * Saves env:\r",
											" *  REGBANK_REGISTER_CODE, REGBANK_REGISTER_MSG, REGBANK_NEED_ACTIVATION,\r",
											" *  REGBANK_ACTIVATION_SEQ, REGBANK_IS_DUPLICATE(Y/N), REGBANK_NEEDS_ACTIVATION(Y/N)\r",
											" */\r",
											"\r",
											"pm.test(\"HTTP 200\", function(){ pm.response.to.have.status(200); });\r",
											"pm.test(\"Content-Type JSON\", function(){\r",
											"  pm.response.to.have.header(\"Content-Type\");\r",
											"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
											"});\r",
											"\r",
											"var json;\r",
											"pm.test(\"Body is JSON\", function(){\r",
											"  json = pm.response.json();\r",
											"  pm.expect(json).to.be.an(\"object\");\r",
											"});\r",
											"\r",
											"pm.test(\"Envelope OK (REGBNKACCNEW)\", function(){\r",
											"  var rs = json.responseStatus || {};\r",
											"  pm.expect(rs.resCode).to.eql(\"0\");\r",
											"  pm.expect(rs.resDesc).to.eql(\"Successful Operation\");\r",
											"  pm.expect(rs.source).to.eql(\"REGBNKACCNEW\");\r",
											"  pm.expect(rs.resCode1).to.eql(\"0\");\r",
											"  pm.expect(rs.resDesc1).to.eql(\"Successful Operation\");\r",
											"});\r",
											"\r",
											"var node = (((json || {}).message || {}).registerBankAccountResponse) || {};\r",
											"pm.test(\"registerBankAccountResponse exists & core keys\", function () {\r",
											"  pm.expect(node).to.be.an(\"object\");\r",
											"  [\"registerCode\",\"registerMessage\",\"needActivation\",\"bnkActivationSeq\"].forEach(function(k){\r",
											"    pm.expect(node, \"Missing key: \" + k).to.have.property(k);\r",
											"  });\r",
											"});\r",
											"\r",
											"// helpers\r",
											"function trim(s){ return String(s == null ? \"\" : s).replace(/^\\s+|\\s+$/g,\"\"); }\r",
											"function isDigits(s){ return /^\\d+$/.test(String(s || \"\")); }\r",
											"function isNullishLike(s){\r",
											"  var v = String(s == null ? \"\" : s).trim().toLowerCase();\r",
											"  return v === \"\" || v === \"null\";\r",
											"}\r",
											"\r",
											"// Branch by registerCode\r",
											"pm.test(\"REGBNKACCNEW outcome checks\", function(){\r",
											"  var code = String(node.registerCode || \"\");\r",
											"  var msg  = trim(node.registerMessage);\r",
											"  var need = String(node.needActivation || \"\");\r",
											"\r",
											"  // Record outcome flags for downstream chaining\r",
											"  var isDup = \"N\", needsAct = \"N\";\r",
											"\r",
											"  if (code === \"16112\") {\r",
											"    // A) Duplicate existing bank (negative)\r",
											"    isDup = \"Y\";\r",
											"    pm.expect(need, \"needActivation must be 'N' for duplicate\").to.eql(\"N\");\r",
											"    pm.expect(isNullishLike(node.bnkActivationSeq), \"bnkActivationSeq must be empty/null for duplicate\").to.be.true;\r",
											"    pm.expect(msg.length, \"registerMessage non-empty\").to.be.greaterThan(0);\r",
											"    var arabicOk = /حساب\\s*بنكي/.test(msg) && /بنفس\\s*البيانات/.test(msg);\r",
											"    pm.expect(arabicOk, \"Arabic message should indicate 'existing bank with same data'\").to.be.true;\r",
											"\r",
											"  } else if (code === \"52\") {\r",
											"    // B) Exists, needs activation\r",
											"    needsAct = \"Y\";\r",
											"    pm.expect(need, \"needActivation must be 'Y' for activation prompt\").to.eql(\"Y\");\r",
											"    var seq = String(node.bnkActivationSeq || \"\").trim();\r",
											"    pm.expect(seq, \"bnkActivationSeq must be non-empty\").to.not.equal(\"\");\r",
											"    pm.expect(isDigits(seq), \"bnkActivationSeq must be digits\").to.be.true;\r",
											"    pm.expect(Number(seq), \"bnkActivationSeq > 0\").to.be.above(0);\r",
											"    pm.expect(msg.length, \"registerMessage non-empty\").to.be.greaterThan(0);\r",
											"    // accept common phrasing variants (\"تفعيل\" / \"تفعيله\")\r",
											"    var actOk = /تفعيل/.test(msg);\r",
											"    pm.expect(actOk, \"Arabic message should indicate activation\").to.be.true;\r",
											"\r",
											"  } else {\r",
											"    // Unexpected business code — fail loudly with context\r",
											"    pm.expect.fail(\"Unexpected registerCode: \" + code + \" (expected '16112' or '52')\");\r",
											"  }\r",
											"\r",
											"  // Save flags\r",
											"  pm.environment.set(\"REGBANK_IS_DUPLICATE\", isDup);\r",
											"  pm.environment.set(\"REGBANK_NEEDS_ACTIVATION\", needsAct);\r",
											"});\r",
											"\r",
											"// Save env (common)\r",
											"pm.environment.set(\"REGBANK_REGISTER_CODE\", String(node.registerCode || \"\"));\r",
											"pm.environment.set(\"REGBANK_REGISTER_MSG\", String(node.registerMessage || \"\"));\r",
											"pm.environment.set(\"REGBANK_NEED_ACTIVATION\", String(node.needActivation || \"\"));\r",
											"pm.environment.set(\"REGBANK_ACTIVATION_SEQ\", String(node.bnkActivationSeq || \"\"));\r",
											"\r",
											"// Minimal schema (structure only)\r",
											"pm.test(\"Schema minimal\", function(){\r",
											"  var schema = {\r",
											"    type: \"object\",\r",
											"    required: [\"responseStatus\",\"message\"],\r",
											"    properties: {\r",
											"      responseStatus: {\r",
											"        type: \"object\",\r",
											"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
											"        properties: {\r",
											"          resCode: {\"const\":\"0\"},\r",
											"          resDesc: {\"const\":\"Successful Operation\"},\r",
											"          source:  {\"const\":\"REGBNKACCNEW\"},\r",
											"          resCode1:{\"const\":\"0\"},\r",
											"          resDesc1:{\"const\":\"Successful Operation\"}\r",
											"        }\r",
											"      },\r",
											"      message: {\r",
											"        type: \"object\",\r",
											"        required: [\"registerBankAccountResponse\"],\r",
											"        properties: {\r",
											"          registerBankAccountResponse: {\r",
											"            type: \"object\",\r",
											"            required: [\"registerCode\",\"registerMessage\",\"needActivation\",\"bnkActivationSeq\"]\r",
											"          }\r",
											"        }\r",
											"      }\r",
											"    }\r",
											"  };\r",
											"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
											"});\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Accept",
										"value": "application/json",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\r\n    \"Srv\": \"REGBNKACCNEW\",\r\n    \"Message\": {\r\n        \"RegisterBankAccountRequest\": {\r\n             \"NIN\": \"{{NIN}}\",\r\n            \"UserId\": \"{{UserID}}\",\r\n            \"userType\": \"INVESTOR\",\r\n            \"lang\": \"ARB\",\r\n            \"transactionId\": \"\",\r\n            \"IntBnkCustomerId\": \"\",\r\n            \"status\": \"\",\r\n            \"accountNo\": \"8558555551628\",\r\n            \"swiftAddress\": \"QNBAQAQAXXX\",\r\n            \"currencyCode\": \"307\",\r\n            \"accountIBAN\": \"QA27QNBA987194588558555551628\",\r\n            \"accountSeq\": \"\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"05-10-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{BaseURL}}{{Oracle19}}",
									"host": [
										"{{BaseURL}}{{Oracle19}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "Wrong IBAN Length",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"/**\r",
											" * REGBNKACCNEW – Negative: wrong IBAN length\r",
											" * Expect:\r",
											" *   registerCode = \"110124\"\r",
											" *   registerMessage Arabic mentions \"IBAN\" and \"غير صحيح\" (wrong)\r",
											" *   bnkActivationSeq is \"null\" or empty/missing\r",
											" * Optional cross-check:\r",
											" *   If request carries IBAN and you have BNKINFO_IBAN_MAP (env/global JSON),\r",
											" *   assert IBAN.length != expected length for its ISO.\r",
											" */\r",
											"\r",
											"pm.test(\"HTTP 200\", function(){ pm.response.to.have.status(200); });\r",
											"pm.test(\"Content-Type JSON\", function(){\r",
											"  pm.response.to.have.header(\"Content-Type\");\r",
											"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
											"});\r",
											"\r",
											"var json;\r",
											"pm.test(\"Body is JSON\", function(){ json = pm.response.json(); pm.expect(json).to.be.an(\"object\"); });\r",
											"\r",
											"pm.test(\"Envelope OK (REGBNKACCNEW)\", function(){\r",
											"  var rs = json.responseStatus || {};\r",
											"  pm.expect(rs.resCode).to.eql(\"0\");\r",
											"  pm.expect(rs.resDesc).to.eql(\"Successful Operation\");\r",
											"  pm.expect(rs.source).to.eql(\"REGBNKACCNEW\");\r",
											"  pm.expect(rs.resCode1).to.eql(\"0\");\r",
											"  pm.expect(rs.resDesc1).to.eql(\"Successful Operation\");\r",
											"});\r",
											"\r",
											"var node = (((json || {}).message || {}).registerBankAccountResponse) || {};\r",
											"pm.test(\"registerBankAccountResponse exists & core keys\", function () {\r",
											"  pm.expect(node).to.be.an(\"object\");\r",
											"  pm.expect(node).to.have.property(\"registerCode\");\r",
											"  pm.expect(node).to.have.property(\"registerMessage\");\r",
											"  pm.expect(node).to.have.property(\"bnkActivationSeq\");\r",
											"});\r",
											"\r",
											"function trim(s){ return String(s == null ? \"\" : s).replace(/^\\s+|\\s+$/g,\"\"); }\r",
											"function findIbanStr(obj){\r",
											"  if (!obj || typeof obj !== \"object\") return null;\r",
											"  for (var k in obj){\r",
											"    if (!obj.hasOwnProperty(k)) continue;\r",
											"    var v = obj[k];\r",
											"    if (typeof k === \"string\" && /iban/i.test(k) && typeof v === \"string\"){\r",
											"      var val = v.replace(/\\s+/g,\"\").toUpperCase();\r",
											"      if (/^[A-Z]{2}[0-9A-Z]{5,40}$/.test(val)) return val; // relaxed for wrong length case\r",
											"    }\r",
											"    if (v && typeof v === \"object\"){\r",
											"      var got = findIbanStr(v);\r",
											"      if (got) return got;\r",
											"    }\r",
											"  }\r",
											"  return null;\r",
											"}\r",
											"\r",
											"// registerCode & message\r",
											"pm.test(\"registerCode = '110124' and message mentions wrong IBAN length\", function(){\r",
											"  pm.expect(String(node.registerCode)).to.eql(\"110124\");\r",
											"  var m = trim(node.registerMessage);\r",
											"  pm.expect(m.length, \"registerMessage non-empty\").to.be.greaterThan(0);\r",
											"  var ok = /IBAN/i.test(m) && /غير\\s*صحيح/.test(m);\r",
											"  pm.expect(ok, \"Arabic message should indicate 'IBAN length incorrect'\").to.be.true;\r",
											"});\r",
											"\r",
											"// activation seq should be null/empty\r",
											"pm.test(\"bnkActivationSeq is null/empty\", function(){\r",
											"  var seq = String(node.bnkActivationSeq || \"\");\r",
											"  pm.expect([\"\", \"null\"]).to.include(seq.toLowerCase());\r",
											"});\r",
											"\r",
											"// Optional: verify request IBAN length != expected\r",
											"pm.test(\"Request IBAN length mismatches expected (if we can compare)\", function(){\r",
											"  var req = {};\r",
											"  try { req = pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {}; } catch(e){}\r",
											"  var iban = findIbanStr(req);\r",
											"  if (!iban){ console.warn(\"No IBAN found in request body; skip length comparison\"); return; }\r",
											"\r",
											"  var iso = iban.substr(0,2);\r",
											"  var mapRaw = pm.environment.get(\"BNKINFO_IBAN_MAP\") || pm.globals.get(\"BNKINFO_IBAN_MAP\") || \"\";\r",
											"  if (!mapRaw) { console.warn(\"BNKINFO_IBAN_MAP not set; skip length comparison\"); return; }\r",
											"  var map = {};\r",
											"  try { map = JSON.parse(mapRaw); } catch(e){ console.warn(\"Invalid BNKINFO_IBAN_MAP JSON\"); return; }\r",
											"  if (!map.hasOwnProperty(iso)) { console.warn(\"No expected IBAN length for ISO \" + iso); return; }\r",
											"\r",
											"  var expectedLen = Number(map[iso]);\r",
											"  pm.expect(iban.length, \"IBAN length should differ from expected for \"+iso).to.not.eql(expectedLen);\r",
											"});\r",
											"\r",
											"// Save env\r",
											"pm.environment.set(\"REGBANK_REGISTER_CODE\", String(node.registerCode || \"\"));\r",
											"pm.environment.set(\"REGBANK_REGISTER_MSG\", String(node.registerMessage || \"\"));\r",
											"pm.environment.set(\"REGBANK_ACTIVATION_SEQ\", String(node.bnkActivationSeq || \"\"));\r",
											"\r",
											"// Minimal schema\r",
											"pm.test(\"Schema minimal\", function(){\r",
											"  var schema = {\r",
											"    type: \"object\",\r",
											"    required: [\"responseStatus\",\"message\"],\r",
											"    properties: {\r",
											"      responseStatus: {\r",
											"        type: \"object\",\r",
											"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
											"        properties: {\r",
											"          resCode: {\"const\":\"0\"}, resDesc: {\"const\":\"Successful Operation\"},\r",
											"          source: {\"const\":\"REGBNKACCNEW\"}, resCode1: {\"const\":\"0\"}, resDesc1: {\"const\":\"Successful Operation\"}\r",
											"        }\r",
											"      },\r",
											"      message: {\r",
											"        type: \"object\",\r",
											"        required: [\"registerBankAccountResponse\"],\r",
											"        properties: {\r",
											"          registerBankAccountResponse: {\r",
											"            type: \"object\",\r",
											"            required: [\"registerCode\",\"registerMessage\",\"bnkActivationSeq\"]\r",
											"          }\r",
											"        }\r",
											"      }\r",
											"    }\r",
											"  };\r",
											"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
											"});\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Accept",
										"value": "application/json",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\r\n    \"Srv\": \"REGBNKACCNEW\",\r\n    \"Message\": {\r\n        \"RegisterBankAccountRequest\": {\r\n             \"NIN\": \"{{NIN}}\",\r\n            \"UserId\": \"{{UserID}}\",\r\n            \"userType\": \"INVESTOR\",\r\n            \"lang\": \"ARB\",\r\n            \"transactionId\": \"\",\r\n            \"IntBnkCustomerId\": \"\",\r\n            \"status\": \"\",\r\n            \"accountNo\": \"855855555\",\r\n            \"swiftAddress\": \"QNBAQAQAXXX\",\r\n            \"currencyCode\": \"307\",\r\n            \"accountIBAN\": \"QA76QNBA9555551619\",\r\n            \"accountSeq\": \"\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"05-10-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{BaseURL}}{{Oracle19}}",
									"host": [
										"{{BaseURL}}{{Oracle19}}"
									]
								}
							},
							"response": []
						}
					]
				},
				{
					"name": "Login",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Check if the status code is 200\r",
									"pm.test(\"Status code is 200\", function () {\r",
									"    pm.response.to.have.status(200);\r",
									"});\r",
									"\r",
									"// Check if response code is 0\r",
									"pm.test(\"Response code is 0\", function () {\r",
									"    var jsonData = pm.response.json(); // Parse JSON response\r",
									"    pm.expect(jsonData.responseStatus.resCode).to.equal(\"0\");\r",
									"});\r",
									"\r",
									"// Check if response description is \"Successful Operation\"\r",
									"pm.test(\"Response description is 'Successful Operation'\", function () {\r",
									"    var jsonData = pm.response.json();\r",
									"    pm.expect(jsonData.responseStatus.resDesc).to.equal(\"Successful Operation\");\r",
									"});\r",
									"\r",
									"// Check if login is successful and capture NIN\r",
									"pm.test(\"Login successful and NIN captured\", function () {\r",
									"    var jsonData = pm.response.json();\r",
									"    var accounts = jsonData.message.logResponse.accounts.account;\r",
									"\r",
									"    if (accounts.length > 0) {\r",
									"        var nin = accounts[0].nin; // Extract NIN\r",
									"        pm.expect(nin).to.not.be.undefined; // Ensure it's not empty\r",
									"\r",
									"        // Store in environment variables\r",
									"        pm.environment.set(\"NIN\", nin);\r",
									"        pm.environment.set(\"UserID\", nin); // Store the same value in UserID\r",
									"\r",
									"        console.log(\"Captured NIN/UserID:\", nin);\r",
									"    } else {\r",
									"        pm.expect.fail(\"NIN not found in the response.\");\r",
									"    }\r",
									"});\r",
									"\r",
									"// Check if login is successful and SessionID is created\r",
									"pm.test(\"Login successful and SessionID created\", function () {\r",
									"    var jsonData = pm.response.json();\r",
									"    var sessionID = jsonData.message.logResponse.sessionID;\r",
									"\r",
									"    pm.expect(sessionID).to.not.be.undefined; // Assert SessionID exists\r",
									"});\r",
									"\r",
									"// Verify Content-Type header is 'application/json'\r",
									"pm.test(\"Content-Type header is 'application/json'\", function () {\r",
									"    pm.expect(pm.response.headers.get(\"Content-Type\")).to.include(\"application/json\");\r",
									"});\r",
									"\r",
									"// Check if login is successful and capture SessionID\r",
									"pm.test(\"Login successful and SessionID captured\", function () {\r",
									"    var jsonData = pm.response.json();\r",
									"    var sessionID = jsonData.message.logResponse.sessionID;\r",
									"\r",
									"    pm.expect(sessionID).to.not.be.undefined; // Assert SessionID exists\r",
									"    pm.environment.set(\"SessionID\", sessionID); // Save SessionID to environment\r",
									"});\r",
									"\r",
									"// Parse the response JSON\r",
									"var jsonData = pm.response.json();\r",
									"\r",
									"// Verify that the response contains the expected roles\r",
									"pm.test(\"Verify roles in response\", function () {\r",
									"    var roles = jsonData.message.logResponse.roles.role;\r",
									"\r",
									"    // Define expected roles\r",
									"    var expectedRoles = [\"UPDATE_ORDER\", \"SAVE_ORDER\", \"REPORTS\", \"CANCEL_ORDER\"];\r",
									"\r",
									"    // Ensure roles exist in the response\r",
									"    pm.expect(roles).to.be.an(\"array\").that.is.not.empty;\r",
									"\r",
									"    // Check that all expected roles exist in the response\r",
									"    expectedRoles.forEach(role => {\r",
									"        pm.expect(roles).to.include(role, `Missing role: ${role}`);\r",
									"    });\r",
									"\r",
									"    console.log(\"✅ Roles verified successfully:\", roles);\r",
									"});\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Get current timestamp in ISO format\r",
									"var timestamp = new Date().toISOString();\r",
									"\r",
									"// Store timestamp in Postman environment\r",
									"pm.environment.set(\"currentTimestamp\", timestamp);\r",
									"\r",
									"// Log the timestamp\r",
									"console.log(\"Timestamp Set:\", timestamp);\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"Srv\": \"Login\",\r\n    \"Message\": {\r\n        \"Login\": {\r\n            \"UserName\": \"1218\",\r\n            \"Password\": \"{{Password}}\",\r\n            \"Lang\": \"ARB\"\r\n        }\r\n    },\r\n    \"Version\": \"1.0\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"08-07-2015\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{BaseURL}}{{Oracle19}}",
							"host": [
								"{{BaseURL}}{{Oracle19}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Add New Bank",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"/**\r",
									" * REGBNKACCNEW – Happy path (New Bank)\r",
									" * Expect:\r",
									" *   registerCode = \"0\"\r",
									" *   registerMessage = \"\" (empty/whitespace)\r",
									" *   bnkActivationSeq = integer string > 0\r",
									" */\r",
									"\r",
									"pm.test(\"HTTP 200\", function () { pm.response.to.have.status(200); });\r",
									"pm.test(\"Content-Type JSON\", function () {\r",
									"  pm.response.to.have.header(\"Content-Type\");\r",
									"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
									"});\r",
									"\r",
									"var json;\r",
									"pm.test(\"Body is JSON\", function(){ json = pm.response.json(); pm.expect(json).to.be.an(\"object\"); });\r",
									"\r",
									"pm.test(\"Envelope OK (REGBNKACCNEW)\", function(){\r",
									"  var rs = json.responseStatus || {};\r",
									"  pm.expect(rs.resCode).to.eql(\"0\");\r",
									"  pm.expect(rs.resDesc).to.eql(\"Successful Operation\");\r",
									"  pm.expect(rs.source).to.eql(\"REGBNKACCNEW\");\r",
									"  pm.expect(rs.resCode1).to.eql(\"0\");\r",
									"  pm.expect(rs.resDesc1).to.eql(\"Successful Operation\");\r",
									"});\r",
									"\r",
									"var node = (((json || {}).message || {}).registerBankAccountResponse) || {};\r",
									"pm.test(\"registerBankAccountResponse exists & core keys\", function () {\r",
									"  pm.expect(node).to.be.an(\"object\");\r",
									"  pm.expect(node).to.have.property(\"registerCode\");\r",
									"  pm.expect(node).to.have.property(\"registerMessage\");\r",
									"  pm.expect(node).to.have.property(\"bnkActivationSeq\");\r",
									"  // needActivation may be absent on success\r",
									"});\r",
									"\r",
									"function trim(s){ return String(s == null ? \"\" : s).replace(/^\\s+|\\s+$/g,\"\"); }\r",
									"function isIntStr(v){ return typeof v === \"string\" && /^-?\\d+$/.test(v); }\r",
									"function findIbanStr(obj){\r",
									"  if (!obj || typeof obj !== \"object\") return null;\r",
									"  for (var k in obj){\r",
									"    if (!obj.hasOwnProperty(k)) continue;\r",
									"    var v = obj[k];\r",
									"    if (typeof k === \"string\" && /iban/i.test(k) && typeof v === \"string\"){\r",
									"      var val = v.replace(/\\s+/g,\"\").toUpperCase();\r",
									"      if (/^[A-Z]{2}[0-9A-Z]{13,34}$/.test(val)) return val;\r",
									"    }\r",
									"    if (v && typeof v === \"object\"){\r",
									"      var got = findIbanStr(v);\r",
									"      if (got) return got;\r",
									"    }\r",
									"  }\r",
									"  return null;\r",
									"}\r",
									"\r",
									"// registerCode logic\r",
									"pm.test(\"registerCode = '0' and message empty\", function(){\r",
									"  pm.expect(String(node.registerCode)).to.eql(\"0\");\r",
									"  pm.expect(trim(node.registerMessage)).to.have.length(0);\r",
									"});\r",
									"\r",
									"// activation seq\r",
									"pm.test(\"bnkActivationSeq is integer string > 0\", function(){\r",
									"  pm.expect(isIntStr(node.bnkActivationSeq), \"bnkActivationSeq int string\").to.be.true;\r",
									"  pm.expect(Number(node.bnkActivationSeq), \"bnkActivationSeq > 0\").to.be.above(0);\r",
									"});\r",
									"\r",
									"// Optional: needActivation (if present)\r",
									"pm.test(\"needActivation (if present) is Y/N\", function(){\r",
									"  if (typeof node.needActivation !== \"undefined\"){\r",
									"    pm.expect([\"Y\",\"N\"]).to.include(String(node.needActivation));\r",
									"  }\r",
									"});\r",
									"\r",
									"// Optional cross-check: IBAN length equals expected (if request carries IBAN and BNKINFO_IBAN_MAP exists)\r",
									"pm.test(\"IBAN length matches country expectation (if available)\", function(){\r",
									"  var req = {};\r",
									"  try { req = pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {}; } catch(e){}\r",
									"  var iban = findIbanStr(req);\r",
									"  if (!iban) return;\r",
									"  var iso = iban.substr(0,2);\r",
									"  var mapRaw = pm.environment.get(\"BNKINFO_IBAN_MAP\") || pm.globals.get(\"BNKINFO_IBAN_MAP\") || \"\";\r",
									"  if (!mapRaw) { console.warn(\"BNKINFO_IBAN_MAP not set; skipping IBAN length check\"); return; }\r",
									"  var map = {};\r",
									"  try { map = JSON.parse(mapRaw); } catch(e){ console.warn(\"Invalid BNKINFO_IBAN_MAP JSON\"); return; }\r",
									"  if (map.hasOwnProperty(iso)){\r",
									"    pm.expect(iban.length, \"IBAN length for \"+iso).to.eql(Number(map[iso]));\r",
									"  }\r",
									"});\r",
									"\r",
									"// Save env\r",
									"pm.environment.set(\"REGBANK_REGISTER_CODE\", String(node.registerCode || \"\"));\r",
									"pm.environment.set(\"REGBANK_REGISTER_MSG\", String(node.registerMessage || \"\"));\r",
									"pm.environment.set(\"REGBANK_ACTIVATION_SEQ\", String(node.bnkActivationSeq || \"\"));\r",
									"pm.environment.set(\"REGBANK_NEED_ACTIVATION\", String(node.needActivation || \"\"));\r",
									"\r",
									"// Minimal schema\r",
									"pm.test(\"Schema minimal\", function(){\r",
									"  var schema = {\r",
									"    type: \"object\",\r",
									"    required: [\"responseStatus\",\"message\"],\r",
									"    properties: {\r",
									"      responseStatus: {\r",
									"        type: \"object\",\r",
									"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
									"        properties: {\r",
									"          resCode: {\"const\":\"0\"}, resDesc: {\"const\":\"Successful Operation\"},\r",
									"          source: {\"const\":\"REGBNKACCNEW\"}, resCode1: {\"const\":\"0\"}, resDesc1: {\"const\":\"Successful Operation\"}\r",
									"        }\r",
									"      },\r",
									"      message: {\r",
									"        type: \"object\",\r",
									"        required: [\"registerBankAccountResponse\"],\r",
									"        properties: {\r",
									"          registerBankAccountResponse: {\r",
									"            type: \"object\",\r",
									"            required: [\"registerCode\",\"registerMessage\",\"bnkActivationSeq\"]\r",
									"          }\r",
									"        }\r",
									"      }\r",
									"    }\r",
									"  };\r",
									"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
									"});\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"Srv\": \"REGBNKACCNEW\",\r\n    \"Message\": {\r\n        \"RegisterBankAccountRequest\": {\r\n             \"NIN\": \"{{NIN}}\",\r\n            \"UserId\": \"{{UserID}}\",\r\n            \"userType\": \"INVESTOR\",\r\n            \"lang\": \"ARB\",\r\n            \"transactionId\": \"\",\r\n            \"IntBnkCustomerId\": \"\",\r\n            \"status\": \"\",\r\n            \"accountNo\": \"758452585252521111111\",\r\n            \"swiftAddress\": \"QNBAQAQAXXX\",\r\n            \"currencyCode\": \"307\",\r\n            \"accountIBAN\": \"QA06QNBA758452585252521111111\",\r\n            \"accountSeq\": \"\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"05-10-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{BaseURL}}{{Oracle19}}",
							"host": [
								"{{BaseURL}}{{Oracle19}}"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "12. Remove Bank Account",
			"item": [
				{
					"name": "Remove new bank",
					"item": [
						{
							"name": "1. Login",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"// Check if the status code is 200\r",
											"pm.test(\"Status code is 200\", function () {\r",
											"    pm.response.to.have.status(200);\r",
											"});\r",
											"\r",
											"// Check if response code is 0\r",
											"pm.test(\"Response code is 0\", function () {\r",
											"    var jsonData = pm.response.json(); // Parse JSON response\r",
											"    pm.expect(jsonData.responseStatus.resCode).to.equal(\"0\");\r",
											"});\r",
											"\r",
											"// Check if response description is \"Successful Operation\"\r",
											"pm.test(\"Response description is 'Successful Operation'\", function () {\r",
											"    var jsonData = pm.response.json();\r",
											"    pm.expect(jsonData.responseStatus.resDesc).to.equal(\"Successful Operation\");\r",
											"});\r",
											"\r",
											"// Check if login is successful and capture NIN\r",
											"pm.test(\"Login successful and NIN captured\", function () {\r",
											"    var jsonData = pm.response.json();\r",
											"    var accounts = jsonData.message.logResponse.accounts.account;\r",
											"\r",
											"    if (accounts.length > 0) {\r",
											"        var nin = accounts[0].nin; // Extract NIN\r",
											"        pm.expect(nin).to.not.be.undefined; // Ensure it's not empty\r",
											"\r",
											"        // Store in environment variables\r",
											"        pm.environment.set(\"NIN\", nin);\r",
											"        pm.environment.set(\"UserID\", nin); // Store the same value in UserID\r",
											"\r",
											"        console.log(\"Captured NIN/UserID:\", nin);\r",
											"    } else {\r",
											"        pm.expect.fail(\"NIN not found in the response.\");\r",
											"    }\r",
											"});\r",
											"\r",
											"// Check if login is successful and SessionID is created\r",
											"pm.test(\"Login successful and SessionID created\", function () {\r",
											"    var jsonData = pm.response.json();\r",
											"    var sessionID = jsonData.message.logResponse.sessionID;\r",
											"\r",
											"    pm.expect(sessionID).to.not.be.undefined; // Assert SessionID exists\r",
											"});\r",
											"\r",
											"// Verify Content-Type header is 'application/json'\r",
											"pm.test(\"Content-Type header is 'application/json'\", function () {\r",
											"    pm.expect(pm.response.headers.get(\"Content-Type\")).to.include(\"application/json\");\r",
											"});\r",
											"\r",
											"// Check if login is successful and capture SessionID\r",
											"pm.test(\"Login successful and SessionID captured\", function () {\r",
											"    var jsonData = pm.response.json();\r",
											"    var sessionID = jsonData.message.logResponse.sessionID;\r",
											"\r",
											"    pm.expect(sessionID).to.not.be.undefined; // Assert SessionID exists\r",
											"    pm.environment.set(\"SessionID\", sessionID); // Save SessionID to environment\r",
											"});\r",
											"\r",
											"// Parse the response JSON\r",
											"var jsonData = pm.response.json();\r",
											"\r",
											"// Verify that the response contains the expected roles\r",
											"pm.test(\"Verify roles in response\", function () {\r",
											"    var roles = jsonData.message.logResponse.roles.role;\r",
											"\r",
											"    // Define expected roles\r",
											"    var expectedRoles = [\"UPDATE_ORDER\", \"SAVE_ORDER\", \"REPORTS\", \"CANCEL_ORDER\"];\r",
											"\r",
											"    // Ensure roles exist in the response\r",
											"    pm.expect(roles).to.be.an(\"array\").that.is.not.empty;\r",
											"\r",
											"    // Check that all expected roles exist in the response\r",
											"    expectedRoles.forEach(role => {\r",
											"        pm.expect(roles).to.include(role, `Missing role: ${role}`);\r",
											"    });\r",
											"\r",
											"    console.log(\"✅ Roles verified successfully:\", roles);\r",
											"});\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// Get current timestamp in ISO format\r",
											"var timestamp = new Date().toISOString();\r",
											"\r",
											"// Store timestamp in Postman environment\r",
											"pm.environment.set(\"currentTimestamp\", timestamp);\r",
											"\r",
											"// Log the timestamp\r",
											"console.log(\"Timestamp Set:\", timestamp);\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "noauth"
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Accept",
										"value": "application/json",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\r\n    \"Srv\": \"Login\",\r\n    \"Message\": {\r\n        \"Login\": {\r\n            \"UserName\": \"1218\",\r\n            \"Password\": \"{{Password}}\",\r\n            \"Lang\": \"ARB\"\r\n        }\r\n    },\r\n    \"Version\": \"1.0\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"08-07-2015\"\r\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{BaseURL}}{{Oracle19}}",
									"host": [
										"{{BaseURL}}{{Oracle19}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "2. Add New Bank",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"/**\r",
											" * REGBNKACCNEW – Happy path (New Bank)\r",
											" * Expect:\r",
											" *   registerCode = \"0\"\r",
											" *   registerMessage = \"\" (empty/whitespace)\r",
											" *   bnkActivationSeq = integer string > 0\r",
											" */\r",
											"\r",
											"pm.test(\"HTTP 200\", function () { pm.response.to.have.status(200); });\r",
											"pm.test(\"Content-Type JSON\", function () {\r",
											"  pm.response.to.have.header(\"Content-Type\");\r",
											"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
											"});\r",
											"\r",
											"var json;\r",
											"pm.test(\"Body is JSON\", function(){ json = pm.response.json(); pm.expect(json).to.be.an(\"object\"); });\r",
											"\r",
											"pm.test(\"Envelope OK (REGBNKACCNEW)\", function(){\r",
											"  var rs = json.responseStatus || {};\r",
											"  pm.expect(rs.resCode).to.eql(\"0\");\r",
											"  pm.expect(rs.resDesc).to.eql(\"Successful Operation\");\r",
											"  pm.expect(rs.source).to.eql(\"REGBNKACCNEW\");\r",
											"  pm.expect(rs.resCode1).to.eql(\"0\");\r",
											"  pm.expect(rs.resDesc1).to.eql(\"Successful Operation\");\r",
											"});\r",
											"\r",
											"var node = (((json || {}).message || {}).registerBankAccountResponse) || {};\r",
											"pm.test(\"registerBankAccountResponse exists & core keys\", function () {\r",
											"  pm.expect(node).to.be.an(\"object\");\r",
											"  pm.expect(node).to.have.property(\"registerCode\");\r",
											"  pm.expect(node).to.have.property(\"registerMessage\");\r",
											"  pm.expect(node).to.have.property(\"bnkActivationSeq\");\r",
											"  // needActivation may be absent on success\r",
											"});\r",
											"\r",
											"function trim(s){ return String(s == null ? \"\" : s).replace(/^\\s+|\\s+$/g,\"\"); }\r",
											"function isIntStr(v){ return typeof v === \"string\" && /^-?\\d+$/.test(v); }\r",
											"function findIbanStr(obj){\r",
											"  if (!obj || typeof obj !== \"object\") return null;\r",
											"  for (var k in obj){\r",
											"    if (!obj.hasOwnProperty(k)) continue;\r",
											"    var v = obj[k];\r",
											"    if (typeof k === \"string\" && /iban/i.test(k) && typeof v === \"string\"){\r",
											"      var val = v.replace(/\\s+/g,\"\").toUpperCase();\r",
											"      if (/^[A-Z]{2}[0-9A-Z]{13,34}$/.test(val)) return val;\r",
											"    }\r",
											"    if (v && typeof v === \"object\"){\r",
											"      var got = findIbanStr(v);\r",
											"      if (got) return got;\r",
											"    }\r",
											"  }\r",
											"  return null;\r",
											"}\r",
											"\r",
											"// registerCode logic\r",
											"pm.test(\"registerCode = '0' and message empty\", function(){\r",
											"  pm.expect(String(node.registerCode)).to.eql(\"0\");\r",
											"  pm.expect(trim(node.registerMessage)).to.have.length(0);\r",
											"});\r",
											"\r",
											"// activation seq\r",
											"pm.test(\"bnkActivationSeq is integer string > 0\", function(){\r",
											"  pm.expect(isIntStr(node.bnkActivationSeq), \"bnkActivationSeq int string\").to.be.true;\r",
											"  pm.expect(Number(node.bnkActivationSeq), \"bnkActivationSeq > 0\").to.be.above(0);\r",
											"});\r",
											"\r",
											"// Optional: needActivation (if present)\r",
											"pm.test(\"needActivation (if present) is Y/N\", function(){\r",
											"  if (typeof node.needActivation !== \"undefined\"){\r",
											"    pm.expect([\"Y\",\"N\"]).to.include(String(node.needActivation));\r",
											"  }\r",
											"});\r",
											"\r",
											"// Optional cross-check: IBAN length equals expected (if request carries IBAN and BNKINFO_IBAN_MAP exists)\r",
											"pm.test(\"IBAN length matches country expectation (if available)\", function(){\r",
											"  var req = {};\r",
											"  try { req = pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {}; } catch(e){}\r",
											"  var iban = findIbanStr(req);\r",
											"  if (!iban) return;\r",
											"  var iso = iban.substr(0,2);\r",
											"  var mapRaw = pm.environment.get(\"BNKINFO_IBAN_MAP\") || pm.globals.get(\"BNKINFO_IBAN_MAP\") || \"\";\r",
											"  if (!mapRaw) { console.warn(\"BNKINFO_IBAN_MAP not set; skipping IBAN length check\"); return; }\r",
											"  var map = {};\r",
											"  try { map = JSON.parse(mapRaw); } catch(e){ console.warn(\"Invalid BNKINFO_IBAN_MAP JSON\"); return; }\r",
											"  if (map.hasOwnProperty(iso)){\r",
											"    pm.expect(iban.length, \"IBAN length for \"+iso).to.eql(Number(map[iso]));\r",
											"  }\r",
											"});\r",
											"\r",
											"// Save env\r",
											"pm.environment.set(\"REGBANK_REGISTER_CODE\", String(node.registerCode || \"\"));\r",
											"pm.environment.set(\"REGBANK_REGISTER_MSG\", String(node.registerMessage || \"\"));\r",
											"pm.environment.set(\"REGBANK_ACTIVATION_SEQ\", String(node.bnkActivationSeq || \"\"));\r",
											"pm.environment.set(\"REGBANK_NEED_ACTIVATION\", String(node.needActivation || \"\"));\r",
											"\r",
											"// Minimal schema\r",
											"pm.test(\"Schema minimal\", function(){\r",
											"  var schema = {\r",
											"    type: \"object\",\r",
											"    required: [\"responseStatus\",\"message\"],\r",
											"    properties: {\r",
											"      responseStatus: {\r",
											"        type: \"object\",\r",
											"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
											"        properties: {\r",
											"          resCode: {\"const\":\"0\"}, resDesc: {\"const\":\"Successful Operation\"},\r",
											"          source: {\"const\":\"REGBNKACCNEW\"}, resCode1: {\"const\":\"0\"}, resDesc1: {\"const\":\"Successful Operation\"}\r",
											"        }\r",
											"      },\r",
											"      message: {\r",
											"        type: \"object\",\r",
											"        required: [\"registerBankAccountResponse\"],\r",
											"        properties: {\r",
											"          registerBankAccountResponse: {\r",
											"            type: \"object\",\r",
											"            required: [\"registerCode\",\"registerMessage\",\"bnkActivationSeq\"]\r",
											"          }\r",
											"        }\r",
											"      }\r",
											"    }\r",
											"  };\r",
											"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
											"});\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Accept",
										"value": "application/json",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\r\n    \"Srv\": \"REGBNKACCNEW\",\r\n    \"Message\": {\r\n        \"RegisterBankAccountRequest\": {\r\n             \"NIN\": \"{{NIN}}\",\r\n            \"UserId\": \"{{UserID}}\",\r\n            \"userType\": \"INVESTOR\",\r\n            \"lang\": \"ARB\",\r\n            \"transactionId\": \"\",\r\n            \"IntBnkCustomerId\": \"\",\r\n            \"status\": \"\",\r\n            \"accountNo\": \"88577555514319\",\r\n            \"swiftAddress\": \"QNBAQAQAXXX\",\r\n            \"currencyCode\": \"307\",\r\n            \"accountIBAN\": \"QA43QNBA987194588577555514319\",\r\n            \"accountSeq\": \"\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"05-10-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{BaseURL}}{{Oracle19}}",
									"host": [
										"{{BaseURL}}{{Oracle19}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "3. Remove Bank Account",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"/**\r",
											" * RMVBNKACC – Happy path\r",
											" * Expect:\r",
											" *  - responseStatus.* = \"0\", source=\"RMVBNKACC\"\r",
											" *  - message.removeBankAccountResponse: { done:\"OK\", removeCode:\"0\", removeMessage:\"\" }\r",
											" * Saves:\r",
											" *  RMV_DONE, RMV_CODE, RMV_MESSAGE\r",
											" */\r",
											"\r",
											"pm.test(\"HTTP 200\", function () { pm.response.to.have.status(200); });\r",
											"pm.test(\"Content-Type is JSON\", function () {\r",
											"  pm.response.to.have.header(\"Content-Type\");\r",
											"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
											"});\r",
											"\r",
											"var json;\r",
											"pm.test(\"Body is valid JSON\", function(){ json = pm.response.json(); pm.expect(json).to.be.an(\"object\"); });\r",
											"\r",
											"pm.test(\"Envelope OK (RMVBNKACC)\", function(){\r",
											"  var rs = json.responseStatus || {};\r",
											"  pm.expect(rs.resCode).to.eql(\"0\");\r",
											"  pm.expect(rs.resDesc).to.eql(\"Successful Operation\");\r",
											"  pm.expect(rs.source).to.eql(\"RMVBNKACC\");\r",
											"  pm.expect(rs.resCode1).to.eql(\"0\");\r",
											"  pm.expect(rs.resDesc1).to.eql(\"Successful Operation\");\r",
											"});\r",
											"\r",
											"var node = (((json || {}).message || {}).removeBankAccountResponse) || {};\r",
											"pm.test(\"removeBankAccountResponse exists & has required keys\", function(){\r",
											"  pm.expect(node).to.be.an(\"object\");\r",
											"  [\"done\",\"removeCode\",\"removeMessage\"].forEach(function(k){\r",
											"    pm.expect(node, \"Missing key: \" + k).to.have.property(k);\r",
											"    pm.expect(typeof node[k], k + \" must be string\").to.eql(\"string\");\r",
											"  });\r",
											"});\r",
											"\r",
											"function trim(s){ return String(s == null ? \"\" : s).replace(/^\\s+|\\s+$/g, \"\"); }\r",
											"function isIntStr(v){ return typeof v === \"string\" && /^-?\\d+$/.test(v); }\r",
											"\r",
											"pm.test(\"done='OK' and removeCode='0', message empty\", function(){\r",
											"  pm.expect(String(node.done)).to.eql(\"OK\");\r",
											"  pm.expect(String(node.removeCode)).to.eql(\"0\");\r",
											"  pm.expect(trim(node.removeMessage)).to.have.length(0);\r",
											"});\r",
											"\r",
											"// (Optional) confirm request Srv\r",
											"pm.test(\"Request Srv is RMVBNKACC\", function(){\r",
											"  try {\r",
											"    var body = pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {};\r",
											"    pm.expect((body || {}).Srv).to.eql(\"RMVBNKACC\");\r",
											"  } catch(e) { console.warn(\"Could not parse request body:\", e.message); }\r",
											"});\r",
											"\r",
											"// Save env\r",
											"pm.environment.set(\"RMV_DONE\", String(node.done || \"\"));\r",
											"pm.environment.set(\"RMV_CODE\", String(node.removeCode || \"\"));\r",
											"pm.environment.set(\"RMV_MESSAGE\", String(node.removeMessage || \"\"));\r",
											"\r",
											"// Minimal schema (tv4)\r",
											"pm.test(\"Schema (minimal) validates\", function(){\r",
											"  var schema = {\r",
											"    type: \"object\",\r",
											"    required: [\"responseStatus\",\"message\"],\r",
											"    properties: {\r",
											"      responseStatus: {\r",
											"        type: \"object\",\r",
											"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
											"        properties: {\r",
											"          resCode: {\"const\":\"0\"}, resDesc: {\"const\":\"Successful Operation\"},\r",
											"          source: {\"const\":\"RMVBNKACC\"}, resCode1: {\"const\":\"0\"}, resDesc1: {\"const\":\"Successful Operation\"}\r",
											"        }\r",
											"      },\r",
											"      message: {\r",
											"        type: \"object\",\r",
											"        required: [\"removeBankAccountResponse\"],\r",
											"        properties: {\r",
											"          removeBankAccountResponse: {\r",
											"            type: \"object\",\r",
											"            required: [\"done\",\"removeCode\",\"removeMessage\"]\r",
											"          }\r",
											"        }\r",
											"      }\r",
											"    }\r",
											"  };\r",
											"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
											"});\r",
											"\r",
											"console.log(\"✅ RMVBNKACC happy path OK:\", \"done=\", pm.environment.get(\"RMV_DONE\"));\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Accept",
										"value": "application/json",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\r\n    \"Srv\": \"RMVBNKACC\",\r\n    \"Message\": {\r\n        \"RemoveBankAccountRequest\": {\r\n            \"NIN\": \"{{NIN}}\",\r\n            \"UserId\": \"{{UserID}}\",\r\n            \"userType\": \"INVESTOR\",\r\n            \"lang\": \"ARB\",\r\n            \"status\": \"2\",\r\n            \"accountNo\": \"{{accountSeq_1}}\",\r\n            \"swiftAddress\": \"{{bnkCode_1}}\",\r\n            \"currencyCode\": \"307\",\r\n            \"accountSeq\": \"{{accountSeq_1}}\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"05-10-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{BaseURL}}{{Oracle19}}",
									"host": [
										"{{BaseURL}}{{Oracle19}}"
									]
								}
							},
							"response": []
						}
					]
				},
				{
					"name": "Error handling",
					"item": [
						{
							"name": "1. Login",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"// Check if the status code is 200\r",
											"pm.test(\"Status code is 200\", function () {\r",
											"    pm.response.to.have.status(200);\r",
											"});\r",
											"\r",
											"// Check if response code is 0\r",
											"pm.test(\"Response code is 0\", function () {\r",
											"    var jsonData = pm.response.json(); // Parse JSON response\r",
											"    pm.expect(jsonData.responseStatus.resCode).to.equal(\"0\");\r",
											"});\r",
											"\r",
											"// Check if response description is \"Successful Operation\"\r",
											"pm.test(\"Response description is 'Successful Operation'\", function () {\r",
											"    var jsonData = pm.response.json();\r",
											"    pm.expect(jsonData.responseStatus.resDesc).to.equal(\"Successful Operation\");\r",
											"});\r",
											"\r",
											"// Check if login is successful and capture NIN\r",
											"pm.test(\"Login successful and NIN captured\", function () {\r",
											"    var jsonData = pm.response.json();\r",
											"    var accounts = jsonData.message.logResponse.accounts.account;\r",
											"\r",
											"    if (accounts.length > 0) {\r",
											"        var nin = accounts[0].nin; // Extract NIN\r",
											"        pm.expect(nin).to.not.be.undefined; // Ensure it's not empty\r",
											"\r",
											"        // Store in environment variables\r",
											"        pm.environment.set(\"NIN\", nin);\r",
											"        pm.environment.set(\"UserID\", nin); // Store the same value in UserID\r",
											"\r",
											"        console.log(\"Captured NIN/UserID:\", nin);\r",
											"    } else {\r",
											"        pm.expect.fail(\"NIN not found in the response.\");\r",
											"    }\r",
											"});\r",
											"\r",
											"// Check if login is successful and SessionID is created\r",
											"pm.test(\"Login successful and SessionID created\", function () {\r",
											"    var jsonData = pm.response.json();\r",
											"    var sessionID = jsonData.message.logResponse.sessionID;\r",
											"\r",
											"    pm.expect(sessionID).to.not.be.undefined; // Assert SessionID exists\r",
											"});\r",
											"\r",
											"// Verify Content-Type header is 'application/json'\r",
											"pm.test(\"Content-Type header is 'application/json'\", function () {\r",
											"    pm.expect(pm.response.headers.get(\"Content-Type\")).to.include(\"application/json\");\r",
											"});\r",
											"\r",
											"// Check if login is successful and capture SessionID\r",
											"pm.test(\"Login successful and SessionID captured\", function () {\r",
											"    var jsonData = pm.response.json();\r",
											"    var sessionID = jsonData.message.logResponse.sessionID;\r",
											"\r",
											"    pm.expect(sessionID).to.not.be.undefined; // Assert SessionID exists\r",
											"    pm.environment.set(\"SessionID\", sessionID); // Save SessionID to environment\r",
											"});\r",
											"\r",
											"// Parse the response JSON\r",
											"var jsonData = pm.response.json();\r",
											"\r",
											"// Verify that the response contains the expected roles\r",
											"pm.test(\"Verify roles in response\", function () {\r",
											"    var roles = jsonData.message.logResponse.roles.role;\r",
											"\r",
											"    // Define expected roles\r",
											"    var expectedRoles = [\"UPDATE_ORDER\", \"SAVE_ORDER\", \"REPORTS\", \"CANCEL_ORDER\"];\r",
											"\r",
											"    // Ensure roles exist in the response\r",
											"    pm.expect(roles).to.be.an(\"array\").that.is.not.empty;\r",
											"\r",
											"    // Check that all expected roles exist in the response\r",
											"    expectedRoles.forEach(role => {\r",
											"        pm.expect(roles).to.include(role, `Missing role: ${role}`);\r",
											"    });\r",
											"\r",
											"    console.log(\"✅ Roles verified successfully:\", roles);\r",
											"});\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// Get current timestamp in ISO format\r",
											"var timestamp = new Date().toISOString();\r",
											"\r",
											"// Store timestamp in Postman environment\r",
											"pm.environment.set(\"currentTimestamp\", timestamp);\r",
											"\r",
											"// Log the timestamp\r",
											"console.log(\"Timestamp Set:\", timestamp);\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "noauth"
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Accept",
										"value": "application/json",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\r\n    \"Srv\": \"Login\",\r\n    \"Message\": {\r\n        \"Login\": {\r\n            \"UserName\": \"1218\",\r\n            \"Password\": \"{{Password}}\",\r\n            \"Lang\": \"ARB\"\r\n        }\r\n    },\r\n    \"Version\": \"1.0\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"08-07-2015\"\r\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{BaseURL}}{{Oracle19}}",
									"host": [
										"{{BaseURL}}{{Oracle19}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "2. Get Banks info",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"/**\r",
											" * BNKBAL – Bank balances & info (ES5)\r",
											" * Validates:\r",
											" *  - HTTP 200, JSON, envelope codes 0/0, source=\"BNKBAL\"\r",
											" *  - bnkInfoResponse existence and key formats\r",
											" *  - Balance fields are numeric strings; negatives allowed by default (toggle strict)\r",
											" *  - banksInfo.bnkInfoRec / bnkTransfers.bnkTransferRec array shapes\r",
											" *  - financierInfo & fundInfo consistency; creditRatio accepts ratio or percent\r",
											" *  - financierInfo fields accept null/\"null\"/\"\" gracefully\r",
											" * Keeps your extracts:\r",
											" *  - accountSeq_i, bnkCode_i, accountCode_i, transferTimeId_i, bankCount\r",
											" *\r",
											" * Optional toggles (Env/Globals):\r",
											" *  - ENFORCE_NON_NEG_BALANCES = Y|N (default N) -> force balances >= 0\r",
											" */\r",
											"\r",
											"// 1) Status code\r",
											"pm.test(\"Status code is 200\", function () {\r",
											"  pm.response.to.have.status(200);\r",
											"});\r",
											"\r",
											"// 2) Envelope base checks\r",
											"pm.test(\"resCode is 0 and resDesc is Successful Operation\", function () {\r",
											"  var resStatus = (pm.response.json() || {}).responseStatus || {};\r",
											"  pm.expect(resStatus.resCode).to.eql(\"0\");\r",
											"  pm.expect(resStatus.resDesc).to.eql(\"Successful Operation\");\r",
											"});\r",
											"\r",
											"// 3) Extract and set bank info (kept as-is)\r",
											"var __json_for_extract = pm.response.json() || {};\r",
											"var __bnkInfoList = ((((__json_for_extract.message || {}).bnkInfoResponse || {}).banksInfo || {}).bnkInfoRec);\r",
											"\r",
											"if (Array.isArray(__bnkInfoList)) {\r",
											"  // Clear previous values\r",
											"  pm.environment.unset(\"bankCount\");\r",
											"\r",
											"  for (var i = 0; i < __bnkInfoList.length; i++) {\r",
											"    var bnk = __bnkInfoList[i] || {};\r",
											"    pm.environment.set(\"accountSeq_\" + (i + 1), String(bnk.accountSeq || \"\"));\r",
											"    pm.environment.set(\"bnkCode_\" + (i + 1), String(bnk.bnkCode || \"\"));\r",
											"    pm.environment.set(\"accountCode_\" + (i + 1), String(bnk.accountCode || \"\"));\r",
											"    pm.environment.set(\"transferTimeId_\" + (i + 1), String(bnk.transferTimeId || \"\"));\r",
											"  }\r",
											"  pm.environment.set(\"bankCount\", String(__bnkInfoList.length));\r",
											"} else {\r",
											"  console.warn(\"banksInfo.bnkInfoRec not found or invalid\");\r",
											"}\r",
											"\r",
											"// Basic header check\r",
											"pm.test(\"Content-Type is JSON\", function () {\r",
											"  pm.response.to.have.header(\"Content-Type\");\r",
											"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
											"});\r",
											"\r",
											"// Parse once & helpers\r",
											"var json = pm.response.json() || {};\r",
											"var rs   = json.responseStatus || {};\r",
											"var bnr  = (json.message || {}).bnkInfoResponse || {};\r",
											"\r",
											"function isNumericStr(v) {\r",
											"  if (typeof v === \"number\") return isFinite(v);\r",
											"  return typeof v === \"string\" && /^-?\\d+(\\.\\d+)?$/.test(v);\r",
											"}\r",
											"function isIntStr(v) {\r",
											"  if (typeof v === \"number\") return Number.isInteger(v);\r",
											"  return typeof v === \"string\" && /^-?\\d+$/.test(v);\r",
											"}\r",
											"function isYN(v)  { return String(v) === \"Y\" || String(v) === \"N\"; }\r",
											"function isNullish(v) {\r",
											"  return v === null || typeof v === \"undefined\" || String(v).trim().toUpperCase() === \"NULL\" || String(v).trim() === \"\";\r",
											"}\r",
											"\r",
											"// Envelope completeness\r",
											"pm.test(\"Envelope complete (BNKBAL)\", function () {\r",
											"  pm.expect(rs.resCode).to.eql(\"0\");\r",
											"  pm.expect(rs.resDesc).to.eql(\"Successful Operation\");\r",
											"  pm.expect(rs.source).to.eql(\"BNKBAL\");\r",
											"  pm.expect(rs.resCode1).to.eql(\"0\");\r",
											"  pm.expect(rs.resDesc1).to.eql(\"Successful Operation\");\r",
											"});\r",
											"\r",
											"// Core node exists\r",
											"pm.test(\"bnkInfoResponse exists\", function () {\r",
											"  pm.expect(bnr).to.be.an(\"object\");\r",
											"});\r",
											"\r",
											"// Name (if provided)\r",
											"pm.test(\"Customer name (if present) is a non-empty string\", function () {\r",
											"  if (typeof bnr.name !== \"undefined\") {\r",
											"    pm.expect(bnr.name).to.be.a(\"string\").and.to.not.equal(\"\");\r",
											"  }\r",
											"});\r",
											"\r",
											"// Balance fields – allow negatives by default (set ENFORCE_NON_NEG_BALANCES=Y to force >=0)\r",
											"pm.test(\"All balance fields are numeric strings (with optional non-negative enforcement)\", function () {\r",
											"  var keys = [\r",
											"    \"buybal1\",\"currentBal\",\"buyBal\",\"buyBal1\",\"onLineBal1\",\"maxBalance1\",\"unclearedBal\",\r",
											"    \"tradeBal\",\"t3Bal\",\"chqColl\",\"onlineBal\",\"todayDepo\",\"todayDepos\",\"allowedBal\",\r",
											"    \"postponed\",\"reservedFawriBalance\",\"maxbalance\",\"newMaxBalance\"\r",
											"  ];\r",
											"  var enforce = String(pm.environment.get(\"ENFORCE_NON_NEG_BALANCES\") || pm.globals.get(\"ENFORCE_NON_NEG_BALANCES\") || \"N\").toUpperCase() === \"Y\";\r",
											"\r",
											"  for (var i=0;i<keys.length;i++){\r",
											"    var k = keys[i];\r",
											"    if (typeof bnr[k] !== \"undefined\") {\r",
											"      pm.expect(isNumericStr(bnr[k]), k + \" must be numeric\").to.be.true;\r",
											"      if (enforce) {\r",
											"        pm.expect(Number(bnr[k]), k + \" must be >= 0 (strict mode)\").to.be.at.least(0);\r",
											"      }\r",
											"    }\r",
											"  }\r",
											"});\r",
											"\r",
											"// banksInfo array and each record format\r",
											"pm.test(\"banksInfo.bnkInfoRec is array (can be empty)\", function () {\r",
											"  var arr = (((bnr || {}).banksInfo || {}).bnkInfoRec);\r",
											"  pm.expect(arr, \"bnkInfoRec\").to.be.an(\"array\");\r",
											"});\r",
											"\r",
											"(function validateBankRecords(){\r",
											"  var arr = (((bnr || {}).banksInfo || {}).bnkInfoRec) || [];\r",
											"  if (!Array.isArray(arr) || arr.length === 0) return;\r",
											"\r",
											"  for (var i=0;i<arr.length;i++){\r",
											"    var rec = arr[i] || {};\r",
											"\r",
											"    pm.expect(String(rec.accountSeq || \"\"), \"accountSeq\").to.match(/^\\d+$/);\r",
											"\r",
											"    // bankCode: allow alphanumeric 2–10 chars (covers \"QNB\" and \"535\")\r",
											"    if (typeof rec.bankCode !== \"undefined\") {\r",
											"      var bc = String(rec.bankCode || \"\").trim().toUpperCase();\r",
											"      pm.expect(bc, \"bankCode non-empty\").to.not.equal(\"\");\r",
											"      pm.expect(bc, \"bankCode format A–Z/0–9, len 2–10\").to.match(/^[A-Z0-9]{2,10}$/);\r",
											"    }\r",
											"\r",
											"    // SWIFT/BIC strict: 8 or 11 alnum\r",
											"    pm.expect(String(rec.bnkCode || \"\"), \"bnkCode (SWIFT/BIC)\").to.match(/^[A-Z0-9]{8}([A-Z0-9]{3})?$/);\r",
											"\r",
											"    pm.expect(rec.bnkName, \"bnkName\").to.be.a(\"string\").and.not.empty;\r",
											"    pm.expect(rec.accountCode, \"accountCode\").to.be.a(\"string\").and.not.empty;\r",
											"\r",
											"    // accountType: accept BOTH/DEBIT/CREDIT/NO/TOBNK\r",
											"    if (typeof rec.accountType !== \"undefined\") {\r",
											"      pm.expect([\"BOTH\",\"DEBIT\",\"CREDIT\",\"NO\",\"TOBNK\"], \"accountType\")\r",
											"        .to.include(String(rec.accountType).toUpperCase());\r",
											"    }\r",
											"\r",
											"    // status\r",
											"    pm.expect(String(rec.accountStatus || \"\"), \"accountStatus\").to.match(/^\\d+$/);\r",
											"    pm.expect(rec.accountStatusDesc, \"accountStatusDesc\").to.be.a(\"string\").and.not.empty;\r",
											"\r",
											"    if (typeof rec.isSahlPlus !== \"undefined\") {\r",
											"      pm.expect(isYN(String(rec.isSahlPlus)), \"isSahlPlus\").to.be.true;\r",
											"    }\r",
											"\r",
											"    // transferTimeId can be long token; just ensure string & non-empty\r",
											"    pm.expect(rec.transferTimeId, \"transferTimeId\").to.be.a(\"string\").and.not.empty;\r",
											"  }\r",
											"})();\r",
											"\r",
											"// bnkTransfers shape\r",
											"pm.test(\"bnkTransfers.bnkTransferRec is array (may be empty)\", function () {\r",
											"  var tr = (((bnr || {}).bnkTransfers || {}).bnkTransferRec);\r",
											"  pm.expect(tr, \"bnkTransferRec\").to.be.an(\"array\");\r",
											"});\r",
											"\r",
											"// financierInfo (if present) – tolerant of null/\"null\"/\"\"\r",
											"pm.test(\"financierInfo (if present) has valid fields\", function () {\r",
											"  var fi = bnr.financierInfo;\r",
											"  if (fi && typeof fi === \"object\") {\r",
											"    if (!isNullish(fi.financierID)) {\r",
											"      pm.expect(String(fi.financierID)).to.match(/^\\d+$/);\r",
											"    }\r",
											"\r",
											"    if (!isNullish(fi.isActive)) {\r",
											"      pm.expect(isYN(String(fi.isActive))).to.be.true;\r",
											"    }\r",
											"\r",
											"    if (!isNullish(fi.isOrdersEnabled)) {\r",
											"      pm.expect(isYN(String(fi.isOrdersEnabled))).to.be.true;\r",
											"    }\r",
											"\r",
											"    if (!isNullish(fi.riskFeesType)) {\r",
											"      pm.expect([\"0\",\"1\",\"2\",\"3\"]).to.include(String(fi.riskFeesType));\r",
											"    }\r",
											"    // riskFeesValue: validate only when present & not nullish\r",
											"    if (!isNullish(fi.riskFeesValue)) {\r",
											"      pm.expect(isNumericStr(fi.riskFeesValue)).to.be.true;\r",
											"      pm.expect(Number(fi.riskFeesValue)).to.be.at.least(0);\r",
											"    }\r",
											"\r",
											"    if (!isNullish(fi.financierAllowancePeriod)) {\r",
											"      pm.expect(isIntStr(fi.financierAllowancePeriod)).to.be.true;\r",
											"      pm.expect(Number(fi.financierAllowancePeriod)).to.be.at.least(0);\r",
											"    }\r",
											"  }\r",
											"});\r",
											"\r",
											"// fundInfo (margin block; can be N or Y)\r",
											"pm.test(\"fundInfo (if present) is consistent\", function () {\r",
											"  var f = bnr.fundInfo;\r",
											"  if (f && typeof f === \"object\") {\r",
											"    pm.expect(isYN(String(f.isFundClient)), \"isFundClient Y/N\").to.be.true;\r",
											"\r",
											"    if (f.isFundClient === \"Y\") {\r",
											"      var numKeys = [\r",
											"        \"fundDebt\",\"fundAvailableCredit\",\"cashBalanceNotCollected\",\"fundedAmountInMarket\",\r",
											"        \"creditRatio\",\"collectedBalance\",\"actualFunded\",\"shareAvCredit\"\r",
											"      ];\r",
											"      for (var i=0;i<numKeys.length;i++){\r",
											"        var k = numKeys[i];\r",
											"        pm.expect(isNumericStr(String(f[k])), \"fundInfo.\"+k+\" numeric\").to.be.true;\r",
											"        pm.expect(Number(f[k]), \"fundInfo.\"+k+\" >= 0\").to.be.at.least(0);\r",
											"      }\r",
											"\r",
											"      // creditRatio sanity: accept ratio [0..1] OR percent [0..100]\r",
											"      if (!isNullish(f.creditRatio)) {\r",
											"        var cr = Number(f.creditRatio);\r",
											"        if (cr > 1) {\r",
											"          pm.expect(cr, \"creditRatio% in [0, 100]\").to.be.at.least(0).and.at.most(100);\r",
											"          pm.environment.set(\"CREDIT_RATIO\", String(cr / 100));     // normalized 0..1\r",
											"          pm.environment.set(\"CREDIT_RATIO_PCT\", String(cr));       // as percent\r",
											"        } else {\r",
											"          pm.expect(cr, \"creditRatio in [0, 1]\").to.be.at.least(0).and.at.most(1);\r",
											"          pm.environment.set(\"CREDIT_RATIO\", String(cr));           // normalized 0..1\r",
											"          pm.environment.set(\"CREDIT_RATIO_PCT\", String(cr * 100)); // as percent\r",
											"        }\r",
											"      }\r",
											"\r",
											"      if (!isNullish(f.isActiveFundClient)) {\r",
											"        pm.expect(isYN(String(f.isActiveFundClient))).to.be.true;\r",
											"      }\r",
											"    }\r",
											"  }\r",
											"});\r",
											"\r",
											"// resType should reflect request's AccRegisterType (when provided)\r",
											"pm.test(\"resType matches AccRegisterType from request (when provided)\", function () {\r",
											"  var reqBody;\r",
											"  try { reqBody = pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {}; } catch(e){}\r",
											"  var accType = (((reqBody || {}).Message || {}).BalDlsRequest || {}).AccRegisterType;\r",
											"  if (accType) {\r",
											"    pm.expect(bnr.resType, \"resType\").to.eql(String(accType));\r",
											"  }\r",
											"});\r",
											"\r",
											"// Guardrails: request Srv should be BNKBAL\r",
											"pm.test(\"Request Srv is BNKBAL\", function () {\r",
											"  var reqBody;\r",
											"  try { reqBody = pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {}; } catch(e){}\r",
											"  pm.expect((reqBody || {}).Srv).to.eql(\"BNKBAL\");\r",
											"});\r",
											"\r",
											"// Minimal schema (tv4)\r",
											"pm.test(\"Schema (minimal) validates\", function () {\r",
											"  var schema = {\r",
											"    type: \"object\",\r",
											"    required: [\"responseStatus\",\"message\"],\r",
											"    properties: {\r",
											"      responseStatus: {\r",
											"        type: \"object\",\r",
											"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
											"        properties: {\r",
											"          resCode:  { \"const\": \"0\" },\r",
											"          resDesc:  { \"const\": \"Successful Operation\" },\r",
											"          source:   { \"const\": \"BNKBAL\" },\r",
											"          resCode1: { \"const\": \"0\" },\r",
											"          resDesc1: { \"const\": \"Successful Operation\" }\r",
											"        }\r",
											"      },\r",
											"      message: {\r",
											"        type: \"object\",\r",
											"        required: [\"bnkInfoResponse\"],\r",
											"        properties: {\r",
											"          bnkInfoResponse: { type: \"object\" }\r",
											"        }\r",
											"      }\r",
											"    }\r",
											"  };\r",
											"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
											"});\r",
											"\r",
											"// Extra: store a few more env helpers (without touching your extract keys)\r",
											"(function storeExtras(){\r",
											"  var arr = (((bnr || {}).banksInfo || {}).bnkInfoRec) || [];\r",
											"  if (arr.length > 0) {\r",
											"    pm.environment.set(\"firstBankCode\", String(arr[0].bankCode || \"\"));\r",
											"    pm.environment.set(\"firstBankSwift\", String(arr[0].bnkCode || \"\"));\r",
											"    pm.environment.set(\"firstAccountStatus\", String(arr[0].accountStatus || \"\"));\r",
											"  }\r",
											"  pm.environment.set(\"bnkTransfersCount\", String(((((bnr || {}).bnkTransfers || {}).bnkTransferRec) || []).length));\r",
											"})();\r",
											"\r",
											"console.log(\"✅ BNKBAL validated.\",\r",
											"            \"bankCount:\", pm.environment.get(\"bankCount\"),\r",
											"            \"transfers:\", pm.environment.get(\"bnkTransfersCount\"),\r",
											"            \"creditRatio(norm):\", pm.environment.get(\"CREDIT_RATIO\"),\r",
											"            \"creditRatio(%) \", pm.environment.get(\"CREDIT_RATIO_PCT\"));\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "noauth"
								},
								"method": "POST",
								"header": [
									{
										"key": "Accept",
										"value": "application/json",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\r\n    \"Srv\": \"BNKBAL\",\r\n    \"Message\": {\r\n        \"BalDlsRequest\": {\r\n            \"NIN\": \"{{NIN}}\",\r\n            \"UserId\": \"{{UserID}}\",\r\n            \"UserType\": \"INVESTOR\",\r\n            \"AccRegisterType\": \"ALL\",\r\n            \"Lang\": \"ARB\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"30-04-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}\r\n\r\n\r\n",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{BaseURL}}{{Oracle19}}",
									"host": [
										"{{BaseURL}}{{Oracle19}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "3. Remove Bank with Wrong bank info",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"/**\r",
											" * RMVBNKACC – Negative: wrong bank info\r",
											" * Expect:\r",
											" *  - HTTP 200\r",
											" *  - responseStatus.resCode/resCode1 = \"50\"\r",
											" *  - source=\"RMVBNKACC\"\r",
											" *  - Arabic message like \"لا يوجد حساب بنكي بهذه المعلومات\"\r",
											" *  - No business payload (message absent/empty)\r",
											" * Optional: check we sent some bank identifier in request (accountSeq, bnkCode, accountCode, bankCode)\r",
											" * Saves:\r",
											" *  RMV_ERR_CODE, RMV_ERR_DESC\r",
											" */\r",
											"\r",
											"pm.test(\"HTTP 200\", function(){ pm.response.to.have.status(200); });\r",
											"pm.test(\"Content-Type is JSON\", function () {\r",
											"  pm.response.to.have.header(\"Content-Type\");\r",
											"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
											"});\r",
											"\r",
											"var json;\r",
											"pm.test(\"Body is valid JSON\", function(){ json = pm.response.json(); pm.expect(json).to.be.an(\"object\"); });\r",
											"\r",
											"// Envelope\r",
											"pm.test(\"responseStatus indicates error 50 (RMVBNKACC)\", function(){\r",
											"  var rs = json.responseStatus || {};\r",
											"  pm.expect(rs.source).to.eql(\"RMVBNKACC\");\r",
											"  pm.expect(rs.resCode).to.eql(\"50\");\r",
											"  pm.expect(rs.resCode1).to.eql(\"50\");\r",
											"\r",
											"  // Arabic message check (tolerant to spaces)\r",
											"  function norm(s){ return String(s == null ? \"\" : s).replace(/\\s+/g,\" \").replace(/^\\s+|\\s+$/g,\"\"); }\r",
											"  var d1 = norm(rs.resDesc), d2 = norm(rs.resDesc1);\r",
											"  pm.expect(/حساب\\s*بنكي/.test(d1) || /حساب\\s*بنكي/.test(d2), \"Message should mention 'حساب بنكي'\").to.be.true;\r",
											"  pm.expect(/بهذه\\s*المعلومات/.test(d1) || /بهذه\\s*المعلومات/.test(d2), \"Message should mention 'بهذه المعلومات'\").to.be.true;\r",
											"});\r",
											"\r",
											"// No business payload\r",
											"pm.test(\"No removeBankAccountResponse on error\", function(){\r",
											"  var msg = json.message;\r",
											"  var empty = (msg == null) || (typeof msg === \"object\" && Object.keys(msg).length === 0);\r",
											"  pm.expect(empty, \"message should be absent or empty for error\").to.be.true;\r",
											"});\r",
											"\r",
											"// Optional: verify request contained an identifier\r",
											"pm.test(\"Request contained some bank identifier (best-effort)\", function(){\r",
											"  try {\r",
											"    var body = pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {};\r",
											"    function hasKeyLike(o){\r",
											"      if (!o || typeof o !== \"object\") return false;\r",
											"      for (var k in o){\r",
											"        if (!o.hasOwnProperty(k)) continue;\r",
											"        var v = o[k];\r",
											"        if (/^(accountSeq|bnkCode|accountCode|bankCode)$/i.test(k) && String(v).trim().length > 0) return true;\r",
											"        if (v && typeof v === \"object\" && hasKeyLike(v)) return true;\r",
											"      }\r",
											"      return false;\r",
											"    }\r",
											"    if (!hasKeyLike(body)) {\r",
											"      console.warn(\"No explicit bank identifier (accountSeq/bnkCode/accountCode/bankCode) found in request body.\");\r",
											"    }\r",
											"  } catch(e){\r",
											"    console.warn(\"Could not parse request body:\", e.message);\r",
											"  }\r",
											"});\r",
											"\r",
											"// Save env\r",
											"pm.environment.set(\"RMV_ERR_CODE\", \"50\");\r",
											"pm.environment.set(\"RMV_ERR_DESC\", String((json.responseStatus || {}).resDesc || \"\"));\r",
											"\r",
											"// Minimal schema\r",
											"pm.test(\"Error schema (minimal) validates\", function(){\r",
											"  var schema = {\r",
											"    type: \"object\",\r",
											"    required: [\"responseStatus\"],\r",
											"    properties: {\r",
											"      responseStatus: {\r",
											"        type: \"object\",\r",
											"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
											"        properties: {\r",
											"          resCode: {\"const\":\"50\"},\r",
											"          resDesc: {\"type\":\"string\"},\r",
											"          source: {\"const\":\"RMVBNKACC\"},\r",
											"          resCode1: {\"const\":\"50\"},\r",
											"          resDesc1: {\"type\":\"string\"}\r",
											"        }\r",
											"      }\r",
											"    },\r",
											"    additionalProperties: true\r",
											"  };\r",
											"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
											"});\r",
											"\r",
											"console.log(\"❌ RMVBNKACC wrong bank info. resCode=50\");\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Accept",
										"value": "application/json",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\r\n    \"Srv\": \"RMVBNKACC\",\r\n    \"Message\": {\r\n        \"RemoveBankAccountRequest\": {\r\n            \"NIN\": \"{{NIN}}\",\r\n            \"UserId\": \"{{UserID}}\",\r\n            \"userType\": \"INVESTOR\",\r\n            \"lang\": \"ARB\",\r\n            \"status\": \"2\",\r\n            \"accountNo\": \"123456\",\r\n            \"swiftAddress\": \"QNBAQAQAXXXX\",\r\n            \"currencyCode\": \"307\",\r\n            \"accountSeq\": \"123456\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"05-10-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{BaseURL}}{{Oracle19}}",
									"host": [
										"{{BaseURL}}{{Oracle19}}"
									]
								}
							},
							"response": []
						}
					]
				},
				{
					"name": "Remove existing bank",
					"item": [
						{
							"name": "1. Login",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"// Check if the status code is 200\r",
											"pm.test(\"Status code is 200\", function () {\r",
											"    pm.response.to.have.status(200);\r",
											"});\r",
											"\r",
											"// Check if response code is 0\r",
											"pm.test(\"Response code is 0\", function () {\r",
											"    var jsonData = pm.response.json(); // Parse JSON response\r",
											"    pm.expect(jsonData.responseStatus.resCode).to.equal(\"0\");\r",
											"});\r",
											"\r",
											"// Check if response description is \"Successful Operation\"\r",
											"pm.test(\"Response description is 'Successful Operation'\", function () {\r",
											"    var jsonData = pm.response.json();\r",
											"    pm.expect(jsonData.responseStatus.resDesc).to.equal(\"Successful Operation\");\r",
											"});\r",
											"\r",
											"// Check if login is successful and capture NIN\r",
											"pm.test(\"Login successful and NIN captured\", function () {\r",
											"    var jsonData = pm.response.json();\r",
											"    var accounts = jsonData.message.logResponse.accounts.account;\r",
											"\r",
											"    if (accounts.length > 0) {\r",
											"        var nin = accounts[0].nin; // Extract NIN\r",
											"        pm.expect(nin).to.not.be.undefined; // Ensure it's not empty\r",
											"\r",
											"        // Store in environment variables\r",
											"        pm.environment.set(\"NIN\", nin);\r",
											"        pm.environment.set(\"UserID\", nin); // Store the same value in UserID\r",
											"\r",
											"        console.log(\"Captured NIN/UserID:\", nin);\r",
											"    } else {\r",
											"        pm.expect.fail(\"NIN not found in the response.\");\r",
											"    }\r",
											"});\r",
											"\r",
											"// Check if login is successful and SessionID is created\r",
											"pm.test(\"Login successful and SessionID created\", function () {\r",
											"    var jsonData = pm.response.json();\r",
											"    var sessionID = jsonData.message.logResponse.sessionID;\r",
											"\r",
											"    pm.expect(sessionID).to.not.be.undefined; // Assert SessionID exists\r",
											"});\r",
											"\r",
											"// Verify Content-Type header is 'application/json'\r",
											"pm.test(\"Content-Type header is 'application/json'\", function () {\r",
											"    pm.expect(pm.response.headers.get(\"Content-Type\")).to.include(\"application/json\");\r",
											"});\r",
											"\r",
											"// Check if login is successful and capture SessionID\r",
											"pm.test(\"Login successful and SessionID captured\", function () {\r",
											"    var jsonData = pm.response.json();\r",
											"    var sessionID = jsonData.message.logResponse.sessionID;\r",
											"\r",
											"    pm.expect(sessionID).to.not.be.undefined; // Assert SessionID exists\r",
											"    pm.environment.set(\"SessionID\", sessionID); // Save SessionID to environment\r",
											"});\r",
											"\r",
											"// Parse the response JSON\r",
											"var jsonData = pm.response.json();\r",
											"\r",
											"// Verify that the response contains the expected roles\r",
											"pm.test(\"Verify roles in response\", function () {\r",
											"    var roles = jsonData.message.logResponse.roles.role;\r",
											"\r",
											"    // Define expected roles\r",
											"    var expectedRoles = [\"UPDATE_ORDER\", \"SAVE_ORDER\", \"REPORTS\", \"CANCEL_ORDER\"];\r",
											"\r",
											"    // Ensure roles exist in the response\r",
											"    pm.expect(roles).to.be.an(\"array\").that.is.not.empty;\r",
											"\r",
											"    // Check that all expected roles exist in the response\r",
											"    expectedRoles.forEach(role => {\r",
											"        pm.expect(roles).to.include(role, `Missing role: ${role}`);\r",
											"    });\r",
											"\r",
											"    console.log(\"✅ Roles verified successfully:\", roles);\r",
											"});\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// Get current timestamp in ISO format\r",
											"var timestamp = new Date().toISOString();\r",
											"\r",
											"// Store timestamp in Postman environment\r",
											"pm.environment.set(\"currentTimestamp\", timestamp);\r",
											"\r",
											"// Log the timestamp\r",
											"console.log(\"Timestamp Set:\", timestamp);\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "noauth"
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Accept",
										"value": "application/json",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\r\n    \"Srv\": \"Login\",\r\n    \"Message\": {\r\n        \"Login\": {\r\n            \"UserName\": \"1218\",\r\n            \"Password\": \"{{Password}}\",\r\n            \"Lang\": \"ARB\"\r\n        }\r\n    },\r\n    \"Version\": \"1.0\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"08-07-2015\"\r\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{BaseURL}}{{Oracle19}}",
									"host": [
										"{{BaseURL}}{{Oracle19}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "2. Get Banks info",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"/**\r",
											" * BNKBAL – Bank balances & info (ES5)\r",
											" * Validates:\r",
											" *  - HTTP 200, JSON, envelope codes 0/0, source=\"BNKBAL\"\r",
											" *  - bnkInfoResponse existence and key formats\r",
											" *  - Balance fields are numeric strings; negatives allowed by default (toggle strict)\r",
											" *  - banksInfo.bnkInfoRec / bnkTransfers.bnkTransferRec array shapes\r",
											" *  - financierInfo & fundInfo consistency; creditRatio accepts ratio or percent\r",
											" *  - financierInfo fields accept null/\"null\"/\"\" gracefully\r",
											" * Keeps your extracts:\r",
											" *  - accountSeq_i, bnkCode_i, accountCode_i, transferTimeId_i, bankCount\r",
											" *\r",
											" * Optional toggles (Env/Globals):\r",
											" *  - ENFORCE_NON_NEG_BALANCES = Y|N (default N) -> force balances >= 0\r",
											" */\r",
											"\r",
											"// 1) Status code\r",
											"pm.test(\"Status code is 200\", function () {\r",
											"  pm.response.to.have.status(200);\r",
											"});\r",
											"\r",
											"// 2) Envelope base checks\r",
											"pm.test(\"resCode is 0 and resDesc is Successful Operation\", function () {\r",
											"  var resStatus = (pm.response.json() || {}).responseStatus || {};\r",
											"  pm.expect(resStatus.resCode).to.eql(\"0\");\r",
											"  pm.expect(resStatus.resDesc).to.eql(\"Successful Operation\");\r",
											"});\r",
											"\r",
											"// 3) Extract and set bank info (kept as-is)\r",
											"var __json_for_extract = pm.response.json() || {};\r",
											"var __bnkInfoList = ((((__json_for_extract.message || {}).bnkInfoResponse || {}).banksInfo || {}).bnkInfoRec);\r",
											"\r",
											"if (Array.isArray(__bnkInfoList)) {\r",
											"  // Clear previous values\r",
											"  pm.environment.unset(\"bankCount\");\r",
											"\r",
											"  for (var i = 0; i < __bnkInfoList.length; i++) {\r",
											"    var bnk = __bnkInfoList[i] || {};\r",
											"    pm.environment.set(\"accountSeq_\" + (i + 1), String(bnk.accountSeq || \"\"));\r",
											"    pm.environment.set(\"bnkCode_\" + (i + 1), String(bnk.bnkCode || \"\"));\r",
											"    pm.environment.set(\"accountCode_\" + (i + 1), String(bnk.accountCode || \"\"));\r",
											"    pm.environment.set(\"transferTimeId_\" + (i + 1), String(bnk.transferTimeId || \"\"));\r",
											"  }\r",
											"  pm.environment.set(\"bankCount\", String(__bnkInfoList.length));\r",
											"} else {\r",
											"  console.warn(\"banksInfo.bnkInfoRec not found or invalid\");\r",
											"}\r",
											"\r",
											"// Basic header check\r",
											"pm.test(\"Content-Type is JSON\", function () {\r",
											"  pm.response.to.have.header(\"Content-Type\");\r",
											"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
											"});\r",
											"\r",
											"// Parse once & helpers\r",
											"var json = pm.response.json() || {};\r",
											"var rs   = json.responseStatus || {};\r",
											"var bnr  = (json.message || {}).bnkInfoResponse || {};\r",
											"\r",
											"function isNumericStr(v) {\r",
											"  if (typeof v === \"number\") return isFinite(v);\r",
											"  return typeof v === \"string\" && /^-?\\d+(\\.\\d+)?$/.test(v);\r",
											"}\r",
											"function isIntStr(v) {\r",
											"  if (typeof v === \"number\") return Number.isInteger(v);\r",
											"  return typeof v === \"string\" && /^-?\\d+$/.test(v);\r",
											"}\r",
											"function isYN(v)  { return String(v) === \"Y\" || String(v) === \"N\"; }\r",
											"function isNullish(v) {\r",
											"  return v === null || typeof v === \"undefined\" || String(v).trim().toUpperCase() === \"NULL\" || String(v).trim() === \"\";\r",
											"}\r",
											"\r",
											"// Envelope completeness\r",
											"pm.test(\"Envelope complete (BNKBAL)\", function () {\r",
											"  pm.expect(rs.resCode).to.eql(\"0\");\r",
											"  pm.expect(rs.resDesc).to.eql(\"Successful Operation\");\r",
											"  pm.expect(rs.source).to.eql(\"BNKBAL\");\r",
											"  pm.expect(rs.resCode1).to.eql(\"0\");\r",
											"  pm.expect(rs.resDesc1).to.eql(\"Successful Operation\");\r",
											"});\r",
											"\r",
											"// Core node exists\r",
											"pm.test(\"bnkInfoResponse exists\", function () {\r",
											"  pm.expect(bnr).to.be.an(\"object\");\r",
											"});\r",
											"\r",
											"// Name (if provided)\r",
											"pm.test(\"Customer name (if present) is a non-empty string\", function () {\r",
											"  if (typeof bnr.name !== \"undefined\") {\r",
											"    pm.expect(bnr.name).to.be.a(\"string\").and.to.not.equal(\"\");\r",
											"  }\r",
											"});\r",
											"\r",
											"// Balance fields – allow negatives by default (set ENFORCE_NON_NEG_BALANCES=Y to force >=0)\r",
											"pm.test(\"All balance fields are numeric strings (with optional non-negative enforcement)\", function () {\r",
											"  var keys = [\r",
											"    \"buybal1\",\"currentBal\",\"buyBal\",\"buyBal1\",\"onLineBal1\",\"maxBalance1\",\"unclearedBal\",\r",
											"    \"tradeBal\",\"t3Bal\",\"chqColl\",\"onlineBal\",\"todayDepo\",\"todayDepos\",\"allowedBal\",\r",
											"    \"postponed\",\"reservedFawriBalance\",\"maxbalance\",\"newMaxBalance\"\r",
											"  ];\r",
											"  var enforce = String(pm.environment.get(\"ENFORCE_NON_NEG_BALANCES\") || pm.globals.get(\"ENFORCE_NON_NEG_BALANCES\") || \"N\").toUpperCase() === \"Y\";\r",
											"\r",
											"  for (var i=0;i<keys.length;i++){\r",
											"    var k = keys[i];\r",
											"    if (typeof bnr[k] !== \"undefined\") {\r",
											"      pm.expect(isNumericStr(bnr[k]), k + \" must be numeric\").to.be.true;\r",
											"      if (enforce) {\r",
											"        pm.expect(Number(bnr[k]), k + \" must be >= 0 (strict mode)\").to.be.at.least(0);\r",
											"      }\r",
											"    }\r",
											"  }\r",
											"});\r",
											"\r",
											"// banksInfo array and each record format\r",
											"pm.test(\"banksInfo.bnkInfoRec is array (can be empty)\", function () {\r",
											"  var arr = (((bnr || {}).banksInfo || {}).bnkInfoRec);\r",
											"  pm.expect(arr, \"bnkInfoRec\").to.be.an(\"array\");\r",
											"});\r",
											"\r",
											"(function validateBankRecords(){\r",
											"  var arr = (((bnr || {}).banksInfo || {}).bnkInfoRec) || [];\r",
											"  if (!Array.isArray(arr) || arr.length === 0) return;\r",
											"\r",
											"  for (var i=0;i<arr.length;i++){\r",
											"    var rec = arr[i] || {};\r",
											"\r",
											"    pm.expect(String(rec.accountSeq || \"\"), \"accountSeq\").to.match(/^\\d+$/);\r",
											"\r",
											"    // bankCode: allow alphanumeric 2–10 chars (covers \"QNB\" and \"535\")\r",
											"    if (typeof rec.bankCode !== \"undefined\") {\r",
											"      var bc = String(rec.bankCode || \"\").trim().toUpperCase();\r",
											"      pm.expect(bc, \"bankCode non-empty\").to.not.equal(\"\");\r",
											"      pm.expect(bc, \"bankCode format A–Z/0–9, len 2–10\").to.match(/^[A-Z0-9]{2,10}$/);\r",
											"    }\r",
											"\r",
											"    // SWIFT/BIC strict: 8 or 11 alnum\r",
											"    pm.expect(String(rec.bnkCode || \"\"), \"bnkCode (SWIFT/BIC)\").to.match(/^[A-Z0-9]{8}([A-Z0-9]{3})?$/);\r",
											"\r",
											"    pm.expect(rec.bnkName, \"bnkName\").to.be.a(\"string\").and.not.empty;\r",
											"    pm.expect(rec.accountCode, \"accountCode\").to.be.a(\"string\").and.not.empty;\r",
											"\r",
											"    // accountType: accept BOTH/DEBIT/CREDIT/NO/TOBNK\r",
											"    if (typeof rec.accountType !== \"undefined\") {\r",
											"      pm.expect([\"BOTH\",\"DEBIT\",\"CREDIT\",\"NO\",\"TOBNK\"], \"accountType\")\r",
											"        .to.include(String(rec.accountType).toUpperCase());\r",
											"    }\r",
											"\r",
											"    // status\r",
											"    pm.expect(String(rec.accountStatus || \"\"), \"accountStatus\").to.match(/^\\d+$/);\r",
											"    pm.expect(rec.accountStatusDesc, \"accountStatusDesc\").to.be.a(\"string\").and.not.empty;\r",
											"\r",
											"    if (typeof rec.isSahlPlus !== \"undefined\") {\r",
											"      pm.expect(isYN(String(rec.isSahlPlus)), \"isSahlPlus\").to.be.true;\r",
											"    }\r",
											"\r",
											"    // transferTimeId can be long token; just ensure string & non-empty\r",
											"    pm.expect(rec.transferTimeId, \"transferTimeId\").to.be.a(\"string\").and.not.empty;\r",
											"  }\r",
											"})();\r",
											"\r",
											"// bnkTransfers shape\r",
											"pm.test(\"bnkTransfers.bnkTransferRec is array (may be empty)\", function () {\r",
											"  var tr = (((bnr || {}).bnkTransfers || {}).bnkTransferRec);\r",
											"  pm.expect(tr, \"bnkTransferRec\").to.be.an(\"array\");\r",
											"});\r",
											"\r",
											"// financierInfo (if present) – tolerant of null/\"null\"/\"\"\r",
											"pm.test(\"financierInfo (if present) has valid fields\", function () {\r",
											"  var fi = bnr.financierInfo;\r",
											"  if (fi && typeof fi === \"object\") {\r",
											"    if (!isNullish(fi.financierID)) {\r",
											"      pm.expect(String(fi.financierID)).to.match(/^\\d+$/);\r",
											"    }\r",
											"\r",
											"    if (!isNullish(fi.isActive)) {\r",
											"      pm.expect(isYN(String(fi.isActive))).to.be.true;\r",
											"    }\r",
											"\r",
											"    if (!isNullish(fi.isOrdersEnabled)) {\r",
											"      pm.expect(isYN(String(fi.isOrdersEnabled))).to.be.true;\r",
											"    }\r",
											"\r",
											"    if (!isNullish(fi.riskFeesType)) {\r",
											"      pm.expect([\"0\",\"1\",\"2\",\"3\"]).to.include(String(fi.riskFeesType));\r",
											"    }\r",
											"    // riskFeesValue: validate only when present & not nullish\r",
											"    if (!isNullish(fi.riskFeesValue)) {\r",
											"      pm.expect(isNumericStr(fi.riskFeesValue)).to.be.true;\r",
											"      pm.expect(Number(fi.riskFeesValue)).to.be.at.least(0);\r",
											"    }\r",
											"\r",
											"    if (!isNullish(fi.financierAllowancePeriod)) {\r",
											"      pm.expect(isIntStr(fi.financierAllowancePeriod)).to.be.true;\r",
											"      pm.expect(Number(fi.financierAllowancePeriod)).to.be.at.least(0);\r",
											"    }\r",
											"  }\r",
											"});\r",
											"\r",
											"// fundInfo (margin block; can be N or Y)\r",
											"pm.test(\"fundInfo (if present) is consistent\", function () {\r",
											"  var f = bnr.fundInfo;\r",
											"  if (f && typeof f === \"object\") {\r",
											"    pm.expect(isYN(String(f.isFundClient)), \"isFundClient Y/N\").to.be.true;\r",
											"\r",
											"    if (f.isFundClient === \"Y\") {\r",
											"      var numKeys = [\r",
											"        \"fundDebt\",\"fundAvailableCredit\",\"cashBalanceNotCollected\",\"fundedAmountInMarket\",\r",
											"        \"creditRatio\",\"collectedBalance\",\"actualFunded\",\"shareAvCredit\"\r",
											"      ];\r",
											"      for (var i=0;i<numKeys.length;i++){\r",
											"        var k = numKeys[i];\r",
											"        pm.expect(isNumericStr(String(f[k])), \"fundInfo.\"+k+\" numeric\").to.be.true;\r",
											"        pm.expect(Number(f[k]), \"fundInfo.\"+k+\" >= 0\").to.be.at.least(0);\r",
											"      }\r",
											"\r",
											"      // creditRatio sanity: accept ratio [0..1] OR percent [0..100]\r",
											"      if (!isNullish(f.creditRatio)) {\r",
											"        var cr = Number(f.creditRatio);\r",
											"        if (cr > 1) {\r",
											"          pm.expect(cr, \"creditRatio% in [0, 100]\").to.be.at.least(0).and.at.most(100);\r",
											"          pm.environment.set(\"CREDIT_RATIO\", String(cr / 100));     // normalized 0..1\r",
											"          pm.environment.set(\"CREDIT_RATIO_PCT\", String(cr));       // as percent\r",
											"        } else {\r",
											"          pm.expect(cr, \"creditRatio in [0, 1]\").to.be.at.least(0).and.at.most(1);\r",
											"          pm.environment.set(\"CREDIT_RATIO\", String(cr));           // normalized 0..1\r",
											"          pm.environment.set(\"CREDIT_RATIO_PCT\", String(cr * 100)); // as percent\r",
											"        }\r",
											"      }\r",
											"\r",
											"      if (!isNullish(f.isActiveFundClient)) {\r",
											"        pm.expect(isYN(String(f.isActiveFundClient))).to.be.true;\r",
											"      }\r",
											"    }\r",
											"  }\r",
											"});\r",
											"\r",
											"// resType should reflect request's AccRegisterType (when provided)\r",
											"pm.test(\"resType matches AccRegisterType from request (when provided)\", function () {\r",
											"  var reqBody;\r",
											"  try { reqBody = pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {}; } catch(e){}\r",
											"  var accType = (((reqBody || {}).Message || {}).BalDlsRequest || {}).AccRegisterType;\r",
											"  if (accType) {\r",
											"    pm.expect(bnr.resType, \"resType\").to.eql(String(accType));\r",
											"  }\r",
											"});\r",
											"\r",
											"// Guardrails: request Srv should be BNKBAL\r",
											"pm.test(\"Request Srv is BNKBAL\", function () {\r",
											"  var reqBody;\r",
											"  try { reqBody = pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {}; } catch(e){}\r",
											"  pm.expect((reqBody || {}).Srv).to.eql(\"BNKBAL\");\r",
											"});\r",
											"\r",
											"// Minimal schema (tv4)\r",
											"pm.test(\"Schema (minimal) validates\", function () {\r",
											"  var schema = {\r",
											"    type: \"object\",\r",
											"    required: [\"responseStatus\",\"message\"],\r",
											"    properties: {\r",
											"      responseStatus: {\r",
											"        type: \"object\",\r",
											"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
											"        properties: {\r",
											"          resCode:  { \"const\": \"0\" },\r",
											"          resDesc:  { \"const\": \"Successful Operation\" },\r",
											"          source:   { \"const\": \"BNKBAL\" },\r",
											"          resCode1: { \"const\": \"0\" },\r",
											"          resDesc1: { \"const\": \"Successful Operation\" }\r",
											"        }\r",
											"      },\r",
											"      message: {\r",
											"        type: \"object\",\r",
											"        required: [\"bnkInfoResponse\"],\r",
											"        properties: {\r",
											"          bnkInfoResponse: { type: \"object\" }\r",
											"        }\r",
											"      }\r",
											"    }\r",
											"  };\r",
											"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
											"});\r",
											"\r",
											"// Extra: store a few more env helpers (without touching your extract keys)\r",
											"(function storeExtras(){\r",
											"  var arr = (((bnr || {}).banksInfo || {}).bnkInfoRec) || [];\r",
											"  if (arr.length > 0) {\r",
											"    pm.environment.set(\"firstBankCode\", String(arr[0].bankCode || \"\"));\r",
											"    pm.environment.set(\"firstBankSwift\", String(arr[0].bnkCode || \"\"));\r",
											"    pm.environment.set(\"firstAccountStatus\", String(arr[0].accountStatus || \"\"));\r",
											"  }\r",
											"  pm.environment.set(\"bnkTransfersCount\", String(((((bnr || {}).bnkTransfers || {}).bnkTransferRec) || []).length));\r",
											"})();\r",
											"\r",
											"console.log(\"✅ BNKBAL validated.\",\r",
											"            \"bankCount:\", pm.environment.get(\"bankCount\"),\r",
											"            \"transfers:\", pm.environment.get(\"bnkTransfersCount\"),\r",
											"            \"creditRatio(norm):\", pm.environment.get(\"CREDIT_RATIO\"),\r",
											"            \"creditRatio(%) \", pm.environment.get(\"CREDIT_RATIO_PCT\"));\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "noauth"
								},
								"method": "POST",
								"header": [
									{
										"key": "Accept",
										"value": "application/json",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\r\n    \"Srv\": \"BNKBAL\",\r\n    \"Message\": {\r\n        \"BalDlsRequest\": {\r\n            \"NIN\": \"{{NIN}}\",\r\n            \"UserId\": \"{{UserID}}\",\r\n            \"UserType\": \"INVESTOR\",\r\n            \"AccRegisterType\": \"ALL\",\r\n            \"Lang\": \"ARB\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"30-04-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}\r\n\r\n\r\n",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{BaseURL}}{{Oracle19}}",
									"host": [
										"{{BaseURL}}{{Oracle19}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "3. Delete Bank Account",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"/**\r",
											" * RMVBNKACC – Happy path\r",
											" * Expect:\r",
											" *  - responseStatus.* = \"0\", source=\"RMVBNKACC\"\r",
											" *  - message.removeBankAccountResponse: { done:\"OK\", removeCode:\"0\", removeMessage:\"\" }\r",
											" * Saves:\r",
											" *  RMV_DONE, RMV_CODE, RMV_MESSAGE\r",
											" */\r",
											"\r",
											"pm.test(\"HTTP 200\", function () { pm.response.to.have.status(200); });\r",
											"pm.test(\"Content-Type is JSON\", function () {\r",
											"  pm.response.to.have.header(\"Content-Type\");\r",
											"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
											"});\r",
											"\r",
											"var json;\r",
											"pm.test(\"Body is valid JSON\", function(){ json = pm.response.json(); pm.expect(json).to.be.an(\"object\"); });\r",
											"\r",
											"pm.test(\"Envelope OK (RMVBNKACC)\", function(){\r",
											"  var rs = json.responseStatus || {};\r",
											"  pm.expect(rs.resCode).to.eql(\"0\");\r",
											"  pm.expect(rs.resDesc).to.eql(\"Successful Operation\");\r",
											"  pm.expect(rs.source).to.eql(\"RMVBNKACC\");\r",
											"  pm.expect(rs.resCode1).to.eql(\"0\");\r",
											"  pm.expect(rs.resDesc1).to.eql(\"Successful Operation\");\r",
											"});\r",
											"\r",
											"var node = (((json || {}).message || {}).removeBankAccountResponse) || {};\r",
											"pm.test(\"removeBankAccountResponse exists & has required keys\", function(){\r",
											"  pm.expect(node).to.be.an(\"object\");\r",
											"  [\"done\",\"removeCode\",\"removeMessage\"].forEach(function(k){\r",
											"    pm.expect(node, \"Missing key: \" + k).to.have.property(k);\r",
											"    pm.expect(typeof node[k], k + \" must be string\").to.eql(\"string\");\r",
											"  });\r",
											"});\r",
											"\r",
											"function trim(s){ return String(s == null ? \"\" : s).replace(/^\\s+|\\s+$/g, \"\"); }\r",
											"function isIntStr(v){ return typeof v === \"string\" && /^-?\\d+$/.test(v); }\r",
											"\r",
											"pm.test(\"done='OK' and removeCode='0', message empty\", function(){\r",
											"  pm.expect(String(node.done)).to.eql(\"OK\");\r",
											"  pm.expect(String(node.removeCode)).to.eql(\"0\");\r",
											"  pm.expect(trim(node.removeMessage)).to.have.length(0);\r",
											"});\r",
											"\r",
											"// (Optional) confirm request Srv\r",
											"pm.test(\"Request Srv is RMVBNKACC\", function(){\r",
											"  try {\r",
											"    var body = pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {};\r",
											"    pm.expect((body || {}).Srv).to.eql(\"RMVBNKACC\");\r",
											"  } catch(e) { console.warn(\"Could not parse request body:\", e.message); }\r",
											"});\r",
											"\r",
											"// Save env\r",
											"pm.environment.set(\"RMV_DONE\", String(node.done || \"\"));\r",
											"pm.environment.set(\"RMV_CODE\", String(node.removeCode || \"\"));\r",
											"pm.environment.set(\"RMV_MESSAGE\", String(node.removeMessage || \"\"));\r",
											"\r",
											"// Minimal schema (tv4)\r",
											"pm.test(\"Schema (minimal) validates\", function(){\r",
											"  var schema = {\r",
											"    type: \"object\",\r",
											"    required: [\"responseStatus\",\"message\"],\r",
											"    properties: {\r",
											"      responseStatus: {\r",
											"        type: \"object\",\r",
											"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
											"        properties: {\r",
											"          resCode: {\"const\":\"0\"}, resDesc: {\"const\":\"Successful Operation\"},\r",
											"          source: {\"const\":\"RMVBNKACC\"}, resCode1: {\"const\":\"0\"}, resDesc1: {\"const\":\"Successful Operation\"}\r",
											"        }\r",
											"      },\r",
											"      message: {\r",
											"        type: \"object\",\r",
											"        required: [\"removeBankAccountResponse\"],\r",
											"        properties: {\r",
											"          removeBankAccountResponse: {\r",
											"            type: \"object\",\r",
											"            required: [\"done\",\"removeCode\",\"removeMessage\"]\r",
											"          }\r",
											"        }\r",
											"      }\r",
											"    }\r",
											"  };\r",
											"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
											"});\r",
											"\r",
											"console.log(\"✅ RMVBNKACC happy path OK:\", \"done=\", pm.environment.get(\"RMV_DONE\"));\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Accept",
										"value": "application/json",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\r\n    \"Srv\": \"RMVBNKACC\",\r\n    \"Message\": {\r\n        \"RemoveBankAccountRequest\": {\r\n            \"NIN\": \"{{NIN}}\",\r\n            \"UserId\": \"{{UserID}}\",\r\n            \"userType\": \"INVESTOR\",\r\n            \"lang\": \"ARB\",\r\n            \"status\": \"2\",\r\n            \"accountNo\": \"{{accountSeq_1}}\",\r\n            \"swiftAddress\": \"{{bnkCode_1}}\",\r\n            \"currencyCode\": \"307\",\r\n            \"accountSeq\": \"{{accountSeq_1}}\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"05-10-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{BaseURL}}{{Oracle19}}",
									"host": [
										"{{BaseURL}}{{Oracle19}}"
									]
								}
							},
							"response": []
						}
					]
				}
			]
		},
		{
			"name": "13. Change Password",
			"item": [
				{
					"name": "Error handling",
					"item": [
						{
							"name": "1. Login",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"// Check if the status code is 200\r",
											"pm.test(\"Status code is 200\", function () {\r",
											"    pm.response.to.have.status(200);\r",
											"});\r",
											"\r",
											"// Check if response code is 0\r",
											"pm.test(\"Response code is 0\", function () {\r",
											"    var jsonData = pm.response.json(); // Parse JSON response\r",
											"    pm.expect(jsonData.responseStatus.resCode).to.equal(\"0\");\r",
											"});\r",
											"\r",
											"// Check if response description is \"Successful Operation\"\r",
											"pm.test(\"Response description is 'Successful Operation'\", function () {\r",
											"    var jsonData = pm.response.json();\r",
											"    pm.expect(jsonData.responseStatus.resDesc).to.equal(\"Successful Operation\");\r",
											"});\r",
											"\r",
											"// Check if login is successful and capture NIN\r",
											"pm.test(\"Login successful and NIN captured\", function () {\r",
											"    var jsonData = pm.response.json();\r",
											"    var accounts = jsonData.message.logResponse.accounts.account;\r",
											"\r",
											"    if (accounts.length > 0) {\r",
											"        var nin = accounts[0].nin; // Extract NIN\r",
											"        pm.expect(nin).to.not.be.undefined; // Ensure it's not empty\r",
											"\r",
											"        // Store in environment variables\r",
											"        pm.environment.set(\"NIN\", nin);\r",
											"        pm.environment.set(\"UserID\", nin); // Store the same value in UserID\r",
											"\r",
											"        console.log(\"Captured NIN/UserID:\", nin);\r",
											"    } else {\r",
											"        pm.expect.fail(\"NIN not found in the response.\");\r",
											"    }\r",
											"});\r",
											"\r",
											"// Check if login is successful and SessionID is created\r",
											"pm.test(\"Login successful and SessionID created\", function () {\r",
											"    var jsonData = pm.response.json();\r",
											"    var sessionID = jsonData.message.logResponse.sessionID;\r",
											"\r",
											"    pm.expect(sessionID).to.not.be.undefined; // Assert SessionID exists\r",
											"});\r",
											"\r",
											"// Verify Content-Type header is 'application/json'\r",
											"pm.test(\"Content-Type header is 'application/json'\", function () {\r",
											"    pm.expect(pm.response.headers.get(\"Content-Type\")).to.include(\"application/json\");\r",
											"});\r",
											"\r",
											"// Check if login is successful and capture SessionID\r",
											"pm.test(\"Login successful and SessionID captured\", function () {\r",
											"    var jsonData = pm.response.json();\r",
											"    var sessionID = jsonData.message.logResponse.sessionID;\r",
											"\r",
											"    pm.expect(sessionID).to.not.be.undefined; // Assert SessionID exists\r",
											"    pm.environment.set(\"SessionID\", sessionID); // Save SessionID to environment\r",
											"});\r",
											"\r",
											"// Parse the response JSON\r",
											"var jsonData = pm.response.json();\r",
											"\r",
											"// Verify that the response contains the expected roles\r",
											"pm.test(\"Verify roles in response\", function () {\r",
											"    var roles = jsonData.message.logResponse.roles.role;\r",
											"\r",
											"    // Define expected roles\r",
											"    var expectedRoles = [\"UPDATE_ORDER\", \"SAVE_ORDER\", \"REPORTS\", \"CANCEL_ORDER\"];\r",
											"\r",
											"    // Ensure roles exist in the response\r",
											"    pm.expect(roles).to.be.an(\"array\").that.is.not.empty;\r",
											"\r",
											"    // Check that all expected roles exist in the response\r",
											"    expectedRoles.forEach(role => {\r",
											"        pm.expect(roles).to.include(role, `Missing role: ${role}`);\r",
											"    });\r",
											"\r",
											"    console.log(\"✅ Roles verified successfully:\", roles);\r",
											"});\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// Get current timestamp in ISO format\r",
											"var timestamp = new Date().toISOString();\r",
											"\r",
											"// Store timestamp in Postman environment\r",
											"pm.environment.set(\"currentTimestamp\", timestamp);\r",
											"\r",
											"// Log the timestamp\r",
											"console.log(\"Timestamp Set:\", timestamp);\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "noauth"
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Accept",
										"value": "application/json",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\r\n    \"Srv\": \"Login\",\r\n    \"Message\": {\r\n        \"Login\": {\r\n            \"UserName\": \"1218\",\r\n            \"Password\": \"12345\",\r\n            \"Lang\": \"ARB\"\r\n        }\r\n    },\r\n    \"Version\": \"1.0\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"08-07-2015\"\r\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{BaseURL}}{{Oracle19}}",
									"host": [
										"{{BaseURL}}{{Oracle19}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "2. Change Password Wrong Current Password",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"/**\r",
											" * CHGPASS – Error: wrong current password\r",
											" * Expect:\r",
											" *  - HTTP 200\r",
											" *  - responseStatus.resCode/resCode1 = \"4\"\r",
											" *  - source=\"CHGPASS\"\r",
											" *  - Arabic message indicates wrong username/password\r",
											" *  - No business payload (message absent/empty)\r",
											" * Saves:\r",
											" *  CHGPASS_ERR_CODE, CHGPASS_ERR_DESC\r",
											" */\r",
											"\r",
											"pm.test(\"HTTP 200\", function () { pm.response.to.have.status(200); });\r",
											"\r",
											"pm.test(\"Content-Type is JSON\", function () {\r",
											"  pm.response.to.have.header(\"Content-Type\");\r",
											"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
											"});\r",
											"\r",
											"var json;\r",
											"pm.test(\"Body is JSON\", function () {\r",
											"  json = pm.response.json();\r",
											"  pm.expect(json).to.be.an(\"object\");\r",
											"});\r",
											"\r",
											"// Envelope\r",
											"pm.test(\"responseStatus indicates error 4 (CHGPASS)\", function () {\r",
											"  var rs = json.responseStatus || {};\r",
											"  pm.expect(rs.source).to.eql(\"CHGPASS\");\r",
											"  pm.expect(rs.resCode).to.eql(\"4\");\r",
											"  pm.expect(rs.resCode1).to.eql(\"4\");\r",
											"\r",
											"  // Tolerate common Arabic variants/spaces\r",
											"  var allowed = [\r",
											"    \"خطأ في أسم المستخدم أو كلمة السر\",\r",
											"    \"خطأ في اسم المستخدم أو كلمة السر\",\r",
											"    \"خطأ في اسم المستخدم أو كلمة المرور\",\r",
											"    \"خطأ في أسم المستخدم أو كلمة المرور\"\r",
											"  ];\r",
											"  pm.expect(allowed, \"resDesc not in allowed variants\").to.include(String(rs.resDesc));\r",
											"  pm.expect(allowed, \"resDesc1 not in allowed variants\").to.include(String(rs.resDesc1));\r",
											"});\r",
											"\r",
											"// No business payload\r",
											"pm.test(\"No changePasswordResponse on error\", function(){\r",
											"  var msg = json.message;\r",
											"  var empty = (msg == null) || (typeof msg === \"object\" && Object.keys(msg).length === 0);\r",
											"  pm.expect(empty, \"message should be absent or empty for error\").to.be.true;\r",
											"});\r",
											"\r",
											"// Security hygiene: no stack/exception leakage\r",
											"pm.test(\"No stack traces in body\", function(){\r",
											"  var text = pm.response.text().toLowerCase();\r",
											"  pm.expect(text).to.not.include(\"stack\");\r",
											"  pm.expect(text).to.not.include(\"exception\");\r",
											"  pm.expect(text).to.not.include(\"trace\");\r",
											"});\r",
											"\r",
											"// Save env\r",
											"pm.environment.set(\"CHGPASS_ERR_CODE\", \"4\");\r",
											"pm.environment.set(\"CHGPASS_ERR_DESC\", String((json.responseStatus || {}).resDesc || \"\"));\r",
											"\r",
											"// Minimal schema (tv4)\r",
											"pm.test(\"Error schema (minimal) validates\", function(){\r",
											"  var schema = {\r",
											"    type: \"object\",\r",
											"    required: [\"responseStatus\"],\r",
											"    properties: {\r",
											"      responseStatus: {\r",
											"        type: \"object\",\r",
											"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
											"        properties: {\r",
											"          resCode:  { \"const\": \"4\" },\r",
											"          resDesc:  { \"type\": \"string\" },\r",
											"          source:   { \"const\": \"CHGPASS\" },\r",
											"          resCode1: { \"const\": \"4\" },\r",
											"          resDesc1: { \"type\": \"string\" }\r",
											"        }\r",
											"      }\r",
											"    },\r",
											"    additionalProperties: true\r",
											"  };\r",
											"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
											"});\r",
											"\r",
											"console.log(\"❌ CHGPASS wrong current password. code=4\");\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Accept",
										"value": "application/json",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\r\n    \"Srv\": \"CHGPASS\",\r\n    \"Message\": {\r\n        \"ChgPassRequest\": {\r\n            \"OldPass\": \"123451111\",\r\n            \"NewPass\": \"12345\",\r\n            \"UserName\": \"{{NIN}}\",\r\n            \"UserType\": \"INVESTOR\",\r\n            \"Lang\": \"ARB\",\r\n            \"OS\": \"Windows\",\r\n            \"Browser\": \"Chrome\",\r\n            \"AppName\": \"WEB_ORDERS.25\",\r\n            \"ClientUserIP\": \"10.80.81.158\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"05-10-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{BaseURL}}{{Oracle19}}",
									"host": [
										"{{BaseURL}}{{Oracle19}}"
									]
								}
							},
							"response": []
						}
					]
				},
				{
					"name": "1. Login",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Check if the status code is 200\r",
									"pm.test(\"Status code is 200\", function () {\r",
									"    pm.response.to.have.status(200);\r",
									"});\r",
									"\r",
									"// Check if response code is 0\r",
									"pm.test(\"Response code is 0\", function () {\r",
									"    var jsonData = pm.response.json(); // Parse JSON response\r",
									"    pm.expect(jsonData.responseStatus.resCode).to.equal(\"0\");\r",
									"});\r",
									"\r",
									"// Check if response description is \"Successful Operation\"\r",
									"pm.test(\"Response description is 'Successful Operation'\", function () {\r",
									"    var jsonData = pm.response.json();\r",
									"    pm.expect(jsonData.responseStatus.resDesc).to.equal(\"Successful Operation\");\r",
									"});\r",
									"\r",
									"// Check if login is successful and capture NIN\r",
									"pm.test(\"Login successful and NIN captured\", function () {\r",
									"    var jsonData = pm.response.json();\r",
									"    var accounts = jsonData.message.logResponse.accounts.account;\r",
									"\r",
									"    if (accounts.length > 0) {\r",
									"        var nin = accounts[0].nin; // Extract NIN\r",
									"        pm.expect(nin).to.not.be.undefined; // Ensure it's not empty\r",
									"\r",
									"        // Store in environment variables\r",
									"        pm.environment.set(\"NIN\", nin);\r",
									"        pm.environment.set(\"UserID\", nin); // Store the same value in UserID\r",
									"\r",
									"        console.log(\"Captured NIN/UserID:\", nin);\r",
									"    } else {\r",
									"        pm.expect.fail(\"NIN not found in the response.\");\r",
									"    }\r",
									"});\r",
									"\r",
									"// Check if login is successful and SessionID is created\r",
									"pm.test(\"Login successful and SessionID created\", function () {\r",
									"    var jsonData = pm.response.json();\r",
									"    var sessionID = jsonData.message.logResponse.sessionID;\r",
									"\r",
									"    pm.expect(sessionID).to.not.be.undefined; // Assert SessionID exists\r",
									"});\r",
									"\r",
									"// Verify Content-Type header is 'application/json'\r",
									"pm.test(\"Content-Type header is 'application/json'\", function () {\r",
									"    pm.expect(pm.response.headers.get(\"Content-Type\")).to.include(\"application/json\");\r",
									"});\r",
									"\r",
									"// Check if login is successful and capture SessionID\r",
									"pm.test(\"Login successful and SessionID captured\", function () {\r",
									"    var jsonData = pm.response.json();\r",
									"    var sessionID = jsonData.message.logResponse.sessionID;\r",
									"\r",
									"    pm.expect(sessionID).to.not.be.undefined; // Assert SessionID exists\r",
									"    pm.environment.set(\"SessionID\", sessionID); // Save SessionID to environment\r",
									"});\r",
									"\r",
									"// Parse the response JSON\r",
									"var jsonData = pm.response.json();\r",
									"\r",
									"// Verify that the response contains the expected roles\r",
									"pm.test(\"Verify roles in response\", function () {\r",
									"    var roles = jsonData.message.logResponse.roles.role;\r",
									"\r",
									"    // Define expected roles\r",
									"    var expectedRoles = [\"UPDATE_ORDER\", \"SAVE_ORDER\", \"REPORTS\", \"CANCEL_ORDER\"];\r",
									"\r",
									"    // Ensure roles exist in the response\r",
									"    pm.expect(roles).to.be.an(\"array\").that.is.not.empty;\r",
									"\r",
									"    // Check that all expected roles exist in the response\r",
									"    expectedRoles.forEach(role => {\r",
									"        pm.expect(roles).to.include(role, `Missing role: ${role}`);\r",
									"    });\r",
									"\r",
									"    console.log(\"✅ Roles verified successfully:\", roles);\r",
									"});\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Get current timestamp in ISO format\r",
									"var timestamp = new Date().toISOString();\r",
									"\r",
									"// Store timestamp in Postman environment\r",
									"pm.environment.set(\"currentTimestamp\", timestamp);\r",
									"\r",
									"// Log the timestamp\r",
									"console.log(\"Timestamp Set:\", timestamp);\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"Srv\": \"Login\",\r\n    \"Message\": {\r\n        \"Login\": {\r\n            \"UserName\": \"1218\",\r\n            \"Password\": \"{{Password}}\",\r\n            \"Lang\": \"ARB\"\r\n        }\r\n    },\r\n    \"Version\": \"1.0\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"08-07-2015\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{BaseURL}}{{Oracle19}}",
							"host": [
								"{{BaseURL}}{{Oracle19}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "2. Change Password",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"/**\r",
									" * CHGPASS – Happy path\r",
									" * Expect:\r",
									" *  - responseStatus.* = \"0\", source=\"CHGPASS\"\r",
									" *  - message.changePasswordResponse.done = \"SUCCESS\"\r",
									" * Saves:\r",
									" *  CHGPASS_DONE\r",
									" */\r",
									"\r",
									"pm.test(\"HTTP 200\", function () { pm.response.to.have.status(200); });\r",
									"\r",
									"pm.test(\"Content-Type is JSON\", function () {\r",
									"  pm.response.to.have.header(\"Content-Type\");\r",
									"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
									"});\r",
									"\r",
									"var json;\r",
									"pm.test(\"Body is JSON\", function () {\r",
									"  json = pm.response.json();\r",
									"  pm.expect(json).to.be.an(\"object\");\r",
									"});\r",
									"\r",
									"// Envelope\r",
									"pm.test(\"responseStatus OK (CHGPASS)\", function () {\r",
									"  var rs = json.responseStatus || {};\r",
									"  pm.expect(rs.resCode).to.eql(\"0\");\r",
									"  pm.expect(rs.resDesc).to.eql(\"Successful Operation\");\r",
									"  pm.expect(rs.source).to.eql(\"CHGPASS\");\r",
									"  pm.expect(rs.resCode1).to.eql(\"0\");\r",
									"  pm.expect(rs.resDesc1).to.eql(\"Successful Operation\");\r",
									"});\r",
									"\r",
									"// Node\r",
									"var node = (((json || {}).message || {}).changePasswordResponse) || {};\r",
									"pm.test(\"changePasswordResponse exists & has 'done'\", function () {\r",
									"  pm.expect(node).to.be.an(\"object\");\r",
									"  pm.expect(node).to.have.property(\"done\");\r",
									"  pm.expect(typeof node.done).to.eql(\"string\");\r",
									"});\r",
									"\r",
									"// Done = SUCCESS (case-insensitive accept)\r",
									"pm.test(\"done = 'SUCCESS'\", function () {\r",
									"  pm.expect(String(node.done).toUpperCase()).to.eql(\"SUCCESS\");\r",
									"});\r",
									"\r",
									"// Optional: confirm request Srv\r",
									"pm.test(\"Request Srv is CHGPASS\", function(){\r",
									"  try {\r",
									"    var body = pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {};\r",
									"    pm.expect((body || {}).Srv).to.eql(\"CHGPASS\");\r",
									"  } catch(e) { console.warn(\"Could not parse request body:\", e.message); }\r",
									"});\r",
									"\r",
									"// Save env\r",
									"pm.environment.set(\"CHGPASS_DONE\", String(node.done || \"\"));\r",
									"\r",
									"// Minimal schema (tv4)\r",
									"pm.test(\"Schema (minimal) validates\", function () {\r",
									"  var schema = {\r",
									"    type: \"object\",\r",
									"    required: [\"responseStatus\",\"message\"],\r",
									"    properties: {\r",
									"      responseStatus: {\r",
									"        type: \"object\",\r",
									"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
									"        properties: {\r",
									"          resCode:  { \"const\": \"0\" },\r",
									"          resDesc:  { \"const\": \"Successful Operation\" },\r",
									"          source:   { \"const\": \"CHGPASS\" },\r",
									"          resCode1: { \"const\": \"0\" },\r",
									"          resDesc1: { \"const\": \"Successful Operation\" }\r",
									"        }\r",
									"      },\r",
									"      message: {\r",
									"        type: \"object\",\r",
									"        required: [\"changePasswordResponse\"],\r",
									"        properties: {\r",
									"          changePasswordResponse: {\r",
									"            type: \"object\",\r",
									"            required: [\"done\"],\r",
									"            properties: { done: { type: \"string\" } }\r",
									"          }\r",
									"        }\r",
									"      }\r",
									"    }\r",
									"  };\r",
									"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
									"});\r",
									"\r",
									"console.log(\"✅ CHGPASS success. done=\", pm.environment.get(\"CHGPASS_DONE\"));\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"Srv\": \"CHGPASS\",\r\n    \"Message\": {\r\n        \"ChgPassRequest\": {\r\n            \"OldPass\": \"{{Password}}\",\r\n            \"NewPass\": \"12345\",\r\n            \"UserName\": \"{{NIN}}\",\r\n            \"UserType\": \"INVESTOR\",\r\n            \"Lang\": \"ARB\",\r\n            \"OS\": \"Windows\",\r\n            \"Browser\": \"Chrome\",\r\n            \"AppName\": \"WEB_ORDERS.25\",\r\n            \"ClientUserIP\": \"10.80.81.158\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"05-10-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{BaseURL}}{{Oracle19}}",
							"host": [
								"{{BaseURL}}{{Oracle19}}"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "14. GET QIIB IBAN LIST",
			"item": [
				{
					"name": "GET QIIB IBAN List",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"Srv\": \"GET_QIIB_IBAN_LIST\",\r\n    \"Message\": {\r\n        \"QiibGetIbanListRequest\": {\r\n             \"NIN\": \"{{NIN}}\",\r\n            \"UserId\": \"{{UserID}}\",\r\n            \"userType\": \"INVESTOR\",\r\n            \"lang\": \"ENG\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"08-10-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{BaseURL}}{{Oracle19}}",
							"host": [
								"{{BaseURL}}{{Oracle19}}"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "15. Activate Bank Account",
			"item": [
				{
					"name": "1. Login",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Check if the status code is 200\r",
									"pm.test(\"Status code is 200\", function () {\r",
									"    pm.response.to.have.status(200);\r",
									"});\r",
									"\r",
									"// Check if response code is 0\r",
									"pm.test(\"Response code is 0\", function () {\r",
									"    var jsonData = pm.response.json(); // Parse JSON response\r",
									"    pm.expect(jsonData.responseStatus.resCode).to.equal(\"0\");\r",
									"});\r",
									"\r",
									"// Check if response description is \"Successful Operation\"\r",
									"pm.test(\"Response description is 'Successful Operation'\", function () {\r",
									"    var jsonData = pm.response.json();\r",
									"    pm.expect(jsonData.responseStatus.resDesc).to.equal(\"Successful Operation\");\r",
									"});\r",
									"\r",
									"// Check if login is successful and capture NIN\r",
									"pm.test(\"Login successful and NIN captured\", function () {\r",
									"    var jsonData = pm.response.json();\r",
									"    var accounts = jsonData.message.logResponse.accounts.account;\r",
									"\r",
									"    if (accounts.length > 0) {\r",
									"        var nin = accounts[0].nin; // Extract NIN\r",
									"        pm.expect(nin).to.not.be.undefined; // Ensure it's not empty\r",
									"\r",
									"        // Store in environment variables\r",
									"        pm.environment.set(\"NIN\", nin);\r",
									"        pm.environment.set(\"UserID\", nin); // Store the same value in UserID\r",
									"\r",
									"        console.log(\"Captured NIN/UserID:\", nin);\r",
									"    } else {\r",
									"        pm.expect.fail(\"NIN not found in the response.\");\r",
									"    }\r",
									"});\r",
									"\r",
									"// Check if login is successful and SessionID is created\r",
									"pm.test(\"Login successful and SessionID created\", function () {\r",
									"    var jsonData = pm.response.json();\r",
									"    var sessionID = jsonData.message.logResponse.sessionID;\r",
									"\r",
									"    pm.expect(sessionID).to.not.be.undefined; // Assert SessionID exists\r",
									"});\r",
									"\r",
									"// Verify Content-Type header is 'application/json'\r",
									"pm.test(\"Content-Type header is 'application/json'\", function () {\r",
									"    pm.expect(pm.response.headers.get(\"Content-Type\")).to.include(\"application/json\");\r",
									"});\r",
									"\r",
									"// Check if login is successful and capture SessionID\r",
									"pm.test(\"Login successful and SessionID captured\", function () {\r",
									"    var jsonData = pm.response.json();\r",
									"    var sessionID = jsonData.message.logResponse.sessionID;\r",
									"\r",
									"    pm.expect(sessionID).to.not.be.undefined; // Assert SessionID exists\r",
									"    pm.environment.set(\"SessionID\", sessionID); // Save SessionID to environment\r",
									"});\r",
									"\r",
									"// Parse the response JSON\r",
									"var jsonData = pm.response.json();\r",
									"\r",
									"// Verify that the response contains the expected roles\r",
									"pm.test(\"Verify roles in response\", function () {\r",
									"    var roles = jsonData.message.logResponse.roles.role;\r",
									"\r",
									"    // Define expected roles\r",
									"    var expectedRoles = [\"UPDATE_ORDER\", \"SAVE_ORDER\", \"REPORTS\", \"CANCEL_ORDER\"];\r",
									"\r",
									"    // Ensure roles exist in the response\r",
									"    pm.expect(roles).to.be.an(\"array\").that.is.not.empty;\r",
									"\r",
									"    // Check that all expected roles exist in the response\r",
									"    expectedRoles.forEach(role => {\r",
									"        pm.expect(roles).to.include(role, `Missing role: ${role}`);\r",
									"    });\r",
									"\r",
									"    console.log(\"✅ Roles verified successfully:\", roles);\r",
									"});\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Get current timestamp in ISO format\r",
									"var timestamp = new Date().toISOString();\r",
									"\r",
									"// Store timestamp in Postman environment\r",
									"pm.environment.set(\"currentTimestamp\", timestamp);\r",
									"\r",
									"// Log the timestamp\r",
									"console.log(\"Timestamp Set:\", timestamp);\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"Srv\": \"Login\",\r\n    \"Message\": {\r\n        \"Login\": {\r\n            \"UserName\": \"1218\",\r\n            \"Password\": \"{{Password}}\",\r\n            \"Lang\": \"ARB\"\r\n        }\r\n    },\r\n    \"Version\": \"1.0\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"08-07-2015\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{BaseURL}}{{Oracle19}}",
							"host": [
								"{{BaseURL}}{{Oracle19}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "2. Add New Bank",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"/**\r",
									" * REGBNKACCNEW – Happy path (New Bank)\r",
									" * Expect:\r",
									" *   registerCode = \"0\"\r",
									" *   registerMessage = \"\" (empty/whitespace)\r",
									" *   bnkActivationSeq = integer string > 0\r",
									" */\r",
									"\r",
									"pm.test(\"HTTP 200\", function () { pm.response.to.have.status(200); });\r",
									"pm.test(\"Content-Type JSON\", function () {\r",
									"  pm.response.to.have.header(\"Content-Type\");\r",
									"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
									"});\r",
									"\r",
									"var json;\r",
									"pm.test(\"Body is JSON\", function(){ json = pm.response.json(); pm.expect(json).to.be.an(\"object\"); });\r",
									"\r",
									"pm.test(\"Envelope OK (REGBNKACCNEW)\", function(){\r",
									"  var rs = json.responseStatus || {};\r",
									"  pm.expect(rs.resCode).to.eql(\"0\");\r",
									"  pm.expect(rs.resDesc).to.eql(\"Successful Operation\");\r",
									"  pm.expect(rs.source).to.eql(\"REGBNKACCNEW\");\r",
									"  pm.expect(rs.resCode1).to.eql(\"0\");\r",
									"  pm.expect(rs.resDesc1).to.eql(\"Successful Operation\");\r",
									"});\r",
									"\r",
									"var node = (((json || {}).message || {}).registerBankAccountResponse) || {};\r",
									"pm.test(\"registerBankAccountResponse exists & core keys\", function () {\r",
									"  pm.expect(node).to.be.an(\"object\");\r",
									"  pm.expect(node).to.have.property(\"registerCode\");\r",
									"  pm.expect(node).to.have.property(\"registerMessage\");\r",
									"  pm.expect(node).to.have.property(\"bnkActivationSeq\");\r",
									"  // needActivation may be absent on success\r",
									"});\r",
									"\r",
									"function trim(s){ return String(s == null ? \"\" : s).replace(/^\\s+|\\s+$/g,\"\"); }\r",
									"function isIntStr(v){ return typeof v === \"string\" && /^-?\\d+$/.test(v); }\r",
									"function findIbanStr(obj){\r",
									"  if (!obj || typeof obj !== \"object\") return null;\r",
									"  for (var k in obj){\r",
									"    if (!obj.hasOwnProperty(k)) continue;\r",
									"    var v = obj[k];\r",
									"    if (typeof k === \"string\" && /iban/i.test(k) && typeof v === \"string\"){\r",
									"      var val = v.replace(/\\s+/g,\"\").toUpperCase();\r",
									"      if (/^[A-Z]{2}[0-9A-Z]{13,34}$/.test(val)) return val;\r",
									"    }\r",
									"    if (v && typeof v === \"object\"){\r",
									"      var got = findIbanStr(v);\r",
									"      if (got) return got;\r",
									"    }\r",
									"  }\r",
									"  return null;\r",
									"}\r",
									"\r",
									"// registerCode logic\r",
									"pm.test(\"registerCode = '0' and message empty\", function(){\r",
									"  pm.expect(String(node.registerCode)).to.eql(\"0\");\r",
									"  pm.expect(trim(node.registerMessage)).to.have.length(0);\r",
									"});\r",
									"\r",
									"// activation seq\r",
									"pm.test(\"bnkActivationSeq is integer string > 0\", function(){\r",
									"  pm.expect(isIntStr(node.bnkActivationSeq), \"bnkActivationSeq int string\").to.be.true;\r",
									"  pm.expect(Number(node.bnkActivationSeq), \"bnkActivationSeq > 0\").to.be.above(0);\r",
									"});\r",
									"\r",
									"// Optional: needActivation (if present)\r",
									"pm.test(\"needActivation (if present) is Y/N\", function(){\r",
									"  if (typeof node.needActivation !== \"undefined\"){\r",
									"    pm.expect([\"Y\",\"N\"]).to.include(String(node.needActivation));\r",
									"  }\r",
									"});\r",
									"\r",
									"// Optional cross-check: IBAN length equals expected (if request carries IBAN and BNKINFO_IBAN_MAP exists)\r",
									"pm.test(\"IBAN length matches country expectation (if available)\", function(){\r",
									"  var req = {};\r",
									"  try { req = pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {}; } catch(e){}\r",
									"  var iban = findIbanStr(req);\r",
									"  if (!iban) return;\r",
									"  var iso = iban.substr(0,2);\r",
									"  var mapRaw = pm.environment.get(\"BNKINFO_IBAN_MAP\") || pm.globals.get(\"BNKINFO_IBAN_MAP\") || \"\";\r",
									"  if (!mapRaw) { console.warn(\"BNKINFO_IBAN_MAP not set; skipping IBAN length check\"); return; }\r",
									"  var map = {};\r",
									"  try { map = JSON.parse(mapRaw); } catch(e){ console.warn(\"Invalid BNKINFO_IBAN_MAP JSON\"); return; }\r",
									"  if (map.hasOwnProperty(iso)){\r",
									"    pm.expect(iban.length, \"IBAN length for \"+iso).to.eql(Number(map[iso]));\r",
									"  }\r",
									"});\r",
									"\r",
									"// Save env\r",
									"pm.environment.set(\"REGBANK_REGISTER_CODE\", String(node.registerCode || \"\"));\r",
									"pm.environment.set(\"REGBANK_REGISTER_MSG\", String(node.registerMessage || \"\"));\r",
									"pm.environment.set(\"REGBANK_ACTIVATION_SEQ\", String(node.bnkActivationSeq || \"\"));\r",
									"pm.environment.set(\"REGBANK_NEED_ACTIVATION\", String(node.needActivation || \"\"));\r",
									"\r",
									"// Minimal schema\r",
									"pm.test(\"Schema minimal\", function(){\r",
									"  var schema = {\r",
									"    type: \"object\",\r",
									"    required: [\"responseStatus\",\"message\"],\r",
									"    properties: {\r",
									"      responseStatus: {\r",
									"        type: \"object\",\r",
									"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
									"        properties: {\r",
									"          resCode: {\"const\":\"0\"}, resDesc: {\"const\":\"Successful Operation\"},\r",
									"          source: {\"const\":\"REGBNKACCNEW\"}, resCode1: {\"const\":\"0\"}, resDesc1: {\"const\":\"Successful Operation\"}\r",
									"        }\r",
									"      },\r",
									"      message: {\r",
									"        type: \"object\",\r",
									"        required: [\"registerBankAccountResponse\"],\r",
									"        properties: {\r",
									"          registerBankAccountResponse: {\r",
									"            type: \"object\",\r",
									"            required: [\"registerCode\",\"registerMessage\",\"bnkActivationSeq\"]\r",
									"          }\r",
									"        }\r",
									"      }\r",
									"    }\r",
									"  };\r",
									"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
									"});\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"Srv\": \"REGBNKACCNEW\",\r\n    \"Message\": {\r\n        \"RegisterBankAccountRequest\": {\r\n             \"NIN\": \"{{NIN}}\",\r\n            \"UserId\": \"{{UserID}}\",\r\n            \"userType\": \"INVESTOR\",\r\n            \"lang\": \"ARB\",\r\n            \"transactionId\": \"\",\r\n            \"IntBnkCustomerId\": \"\",\r\n            \"status\": \"\",\r\n            \"accountNo\": \"88577555658744\",\r\n            \"swiftAddress\": \"QNBAQAQAXXX\",\r\n            \"currencyCode\": \"307\",\r\n            \"accountIBAN\": \"QA65QNBA987194588577555658744\",\r\n            \"accountSeq\": \"\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"05-10-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{BaseURL}}{{Oracle19}}",
							"host": [
								"{{BaseURL}}{{Oracle19}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "3. Get Banks info",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"/**\r",
									" * BNKBAL – Bank balances & info (ES5)\r",
									" * Validates:\r",
									" *  - HTTP 200, JSON, envelope codes 0/0, source=\"BNKBAL\"\r",
									" *  - bnkInfoResponse existence and key formats\r",
									" *  - Balance fields are numeric strings; negatives allowed by default (toggle strict)\r",
									" *  - banksInfo.bnkInfoRec / bnkTransfers.bnkTransferRec array shapes\r",
									" *  - financierInfo & fundInfo consistency; creditRatio accepts ratio or percent\r",
									" *  - financierInfo fields accept null/\"null\"/\"\" gracefully\r",
									" * Keeps your extracts:\r",
									" *  - accountSeq_i, bnkCode_i, accountCode_i, transferTimeId_i, bankCount\r",
									" *\r",
									" * Optional toggles (Env/Globals):\r",
									" *  - ENFORCE_NON_NEG_BALANCES = Y|N (default N) -> force balances >= 0\r",
									" */\r",
									"\r",
									"// 1) Status code\r",
									"pm.test(\"Status code is 200\", function () {\r",
									"  pm.response.to.have.status(200);\r",
									"});\r",
									"\r",
									"// 2) Envelope base checks\r",
									"pm.test(\"resCode is 0 and resDesc is Successful Operation\", function () {\r",
									"  var resStatus = (pm.response.json() || {}).responseStatus || {};\r",
									"  pm.expect(resStatus.resCode).to.eql(\"0\");\r",
									"  pm.expect(resStatus.resDesc).to.eql(\"Successful Operation\");\r",
									"});\r",
									"\r",
									"// 3) Extract and set bank info (kept as-is)\r",
									"var __json_for_extract = pm.response.json() || {};\r",
									"var __bnkInfoList = ((((__json_for_extract.message || {}).bnkInfoResponse || {}).banksInfo || {}).bnkInfoRec);\r",
									"\r",
									"if (Array.isArray(__bnkInfoList)) {\r",
									"  // Clear previous values\r",
									"  pm.environment.unset(\"bankCount\");\r",
									"\r",
									"  for (var i = 0; i < __bnkInfoList.length; i++) {\r",
									"    var bnk = __bnkInfoList[i] || {};\r",
									"    pm.environment.set(\"accountSeq_\" + (i + 1), String(bnk.accountSeq || \"\"));\r",
									"    pm.environment.set(\"bnkCode_\" + (i + 1), String(bnk.bnkCode || \"\"));\r",
									"    pm.environment.set(\"accountCode_\" + (i + 1), String(bnk.accountCode || \"\"));\r",
									"    pm.environment.set(\"transferTimeId_\" + (i + 1), String(bnk.transferTimeId || \"\"));\r",
									"  }\r",
									"  pm.environment.set(\"bankCount\", String(__bnkInfoList.length));\r",
									"} else {\r",
									"  console.warn(\"banksInfo.bnkInfoRec not found or invalid\");\r",
									"}\r",
									"\r",
									"// Basic header check\r",
									"pm.test(\"Content-Type is JSON\", function () {\r",
									"  pm.response.to.have.header(\"Content-Type\");\r",
									"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
									"});\r",
									"\r",
									"// Parse once & helpers\r",
									"var json = pm.response.json() || {};\r",
									"var rs   = json.responseStatus || {};\r",
									"var bnr  = (json.message || {}).bnkInfoResponse || {};\r",
									"\r",
									"function isNumericStr(v) {\r",
									"  if (typeof v === \"number\") return isFinite(v);\r",
									"  return typeof v === \"string\" && /^-?\\d+(\\.\\d+)?$/.test(v);\r",
									"}\r",
									"function isIntStr(v) {\r",
									"  if (typeof v === \"number\") return Number.isInteger(v);\r",
									"  return typeof v === \"string\" && /^-?\\d+$/.test(v);\r",
									"}\r",
									"function isYN(v)  { return String(v) === \"Y\" || String(v) === \"N\"; }\r",
									"function isNullish(v) {\r",
									"  return v === null || typeof v === \"undefined\" || String(v).trim().toUpperCase() === \"NULL\" || String(v).trim() === \"\";\r",
									"}\r",
									"\r",
									"// Envelope completeness\r",
									"pm.test(\"Envelope complete (BNKBAL)\", function () {\r",
									"  pm.expect(rs.resCode).to.eql(\"0\");\r",
									"  pm.expect(rs.resDesc).to.eql(\"Successful Operation\");\r",
									"  pm.expect(rs.source).to.eql(\"BNKBAL\");\r",
									"  pm.expect(rs.resCode1).to.eql(\"0\");\r",
									"  pm.expect(rs.resDesc1).to.eql(\"Successful Operation\");\r",
									"});\r",
									"\r",
									"// Core node exists\r",
									"pm.test(\"bnkInfoResponse exists\", function () {\r",
									"  pm.expect(bnr).to.be.an(\"object\");\r",
									"});\r",
									"\r",
									"// Name (if provided)\r",
									"pm.test(\"Customer name (if present) is a non-empty string\", function () {\r",
									"  if (typeof bnr.name !== \"undefined\") {\r",
									"    pm.expect(bnr.name).to.be.a(\"string\").and.to.not.equal(\"\");\r",
									"  }\r",
									"});\r",
									"\r",
									"// Balance fields – allow negatives by default (set ENFORCE_NON_NEG_BALANCES=Y to force >=0)\r",
									"pm.test(\"All balance fields are numeric strings (with optional non-negative enforcement)\", function () {\r",
									"  var keys = [\r",
									"    \"buybal1\",\"currentBal\",\"buyBal\",\"buyBal1\",\"onLineBal1\",\"maxBalance1\",\"unclearedBal\",\r",
									"    \"tradeBal\",\"t3Bal\",\"chqColl\",\"onlineBal\",\"todayDepo\",\"todayDepos\",\"allowedBal\",\r",
									"    \"postponed\",\"reservedFawriBalance\",\"maxbalance\",\"newMaxBalance\"\r",
									"  ];\r",
									"  var enforce = String(pm.environment.get(\"ENFORCE_NON_NEG_BALANCES\") || pm.globals.get(\"ENFORCE_NON_NEG_BALANCES\") || \"N\").toUpperCase() === \"Y\";\r",
									"\r",
									"  for (var i=0;i<keys.length;i++){\r",
									"    var k = keys[i];\r",
									"    if (typeof bnr[k] !== \"undefined\") {\r",
									"      pm.expect(isNumericStr(bnr[k]), k + \" must be numeric\").to.be.true;\r",
									"      if (enforce) {\r",
									"        pm.expect(Number(bnr[k]), k + \" must be >= 0 (strict mode)\").to.be.at.least(0);\r",
									"      }\r",
									"    }\r",
									"  }\r",
									"});\r",
									"\r",
									"// banksInfo array and each record format\r",
									"pm.test(\"banksInfo.bnkInfoRec is array (can be empty)\", function () {\r",
									"  var arr = (((bnr || {}).banksInfo || {}).bnkInfoRec);\r",
									"  pm.expect(arr, \"bnkInfoRec\").to.be.an(\"array\");\r",
									"});\r",
									"\r",
									"(function validateBankRecords(){\r",
									"  var arr = (((bnr || {}).banksInfo || {}).bnkInfoRec) || [];\r",
									"  if (!Array.isArray(arr) || arr.length === 0) return;\r",
									"\r",
									"  for (var i=0;i<arr.length;i++){\r",
									"    var rec = arr[i] || {};\r",
									"\r",
									"    pm.expect(String(rec.accountSeq || \"\"), \"accountSeq\").to.match(/^\\d+$/);\r",
									"\r",
									"    // bankCode: allow alphanumeric 2–10 chars (covers \"QNB\" and \"535\")\r",
									"    if (typeof rec.bankCode !== \"undefined\") {\r",
									"      var bc = String(rec.bankCode || \"\").trim().toUpperCase();\r",
									"      pm.expect(bc, \"bankCode non-empty\").to.not.equal(\"\");\r",
									"      pm.expect(bc, \"bankCode format A–Z/0–9, len 2–10\").to.match(/^[A-Z0-9]{2,10}$/);\r",
									"    }\r",
									"\r",
									"    // SWIFT/BIC strict: 8 or 11 alnum\r",
									"    pm.expect(String(rec.bnkCode || \"\"), \"bnkCode (SWIFT/BIC)\").to.match(/^[A-Z0-9]{8}([A-Z0-9]{3})?$/);\r",
									"\r",
									"    pm.expect(rec.bnkName, \"bnkName\").to.be.a(\"string\").and.not.empty;\r",
									"    pm.expect(rec.accountCode, \"accountCode\").to.be.a(\"string\").and.not.empty;\r",
									"\r",
									"    // accountType: accept BOTH/DEBIT/CREDIT/NO/TOBNK\r",
									"    if (typeof rec.accountType !== \"undefined\") {\r",
									"      pm.expect([\"BOTH\",\"DEBIT\",\"CREDIT\",\"NO\",\"TOBNK\"], \"accountType\")\r",
									"        .to.include(String(rec.accountType).toUpperCase());\r",
									"    }\r",
									"\r",
									"    // status\r",
									"    pm.expect(String(rec.accountStatus || \"\"), \"accountStatus\").to.match(/^\\d+$/);\r",
									"    pm.expect(rec.accountStatusDesc, \"accountStatusDesc\").to.be.a(\"string\").and.not.empty;\r",
									"\r",
									"    if (typeof rec.isSahlPlus !== \"undefined\") {\r",
									"      pm.expect(isYN(String(rec.isSahlPlus)), \"isSahlPlus\").to.be.true;\r",
									"    }\r",
									"\r",
									"    // transferTimeId can be long token; just ensure string & non-empty\r",
									"    pm.expect(rec.transferTimeId, \"transferTimeId\").to.be.a(\"string\").and.not.empty;\r",
									"  }\r",
									"})();\r",
									"\r",
									"// bnkTransfers shape\r",
									"pm.test(\"bnkTransfers.bnkTransferRec is array (may be empty)\", function () {\r",
									"  var tr = (((bnr || {}).bnkTransfers || {}).bnkTransferRec);\r",
									"  pm.expect(tr, \"bnkTransferRec\").to.be.an(\"array\");\r",
									"});\r",
									"\r",
									"// financierInfo (if present) – tolerant of null/\"null\"/\"\"\r",
									"pm.test(\"financierInfo (if present) has valid fields\", function () {\r",
									"  var fi = bnr.financierInfo;\r",
									"  if (fi && typeof fi === \"object\") {\r",
									"    if (!isNullish(fi.financierID)) {\r",
									"      pm.expect(String(fi.financierID)).to.match(/^\\d+$/);\r",
									"    }\r",
									"\r",
									"    if (!isNullish(fi.isActive)) {\r",
									"      pm.expect(isYN(String(fi.isActive))).to.be.true;\r",
									"    }\r",
									"\r",
									"    if (!isNullish(fi.isOrdersEnabled)) {\r",
									"      pm.expect(isYN(String(fi.isOrdersEnabled))).to.be.true;\r",
									"    }\r",
									"\r",
									"    if (!isNullish(fi.riskFeesType)) {\r",
									"      pm.expect([\"0\",\"1\",\"2\",\"3\"]).to.include(String(fi.riskFeesType));\r",
									"    }\r",
									"    // riskFeesValue: validate only when present & not nullish\r",
									"    if (!isNullish(fi.riskFeesValue)) {\r",
									"      pm.expect(isNumericStr(fi.riskFeesValue)).to.be.true;\r",
									"      pm.expect(Number(fi.riskFeesValue)).to.be.at.least(0);\r",
									"    }\r",
									"\r",
									"    if (!isNullish(fi.financierAllowancePeriod)) {\r",
									"      pm.expect(isIntStr(fi.financierAllowancePeriod)).to.be.true;\r",
									"      pm.expect(Number(fi.financierAllowancePeriod)).to.be.at.least(0);\r",
									"    }\r",
									"  }\r",
									"});\r",
									"\r",
									"// fundInfo (margin block; can be N or Y)\r",
									"pm.test(\"fundInfo (if present) is consistent\", function () {\r",
									"  var f = bnr.fundInfo;\r",
									"  if (f && typeof f === \"object\") {\r",
									"    pm.expect(isYN(String(f.isFundClient)), \"isFundClient Y/N\").to.be.true;\r",
									"\r",
									"    if (f.isFundClient === \"Y\") {\r",
									"      var numKeys = [\r",
									"        \"fundDebt\",\"fundAvailableCredit\",\"cashBalanceNotCollected\",\"fundedAmountInMarket\",\r",
									"        \"creditRatio\",\"collectedBalance\",\"actualFunded\",\"shareAvCredit\"\r",
									"      ];\r",
									"      for (var i=0;i<numKeys.length;i++){\r",
									"        var k = numKeys[i];\r",
									"        pm.expect(isNumericStr(String(f[k])), \"fundInfo.\"+k+\" numeric\").to.be.true;\r",
									"        pm.expect(Number(f[k]), \"fundInfo.\"+k+\" >= 0\").to.be.at.least(0);\r",
									"      }\r",
									"\r",
									"      // creditRatio sanity: accept ratio [0..1] OR percent [0..100]\r",
									"      if (!isNullish(f.creditRatio)) {\r",
									"        var cr = Number(f.creditRatio);\r",
									"        if (cr > 1) {\r",
									"          pm.expect(cr, \"creditRatio% in [0, 100]\").to.be.at.least(0).and.at.most(100);\r",
									"          pm.environment.set(\"CREDIT_RATIO\", String(cr / 100));     // normalized 0..1\r",
									"          pm.environment.set(\"CREDIT_RATIO_PCT\", String(cr));       // as percent\r",
									"        } else {\r",
									"          pm.expect(cr, \"creditRatio in [0, 1]\").to.be.at.least(0).and.at.most(1);\r",
									"          pm.environment.set(\"CREDIT_RATIO\", String(cr));           // normalized 0..1\r",
									"          pm.environment.set(\"CREDIT_RATIO_PCT\", String(cr * 100)); // as percent\r",
									"        }\r",
									"      }\r",
									"\r",
									"      if (!isNullish(f.isActiveFundClient)) {\r",
									"        pm.expect(isYN(String(f.isActiveFundClient))).to.be.true;\r",
									"      }\r",
									"    }\r",
									"  }\r",
									"});\r",
									"\r",
									"// resType should reflect request's AccRegisterType (when provided)\r",
									"pm.test(\"resType matches AccRegisterType from request (when provided)\", function () {\r",
									"  var reqBody;\r",
									"  try { reqBody = pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {}; } catch(e){}\r",
									"  var accType = (((reqBody || {}).Message || {}).BalDlsRequest || {}).AccRegisterType;\r",
									"  if (accType) {\r",
									"    pm.expect(bnr.resType, \"resType\").to.eql(String(accType));\r",
									"  }\r",
									"});\r",
									"\r",
									"// Guardrails: request Srv should be BNKBAL\r",
									"pm.test(\"Request Srv is BNKBAL\", function () {\r",
									"  var reqBody;\r",
									"  try { reqBody = pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {}; } catch(e){}\r",
									"  pm.expect((reqBody || {}).Srv).to.eql(\"BNKBAL\");\r",
									"});\r",
									"\r",
									"// Minimal schema (tv4)\r",
									"pm.test(\"Schema (minimal) validates\", function () {\r",
									"  var schema = {\r",
									"    type: \"object\",\r",
									"    required: [\"responseStatus\",\"message\"],\r",
									"    properties: {\r",
									"      responseStatus: {\r",
									"        type: \"object\",\r",
									"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
									"        properties: {\r",
									"          resCode:  { \"const\": \"0\" },\r",
									"          resDesc:  { \"const\": \"Successful Operation\" },\r",
									"          source:   { \"const\": \"BNKBAL\" },\r",
									"          resCode1: { \"const\": \"0\" },\r",
									"          resDesc1: { \"const\": \"Successful Operation\" }\r",
									"        }\r",
									"      },\r",
									"      message: {\r",
									"        type: \"object\",\r",
									"        required: [\"bnkInfoResponse\"],\r",
									"        properties: {\r",
									"          bnkInfoResponse: { type: \"object\" }\r",
									"        }\r",
									"      }\r",
									"    }\r",
									"  };\r",
									"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
									"});\r",
									"\r",
									"// Extra: store a few more env helpers (without touching your extract keys)\r",
									"(function storeExtras(){\r",
									"  var arr = (((bnr || {}).banksInfo || {}).bnkInfoRec) || [];\r",
									"  if (arr.length > 0) {\r",
									"    pm.environment.set(\"firstBankCode\", String(arr[0].bankCode || \"\"));\r",
									"    pm.environment.set(\"firstBankSwift\", String(arr[0].bnkCode || \"\"));\r",
									"    pm.environment.set(\"firstAccountStatus\", String(arr[0].accountStatus || \"\"));\r",
									"  }\r",
									"  pm.environment.set(\"bnkTransfersCount\", String(((((bnr || {}).bnkTransfers || {}).bnkTransferRec) || []).length));\r",
									"})();\r",
									"\r",
									"console.log(\"✅ BNKBAL validated.\",\r",
									"            \"bankCount:\", pm.environment.get(\"bankCount\"),\r",
									"            \"transfers:\", pm.environment.get(\"bnkTransfersCount\"),\r",
									"            \"creditRatio(norm):\", pm.environment.get(\"CREDIT_RATIO\"),\r",
									"            \"creditRatio(%) \", pm.environment.get(\"CREDIT_RATIO_PCT\"));\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "POST",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"Srv\": \"BNKBAL\",\r\n    \"Message\": {\r\n        \"BalDlsRequest\": {\r\n            \"NIN\": \"{{NIN}}\",\r\n            \"UserId\": \"{{UserID}}\",\r\n            \"UserType\": \"INVESTOR\",\r\n            \"AccRegisterType\": \"ALL\",\r\n            \"Lang\": \"ARB\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"30-04-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}\r\n\r\n\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{BaseURL}}{{Oracle19}}",
							"host": [
								"{{BaseURL}}{{Oracle19}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "4. Remove Bank Account",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"/**\r",
									" * RMVBNKACC – Happy path\r",
									" * Expect:\r",
									" *  - responseStatus.* = \"0\", source=\"RMVBNKACC\"\r",
									" *  - message.removeBankAccountResponse: { done:\"OK\", removeCode:\"0\", removeMessage:\"\" }\r",
									" * Saves:\r",
									" *  RMV_DONE, RMV_CODE, RMV_MESSAGE\r",
									" */\r",
									"\r",
									"pm.test(\"HTTP 200\", function () { pm.response.to.have.status(200); });\r",
									"pm.test(\"Content-Type is JSON\", function () {\r",
									"  pm.response.to.have.header(\"Content-Type\");\r",
									"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
									"});\r",
									"\r",
									"var json;\r",
									"pm.test(\"Body is valid JSON\", function(){ json = pm.response.json(); pm.expect(json).to.be.an(\"object\"); });\r",
									"\r",
									"pm.test(\"Envelope OK (RMVBNKACC)\", function(){\r",
									"  var rs = json.responseStatus || {};\r",
									"  pm.expect(rs.resCode).to.eql(\"0\");\r",
									"  pm.expect(rs.resDesc).to.eql(\"Successful Operation\");\r",
									"  pm.expect(rs.source).to.eql(\"RMVBNKACC\");\r",
									"  pm.expect(rs.resCode1).to.eql(\"0\");\r",
									"  pm.expect(rs.resDesc1).to.eql(\"Successful Operation\");\r",
									"});\r",
									"\r",
									"var node = (((json || {}).message || {}).removeBankAccountResponse) || {};\r",
									"pm.test(\"removeBankAccountResponse exists & has required keys\", function(){\r",
									"  pm.expect(node).to.be.an(\"object\");\r",
									"  [\"done\",\"removeCode\",\"removeMessage\"].forEach(function(k){\r",
									"    pm.expect(node, \"Missing key: \" + k).to.have.property(k);\r",
									"    pm.expect(typeof node[k], k + \" must be string\").to.eql(\"string\");\r",
									"  });\r",
									"});\r",
									"\r",
									"function trim(s){ return String(s == null ? \"\" : s).replace(/^\\s+|\\s+$/g, \"\"); }\r",
									"function isIntStr(v){ return typeof v === \"string\" && /^-?\\d+$/.test(v); }\r",
									"\r",
									"pm.test(\"done='OK' and removeCode='0', message empty\", function(){\r",
									"  pm.expect(String(node.done)).to.eql(\"OK\");\r",
									"  pm.expect(String(node.removeCode)).to.eql(\"0\");\r",
									"  pm.expect(trim(node.removeMessage)).to.have.length(0);\r",
									"});\r",
									"\r",
									"// (Optional) confirm request Srv\r",
									"pm.test(\"Request Srv is RMVBNKACC\", function(){\r",
									"  try {\r",
									"    var body = pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {};\r",
									"    pm.expect((body || {}).Srv).to.eql(\"RMVBNKACC\");\r",
									"  } catch(e) { console.warn(\"Could not parse request body:\", e.message); }\r",
									"});\r",
									"\r",
									"// Save env\r",
									"pm.environment.set(\"RMV_DONE\", String(node.done || \"\"));\r",
									"pm.environment.set(\"RMV_CODE\", String(node.removeCode || \"\"));\r",
									"pm.environment.set(\"RMV_MESSAGE\", String(node.removeMessage || \"\"));\r",
									"\r",
									"// Minimal schema (tv4)\r",
									"pm.test(\"Schema (minimal) validates\", function(){\r",
									"  var schema = {\r",
									"    type: \"object\",\r",
									"    required: [\"responseStatus\",\"message\"],\r",
									"    properties: {\r",
									"      responseStatus: {\r",
									"        type: \"object\",\r",
									"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
									"        properties: {\r",
									"          resCode: {\"const\":\"0\"}, resDesc: {\"const\":\"Successful Operation\"},\r",
									"          source: {\"const\":\"RMVBNKACC\"}, resCode1: {\"const\":\"0\"}, resDesc1: {\"const\":\"Successful Operation\"}\r",
									"        }\r",
									"      },\r",
									"      message: {\r",
									"        type: \"object\",\r",
									"        required: [\"removeBankAccountResponse\"],\r",
									"        properties: {\r",
									"          removeBankAccountResponse: {\r",
									"            type: \"object\",\r",
									"            required: [\"done\",\"removeCode\",\"removeMessage\"]\r",
									"          }\r",
									"        }\r",
									"      }\r",
									"    }\r",
									"  };\r",
									"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
									"});\r",
									"\r",
									"console.log(\"✅ RMVBNKACC happy path OK:\", \"done=\", pm.environment.get(\"RMV_DONE\"));\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"Srv\": \"RMVBNKACC\",\r\n    \"Message\": {\r\n        \"RemoveBankAccountRequest\": {\r\n            \"NIN\": \"{{NIN}}\",\r\n            \"UserId\": \"{{UserID}}\",\r\n            \"userType\": \"INVESTOR\",\r\n            \"lang\": \"ARB\",\r\n            \"status\": \"2\",\r\n            \"accountNo\": \"{{accountSeq_1}}\",\r\n            \"swiftAddress\": \"{{bnkCode_1}}\",\r\n            \"currencyCode\": \"307\",\r\n            \"accountSeq\": \"{{accountSeq_1}}\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"05-10-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{BaseURL}}{{Oracle19}}",
							"host": [
								"{{BaseURL}}{{Oracle19}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "5. Activate Bank Account",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"/**\r",
									" * ACTVBNKACC – Activate Bank Account (Happy Path)\r",
									" * Expect:\r",
									" *  - responseStatus.* = \"0\", source=\"ACTVBNKACC\"\r",
									" *  - message.activateBankAccountResponse: { activateCode:\"0\", activateMessage:\"\" }\r",
									" * Optional checks (via env/globals):\r",
									" *  - REQUIRE_EMPTY_MESSAGE_ON_SUCCESS = Y|N (default Y)\r",
									" *  - If REGBANK_ACTIVATION_SEQ is set, verify the request includes same activation seq\r",
									" * Saves:\r",
									" *  ACTV_DONE_CODE, ACTV_MESSAGE\r",
									" */\r",
									"\r",
									"pm.test(\"HTTP 200\", function () { pm.response.to.have.status(200); });\r",
									"\r",
									"pm.test(\"Content-Type is JSON\", function () {\r",
									"  pm.response.to.have.header(\"Content-Type\");\r",
									"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
									"});\r",
									"\r",
									"var json;\r",
									"pm.test(\"Body is valid JSON\", function () {\r",
									"  json = pm.response.json();\r",
									"  pm.expect(json).to.be.an(\"object\");\r",
									"});\r",
									"\r",
									"// -------- Envelope --------\r",
									"pm.test(\"responseStatus OK (ACTVBNKACC)\", function () {\r",
									"  var rs = json.responseStatus || {};\r",
									"  pm.expect(rs.resCode).to.eql(\"0\");\r",
									"  pm.expect(rs.resDesc).to.eql(\"Successful Operation\");\r",
									"  pm.expect(rs.source).to.eql(\"ACTVBNKACC\");\r",
									"  pm.expect(rs.resCode1).to.eql(\"0\");\r",
									"  pm.expect(rs.resDesc1).to.eql(\"Successful Operation\");\r",
									"});\r",
									"\r",
									"// -------- Node --------\r",
									"var node = (((json || {}).message || {}).activateBankAccountResponse) || {};\r",
									"pm.test(\"activateBankAccountResponse exists & has required keys\", function () {\r",
									"  pm.expect(node).to.be.an(\"object\");\r",
									"  pm.expect(node, \"Missing key: activateCode\").to.have.property(\"activateCode\");\r",
									"  pm.expect(node, \"Missing key: activateMessage\").to.have.property(\"activateMessage\");\r",
									"  pm.expect(typeof node.activateCode, \"activateCode must be string\").to.eql(\"string\");\r",
									"  pm.expect(typeof node.activateMessage, \"activateMessage must be string\").to.eql(\"string\");\r",
									"});\r",
									"\r",
									"// Helpers\r",
									"function trim(s){ return String(s == null ? \"\" : s).replace(/^\\s+|\\s+$/g, \"\"); }\r",
									"function getFlag(name, defVal){\r",
									"  var v = pm.environment.get(name) || pm.globals.get(name);\r",
									"  v = (v == null ? \"\" : String(v)).toUpperCase();\r",
									"  if (v !== \"Y\" && v !== \"N\") return defVal;\r",
									"  return v;\r",
									"}\r",
									"\r",
									"// Expectations\r",
									"pm.test(\"activateCode = '0' and (optionally) empty message\", function () {\r",
									"  pm.expect(String(node.activateCode)).to.eql(\"0\");\r",
									"  var requireEmpty = getFlag(\"REQUIRE_EMPTY_MESSAGE_ON_SUCCESS\", \"Y\") === \"Y\";\r",
									"  if (requireEmpty) {\r",
									"    pm.expect(trim(node.activateMessage)).to.have.length(0);\r",
									"  }\r",
									"});\r",
									"\r",
									"// Optional: confirm request Srv\r",
									"pm.test(\"Request Srv is ACTVBNKACC\", function(){\r",
									"  try {\r",
									"    var body = pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {};\r",
									"    pm.expect((body || {}).Srv).to.eql(\"ACTVBNKACC\");\r",
									"  } catch(e) { console.warn(\"Could not parse request body:\", e.message); }\r",
									"});\r",
									"\r",
									"// Optional: verify the request contained expected activation sequence (from registration step)\r",
									"pm.test(\"Request includes expected activation sequence (if provided)\", function () {\r",
									"  var expectedSeq = pm.environment.get(\"REGBANK_ACTIVATION_SEQ\") || pm.globals.get(\"REGBANK_ACTIVATION_SEQ\") || \"\";\r",
									"  if (!expectedSeq) { return; }\r",
									"\r",
									"  function findSeq(obj){\r",
									"    if (!obj || typeof obj !== \"object\") return null;\r",
									"    for (var k in obj){\r",
									"      if (!obj.hasOwnProperty(k)) continue;\r",
									"      var v = obj[k];\r",
									"      if (typeof k === \"string\" && /(activation|bnk).*seq/i.test(k) && String(v).trim().length > 0) {\r",
									"        return String(v).trim();\r",
									"      }\r",
									"      if (v && typeof v === \"object\"){\r",
									"        var nested = findSeq(v);\r",
									"        if (nested) return nested;\r",
									"      }\r",
									"    }\r",
									"    return null;\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    var body = pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {};\r",
									"    var sentSeq = findSeq(body);\r",
									"    if (sentSeq) {\r",
									"      pm.expect(sentSeq, \"Activation sequence in request should match REGBANK_ACTIVATION_SEQ\").to.eql(String(expectedSeq));\r",
									"    } else {\r",
									"      console.warn(\"No activation sequence field found in request body to compare with REGBANK_ACTIVATION_SEQ=\", expectedSeq);\r",
									"    }\r",
									"  } catch(e){\r",
									"    console.warn(\"Could not parse request body for activation sequence:\", e.message);\r",
									"  }\r",
									"});\r",
									"\r",
									"// Save env\r",
									"pm.environment.set(\"ACTV_DONE_CODE\", String(node.activateCode || \"\"));\r",
									"pm.environment.set(\"ACTV_MESSAGE\", String(node.activateMessage || \"\"));\r",
									"\r",
									"// -------- Minimal schema (tv4) --------\r",
									"pm.test(\"Schema (minimal) validates\", function () {\r",
									"  var schema = {\r",
									"    type: \"object\",\r",
									"    required: [\"responseStatus\",\"message\"],\r",
									"    properties: {\r",
									"      responseStatus: {\r",
									"        type: \"object\",\r",
									"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
									"        properties: {\r",
									"          resCode:  { \"const\": \"0\" },\r",
									"          resDesc:  { \"const\": \"Successful Operation\" },\r",
									"          source:   { \"const\": \"ACTVBNKACC\" },\r",
									"          resCode1: { \"const\": \"0\" },\r",
									"          resDesc1: { \"const\": \"Successful Operation\" }\r",
									"        }\r",
									"      },\r",
									"      message: {\r",
									"        type: \"object\",\r",
									"        required: [\"activateBankAccountResponse\"],\r",
									"        properties: {\r",
									"          activateBankAccountResponse: {\r",
									"            type: \"object\",\r",
									"            required: [\"activateCode\",\"activateMessage\"],\r",
									"            properties: {\r",
									"              activateCode: { type: \"string\" },\r",
									"              activateMessage: { type: \"string\" }\r",
									"            }\r",
									"          }\r",
									"        }\r",
									"      }\r",
									"    }\r",
									"  };\r",
									"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
									"});\r",
									"\r",
									"console.log(\"✅ ACTVBNKACC success. code=\", pm.environment.get(\"ACTV_DONE_CODE\"));\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"Srv\": \"ACTVBNKACC\",\r\n    \"Message\": {\r\n        \"ActivateBankAccountRequest\": {\r\n             \"NIN\": \"{{NIN}}\",\r\n            \"UserId\": \"{{UserID}}\",\r\n            \"userType\": \"INVESTOR\",\r\n            \"lang\": \"ARB\",\r\n            \"transactionId\": \"\",\r\n            \"IntBnkCustomerId\": \"\",\r\n            \"status\": \"\",\r\n            \"accountNo\": \"{{accountCode_1}}\",\r\n            \"swiftAddress\": \"{{bnkCode_1}}\",\r\n            \"currencyCode\": \"307\",\r\n            \"accountIBAN\": \"QA06QNBA758452585252521111111\",\r\n            \"accountSeq\": \"{{accountSeq_1}}\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"05-10-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{BaseURL}}{{Oracle19}}",
							"host": [
								"{{BaseURL}}{{Oracle19}}"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "16. Fund",
			"item": [
				{
					"name": "GETFUNDDUE",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"/**\r",
									" * GETFUNDDUE – Unified tests for:\r",
									" *  (1) Normal/Margin NIN with NO debit (item = [])\r",
									" *  (2) Margin NIN WITH debit (item = [ ... ])\r",
									" * Validates:\r",
									" *  - HTTP 200, JSON\r",
									" *  - responseStatus.* = \"0\", source=\"GETFUNDDUE\"\r",
									" *  - message.fundPaymentDueResponse.item is an array\r",
									" *  - If empty -> pass Case 1\r",
									" *  - If non-empty -> validate detailed fields (dates, numeric strings incl. \"null\", flags 0/1)\r",
									" * Saves:\r",
									" *  FUNDDUE_HAS_DEBIT (Y/N), FUNDDUE_COUNT, FUNDDUE_TOTAL_PAYABLE,\r",
									" *  FUNDDUE_FIRST_STATUS, FUNDDUE_FIRST_PAYVALUE\r",
									" */\r",
									"\r",
									"pm.test(\"HTTP 200\", function () { pm.response.to.have.status(200); });\r",
									"\r",
									"pm.test(\"Content-Type is JSON\", function () {\r",
									"  pm.response.to.have.header(\"Content-Type\");\r",
									"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
									"});\r",
									"\r",
									"var json;\r",
									"pm.test(\"Body is JSON\", function () {\r",
									"  json = pm.response.json();\r",
									"  pm.expect(json).to.be.an(\"object\");\r",
									"});\r",
									"\r",
									"// -------- Envelope --------\r",
									"pm.test(\"responseStatus OK (GETFUNDDUE)\", function () {\r",
									"  var rs = json.responseStatus || {};\r",
									"  pm.expect(rs.resCode).to.eql(\"0\");\r",
									"  pm.expect(rs.resDesc).to.eql(\"Successful Operation\");\r",
									"  pm.expect(rs.source).to.eql(\"GETFUNDDUE\");\r",
									"  pm.expect(rs.resCode1).to.eql(\"0\");\r",
									"  pm.expect(rs.resDesc1).to.eql(\"Successful Operation\");\r",
									"});\r",
									"\r",
									"// -------- Node & array --------\r",
									"var node = (((json || {}).message || {}).fundPaymentDueResponse) || {};\r",
									"pm.test(\"fundPaymentDueResponse exists\", function () {\r",
									"  pm.expect(node).to.be.an(\"object\");\r",
									"  pm.expect(node).to.have.property(\"item\");\r",
									"});\r",
									"\r",
									"function asArray(x){ return x == null ? [] : (Array.isArray(x) ? x : [x]); }\r",
									"var items = asArray(node.item);\r",
									"\r",
									"// Optional minimum expected items\r",
									"var minDue = Number(pm.environment.get(\"MIN_FUNDDUE\") || pm.globals.get(\"MIN_FUNDDUE\") || 0);\r",
									"pm.test(\"item is an array (len >= MIN_FUNDDUE)\", function () {\r",
									"  pm.expect(items).to.be.an(\"array\");\r",
									"  pm.expect(items.length).to.be.at.least(minDue);\r",
									"});\r",
									"\r",
									"// Helpers\r",
									"function trim(s){ return String(s == null ? \"\" : s).replace(/^\\s+|\\s+$/g,\"\"); }\r",
									"function isNumericStr(v){ return typeof v === \"string\" && /^-?\\d+(\\.\\d+)?$/.test(v); }\r",
									"function isIntStr(v){ return typeof v === \"string\" && /^-?\\d+$/.test(v); }\r",
									"function isDdMmYyyy(s){\r",
									"  // Accept \"dd/MM/yyyy\" (with leading zeros) 01..31 / 01..12 / 1900..2099\r",
									"  s = String(s || \"\");\r",
									"  var m = s.match(/^(\\d{2})\\/(\\d{2})\\/(\\d{4})$/);\r",
									"  if (!m) return false;\r",
									"  var d = +m[1], M = +m[2], Y = +m[3];\r",
									"  if (M < 1 || M > 12) return false;\r",
									"  if (d < 1 || d > 31) return false;\r",
									"  if (Y < 1900 || Y > 2099) return false;\r",
									"  return true;\r",
									"}\r",
									"function is01Flag(v){ return v === \"0\" || v === \"1\"; }\r",
									"function numOrNullString(s){ // returns { ok:bool, val:Number|null }\r",
									"  if (s == null) return { ok:false, val:null };\r",
									"  var t = String(s).toLowerCase().trim();\r",
									"  if (t === \"null\" || t === \"\") return { ok:true, val:null };\r",
									"  if (/^-?\\d+(\\.\\d+)?$/.test(t)) return { ok:true, val:Number(t) };\r",
									"  return { ok:false, val:null };\r",
									"}\r",
									"\r",
									"// -------- Case detection --------\r",
									"var hasDebit = items.length > 0;\r",
									"\r",
									"// Case 1: No debit (works for Margin or Normal NIN)\r",
									"pm.test(\"Case 1: No debit -> items array empty (if applicable)\", function(){\r",
									"  if (!hasDebit) {\r",
									"    pm.expect(items.length).to.eql(0);\r",
									"  } else {\r",
									"    this.skip && this.skip();\r",
									"  }\r",
									"});\r",
									"\r",
									"// Case 2: Has debit (Margin NIN)\r",
									"pm.test(\"Case 2: Has debit -> validate each item (if applicable)\", function () {\r",
									"  if (!hasDebit) { this.skip && this.skip(); return; }\r",
									"\r",
									"  for (var i = 0; i < items.length; i++) {\r",
									"    var it = items[i];\r",
									"    pm.expect(it, \"item @\" + i + \" must be object\").to.be.an(\"object\");\r",
									"\r",
									"    // Required keys (as per sample)\r",
									"    var required = [\r",
									"      \"paymentDueDate\",\"pureValue\",\"actualFunded\",\"actualFundDate\",\"remainingFund\",\r",
									"      \"payValue\",\"status\",\"statusDescArb\",\"statusDescEng\",\"canLq\",\"canExt\",\"canCanc\",\"canAppr\"\r",
									"    ];\r",
									"    for (var r = 0; r < required.length; r++){\r",
									"      pm.expect(it, \"Missing key '\"+required[r]+\"' @\" + i).to.have.property(required[r]);\r",
									"    }\r",
									"\r",
									"    // Dates: dd/MM/yyyy\r",
									"    pm.expect(isDdMmYyyy(it.paymentDueDate), \"paymentDueDate dd/MM/yyyy @\" + i).to.be.true;\r",
									"    pm.expect(isDdMmYyyy(it.actualFundDate), \"actualFundDate dd/MM/yyyy @\" + i).to.be.true;\r",
									"    if (it.hasOwnProperty(\"lastPaymentDate\") && it.lastPaymentDate !== null) {\r",
									"      // lastPaymentDate appears in your sample; validate if present (can be dd/MM/yyyy)\r",
									"      pm.expect(isDdMmYyyy(it.lastPaymentDate), \"lastPaymentDate dd/MM/yyyy @\" + i).to.be.true;\r",
									"    }\r",
									"\r",
									"    // Numeric strings (allow \"null\" for payValue per sample)\r",
									"    var pv = numOrNullString(it.pureValue);\r",
									"    var af = numOrNullString(it.actualFunded);\r",
									"    var rf = numOrNullString(it.remainingFund);\r",
									"    var py = numOrNullString(it.payValue);\r",
									"\r",
									"    pm.expect(pv.ok && pv.val !== null, \"pureValue numeric @\" + i).to.be.true;\r",
									"    pm.expect(af.ok && af.val !== null, \"actualFunded numeric @\" + i).to.be.true;\r",
									"    pm.expect(rf.ok && rf.val !== null, \"remainingFund numeric @\" + i).to.be.true;\r",
									"    pm.expect(py.ok, \"payValue numeric or 'null' @\" + i).to.be.true;\r",
									"\r",
									"    pm.expect(pv.val, \"pureValue >= 0 @\" + i).to.be.at.least(0);\r",
									"    pm.expect(af.val, \"actualFunded >= 0 @\" + i).to.be.at.least(0);\r",
									"    pm.expect(rf.val, \"remainingFund >= 0 @\" + i).to.be.at.least(0);\r",
									"    if (py.val !== null) {\r",
									"      pm.expect(py.val, \"payValue >= 0 @\" + i).to.be.at.least(0);\r",
									"    }\r",
									"\r",
									"    // Flags 0/1\r",
									"    pm.expect(is01Flag(it.canLq),  \"canLq must be '0' or '1' @\" + i).to.be.true;\r",
									"    pm.expect(is01Flag(it.canExt), \"canExt must be '0' or '1' @\" + i).to.be.true;\r",
									"    pm.expect(is01Flag(it.canCanc),\"canCanc must be '0' or '1' @\" + i).to.be.true;\r",
									"    pm.expect(is01Flag(it.canAppr),\"canAppr must be '0' or '1' @\" + i).to.be.true;\r",
									"\r",
									"    // status & descriptions (soft checks)\r",
									"    pm.expect(/^\\d+$/.test(String(it.status)), \"status numeric string @\" + i).to.be.true;\r",
									"    pm.expect(trim(it.statusDescArb).length, \"statusDescArb non-empty @\" + i).to.be.greaterThan(0);\r",
									"    pm.expect(trim(it.statusDescEng).length, \"statusDescEng non-empty @\" + i).to.be.greaterThan(0);\r",
									"    if (String(it.status) === \"3\") {\r",
									"      // If expired, English should say 'Expired' (case-insensitive); Arabic should include 'منتهي'\r",
									"      pm.expect(/expired/i.test(String(it.statusDescEng)), \"statusDescEng should include 'Expired' @\" + i).to.be.true;\r",
									"      pm.expect(/منتهي/.test(String(it.statusDescArb)), \"statusDescArb should include 'منتهي' @\" + i).to.be.true;\r",
									"    }\r",
									"\r",
									"    // Optional numeric id\r",
									"    if (it.hasOwnProperty(\"fundExtReqStatusId\")) {\r",
									"      pm.expect(isIntStr(String(it.fundExtReqStatusId)), \"fundExtReqStatusId int @\" + i).to.be.true;\r",
									"    }\r",
									"\r",
									"    // Cross-field sanity:\r",
									"    // remainingFund <= actualFunded\r",
									"    pm.expect(rf.val, \"remainingFund <= actualFunded @\" + i).to.be.at.most(af.val);\r",
									"    // If payValue present numeric: payValue <= remainingFund (installment shouldn't exceed remaining)\r",
									"    if (py.val !== null) {\r",
									"      pm.expect(py.val, \"payValue <= remainingFund @\" + i).to.be.at.most(rf.val);\r",
									"    }\r",
									"  }\r",
									"});\r",
									"\r",
									"// -------- Save env --------\r",
									"(function saveEnv(){\r",
									"  pm.environment.set(\"FUNDDUE_HAS_DEBIT\", hasDebit ? \"Y\" : \"N\");\r",
									"  pm.environment.set(\"FUNDDUE_COUNT\", String(items.length));\r",
									"\r",
									"  // total payable (sum of payValue where numeric)\r",
									"  var total = 0;\r",
									"  for (var i=0;i<items.length;i++){\r",
									"    var v = numOrNullString(items[i].payValue);\r",
									"    if (v.ok && v.val !== null) total += v.val;\r",
									"  }\r",
									"  pm.environment.set(\"FUNDDUE_TOTAL_PAYABLE\", String(total));\r",
									"\r",
									"  if (items.length > 0) {\r",
									"    var first = items[0];\r",
									"    var fv = numOrNullString(first.payValue);\r",
									"    pm.environment.set(\"FUNDDUE_FIRST_STATUS\", String(first.status || \"\"));\r",
									"    pm.environment.set(\"FUNDDUE_FIRST_PAYVALUE\", fv.val === null ? \"null\" : String(fv.val));\r",
									"  } else {\r",
									"    pm.environment.unset(\"FUNDDUE_FIRST_STATUS\");\r",
									"    pm.environment.unset(\"FUNDDUE_FIRST_PAYVALUE\");\r",
									"  }\r",
									"})();\r",
									"\r",
									"// -------- Minimal schema (tv4) --------\r",
									"pm.test(\"Schema (minimal) validates\", function () {\r",
									"  var schema = {\r",
									"    type: \"object\",\r",
									"    required: [\"responseStatus\",\"message\"],\r",
									"    properties: {\r",
									"      responseStatus: {\r",
									"        type: \"object\",\r",
									"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
									"        properties: {\r",
									"          resCode:  { \"const\": \"0\" },\r",
									"          resDesc:  { \"const\": \"Successful Operation\" },\r",
									"          source:   { \"const\": \"GETFUNDDUE\" },\r",
									"          resCode1: { \"const\": \"0\" },\r",
									"          resDesc1: { \"const\": \"Successful Operation\" }\r",
									"        }\r",
									"      },\r",
									"      message: {\r",
									"        type: \"object\",\r",
									"        required: [\"fundPaymentDueResponse\"],\r",
									"        properties: {\r",
									"          fundPaymentDueResponse: {\r",
									"            type: \"object\",\r",
									"            required: [\"item\"],\r",
									"            properties: {\r",
									"              item: { type: \"array\" }\r",
									"            }\r",
									"          }\r",
									"        }\r",
									"      }\r",
									"    }\r",
									"  };\r",
									"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
									"});\r",
									"\r",
									"console.log(\"✅ GETFUNDDUE unified validation. hasDebit=\", pm.environment.get(\"FUNDDUE_HAS_DEBIT\"),\r",
									"            \"count=\", pm.environment.get(\"FUNDDUE_COUNT\"),\r",
									"            \"totalPayable=\", pm.environment.get(\"FUNDDUE_TOTAL_PAYABLE\"));\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "POST",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"Srv\": \"GETFUNDDUE\",\r\n    \"Message\": {\r\n        \"PaymentDueRequest\": {\r\n            \"Lang\": \"ARB\",\r\n            \"UserId\": \"{{UserID}}\",\r\n            \"UserType\": \"INVESTOR\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"01-05-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{BaseURL}}{{Oracle19}}",
							"host": [
								"{{BaseURL}}{{Oracle19}}"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "17. E_DEF / E_DOC get requests",
			"item": [
				{
					"name": "Error handling",
					"item": [
						{
							"name": "GRP_EDOC download missing data",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"/**\r",
											" * GRP_EDOC – Unified validation for:\r",
											" *  A) Missing reference number -> resCode=\"51\"\r",
											" *  B) Happy path -> resCode=\"0\" + populated edocsResponse/eDocsResponse\r",
											" *  C) Wrong reference number -> resCode=\"0\" + empty edocsResponse/eDocsResponse\r",
											" */\r",
											"\r",
											"pm.test(\"HTTP 200\", function(){ pm.response.to.have.status(200); });\r",
											"\r",
											"pm.test(\"Content-Type JSON\", function(){\r",
											"  pm.response.to.have.header(\"Content-Type\");\r",
											"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
											"});\r",
											"\r",
											"var json;\r",
											"pm.test(\"Body is JSON\", function(){\r",
											"  json = pm.response.json();\r",
											"  pm.expect(json).to.be.an(\"object\");\r",
											"});\r",
											"\r",
											"// ---------------- Helpers ----------------\r",
											"function trim(s){ return String(s == null ? \"\" : s).replace(/^\\s+|\\s+$/g, \"\"); }\r",
											"function isIntStr(v){ return typeof v === \"string\" && /^-?\\d+$/.test(v); }\r",
											"function isIPv4(s){\r",
											"  s = String(s || \"\");\r",
											"  var m = s.match(/^(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})$/);\r",
											"  if (!m) return false;\r",
											"  for (var i=1;i<=4;i++){ var n = +m[i]; if (n < 0 || n > 255) return false; }\r",
											"  return true;\r",
											"}\r",
											"function getFirst(obj, keys){\r",
											"  for (var i=0;i<keys.length;i++){\r",
											"    var k = keys[i];\r",
											"    if (obj && Object.prototype.hasOwnProperty.call(obj, k) && obj[k] != null) return obj[k];\r",
											"  }\r",
											"  return undefined;\r",
											"}\r",
											"function isEmptyObject(o){\r",
											"  if (!o || typeof o !== \"object\") return true;\r",
											"  return Object.keys(o).length === 0;\r",
											"}\r",
											"function asArray(x){ return x == null ? [] : (Array.isArray(x) ? x : [x]); }\r",
											"\r",
											"// Optional: capture request refNo we sent (if any) for traceability\r",
											"(function captureRequestRef(){\r",
											"  try {\r",
											"    var req = pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {};\r",
											"    // try common paths/names for reference number\r",
											"    function findRef(o){\r",
											"      if (!o || typeof o !== \"object\") return \"\";\r",
											"      for (var k in o){\r",
											"        if (!o.hasOwnProperty(k)) continue;\r",
											"        var v = o[k];\r",
											"        if (/^(refNo|referenceNo|reference|ref)$/i.test(k)) return String(v || \"\");\r",
											"        if (v && typeof v === \"object\") {\r",
											"          var got = findRef(v); if (got) return got;\r",
											"        }\r",
											"      }\r",
											"      return \"\";\r",
											"    }\r",
											"    var r = findRef(req);\r",
											"    if (r) pm.environment.set(\"EDOC_REQ_REFNO\", r); else pm.environment.unset(\"EDOC_REQ_REFNO\");\r",
											"  } catch(e){\r",
											"    console.warn(\"Could not parse request to capture refNo:\", e.message);\r",
											"    pm.environment.unset(\"EDOC_REQ_REFNO\");\r",
											"  }\r",
											"})();\r",
											"\r",
											"// ---------------- Envelope ----------------\r",
											"var rs = json.responseStatus || {};\r",
											"pm.test(\"Source is GRP_EDOC & resCode is expected (0 or 51)\", function(){\r",
											"  pm.expect(rs.source).to.eql(\"GRP_EDOC\");\r",
											"  pm.expect([\"0\",\"51\"]).to.include(String(rs.resCode));\r",
											"  pm.expect([\"0\",\"51\"]).to.include(String(rs.resCode1));\r",
											"});\r",
											"\r",
											"// Determine scenario\r",
											"var scenario = (rs.resCode === \"51\") ? \"MISSING_REF\" : \"SUCCESS\";\r",
											"\r",
											"// Node root (both case variants)\r",
											"var msg = json.message || {};\r",
											"var edocNode = getFirst(msg, [\"edocsResponse\",\"eDocsResponse\"]);\r",
											"\r",
											"// ---------------- Scenario A: Missing reference number ----------------\r",
											"pm.test(\"Scenario A – Missing reference number (if applicable)\", function(){\r",
											"  if (scenario !== \"MISSING_REF\") { this.skip && this.skip(); return; }\r",
											"\r",
											"  // Arabic message tolerance\r",
											"  var allowed = { \"البيانات المطلوبة ناقصة\":1 };\r",
											"  pm.expect(allowed[trim(rs.resDesc)] === 1, \"resDesc Arabic matches 'البيانات المطلوبة ناقصة'\").to.be.true;\r",
											"  pm.expect(allowed[trim(rs.resDesc1)] === 1, \"resDesc1 Arabic matches 'البيانات المطلوبة ناقصة'\").to.be.true;\r",
											"\r",
											"  // No business payload expected\r",
											"  pm.expect(edocNode == null || isEmptyObject(edocNode), \"No edocs payload when reference is missing\").to.be.true;\r",
											"\r",
											"  // Save flags\r",
											"  pm.environment.set(\"EDOC_SCENARIO\", \"MISSING_REF\");\r",
											"  pm.environment.set(\"EDOC_FOUND\", \"N\");\r",
											"});\r",
											"\r",
											"// ---------------- Scenario B/C: resCode=0 ----------------\r",
											"pm.test(\"Scenario B/C – resCode=0 success envelope (Arabic/English)\", function(){\r",
											"  if (scenario !== \"SUCCESS\") { this.skip && this.skip(); return; }\r",
											"  var d0 = trim(rs.resDesc), d1 = trim(rs.resDesc1);\r",
											"  var ok = (d0 === \"Successful Operation\" || /عملي[هة]\\s*ناجحة/.test(d0)) ||\r",
											"           (d1 === \"Successful Operation\" || /عملي[هة]\\s*ناجحة/.test(d1));\r",
											"  pm.expect(ok, \"resDesc indicates success\").to.be.true;\r",
											"});\r",
											"\r",
											"// Decide B vs C\r",
											"var hasPayload = (scenario === \"SUCCESS\") && edocNode && !isEmptyObject(edocNode);\r",
											"\r",
											"// ---------------- Scenario B: Happy path with payload ----------------\r",
											"pm.test(\"Scenario B – Happy path: edocs payload present & valid\", function(){\r",
											"  if (!hasPayload) { this.skip && this.skip(); return; }\r",
											"\r",
											"  // ext info (support variant keys)\r",
											"  var extInfo = getFirst(edocNode, [\"edocsExtaInfo\",\"eDocsExtaInfo\",\"edocsExtraInfo\",\"eDocsExtraInfo\"]);\r",
											"  pm.expect(extInfo, \"Extended info node exists\").to.be.an(\"object\");\r",
											"\r",
											"  // Client info (variant keys)\r",
											"  var clientInfo = getFirst(extInfo, [\"edocsClientInformation\",\"eDocsClientInformation\",\"clientInformation\"]);\r",
											"  pm.expect(clientInfo, \"Client info node exists\").to.be.an(\"object\");\r",
											"\r",
											"  // Client fields\r",
											"  [\"titleArb\",\"titleEng\",\"clientNameArb\",\"clientNameEng\"].forEach(function(k){\r",
											"    pm.expect(clientInfo, \"Missing client field: \" + k).to.have.property(k);\r",
											"    pm.expect(trim(clientInfo[k]).length, k+\" non-empty\").to.be.greaterThan(0);\r",
											"  });\r",
											"\r",
											"  // nin\r",
											"  pm.expect(extInfo).to.have.property(\"nin\");\r",
											"  pm.expect(trim(extInfo.nin).length, \"nin non-empty\").to.be.greaterThan(0);\r",
											"\r",
											"  // status & descriptions\r",
											"  pm.expect(extInfo).to.have.property(\"status\");\r",
											"  pm.expect(/^[A-Z]{2,4}$/.test(String(extInfo.status)), \"status code upper alpha\").to.be.true;\r",
											"\r",
											"  pm.expect(extInfo).to.have.property(\"statusDescArb\");\r",
											"  pm.expect(trim(extInfo.statusDescArb).length, \"statusDescArb\").to.be.greaterThan(0);\r",
											"\r",
											"  pm.expect(extInfo).to.have.property(\"statusDescEng\");\r",
											"  pm.expect(trim(extInfo.statusDescEng).length, \"statusDescEng\").to.be.greaterThan(0);\r",
											"\r",
											"  // ip\r",
											"  pm.expect(extInfo).to.have.property(\"ip\");\r",
											"  pm.expect(isIPv4(extInfo.ip), \"ip IPv4\").to.be.true;\r",
											"\r",
											"  // batchId (numeric string)\r",
											"  pm.expect(extInfo).to.have.property(\"batchId\");\r",
											"  pm.expect(isIntStr(String(extInfo.batchId)), \"batchId integer string\").to.be.true;\r",
											"  pm.expect(Number(extInfo.batchId), \"batchId > 0\").to.be.above(0);\r",
											"\r",
											"  // Save env vars\r",
											"  pm.environment.set(\"EDOC_SCENARIO\", \"HAPPY\");\r",
											"  pm.environment.set(\"EDOC_FOUND\", \"Y\");\r",
											"  pm.environment.set(\"EDOC_NIN\", String(extInfo.nin || \"\"));\r",
											"  pm.environment.set(\"EDOC_STATUS\", String(extInfo.status || \"\"));\r",
											"  pm.environment.set(\"EDOC_STATUS_AR\", String(extInfo.statusDescArb || \"\"));\r",
											"  pm.environment.set(\"EDOC_STATUS_EN\", String(extInfo.statusDescEng || \"\"));\r",
											"  pm.environment.set(\"EDOC_IP\", String(extInfo.ip || \"\"));\r",
											"  pm.environment.set(\"EDOC_BATCH_ID\", String(extInfo.batchId || \"\"));\r",
											"  pm.environment.set(\"EDOC_CLIENT_TITLE_AR\", String(clientInfo.titleArb || \"\"));\r",
											"  pm.environment.set(\"EDOC_CLIENT_TITLE_EN\", String(clientInfo.titleEng || \"\"));\r",
											"  pm.environment.set(\"EDOC_CLIENT_NAME_AR\", String(clientInfo.clientNameArb || \"\"));\r",
											"  pm.environment.set(\"EDOC_CLIENT_NAME_EN\", String(clientInfo.clientNameEng || \"\"));\r",
											"});\r",
											"\r",
											"// ---------------- Scenario C: resCode=0 but empty payload (wrong ref) ----------------\r",
											"pm.test(\"Scenario C – Wrong reference number: success envelope but empty payload\", function(){\r",
											"  if (scenario !== \"SUCCESS\" || hasPayload) { this.skip && this.skip(); return; }\r",
											"\r",
											"  // Either edocsResponse/eDocsResponse is absent or empty\r",
											"  pm.expect(edocNode == null || isEmptyObject(edocNode), \"Empty edocs payload for wrong ref\").to.be.true;\r",
											"\r",
											"  pm.environment.set(\"EDOC_SCENARIO\", \"WRONG_REF\");\r",
											"  pm.environment.set(\"EDOC_FOUND\", \"N\");\r",
											"  pm.environment.unset(\"EDOC_NIN\");\r",
											"  pm.environment.unset(\"EDOC_STATUS\");\r",
											"  pm.environment.unset(\"EDOC_STATUS_AR\");\r",
											"  pm.environment.unset(\"EDOC_STATUS_EN\");\r",
											"  pm.environment.unset(\"EDOC_IP\");\r",
											"  pm.environment.unset(\"EDOC_BATCH_ID\");\r",
											"  pm.environment.unset(\"EDOC_CLIENT_TITLE_AR\");\r",
											"  pm.environment.unset(\"EDOC_CLIENT_TITLE_EN\");\r",
											"  pm.environment.unset(\"EDOC_CLIENT_NAME_AR\");\r",
											"  pm.environment.unset(\"EDOC_CLIENT_NAME_EN\");\r",
											"});\r",
											"\r",
											"// ---------------- Minimal schema (tv4) ----------------\r",
											"pm.test(\"Schema (minimal) validates\", function(){\r",
											"  var schema = {\r",
											"    type: \"object\",\r",
											"    required: [\"responseStatus\"],\r",
											"    properties: {\r",
											"      responseStatus: {\r",
											"        type: \"object\",\r",
											"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
											"        properties: {\r",
											"          source: { \"const\": \"GRP_EDOC\" },\r",
											"          resCode: { \"enum\": [\"0\",\"51\"] },\r",
											"          resCode1:{ \"enum\": [\"0\",\"51\"] }\r",
											"        }\r",
											"      },\r",
											"      message: { type: \"object\" }\r",
											"    }\r",
											"  };\r",
											"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
											"});\r",
											"\r",
											"// ---------------- Optional: verify request Srv ----------------\r",
											"pm.test(\"Request Srv is GRP_EDOC\", function(){\r",
											"  try {\r",
											"    var body = pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {};\r",
											"    pm.expect((body || {}).Srv).to.eql(\"GRP_EDOC\");\r",
											"  } catch(e) { console.warn(\"Could not parse request body:\", e.message); }\r",
											"});\r",
											"\r",
											"// ---------------- Visualizer (compact) ----------------\r",
											"(function render(){\r",
											"  var template =\r",
											"    '<style>.t{font-family:system-ui,Segoe UI,Roboto,Arial;font-size:14px;color:#333;width:100%;border-collapse:collapse}' +\r",
											"    '.t th,.t td{border:1px solid #87ceeb;padding:6px;text-align:left}.t th{background:#87ceeb}.v{color:#0a8f08}.x{color:#b00020}</style>' +\r",
											"    '<h3>GRP_EDOC – Scenario: {{scenario}}</h3>' +\r",
											"    '<table class=\"t\"><tbody>' +\r",
											"    '<tr><th>refNo (request)</th><td>{{reqRef}}</td></tr>' +\r",
											"    '<tr><th>Found</th><td class=\"{{foundCls}}\">{{found}}</td></tr>' +\r",
											"    '<tr><th>NIN</th><td>{{nin}}</td></tr>' +\r",
											"    '<tr><th>Status</th><td>{{status}} / {{statusAr}} / {{statusEn}}</td></tr>' +\r",
											"    '<tr><th>Batch ID</th><td>{{batchId}}</td></tr>' +\r",
											"    '<tr><th>IP</th><td>{{ip}}</td></tr>' +\r",
											"    '<tr><th>Client</th><td>{{titleAr}} {{nameAr}} | {{titleEn}} {{nameEn}}</td></tr>' +\r",
											"    '</tbody></table>';\r",
											"\r",
											"  pm.visualizer.set(template, {\r",
											"    scenario: pm.environment.get(\"EDOC_SCENARIO\") || \"\",\r",
											"    reqRef: pm.environment.get(\"EDOC_REQ_REFNO\") || \"\",\r",
											"    found: (pm.environment.get(\"EDOC_FOUND\") || \"\") === \"Y\" ? \"Yes\" : \"No\",\r",
											"    foundCls: (pm.environment.get(\"EDOC_FOUND\") || \"\") === \"Y\" ? \"v\" : \"x\",\r",
											"    nin: pm.environment.get(\"EDOC_NIN\") || \"\",\r",
											"    status: pm.environment.get(\"EDOC_STATUS\") || \"\",\r",
											"    statusAr: pm.environment.get(\"EDOC_STATUS_AR\") || \"\",\r",
											"    statusEn: pm.environment.get(\"EDOC_STATUS_EN\") || \"\",\r",
											"    batchId: pm.environment.get(\"EDOC_BATCH_ID\") || \"\",\r",
											"    ip: pm.environment.get(\"EDOC_IP\") || \"\",\r",
											"    titleAr: pm.environment.get(\"EDOC_CLIENT_TITLE_AR\") || \"\",\r",
											"    titleEn: pm.environment.get(\"EDOC_CLIENT_TITLE_EN\") || \"\",\r",
											"    nameAr: pm.environment.get(\"EDOC_CLIENT_NAME_AR\") || \"\",\r",
											"    nameEn: pm.environment.get(\"EDOC_CLIENT_NAME_EN\") || \"\"\r",
											"  });\r",
											"})();\r",
											"\r",
											"console.log(\"✅ GRP_EDOC validated. scenario=\", pm.environment.get(\"EDOC_SCENARIO\"),\r",
											"            \"found=\", pm.environment.get(\"EDOC_FOUND\"),\r",
											"            \"reqRef=\", pm.environment.get(\"EDOC_REQ_REFNO\"));\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Accept",
										"value": "application/json",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\r\n    \"Srv\": \"GRP_EDOC\",\r\n    \"Message\": {\r\n        \"EDocsRequest\": {\r\n            \"RefNo\": \"\",\r\n            \"RequestSource\": \"CONTRACT\",\r\n            \"NIN\": \"{{NIN}}\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"05-10-2025\",\r\n     \"sessionId\": \"{{SessionID}}\",\r\n    \"Lang\": \"ARB\"\r\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{BaseURL}}{{Oracle19}}",
									"host": [
										"{{BaseURL}}{{Oracle19}}"
									]
								}
							},
							"response": []
						}
					]
				},
				{
					"name": "1. Login - E_DEF",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Check if the status code is 200\r",
									"pm.test(\"Status code is 200\", function () {\r",
									"    pm.response.to.have.status(200);\r",
									"});\r",
									"\r",
									"// Check if response code is 0\r",
									"pm.test(\"Response code is 0\", function () {\r",
									"    var jsonData = pm.response.json(); // Parse JSON response\r",
									"    pm.expect(jsonData.responseStatus.resCode).to.equal(\"0\");\r",
									"});\r",
									"\r",
									"// Check if response description is \"Successful Operation\"\r",
									"pm.test(\"Response description is 'Successful Operation'\", function () {\r",
									"    var jsonData = pm.response.json();\r",
									"    pm.expect(jsonData.responseStatus.resDesc).to.equal(\"Successful Operation\");\r",
									"});\r",
									"\r",
									"// Check if login is successful and capture NIN\r",
									"pm.test(\"Login successful and NIN captured\", function () {\r",
									"    var jsonData = pm.response.json();\r",
									"    var accounts = jsonData.message.logResponse.accounts.account;\r",
									"\r",
									"    if (accounts.length > 0) {\r",
									"        var nin = accounts[0].nin; // Extract NIN\r",
									"        pm.expect(nin).to.not.be.undefined; // Ensure it's not empty\r",
									"\r",
									"        // Store in environment variables\r",
									"        pm.environment.set(\"NIN\", nin);\r",
									"        pm.environment.set(\"UserID\", nin); // Store the same value in UserID\r",
									"\r",
									"        console.log(\"Captured NIN/UserID:\", nin);\r",
									"    } else {\r",
									"        pm.expect.fail(\"NIN not found in the response.\");\r",
									"    }\r",
									"});\r",
									"\r",
									"// Check if login is successful and SessionID is created\r",
									"pm.test(\"Login successful and SessionID created\", function () {\r",
									"    var jsonData = pm.response.json();\r",
									"    var sessionID = jsonData.message.logResponse.sessionID;\r",
									"\r",
									"    pm.expect(sessionID).to.not.be.undefined; // Assert SessionID exists\r",
									"});\r",
									"\r",
									"// Verify Content-Type header is 'application/json'\r",
									"pm.test(\"Content-Type header is 'application/json'\", function () {\r",
									"    pm.expect(pm.response.headers.get(\"Content-Type\")).to.include(\"application/json\");\r",
									"});\r",
									"\r",
									"// Check if login is successful and capture SessionID\r",
									"pm.test(\"Login successful and SessionID captured\", function () {\r",
									"    var jsonData = pm.response.json();\r",
									"    var sessionID = jsonData.message.logResponse.sessionID;\r",
									"\r",
									"    pm.expect(sessionID).to.not.be.undefined; // Assert SessionID exists\r",
									"    pm.environment.set(\"SessionID\", sessionID); // Save SessionID to environment\r",
									"});\r",
									"\r",
									"// Parse the response JSON\r",
									"var jsonData = pm.response.json();\r",
									"\r",
									"// Verify that the response contains the expected roles\r",
									"pm.test(\"Verify roles in response\", function () {\r",
									"    var roles = jsonData.message.logResponse.roles.role;\r",
									"\r",
									"    // Define expected roles\r",
									"    var expectedRoles = [\"UPDATE_ORDER\", \"SAVE_ORDER\", \"REPORTS\", \"CANCEL_ORDER\"];\r",
									"\r",
									"    // Ensure roles exist in the response\r",
									"    pm.expect(roles).to.be.an(\"array\").that.is.not.empty;\r",
									"\r",
									"    // Check that all expected roles exist in the response\r",
									"    expectedRoles.forEach(role => {\r",
									"        pm.expect(roles).to.include(role, `Missing role: ${role}`);\r",
									"    });\r",
									"\r",
									"    console.log(\"✅ Roles verified successfully:\", roles);\r",
									"});\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Get current timestamp in ISO format\r",
									"var timestamp = new Date().toISOString();\r",
									"\r",
									"// Store timestamp in Postman environment\r",
									"pm.environment.set(\"currentTimestamp\", timestamp);\r",
									"\r",
									"// Log the timestamp\r",
									"console.log(\"Timestamp Set:\", timestamp);\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"Srv\": \"Login\",\r\n    \"Message\": {\r\n        \"Login\": {\r\n            \"UserName\": \"2024\",\r\n            \"Password\": \"{{Password}}\",\r\n            \"Lang\": \"ARB\"\r\n        }\r\n    },\r\n    \"Version\": \"1.0\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"08-07-2015\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{BaseURL}}{{Oracle19}}",
							"host": [
								"{{BaseURL}}{{Oracle19}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "2. E_DEF_LIST_REQ",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"/**\r",
									" * E_DEF_LIST_REQ – Unified validation\r",
									" * Covers:\r",
									" *  (1) No requests (edefRecord = [])\r",
									" *  (2) Has requests (edefRecord = [ ... ])\r",
									" *\r",
									" * Optional controls (Env/Globals):\r",
									" *  - MIN_EDEF = 0\r",
									" *  - REQUIRE_TYPE_MARGIN = Y|N (default N)\r",
									" *  - STRICT_DESC = Y|N (default N) -> Arabic \"عمليه ناجحة\"/\"عملية ناجحة\"\r",
									" *  - ASSERT_NIN = Y|N (default N) -> if NIN env exists, require record.nin == NIN\r",
									" *  - STRICT_REFNO_UUID = Y|N (default N) -> enforce refNo is UUID\r",
									" */\r",
									"\r",
									"pm.test(\"HTTP 200\", function () { pm.response.to.have.status(200); });\r",
									"\r",
									"pm.test(\"Content-Type is JSON\", function () {\r",
									"  pm.response.to.have.header(\"Content-Type\");\r",
									"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
									"});\r",
									"\r",
									"var json;\r",
									"pm.test(\"Body is JSON\", function () {\r",
									"  json = pm.response.json();\r",
									"  pm.expect(json).to.be.an(\"object\");\r",
									"});\r",
									"\r",
									"// -------- Envelope --------\r",
									"pm.test(\"responseStatus OK (E_DEF_LIST_REQ)\", function () {\r",
									"  var rs = json.responseStatus || {};\r",
									"  pm.expect(rs.resCode).to.eql(\"0\");\r",
									"  pm.expect(rs.resCode1).to.eql(\"0\");\r",
									"  pm.expect(rs.source).to.eql(\"E_DEF_LIST_REQ\");\r",
									"\r",
									"  var strict = String(pm.environment.get(\"STRICT_DESC\") || pm.globals.get(\"STRICT_DESC\") || \"N\").toUpperCase() === \"Y\";\r",
									"  var d0 = String((rs.resDesc  || \"\")).trim();\r",
									"  var d1 = String((rs.resDesc1 || \"\")).trim();\r",
									"\r",
									"  if (strict) {\r",
									"    var allowedAr = { \"عمليه ناجحة\":1, \"عملية ناجحة\":1 };\r",
									"    pm.expect(allowedAr[d0] === 1 && allowedAr[d1] === 1, \"resDesc must be Arabic success in strict mode\").to.be.true;\r",
									"  } else {\r",
									"    var ok = (d0 === \"Successful Operation\" || /عملي[هة]\\s*ناجحة/.test(d0)) ||\r",
									"             (d1 === \"Successful Operation\" || /عملي[هة]\\s*ناجحة/.test(d1));\r",
									"    pm.expect(ok, \"resDesc should indicate success\").to.be.true;\r",
									"  }\r",
									"});\r",
									"\r",
									"// Extract first refNo into env var {{refNo}} (if exists)\r",
									"pm.test(\"Extract first refNo (if any) -> {{refNo}}\", function () {\r",
									"  var data = pm.response.json() || {};\r",
									"  var msg  = data.message || {};\r",
									"\r",
									"  function asArray(x){ return x == null ? [] : (Array.isArray(x) ? x : [x]); }\r",
									"\r",
									"  var recs = []\r",
									"    .concat(asArray(((msg.edefListResponse  || {}).edefRecord)))\r",
									"    .concat(asArray(((msg.eDefListResponse || {}).edefRecord)));\r",
									"\r",
									"  if (recs.length > 0) {\r",
									"    var first = recs[0] || {};\r",
									"    var ref = String(first.refNo || \"\").replace(/^\\s+|\\s+$/g, \"\");\r",
									"    if (ref) {\r",
									"      pm.environment.set(\"refNo\", ref);\r",
									"      // Optional: soft check for UUID (won't fail if not)\r",
									"      if (!/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/.test(ref)) {\r",
									"        console.warn(\"refNo is non-UUID format:\", ref);\r",
									"      }\r",
									"    } else {\r",
									"      pm.environment.unset(\"refNo\");\r",
									"      console.warn(\"First E-DEF record has no refNo.\");\r",
									"    }\r",
									"  } else {\r",
									"    pm.environment.unset(\"refNo\");\r",
									"    console.warn(\"No E-DEF records found; nothing to extract.\");\r",
									"  }\r",
									"});\r",
									"\r",
									"\r",
									"// -------- Extract records (support both node names) --------\r",
									"function asArray(x){ return x == null ? [] : (Array.isArray(x) ? x : [x]); }\r",
									"\r",
									"var msg  = (json.message || {});\r",
									"var recs = asArray((((msg.edefListResponse || {}).edefRecord)))\r",
									"         .concat(asArray((((msg.eDefListResponse || {}).edefRecord))));\r",
									"\r",
									"// Deduplicate by refNo (if present) else by id\r",
									"function getIdKey(r){\r",
									"  var ref = r && r.refNo ? String(r.refNo).replace(/^\\s+|\\s+$/g, \"\") : \"\";\r",
									"  if (ref) return \"ref:\" + ref;\r",
									"  var rid = r && (r.edefreqID || r.edefReqID) ? String(r.edefreqID || r.edefReqID) : \"\";\r",
									"  if (rid) return \"id:\" + rid;\r",
									"  return \"idx:\" + Math.random();\r",
									"}\r",
									"var seen = {}, records = [];\r",
									"for (var i=0;i<recs.length;i++){\r",
									"  var key = getIdKey(recs[i]);\r",
									"  if (!seen[key]) { seen[key] = true; records.push(recs[i]); }\r",
									"}\r",
									"\r",
									"// Array & minimum size\r",
									"var minCnt = Number(pm.environment.get(\"MIN_EDEF\") || pm.globals.get(\"MIN_EDEF\") || 0);\r",
									"pm.test(\"edefRecord is array (len >= MIN_EDEF)\", function () {\r",
									"  pm.expect(records).to.be.an(\"array\");\r",
									"  pm.expect(records.length).to.be.at.least(minCnt);\r",
									"});\r",
									"\r",
									"// -------- Helpers --------\r",
									"function trim(s){ return String(s == null ? \"\" : s).replace(/^\\s+|\\s+$/g,\"\"); }\r",
									"function isIntStr(v){ return typeof v === \"string\" && /^-?\\d+$/.test(v); }\r",
									"function isUuid(s){ return /^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/.test(String(s || \"\")); }\r",
									"function isDdMmYyyy(s){\r",
									"  s = String(s || \"\");\r",
									"  var m = s.match(/^(\\d{2})\\/(\\d{2})\\/(\\d{4})$/);\r",
									"  if (!m) return false;\r",
									"  var d = +m[1], M = +m[2], Y = +m[3];\r",
									"  if (M < 1 || M > 12) return false;\r",
									"  if (d < 1 || d > 31) return false;\r",
									"  if (Y < 1900 || Y > 2099) return false;\r",
									"  return true;\r",
									"}\r",
									"function isIPv4(s){\r",
									"  s = String(s || \"\");\r",
									"  var m = s.match(/^(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})$/);\r",
									"  if (!m) return false;\r",
									"  for (var k=1;k<=4;k++){ var n = +m[k]; if (n < 0 || n > 255) return false; }\r",
									"  return true;\r",
									"}\r",
									"function getFlag(name, defVal){\r",
									"  var v = pm.environment.get(name) || pm.globals.get(name);\r",
									"  v = (v == null ? \"\" : String(v)).toUpperCase();\r",
									"  if (v !== \"Y\" && v !== \"N\") return defVal;\r",
									"  return v;\r",
									"}\r",
									"\r",
									"// -------- Case 1: No requests --------\r",
									"pm.test(\"Case 1: No E_DEF requests (if applicable)\", function () {\r",
									"  if (records.length === 0) {\r",
									"    pm.expect(records.length).to.eql(0);\r",
									"  } else {\r",
									"    this.skip && this.skip();\r",
									"  }\r",
									"});\r",
									"\r",
									"// -------- Case 2: Has requests --------\r",
									"pm.test(\"Case 2: Has E_DEF requests (if applicable)\", function () {\r",
									"  if (records.length === 0) { this.skip && this.skip(); return; }\r",
									"\r",
									"  var requireMargin = getFlag(\"REQUIRE_TYPE_MARGIN\", \"N\") === \"Y\";\r",
									"  var assertNin     = getFlag(\"ASSERT_NIN\", \"N\") === \"Y\";\r",
									"  var strictRef     = getFlag(\"STRICT_REFNO_UUID\", \"N\") === \"Y\";\r",
									"  var envNin        = pm.environment.get(\"NIN\") || pm.globals.get(\"NIN\") || \"\";\r",
									"\r",
									"  var idSet = {}, refSet = {};\r",
									"  var dupIds = [], dupRefs = [];\r",
									"\r",
									"  for (var j=0;j<records.length;j++){\r",
									"    var r = records[j];\r",
									"    pm.expect(r, \"record @\" + j + \" is object\").to.be.an(\"object\");\r",
									"\r",
									"    // IDs (edefreqID/edefReqID)\r",
									"    var id1 = String(r.edefreqID || \"\");\r",
									"    var id2 = String(r.edefReqID || \"\");\r",
									"    pm.expect(id1 || id2, \"edefreqID/edefReqID must exist @\" + j).to.be.ok;\r",
									"    if (id1 && id2) pm.expect(id1, \"edefreqID equals edefReqID @\" + j).to.eql(id2);\r",
									"    var id = id1 || id2;\r",
									"    pm.expect(isIntStr(id), \"edefReqID integer string @\" + j).to.be.true;\r",
									"    pm.expect(Number(id), \"edefReqID > 0 @\" + j).to.be.above(0);\r",
									"    if (idSet[id]) dupIds.push(id); else idSet[id] = true;\r",
									"\r",
									"    // nin\r",
									"    if (r.hasOwnProperty(\"nin\")) {\r",
									"      pm.expect(trim(r.nin).length, \"nin non-empty @\" + j).to.be.greaterThan(0);\r",
									"      if (assertNin && envNin) pm.expect(String(r.nin), \"record.nin should match env NIN @\" + j).to.eql(String(envNin));\r",
									"    }\r",
									"\r",
									"    // refNo: non-empty; optionally strict UUID\r",
									"    var refNo = String(r.refNo || \"\").replace(/^\\s+|\\s+$/g, \"\");\r",
									"    pm.expect(refNo.length, \"refNo non-empty @\" + j).to.be.greaterThan(0);\r",
									"    if (strictRef) {\r",
									"      pm.expect(isUuid(refNo), \"refNo must be UUID @\" + j).to.be.true;\r",
									"    } else if (!isUuid(refNo)) {\r",
									"      console.warn(\"Non-UUID refNo @\" + j + \":\", refNo);\r",
									"    }\r",
									"    if (refNo) { if (refSet[refNo]) dupRefs.push(refNo); else refSet[refNo] = true; }\r",
									"\r",
									"    // type & desc\r",
									"    pm.expect(trim(r.type).length, \"type non-empty @\" + j).to.be.greaterThan(0);\r",
									"    if (requireMargin) pm.expect(String(r.type).toUpperCase(), \"type must be MARGIN @\" + j).to.eql(\"MARGIN\");\r",
									"    pm.expect(trim(r.typeDesc).length, \"typeDesc non-empty @\" + j).to.be.greaterThan(0);\r",
									"\r",
									"    // status & stateDesc\r",
									"    pm.expect(/^[A-Z]{2,4}$/.test(String(r.status || \"\")), \"status code upper alpha @\" + j).to.be.true;\r",
									"    pm.expect(trim(r.stateDesc).length, \"stateDesc non-empty @\" + j).to.be.greaterThan(0);\r",
									"\r",
									"    // dates & ip\r",
									"    pm.expect(isDdMmYyyy(r.entryDate), \"entryDate dd/MM/yyyy @\" + j).to.be.true;\r",
									"    pm.expect(isIPv4(r.ip), \"ip IPv4 @\" + j).to.be.true;\r",
									"\r",
									"    // hasContract (if present)\r",
									"    if (r.hasOwnProperty(\"hasContract\")) {\r",
									"      pm.expect([\"Y\",\"N\"], \"hasContract Y/N @\" + j).to.include(String(r.hasContract));\r",
									"    }\r",
									"  }\r",
									"\r",
									"  pm.expect(dupIds,  \"Duplicate edefReqID(s): \" + dupIds.join(\", \")).to.eql([]);\r",
									"  pm.expect(dupRefs, \"Duplicate refNo(s): \" + dupRefs.join(\", \")).to.eql([]);\r",
									"});\r",
									"\r",
									"// -------- Save env --------\r",
									"(function saveEnv(){\r",
									"  pm.environment.set(\"EDEF_COUNT\", String(records.length));\r",
									"  pm.environment.set(\"EDEF_HAS_ANY\", records.length > 0 ? \"Y\" : \"N\");\r",
									"\r",
									"  var ids = [], statusCounts = {};\r",
									"  for (var k=0;k<records.length;k++){\r",
									"    var r = records[k];\r",
									"    var id = String(r.edefreqID || r.edefReqID || \"\");\r",
									"    if (id) ids.push(id);\r",
									"    var st = String(r.status || \"\");\r",
									"    statusCounts[st] = (statusCounts[st] || 0) + 1;\r",
									"  }\r",
									"  pm.environment.set(\"EDEF_IDS\", JSON.stringify(ids));\r",
									"  pm.environment.set(\"EDEF_STATUS_COUNTS\", JSON.stringify(statusCounts));\r",
									"  if (records.length > 0) pm.environment.set(\"EDEF_FIRST_REFNO\", String(records[0].refNo || \"\"));\r",
									"  else pm.environment.unset(\"EDEF_FIRST_REFNO\");\r",
									"})();\r",
									"\r",
									"// -------- Minimal schema (tv4) --------\r",
									"pm.test(\"Schema (minimal) validates\", function () {\r",
									"  var schema = {\r",
									"    type: \"object\",\r",
									"    required: [\"responseStatus\",\"message\"],\r",
									"    properties: {\r",
									"      responseStatus: {\r",
									"        type: \"object\",\r",
									"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
									"        properties: {\r",
									"          resCode:  { \"const\": \"0\" },\r",
									"          source:   { \"const\": \"E_DEF_LIST_REQ\" },\r",
									"          resCode1: { \"const\": \"0\" }\r",
									"        }\r",
									"      },\r",
									"      message: {\r",
									"        type: \"object\",\r",
									"        properties: {\r",
									"          edefListResponse:  { type: \"object\", properties: { edefRecord: { type: \"array\" } } },\r",
									"          eDefListResponse:  { type: \"object\", properties: { edefRecord: { type: \"array\" } } }\r",
									"        }\r",
									"      }\r",
									"    }\r",
									"  };\r",
									"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
									"});\r",
									"\r",
									"// -------- Verify request Srv (optional) --------\r",
									"pm.test(\"Request Srv is E_DEF_LIST_REQ\", function(){\r",
									"  try {\r",
									"    var body = pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {};\r",
									"    pm.expect((body || {}).Srv).to.eql(\"E_DEF_LIST_REQ\");\r",
									"  } catch(e) { console.warn(\"Could not parse request body:\", e.message); }\r",
									"});\r",
									"\r",
									"// -------- Visualizer --------\r",
									"(function render(){\r",
									"  var template =\r",
									"    '<style>.t{font-family:system-ui,Segoe UI,Roboto,Arial;font-size:14px;color:#333;width:100%;border-collapse:collapse}' +\r",
									"    '.t th,.t td{border:1px solid #87ceeb;padding:6px;text-align:left}.t th{background:#87ceeb}.empty{color:#666;font-style:italic}</style>' +\r",
									"    '<h3>E-DEF List Requests — Count: {{count}}</h3>' +\r",
									"    '{{#has}}' +\r",
									"      '<table class=\"t\"><thead><tr><th>#</th><th>ID</th><th>NIN</th><th>Type</th><th>Status</th><th>Entry Date</th><th>Has Contract</th><th>RefNo</th></tr></thead><tbody>' +\r",
									"      '{{#rows}}<tr><td>{{i}}</td><td>{{id}}</td><td>{{nin}}</td><td>{{type}}</td><td>{{status}}</td><td>{{entryDate}}</td><td>{{hasContract}}</td><td>{{refNo}}</td></tr>{{/rows}}' +\r",
									"      '</tbody></table>' +\r",
									"    '{{/has}}' +\r",
									"    '{{^has}}<p class=\"empty\">No E-DEF list requests.</p>{{/has}}';\r",
									"\r",
									"  var rows = [], m;\r",
									"  for (m=0;m<records.length;m++){\r",
									"    var r = records[m] || {};\r",
									"    rows.push({\r",
									"      i: m+1,\r",
									"      id: String(r.edefreqID || r.edefReqID || \"\"),\r",
									"      nin: String(r.nin || \"\"),\r",
									"      type: String(r.type || \"\"),\r",
									"      status: String(r.status || \"\"),\r",
									"      entryDate: String(r.entryDate || \"\"),\r",
									"      hasContract: String(r.hasContract || \"\"),\r",
									"      refNo: String(r.refNo || \"\")\r",
									"    });\r",
									"  }\r",
									"\r",
									"  pm.visualizer.set(template, { count: records.length, has: records.length > 0, rows: rows });\r",
									"})();\r",
									"\r",
									"console.log(\"✅ E_DEF_LIST_REQ validated. count=\", pm.environment.get(\"EDEF_COUNT\"));\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"Srv\": \"E_DEF_LIST_REQ\",\r\n    \"Message\": {\r\n        \"EDefListRequest\": {\r\n            \"NIN\": \"{{NIN}}\",\r\n            \"Type\": \"MARGIN|UPDATE_MISSING_INFO\",\r\n            \"Status\": \"\",\r\n            \"EntryDateFrom\": \"\",\r\n            \"EntryDateTo\": \"\",\r\n            \"StatusDateFrom\": \"\",\r\n            \"StatusDateTo\": \"\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"05-10-2025\",\r\n    \"sessionId\": \"{{SessionID}}\",\r\n    \"Lang\": \"ARB\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{BaseURL}}{{Oracle19}}",
							"host": [
								"{{BaseURL}}{{Oracle19}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "3. GRP_EDOC download",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"/**\r",
									" * GRP_EDOC – Unified validation for:\r",
									" *  A) Missing reference number -> resCode=\"51\"\r",
									" *  B) Happy path -> resCode=\"0\" + populated edocsResponse/eDocsResponse\r",
									" *  C) Wrong reference number -> resCode=\"0\" + empty edocsResponse/eDocsResponse\r",
									" */\r",
									"\r",
									"pm.test(\"HTTP 200\", function(){ pm.response.to.have.status(200); });\r",
									"\r",
									"pm.test(\"Content-Type JSON\", function(){\r",
									"  pm.response.to.have.header(\"Content-Type\");\r",
									"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
									"});\r",
									"\r",
									"var json;\r",
									"pm.test(\"Body is JSON\", function(){\r",
									"  json = pm.response.json();\r",
									"  pm.expect(json).to.be.an(\"object\");\r",
									"});\r",
									"\r",
									"// ---------------- Helpers ----------------\r",
									"function trim(s){ return String(s == null ? \"\" : s).replace(/^\\s+|\\s+$/g, \"\"); }\r",
									"function isIntStr(v){ return typeof v === \"string\" && /^-?\\d+$/.test(v); }\r",
									"function isIPv4(s){\r",
									"  s = String(s || \"\");\r",
									"  var m = s.match(/^(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})$/);\r",
									"  if (!m) return false;\r",
									"  for (var i=1;i<=4;i++){ var n = +m[i]; if (n < 0 || n > 255) return false; }\r",
									"  return true;\r",
									"}\r",
									"function getFirst(obj, keys){\r",
									"  for (var i=0;i<keys.length;i++){\r",
									"    var k = keys[i];\r",
									"    if (obj && Object.prototype.hasOwnProperty.call(obj, k) && obj[k] != null) return obj[k];\r",
									"  }\r",
									"  return undefined;\r",
									"}\r",
									"function isEmptyObject(o){\r",
									"  if (!o || typeof o !== \"object\") return true;\r",
									"  return Object.keys(o).length === 0;\r",
									"}\r",
									"function asArray(x){ return x == null ? [] : (Array.isArray(x) ? x : [x]); }\r",
									"\r",
									"// Optional: capture request refNo we sent (if any) for traceability\r",
									"(function captureRequestRef(){\r",
									"  try {\r",
									"    var req = pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {};\r",
									"    // try common paths/names for reference number\r",
									"    function findRef(o){\r",
									"      if (!o || typeof o !== \"object\") return \"\";\r",
									"      for (var k in o){\r",
									"        if (!o.hasOwnProperty(k)) continue;\r",
									"        var v = o[k];\r",
									"        if (/^(refNo|referenceNo|reference|ref)$/i.test(k)) return String(v || \"\");\r",
									"        if (v && typeof v === \"object\") {\r",
									"          var got = findRef(v); if (got) return got;\r",
									"        }\r",
									"      }\r",
									"      return \"\";\r",
									"    }\r",
									"    var r = findRef(req);\r",
									"    if (r) pm.environment.set(\"EDOC_REQ_REFNO\", r); else pm.environment.unset(\"EDOC_REQ_REFNO\");\r",
									"  } catch(e){\r",
									"    console.warn(\"Could not parse request to capture refNo:\", e.message);\r",
									"    pm.environment.unset(\"EDOC_REQ_REFNO\");\r",
									"  }\r",
									"})();\r",
									"\r",
									"// ---------------- Envelope ----------------\r",
									"var rs = json.responseStatus || {};\r",
									"pm.test(\"Source is GRP_EDOC & resCode is expected (0 or 51)\", function(){\r",
									"  pm.expect(rs.source).to.eql(\"GRP_EDOC\");\r",
									"  pm.expect([\"0\",\"51\"]).to.include(String(rs.resCode));\r",
									"  pm.expect([\"0\",\"51\"]).to.include(String(rs.resCode1));\r",
									"});\r",
									"\r",
									"// Determine scenario\r",
									"var scenario = (rs.resCode === \"51\") ? \"MISSING_REF\" : \"SUCCESS\";\r",
									"\r",
									"// Node root (both case variants)\r",
									"var msg = json.message || {};\r",
									"var edocNode = getFirst(msg, [\"edocsResponse\",\"eDocsResponse\"]);\r",
									"\r",
									"// ---------------- Scenario A: Missing reference number ----------------\r",
									"pm.test(\"Scenario A – Missing reference number (if applicable)\", function(){\r",
									"  if (scenario !== \"MISSING_REF\") { this.skip && this.skip(); return; }\r",
									"\r",
									"  // Arabic message tolerance\r",
									"  var allowed = { \"البيانات المطلوبة ناقصة\":1 };\r",
									"  pm.expect(allowed[trim(rs.resDesc)] === 1, \"resDesc Arabic matches 'البيانات المطلوبة ناقصة'\").to.be.true;\r",
									"  pm.expect(allowed[trim(rs.resDesc1)] === 1, \"resDesc1 Arabic matches 'البيانات المطلوبة ناقصة'\").to.be.true;\r",
									"\r",
									"  // No business payload expected\r",
									"  pm.expect(edocNode == null || isEmptyObject(edocNode), \"No edocs payload when reference is missing\").to.be.true;\r",
									"\r",
									"  // Save flags\r",
									"  pm.environment.set(\"EDOC_SCENARIO\", \"MISSING_REF\");\r",
									"  pm.environment.set(\"EDOC_FOUND\", \"N\");\r",
									"});\r",
									"\r",
									"// ---------------- Scenario B/C: resCode=0 ----------------\r",
									"pm.test(\"Scenario B/C – resCode=0 success envelope (Arabic/English)\", function(){\r",
									"  if (scenario !== \"SUCCESS\") { this.skip && this.skip(); return; }\r",
									"  var d0 = trim(rs.resDesc), d1 = trim(rs.resDesc1);\r",
									"  var ok = (d0 === \"Successful Operation\" || /عملي[هة]\\s*ناجحة/.test(d0)) ||\r",
									"           (d1 === \"Successful Operation\" || /عملي[هة]\\s*ناجحة/.test(d1));\r",
									"  pm.expect(ok, \"resDesc indicates success\").to.be.true;\r",
									"});\r",
									"\r",
									"// Decide B vs C\r",
									"var hasPayload = (scenario === \"SUCCESS\") && edocNode && !isEmptyObject(edocNode);\r",
									"\r",
									"// ---------------- Scenario B: Happy path with payload ----------------\r",
									"pm.test(\"Scenario B – Happy path: edocs payload present & valid\", function(){\r",
									"  if (!hasPayload) { this.skip && this.skip(); return; }\r",
									"\r",
									"  // ext info (support variant keys)\r",
									"  var extInfo = getFirst(edocNode, [\"edocsExtaInfo\",\"eDocsExtaInfo\",\"edocsExtraInfo\",\"eDocsExtraInfo\"]);\r",
									"  pm.expect(extInfo, \"Extended info node exists\").to.be.an(\"object\");\r",
									"\r",
									"  // Client info (variant keys)\r",
									"  var clientInfo = getFirst(extInfo, [\"edocsClientInformation\",\"eDocsClientInformation\",\"clientInformation\"]);\r",
									"  pm.expect(clientInfo, \"Client info node exists\").to.be.an(\"object\");\r",
									"\r",
									"  // Client fields\r",
									"  [\"titleArb\",\"titleEng\",\"clientNameArb\",\"clientNameEng\"].forEach(function(k){\r",
									"    pm.expect(clientInfo, \"Missing client field: \" + k).to.have.property(k);\r",
									"    pm.expect(trim(clientInfo[k]).length, k+\" non-empty\").to.be.greaterThan(0);\r",
									"  });\r",
									"\r",
									"  // nin\r",
									"  pm.expect(extInfo).to.have.property(\"nin\");\r",
									"  pm.expect(trim(extInfo.nin).length, \"nin non-empty\").to.be.greaterThan(0);\r",
									"\r",
									"  // status & descriptions\r",
									"  pm.expect(extInfo).to.have.property(\"status\");\r",
									"  pm.expect(/^[A-Z]{2,4}$/.test(String(extInfo.status)), \"status code upper alpha\").to.be.true;\r",
									"\r",
									"  pm.expect(extInfo).to.have.property(\"statusDescArb\");\r",
									"  pm.expect(trim(extInfo.statusDescArb).length, \"statusDescArb\").to.be.greaterThan(0);\r",
									"\r",
									"  pm.expect(extInfo).to.have.property(\"statusDescEng\");\r",
									"  pm.expect(trim(extInfo.statusDescEng).length, \"statusDescEng\").to.be.greaterThan(0);\r",
									"\r",
									"  // ip\r",
									"  pm.expect(extInfo).to.have.property(\"ip\");\r",
									"  pm.expect(isIPv4(extInfo.ip), \"ip IPv4\").to.be.true;\r",
									"\r",
									"  // batchId (numeric string)\r",
									"  pm.expect(extInfo).to.have.property(\"batchId\");\r",
									"  pm.expect(isIntStr(String(extInfo.batchId)), \"batchId integer string\").to.be.true;\r",
									"  pm.expect(Number(extInfo.batchId), \"batchId > 0\").to.be.above(0);\r",
									"\r",
									"  // Save env vars\r",
									"  pm.environment.set(\"EDOC_SCENARIO\", \"HAPPY\");\r",
									"  pm.environment.set(\"EDOC_FOUND\", \"Y\");\r",
									"  pm.environment.set(\"EDOC_NIN\", String(extInfo.nin || \"\"));\r",
									"  pm.environment.set(\"EDOC_STATUS\", String(extInfo.status || \"\"));\r",
									"  pm.environment.set(\"EDOC_STATUS_AR\", String(extInfo.statusDescArb || \"\"));\r",
									"  pm.environment.set(\"EDOC_STATUS_EN\", String(extInfo.statusDescEng || \"\"));\r",
									"  pm.environment.set(\"EDOC_IP\", String(extInfo.ip || \"\"));\r",
									"  pm.environment.set(\"EDOC_BATCH_ID\", String(extInfo.batchId || \"\"));\r",
									"  pm.environment.set(\"EDOC_CLIENT_TITLE_AR\", String(clientInfo.titleArb || \"\"));\r",
									"  pm.environment.set(\"EDOC_CLIENT_TITLE_EN\", String(clientInfo.titleEng || \"\"));\r",
									"  pm.environment.set(\"EDOC_CLIENT_NAME_AR\", String(clientInfo.clientNameArb || \"\"));\r",
									"  pm.environment.set(\"EDOC_CLIENT_NAME_EN\", String(clientInfo.clientNameEng || \"\"));\r",
									"});\r",
									"\r",
									"// ---------------- Scenario C: resCode=0 but empty payload (wrong ref) ----------------\r",
									"pm.test(\"Scenario C – Wrong reference number: success envelope but empty payload\", function(){\r",
									"  if (scenario !== \"SUCCESS\" || hasPayload) { this.skip && this.skip(); return; }\r",
									"\r",
									"  // Either edocsResponse/eDocsResponse is absent or empty\r",
									"  pm.expect(edocNode == null || isEmptyObject(edocNode), \"Empty edocs payload for wrong ref\").to.be.true;\r",
									"\r",
									"  pm.environment.set(\"EDOC_SCENARIO\", \"WRONG_REF\");\r",
									"  pm.environment.set(\"EDOC_FOUND\", \"N\");\r",
									"  pm.environment.unset(\"EDOC_NIN\");\r",
									"  pm.environment.unset(\"EDOC_STATUS\");\r",
									"  pm.environment.unset(\"EDOC_STATUS_AR\");\r",
									"  pm.environment.unset(\"EDOC_STATUS_EN\");\r",
									"  pm.environment.unset(\"EDOC_IP\");\r",
									"  pm.environment.unset(\"EDOC_BATCH_ID\");\r",
									"  pm.environment.unset(\"EDOC_CLIENT_TITLE_AR\");\r",
									"  pm.environment.unset(\"EDOC_CLIENT_TITLE_EN\");\r",
									"  pm.environment.unset(\"EDOC_CLIENT_NAME_AR\");\r",
									"  pm.environment.unset(\"EDOC_CLIENT_NAME_EN\");\r",
									"});\r",
									"\r",
									"// ---------------- Minimal schema (tv4) ----------------\r",
									"pm.test(\"Schema (minimal) validates\", function(){\r",
									"  var schema = {\r",
									"    type: \"object\",\r",
									"    required: [\"responseStatus\"],\r",
									"    properties: {\r",
									"      responseStatus: {\r",
									"        type: \"object\",\r",
									"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
									"        properties: {\r",
									"          source: { \"const\": \"GRP_EDOC\" },\r",
									"          resCode: { \"enum\": [\"0\",\"51\"] },\r",
									"          resCode1:{ \"enum\": [\"0\",\"51\"] }\r",
									"        }\r",
									"      },\r",
									"      message: { type: \"object\" }\r",
									"    }\r",
									"  };\r",
									"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
									"});\r",
									"\r",
									"// ---------------- Optional: verify request Srv ----------------\r",
									"pm.test(\"Request Srv is GRP_EDOC\", function(){\r",
									"  try {\r",
									"    var body = pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {};\r",
									"    pm.expect((body || {}).Srv).to.eql(\"GRP_EDOC\");\r",
									"  } catch(e) { console.warn(\"Could not parse request body:\", e.message); }\r",
									"});\r",
									"\r",
									"// ---------------- Visualizer (compact) ----------------\r",
									"(function render(){\r",
									"  var template =\r",
									"    '<style>.t{font-family:system-ui,Segoe UI,Roboto,Arial;font-size:14px;color:#333;width:100%;border-collapse:collapse}' +\r",
									"    '.t th,.t td{border:1px solid #87ceeb;padding:6px;text-align:left}.t th{background:#87ceeb}.v{color:#0a8f08}.x{color:#b00020}</style>' +\r",
									"    '<h3>GRP_EDOC – Scenario: {{scenario}}</h3>' +\r",
									"    '<table class=\"t\"><tbody>' +\r",
									"    '<tr><th>refNo (request)</th><td>{{reqRef}}</td></tr>' +\r",
									"    '<tr><th>Found</th><td class=\"{{foundCls}}\">{{found}}</td></tr>' +\r",
									"    '<tr><th>NIN</th><td>{{nin}}</td></tr>' +\r",
									"    '<tr><th>Status</th><td>{{status}} / {{statusAr}} / {{statusEn}}</td></tr>' +\r",
									"    '<tr><th>Batch ID</th><td>{{batchId}}</td></tr>' +\r",
									"    '<tr><th>IP</th><td>{{ip}}</td></tr>' +\r",
									"    '<tr><th>Client</th><td>{{titleAr}} {{nameAr}} | {{titleEn}} {{nameEn}}</td></tr>' +\r",
									"    '</tbody></table>';\r",
									"\r",
									"  pm.visualizer.set(template, {\r",
									"    scenario: pm.environment.get(\"EDOC_SCENARIO\") || \"\",\r",
									"    reqRef: pm.environment.get(\"EDOC_REQ_REFNO\") || \"\",\r",
									"    found: (pm.environment.get(\"EDOC_FOUND\") || \"\") === \"Y\" ? \"Yes\" : \"No\",\r",
									"    foundCls: (pm.environment.get(\"EDOC_FOUND\") || \"\") === \"Y\" ? \"v\" : \"x\",\r",
									"    nin: pm.environment.get(\"EDOC_NIN\") || \"\",\r",
									"    status: pm.environment.get(\"EDOC_STATUS\") || \"\",\r",
									"    statusAr: pm.environment.get(\"EDOC_STATUS_AR\") || \"\",\r",
									"    statusEn: pm.environment.get(\"EDOC_STATUS_EN\") || \"\",\r",
									"    batchId: pm.environment.get(\"EDOC_BATCH_ID\") || \"\",\r",
									"    ip: pm.environment.get(\"EDOC_IP\") || \"\",\r",
									"    titleAr: pm.environment.get(\"EDOC_CLIENT_TITLE_AR\") || \"\",\r",
									"    titleEn: pm.environment.get(\"EDOC_CLIENT_TITLE_EN\") || \"\",\r",
									"    nameAr: pm.environment.get(\"EDOC_CLIENT_NAME_AR\") || \"\",\r",
									"    nameEn: pm.environment.get(\"EDOC_CLIENT_NAME_EN\") || \"\"\r",
									"  });\r",
									"})();\r",
									"\r",
									"console.log(\"✅ GRP_EDOC validated. scenario=\", pm.environment.get(\"EDOC_SCENARIO\"),\r",
									"            \"found=\", pm.environment.get(\"EDOC_FOUND\"),\r",
									"            \"reqRef=\", pm.environment.get(\"EDOC_REQ_REFNO\"));\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"Srv\": \"GRP_EDOC\",\r\n    \"Message\": {\r\n        \"EDocsRequest\": {\r\n            \"RefNo\": \"{{refNo}}\",\r\n            \"RequestSource\": \"CONTRACT\",\r\n            \"NIN\": \"{{NIN}}\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"05-10-2025\",\r\n    \"sessionId\": \"{{SessionID}}\",\r\n    \"Lang\": \"ARB\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{BaseURL}}{{Oracle19}}",
							"host": [
								"{{BaseURL}}{{Oracle19}}"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "18. E_DEF Add request",
			"item": [
				{
					"name": "1. Login - E_DEF Add request",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Check if the status code is 200\r",
									"pm.test(\"Status code is 200\", function () {\r",
									"    pm.response.to.have.status(200);\r",
									"});\r",
									"\r",
									"// Check if response code is 0\r",
									"pm.test(\"Response code is 0\", function () {\r",
									"    var jsonData = pm.response.json(); // Parse JSON response\r",
									"    pm.expect(jsonData.responseStatus.resCode).to.equal(\"0\");\r",
									"});\r",
									"\r",
									"// Check if response description is \"Successful Operation\"\r",
									"pm.test(\"Response description is 'Successful Operation'\", function () {\r",
									"    var jsonData = pm.response.json();\r",
									"    pm.expect(jsonData.responseStatus.resDesc).to.equal(\"Successful Operation\");\r",
									"});\r",
									"\r",
									"// Check if login is successful and capture NIN\r",
									"pm.test(\"Login successful and NIN captured\", function () {\r",
									"    var jsonData = pm.response.json();\r",
									"    var accounts = jsonData.message.logResponse.accounts.account;\r",
									"\r",
									"    if (accounts.length > 0) {\r",
									"        var nin = accounts[0].nin; // Extract NIN\r",
									"        pm.expect(nin).to.not.be.undefined; // Ensure it's not empty\r",
									"\r",
									"        // Store in environment variables\r",
									"        pm.environment.set(\"NIN\", nin);\r",
									"        pm.environment.set(\"UserID\", nin); // Store the same value in UserID\r",
									"\r",
									"        console.log(\"Captured NIN/UserID:\", nin);\r",
									"    } else {\r",
									"        pm.expect.fail(\"NIN not found in the response.\");\r",
									"    }\r",
									"});\r",
									"\r",
									"// Check if login is successful and SessionID is created\r",
									"pm.test(\"Login successful and SessionID created\", function () {\r",
									"    var jsonData = pm.response.json();\r",
									"    var sessionID = jsonData.message.logResponse.sessionID;\r",
									"\r",
									"    pm.expect(sessionID).to.not.be.undefined; // Assert SessionID exists\r",
									"});\r",
									"\r",
									"// Verify Content-Type header is 'application/json'\r",
									"pm.test(\"Content-Type header is 'application/json'\", function () {\r",
									"    pm.expect(pm.response.headers.get(\"Content-Type\")).to.include(\"application/json\");\r",
									"});\r",
									"\r",
									"// Check if login is successful and capture SessionID\r",
									"pm.test(\"Login successful and SessionID captured\", function () {\r",
									"    var jsonData = pm.response.json();\r",
									"    var sessionID = jsonData.message.logResponse.sessionID;\r",
									"\r",
									"    pm.expect(sessionID).to.not.be.undefined; // Assert SessionID exists\r",
									"    pm.environment.set(\"SessionID\", sessionID); // Save SessionID to environment\r",
									"});\r",
									"\r",
									"// Parse the response JSON\r",
									"var jsonData = pm.response.json();\r",
									"\r",
									"// Verify that the response contains the expected roles\r",
									"pm.test(\"Verify roles in response\", function () {\r",
									"    var roles = jsonData.message.logResponse.roles.role;\r",
									"\r",
									"    // Define expected roles\r",
									"    var expectedRoles = [\"UPDATE_ORDER\", \"SAVE_ORDER\", \"REPORTS\", \"CANCEL_ORDER\"];\r",
									"\r",
									"    // Ensure roles exist in the response\r",
									"    pm.expect(roles).to.be.an(\"array\").that.is.not.empty;\r",
									"\r",
									"    // Check that all expected roles exist in the response\r",
									"    expectedRoles.forEach(role => {\r",
									"        pm.expect(roles).to.include(role, `Missing role: ${role}`);\r",
									"    });\r",
									"\r",
									"    console.log(\"✅ Roles verified successfully:\", roles);\r",
									"});\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Get current timestamp in ISO format\r",
									"var timestamp = new Date().toISOString();\r",
									"\r",
									"// Store timestamp in Postman environment\r",
									"pm.environment.set(\"currentTimestamp\", timestamp);\r",
									"\r",
									"// Log the timestamp\r",
									"console.log(\"Timestamp Set:\", timestamp);\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"Srv\": \"Login\",\r\n    \"Message\": {\r\n        \"Login\": {\r\n            \"UserName\": \"13540910\",\r\n            \"Password\": \"{{Password}}\",\r\n            \"Lang\": \"ARB\"\r\n        }\r\n    },\r\n    \"Version\": \"1.0\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"08-07-2015\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{BaseURL}}{{Oracle19}}",
							"host": [
								"{{BaseURL}}{{Oracle19}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "2. E_DEF ADD Request",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"/**\r",
									" * E_DEF_ADD_REQ – Add E-DEF request (Unified)\r",
									" * Scenarios:\r",
									" *  - Eligible: resCode=\"0\" -> message.(edefAddResponse|eDefAddResponse).refNo\r",
									" *  - Already have request: resCode=\"602\" -> Arabic message, no refNo\r",
									" *\r",
									" * Saves:\r",
									" *  refNo (only when eligible), EDEF_ADD_SCENARIO (ELIGIBLE|ALREADY),\r",
									" *  EDEF_ADD_DESC\r",
									" *\r",
									" * Optional (Env/Globals):\r",
									" *  - STRICT_REFNO_UUID = Y|N (default N) -> enforce UUID format for refNo\r",
									" */\r",
									"\r",
									"pm.test(\"HTTP 200\", function () { pm.response.to.have.status(200); });\r",
									"pm.test(\"Content-Type JSON\", function(){\r",
									"  pm.response.to.have.header(\"Content-Type\");\r",
									"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
									"});\r",
									"\r",
									"// Parse\r",
									"var json;\r",
									"pm.test(\"Body is JSON\", function(){\r",
									"  json = pm.response.json();\r",
									"  pm.expect(json).to.be.an(\"object\");\r",
									"});\r",
									"\r",
									"// Helpers\r",
									"function trim(s){ return String(s == null ? \"\" : s).replace(/^\\s+|\\s+$/g,\"\"); }\r",
									"function getFlag(name, defVal){\r",
									"  var v = pm.environment.get(name) || pm.globals.get(name);\r",
									"  v = (v == null ? \"\" : String(v)).toUpperCase();\r",
									"  if (v !== \"Y\" && v !== \"N\") return defVal;\r",
									"  return v;\r",
									"}\r",
									"function isUuid(s){ return /^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/.test(String(s || \"\")); }\r",
									"\r",
									"// Envelope\r",
									"var rs = json.responseStatus || {};\r",
									"pm.test(\"Source is E_DEF_ADD_REQ & resCode is expected (0 or 602)\", function(){\r",
									"  pm.expect(rs.source).to.eql(\"E_DEF_ADD_REQ\");\r",
									"  pm.expect([\"0\",\"602\"]).to.include(String(rs.resCode));\r",
									"  pm.expect([\"0\",\"602\"]).to.include(String(rs.resCode1));\r",
									"});\r",
									"\r",
									"// Nodes (both name variants supported)\r",
									"var msg = json.message || {};\r",
									"var nodeLower = (msg.edefAddResponse || {});\r",
									"var nodeCamel = (msg.eDefAddResponse || {});\r",
									"\r",
									"// Scenario branching\r",
									"var scenario = (rs.resCode === \"0\") ? \"ELIGIBLE\" : \"ALREADY\";\r",
									"\r",
									"// --- Eligible path ---\r",
									"pm.test(\"Eligible to add request (if applicable)\", function(){\r",
									"  if (scenario !== \"ELIGIBLE\") { this.skip && this.skip(); return; }\r",
									"\r",
									"  // Must have refNo in at least one node\r",
									"  pm.expect(nodeLower || nodeCamel).to.be.an(\"object\");\r",
									"\r",
									"  var ref = trim((nodeLower.refNo || nodeCamel.refNo || \"\"));\r",
									"  pm.expect(ref.length, \"refNo non-empty\").to.be.greaterThan(0);\r",
									"\r",
									"  // Optional strict UUID\r",
									"  var strict = getFlag(\"STRICT_REFNO_UUID\",\"N\") === \"Y\";\r",
									"  if (strict) {\r",
									"    pm.expect(isUuid(ref), \"refNo must be UUID\").to.be.true;\r",
									"  } else if (!isUuid(ref)) {\r",
									"    console.warn(\"refNo is non-UUID format:\", ref);\r",
									"  }\r",
									"\r",
									"  // Save env\r",
									"  pm.environment.set(\"refNo\", ref);\r",
									"  pm.environment.set(\"EDEF_ADD_SCENARIO\", \"ELIGIBLE\");\r",
									"  pm.environment.set(\"EDEF_ADD_DESC\", trim(rs.resDesc || rs.resDesc1 || \"\"));\r",
									"});\r",
									"\r",
									"// --- Already have request path ---\r",
									"pm.test(\"Already have active E-DEF request (if applicable)\", function(){\r",
									"  if (scenario !== \"ALREADY\") { this.skip && this.skip(); return; }\r",
									"\r",
									"  // Arabic message tolerant to spacing\r",
									"  var d0 = trim(rs.resDesc), d1 = trim(rs.resDesc1);\r",
									"  var ok = /لديك\\s*طلب\\s*تفعيل\\s*حساب\\s*تداول\\s*بالهامش\\s*قيد\\s*التفعيل/.test(d0) &&\r",
									"           /لديك\\s*طلب\\s*تفعيل\\s*حساب\\s*تداول\\s*بالهامش\\s*قيد\\s*التفعيل/.test(d1);\r",
									"  pm.expect(ok, \"Arabic 'already have request' message\").to.be.true;\r",
									"\r",
									"  // No refNo should be provided in this case\r",
									"  var refLower = trim(String(nodeLower.refNo || \"\"));\r",
									"  var refCamel = trim(String(nodeCamel.refNo || \"\"));\r",
									"  pm.expect(refLower.length + refCamel.length, \"refNo should be absent on 'already'\").to.eql(0);\r",
									"\r",
									"  // Clear refNo to avoid stale values\r",
									"  pm.environment.unset(\"refNo\");\r",
									"  pm.environment.set(\"EDEF_ADD_SCENARIO\", \"ALREADY\");\r",
									"  pm.environment.set(\"EDEF_ADD_DESC\", d0 || d1);\r",
									"});\r",
									"\r",
									"// Minimal schema\r",
									"pm.test(\"Schema (minimal) validates\", function(){\r",
									"  var schema = {\r",
									"    type: \"object\",\r",
									"    required: [\"responseStatus\"],\r",
									"    properties: {\r",
									"      responseStatus: {\r",
									"        type: \"object\",\r",
									"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
									"        properties: {\r",
									"          source: { \"const\": \"E_DEF_ADD_REQ\" },\r",
									"          resCode: { \"enum\": [\"0\",\"602\"] },\r",
									"          resCode1:{ \"enum\": [\"0\",\"602\"] }\r",
									"        }\r",
									"      },\r",
									"      message: { type: \"object\" }\r",
									"    }\r",
									"  };\r",
									"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
									"});\r",
									"\r",
									"// Optional: verify request Srv\r",
									"pm.test(\"Request Srv is E_DEF_ADD_REQ\", function(){\r",
									"  try {\r",
									"    var body = pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {};\r",
									"    pm.expect((body || {}).Srv).to.eql(\"E_DEF_ADD_REQ\");\r",
									"  } catch(e) { console.warn(\"Could not parse request body:\", e.message); }\r",
									"});\r",
									"\r",
									"console.log(\"✅ E_DEF_ADD_REQ\", \"scenario=\", scenario, \"refNo=\", pm.environment.get(\"refNo\") || \"(none)\");\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "/* Steps: \r\n1. Login with 13540910 \r\n2. Check DB for nin 13540910 (Select * from Fund_Clients_Mirror FC where fc.cl_id= '13540910')\r\n3. If there is a record, delete it then call the API \r\n*/\r\n\r\n{\r\n    \"Srv\": \"E_DEF_ADD_REQ\",\r\n    \"Message\": {\r\n        \"EDefAddRequest\": {\r\n            \"NIN\": \"13540910\",\r\n            \"RefNo\": \"\",\r\n            \"Type\": \"MARGIN\",\r\n            \"ClientUserIP\": \"{{ClientAltIP}}\",\r\n            \"Qid\": \"\",\r\n            \"NameAr\": \"\",\r\n            \"NameEn\": \"\",\r\n            \"Title\": \"\",\r\n            \"SonNin\": \"\",\r\n            \"Birthdate\": \"\",\r\n            \"Nationality\": \"\",\r\n            \"Address\": \"\",\r\n            \"AddressCountriesId\": \"\",\r\n            \"AddressCity\": \"\",\r\n            \"MarketKnowledge\": \"\",\r\n            \"InvestmentObjective\": \"\",\r\n            \"MarginAmountType\": \"\",\r\n            \"MarginDoActive\": \"\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"05-10-2025\",\r\n    \"sessionId\": \"{{SessionID}}\",\r\n    \"Lang\": \"ARB\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{BaseURL}}{{Oracle19}}",
							"host": [
								"{{BaseURL}}{{Oracle19}}"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "19. Trading - Normal Orders",
			"item": [
				{
					"name": "Normal Orders",
					"item": [
						{
							"name": "Login",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"// Check if the status code is 200\r",
											"pm.test(\"Status code is 200\", function () {\r",
											"    pm.response.to.have.status(200);\r",
											"});\r",
											"\r",
											"// Check if response code is 0\r",
											"pm.test(\"Response code is 0\", function () {\r",
											"    var jsonData = pm.response.json(); // Parse JSON response\r",
											"    pm.expect(jsonData.responseStatus.resCode).to.equal(\"0\");\r",
											"});\r",
											"\r",
											"// Check if response description is \"Successful Operation\"\r",
											"pm.test(\"Response description is 'Successful Operation'\", function () {\r",
											"    var jsonData = pm.response.json();\r",
											"    pm.expect(jsonData.responseStatus.resDesc).to.equal(\"Successful Operation\");\r",
											"});\r",
											"\r",
											"// Check if login is successful and capture NIN\r",
											"pm.test(\"Login successful and NIN captured\", function () {\r",
											"    var jsonData = pm.response.json();\r",
											"    var accounts = jsonData.message.logResponse.accounts.account;\r",
											"\r",
											"    if (accounts.length > 0) {\r",
											"        var nin = accounts[0].nin; // Extract NIN\r",
											"        pm.expect(nin).to.not.be.undefined; // Ensure it's not empty\r",
											"\r",
											"        // Store in environment variables\r",
											"        pm.environment.set(\"NIN\", nin);\r",
											"        pm.environment.set(\"UserID\", nin); // Store the same value in UserID\r",
											"\r",
											"        console.log(\"Captured NIN/UserID:\", nin);\r",
											"    } else {\r",
											"        pm.expect.fail(\"NIN not found in the response.\");\r",
											"    }\r",
											"});\r",
											"\r",
											"// Check if login is successful and SessionID is created\r",
											"pm.test(\"Login successful and SessionID created\", function () {\r",
											"    var jsonData = pm.response.json();\r",
											"    var sessionID = jsonData.message.logResponse.sessionID;\r",
											"\r",
											"    pm.expect(sessionID).to.not.be.undefined; // Assert SessionID exists\r",
											"});\r",
											"\r",
											"// Verify Content-Type header is 'application/json'\r",
											"pm.test(\"Content-Type header is 'application/json'\", function () {\r",
											"    pm.expect(pm.response.headers.get(\"Content-Type\")).to.include(\"application/json\");\r",
											"});\r",
											"\r",
											"// Check if login is successful and capture SessionID\r",
											"pm.test(\"Login successful and SessionID captured\", function () {\r",
											"    var jsonData = pm.response.json();\r",
											"    var sessionID = jsonData.message.logResponse.sessionID;\r",
											"\r",
											"    pm.expect(sessionID).to.not.be.undefined; // Assert SessionID exists\r",
											"    pm.environment.set(\"SessionID\", sessionID); // Save SessionID to environment\r",
											"});\r",
											"\r",
											"// Parse the response JSON\r",
											"var jsonData = pm.response.json();\r",
											"\r",
											"// Verify that the response contains the expected roles\r",
											"pm.test(\"Verify roles in response\", function () {\r",
											"    var roles = jsonData.message.logResponse.roles.role;\r",
											"\r",
											"    // Define expected roles\r",
											"    var expectedRoles = [\"UPDATE_ORDER\", \"SAVE_ORDER\", \"REPORTS\", \"CANCEL_ORDER\"];\r",
											"\r",
											"    // Ensure roles exist in the response\r",
											"    pm.expect(roles).to.be.an(\"array\").that.is.not.empty;\r",
											"\r",
											"    // Check that all expected roles exist in the response\r",
											"    expectedRoles.forEach(role => {\r",
											"        pm.expect(roles).to.include(role, `Missing role: ${role}`);\r",
											"    });\r",
											"\r",
											"    console.log(\"✅ Roles verified successfully:\", roles);\r",
											"});\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// Get current timestamp in ISO format\r",
											"var timestamp = new Date().toISOString();\r",
											"\r",
											"// Store timestamp in Postman environment\r",
											"pm.environment.set(\"currentTimestamp\", timestamp);\r",
											"\r",
											"// Log the timestamp\r",
											"console.log(\"Timestamp Set:\", timestamp);\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "noauth"
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Accept",
										"value": "application/json",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\r\n    \"Srv\": \"Login\",\r\n    \"Message\": {\r\n        \"Login\": {\r\n            \"UserName\": \"80509\",\r\n            \"Password\": \"{{Password}}\",\r\n            \"Lang\": \"ARB\"\r\n        }\r\n    },\r\n    \"Version\": \"1.0\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"10-08-2015\"\r\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{BaseURL}}{{Oracle19}}",
									"host": [
										"{{BaseURL}}{{Oracle19}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "Save Normal Order",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"// ✅ 1. Check status code\r",
											"pm.test(\"Status code is 200\", function () {\r",
											"    pm.response.to.have.status(200);\r",
											"});\r",
											"\r",
											"// ✅ 2. Parse JSON once for reuse\r",
											"const jsonData = pm.response.json();\r",
											"\r",
											"// ✅ 3. Check for resCode 0 (success) OR handle resCode 15 (price error)\r",
											"pm.test(\"Validate response status based on resCode\", function () {\r",
											"    const resCode = jsonData.responseStatus.resCode;\r",
											"    const resDesc = jsonData.responseStatus.resDesc;\r",
											"\r",
											"    if (resCode === \"0\") {\r",
											"        pm.expect(resDesc).to.eql(\"Successful Operation\");\r",
											"    } else if (resCode === \"15\" && resDesc === \"خطأ في السعر\") {\r",
											"        console.warn(\"Price error detected: resCode 15 - خطأ في السعر\");\r",
											"        pm.expect(resCode).to.eql(\"15\"); // Passes with correct error code\r",
											"    } else {\r",
											"        console.warn(\"Unexpected resCode:\", resCode, \"-\", resDesc);\r",
											"        pm.expect.fail(`Unhandled resCode: ${resCode} - ${resDesc}`);\r",
											"    }\r",
											"});\r",
											"\r",
											"// ✅ 4. Check nested response code if available\r",
											"pm.test(\"Check nested resCode1\", function () {\r",
											"    const resCode1 = jsonData.responseStatus.resCode1;\r",
											"    const resDesc1 = jsonData.responseStatus.resDesc1;\r",
											"\r",
											"    if (resCode1 === \"0\") {\r",
											"        pm.expect(resDesc1).to.eql(\"Successful Operation\");\r",
											"    } else if (resCode1 === \"15\" && resDesc1 === \"خطأ في السعر\") {\r",
											"        console.warn(\"Nested price error: resCode1 15 - خطأ في السعر\");\r",
											"        pm.expect(resCode1).to.eql(\"15\");\r",
											"    } else {\r",
											"        console.warn(\"Unhandled nested resCode1:\", resCode1, \"-\", resDesc1);\r",
											"    }\r",
											"});\r",
											"\r",
											"// ✅ 5. Capture `sym` from request body and save to environment\r",
											"pm.test(\"Capture sym from request and save to environment\", function () {\r",
											"    const requestBody = JSON.parse(pm.request.body.raw);\r",
											"    const sym = requestBody.Message.SaveOrdRequest.sym;\r",
											"\r",
											"    pm.expect(sym).to.not.be.undefined;\r",
											"    pm.environment.set(\"Symbol\", sym);\r",
											"    console.log(\"Captured sym:\", sym);\r",
											"});\r",
											"\r",
											"// ✅ 6. Capture NewSLNO if order is successful\r",
											"pm.test(\"Capture NewSLNO if available\", function () {\r",
											"    if (jsonData.message && jsonData.message.saveOrdResponse) {\r",
											"        const newSLNO = jsonData.message.saveOrdResponse.newSLNO;\r",
											"\r",
											"        if (newSLNO) {\r",
											"            pm.environment.set(\"NewSLNO\", newSLNO);\r",
											"            console.log(\"Captured NewSLNO:\", newSLNO);\r",
											"            pm.expect(newSLNO).to.not.be.undefined;\r",
											"        } else {\r",
											"            console.warn(\"NewSLNO is missing in response.\");\r",
											"        }\r",
											"    } else {\r",
											"        console.warn(\"saveOrdResponse not found, likely due to error response.\");\r",
											"    }\r",
											"});\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Accept",
										"value": "application/json",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\r\n    \"Srv\": \"SAVE_ORDER\",\r\n    \"Message\": {\r\n        \"SaveOrdRequest\": {\r\n            \"ordType\": \"BUY\",\r\n            \"nin\": \"{{NIN}}\",\r\n            \"sym\": \"QNNS\",\r\n            \"shrsNo\": \"100\",\r\n            \"shrPrc\": \"10\",\r\n            \"mkPrc\": \"N\",\r\n            \"mPay_type\": \"KB\",\r\n            \"ordVald\": \"1\",\r\n            \"expirationDateTime\": \"\",\r\n            \"usrId\": \"{{UserID}}\",\r\n            \"userType\": \"INVESTOR\",\r\n            \"investorType\": \"INVESTOR\",\r\n            \"lang\": \"ARB\",\r\n            \"orderSource\": \"WEB_ORDERS.25\",\r\n            \"stopPrice\": \"\",\r\n            \"fixType\": \"2\",\r\n            \"discloseVolume\": \"0\",\r\n            \"clientAltIP\": \"{{ClientAltIP}}\",\r\n            \"clientUserIP\": \"10.80.81.158\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"10-08-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{BaseURL}}{{Oracle19}}",
									"host": [
										"{{BaseURL}}{{Oracle19}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "Update Normal Order",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"// ✅ 1. Check status code\r",
											"pm.test(\"Status code is 200\", function () {\r",
											"    pm.response.to.have.status(200);\r",
											"});\r",
											"\r",
											"// ✅ 2. Handle different UPDATE_ORDER resCode scenarios\r",
											"pm.test(\"Handle UPDATE_ORDER response codes correctly\", function () {\r",
											"    const jsonData = pm.response.json();\r",
											"    const resCode = jsonData.responseStatus.resCode;\r",
											"    const resDesc = jsonData.responseStatus.resDesc;\r",
											"\r",
											"    if (resCode === \"0\") {\r",
											"        pm.expect(resDesc).to.eql(\"Successful Operation\");\r",
											"        pm.expect(jsonData.message.updateOrderResponse.done).to.eql(\"OK\");\r",
											"        console.log(\"✅ Order updated successfully.\");\r",
											"    } else if (resCode === \"15\") {\r",
											"        pm.expect(resDesc).to.eql(\"خطأ في السعر\");\r",
											"        console.log(\"⚠️ Price error during update: resCode 15.\");\r",
											"    } else {\r",
											"        console.warn(\"⚠️ Unexpected resCode:\", resCode, \"-\", resDesc);\r",
											"        pm.test.skip(\"Skipping assertion for unexpected resCode: \" + resCode);\r",
											"    }\r",
											"});\r",
											"\r",
											"\r",
											"// ✅ 3. Capture `sym` from request and save to environment\r",
											"pm.test(\"Capture sym from request and save to environment\", function () {\r",
											"    const requestBody = JSON.parse(pm.request.body.raw);\r",
											"    const sym = requestBody.Message.UpdateOrderRequest.sym;\r",
											"\r",
											"    pm.expect(sym).to.not.be.undefined;\r",
											"    pm.environment.set(\"Symbol\", sym);\r",
											"    console.log(\"Captured sym (symbol):\", sym);\r",
											"});\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "noauth"
								},
								"method": "POST",
								"header": [
									{
										"key": "Accept",
										"value": "application/json",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\r\n    \"Srv\": \"UPDATE_ORDER\",\r\n    \"Message\": {\r\n        \"UpdateOrderRequest\": {\r\n            \"sLNO\": \"{{NewSLNO}}\",\r\n            \"ordType\": \"BUY\",\r\n            \"nin\": \"{{NIN}}\",\r\n            \"sym\": \"{{Symbol}}\",\r\n            \"shrsNo\": \"550\",\r\n            \"shrPrc\": \"10.00\",\r\n            \"mkPrc\": \"N\",\r\n            \"ordVald\": \"\",\r\n            \"expirationDateTime\":\"\",\r\n            \"userId\": \"{{UserID}}\",\r\n            \"userType\": \"INVESTOR\",\r\n            \"inv_Type\": \"INVESTOR\",\r\n            \"lang\": \"ARB\",\r\n            \"stopPrice\": \"\",\r\n            \"fixType\": \"2\",\r\n            \"discloseVolume\": \"100\",\r\n            \"clientAltIP\": \"{{ClientAltIP}}\",\r\n            \"clientUserIP\": \"10.80.81.158\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"10-08-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{BaseURL}}{{Oracle19}}",
									"host": [
										"{{BaseURL}}{{Oracle19}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "Cancel Normal Order",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"// ✅ 1. Check status code\r",
											"pm.test(\"Status code is 200\", function () {\r",
											"    pm.response.to.have.status(200);\r",
											"});\r",
											"\r",
											"// ✅ 2. Handle different resCode scenarios\r",
											"pm.test(\"Handle CANCEL_ORDER response codes correctly\", function () {\r",
											"    const jsonData = pm.response.json();\r",
											"    const resCode = jsonData.responseStatus.resCode;\r",
											"    const resDesc = jsonData.responseStatus.resDesc;\r",
											"\r",
											"    if (resCode === \"0\") {\r",
											"        pm.expect(resDesc).to.eql(\"Successful Operation\");\r",
											"        pm.expect(jsonData.message.canOrderResponse.done).to.eql(\"OK\");\r",
											"        console.log(\"✅ Order cancelled successfully.\");\r",
											"    } else if (resCode === \"17\") {\r",
											"        pm.expect(resDesc).to.eql(\"غير مسموح بالعمليه\");\r",
											"        console.log(\"⚠️ Order already cancelled or not allowed: resCode 17.\");\r",
											"    } else {\r",
											"        console.warn(\"⚠️ Unexpected resCode:\", resCode, \"-\", resDesc);\r",
											"        // Optionally, mark test as pending without failing:\r",
											"        pm.test.skip(\"Skipping assertion for unexpected resCode: \" + resCode);\r",
											"    }\r",
											"});\r",
											"\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Accept",
										"value": "application/json",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\r\n    \"Srv\": \"CANCEL_ORDER\",\r\n    \"Message\": {\r\n        \"CanOrderRequest\": {\r\n            \"nin\": \"{{NIN}}\",\r\n            \"slno\": \"{{NewSLNO}}\",\r\n            \"userId\": \"{{UserID}}\",\r\n            \"userType\": \"INVESTOR\",\r\n            \"lang\": \"ARB\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"10-08-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{BaseURL}}{{Oracle19}}",
									"host": [
										"{{BaseURL}}{{Oracle19}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "Get Order",
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "Accept",
										"value": "application/json",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\r\n    \"Srv\": \"GETORDERS\",\r\n    \"Message\": {\r\n        \"GetOrderRequest\": {\r\n            \"searchWay\": \"SLNO\",\r\n            \"nin\": \"{{NIN}}\",\r\n            \"bySlNO\": \"{{NewSLNO}}\",\r\n            \"byDate\": \"\",\r\n            \"userId\": \"{{NIN}}\",\r\n            \"userType\": \"INVESTOR\",\r\n            \"lang\": \"ENG\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"10-08-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{BaseURL}}{{Oracle19}}",
									"host": [
										"{{BaseURL}}{{Oracle19}}"
									]
								}
							},
							"response": []
						}
					]
				},
				{
					"name": "Error handling",
					"item": [
						{
							"name": "Save Order insufficient balance",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"/**\r",
											" * SAVE_ORDER – Negative: Insufficient balance\r",
											" * Expect:\r",
											" *  - HTTP 200\r",
											" *  - responseStatus.resCode/resCode1 = \"16\"\r",
											" *  - source=\"SAVE_ORDER\"\r",
											" *  - Arabic message like \"رصيد غير كافي\"\r",
											" *  - No business payload\r",
											" *\r",
											" * Saves:\r",
											" *  SAVE_ORDER_ERR_CODE=16, SAVE_ORDER_ERR_DESC\r",
											" *\r",
											" * Optional soft cross-checks (set in Env/Globals if you want strict assertions):\r",
											" *  - BUYING_POWER (number) and FEES_RATE (e.g., 0.00275)\r",
											" *  - STRICT_CASH_CHECK = Y|N (default N) -> if Y, assert totalCost > BUYING_POWER\r",
											" */\r",
											"\r",
											"pm.test(\"HTTP 200\", function(){ pm.response.to.have.status(200); });\r",
											"\r",
											"pm.test(\"Content-Type JSON\", function(){\r",
											"  pm.response.to.have.header(\"Content-Type\");\r",
											"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
											"});\r",
											"\r",
											"// Parse\r",
											"var json;\r",
											"pm.test(\"Body is JSON\", function(){\r",
											"  json = pm.response.json();\r",
											"  pm.expect(json).to.be.an(\"object\");\r",
											"});\r",
											"\r",
											"// Helpers\r",
											"function trim(s){ return String(s == null ? \"\" : s).replace(/^\\s+|\\s+$/g,\"\"); }\r",
											"function isNumStr(v){ return typeof v === \"string\" && /^-?\\d+(\\.\\d+)?$/.test(v); }\r",
											"function getFlag(name, defVal){\r",
											"  var v = pm.environment.get(name) || pm.globals.get(name);\r",
											"  v = (v == null ? \"\" : String(v)).toUpperCase();\r",
											"  if (v !== \"Y\" && v !== \"N\") return defVal;\r",
											"  return v;\r",
											"}\r",
											"\r",
											"// Envelope\r",
											"var rs = json.responseStatus || {};\r",
											"pm.test(\"responseStatus indicates insufficient balance (16)\", function(){\r",
											"  pm.expect(rs.source).to.eql(\"SAVE_ORDER\");\r",
											"  pm.expect(rs.resCode).to.eql(\"16\");\r",
											"  pm.expect(rs.resCode1).to.eql(\"16\");\r",
											"  var d0 = trim(rs.resDesc), d1 = trim(rs.resDesc1);\r",
											"  pm.expect(/رصيد\\s*غير\\s*كافي/.test(d0) || /رصيد\\s*غير\\s*كافي/.test(d1), \"Arabic message should say insufficient balance\").to.be.true;\r",
											"});\r",
											"\r",
											"// No business payload\r",
											"pm.test(\"No business payload on error\", function(){\r",
											"  var msg = json.message;\r",
											"  var empty = (msg == null) || (typeof msg === \"object\" && Object.keys(msg).length === 0);\r",
											"  pm.expect(empty, \"message should be absent or empty for error\").to.be.true;\r",
											"});\r",
											"\r",
											"// Optional soft cross-check: (price * qty) * (1 + fees) > BUYING_POWER\r",
											"pm.test(\"Optional: total cost exceeds buying power (if configured)\", function(){\r",
											"  var strict = getFlag(\"STRICT_CASH_CHECK\",\"N\") === \"Y\";\r",
											"  // pull request body\r",
											"  var body = {};\r",
											"  try { body = pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {}; } catch(e){}\r",
											"  // find price/qty\r",
											"  function findFirstByKey(o, regex){\r",
											"    if (!o || typeof o !== \"object\") return null;\r",
											"    for (var k in o){\r",
											"      if (!o.hasOwnProperty(k)) continue;\r",
											"      var v = o[k];\r",
											"      if (regex.test(String(k)) && (typeof v === \"number\" || isNumStr(String(v)))) return Number(v);\r",
											"      if (v && typeof v === \"object\"){ var t = findFirstByKey(v, regex); if (t !== null) return t; }\r",
											"    }\r",
											"    return null;\r",
											"  }\r",
											"  var price = findFirstByKey(body, /^(price|orderPrice|prc)$/i);\r",
											"  var qty   = findFirstByKey(body, /^(qty|quantity|orderQty|qnt)$/i);\r",
											"  var bpStr = pm.environment.get(\"BUYING_POWER\") || pm.globals.get(\"BUYING_POWER\") ||\r",
											"              pm.environment.get(\"AVAILABLE_BUYING_POWER\") || pm.globals.get(\"AVAILABLE_BUYING_POWER\") || \"\";\r",
											"  var feeStr = pm.environment.get(\"FEES_RATE\") || pm.globals.get(\"FEES_RATE\") || \"0\";\r",
											"  if (price !== null && qty !== null && (isNumStr(bpStr) || typeof bpStr === \"number\")) {\r",
											"    var bp = Number(bpStr);\r",
											"    var fees = Number(feeStr) || 0;\r",
											"    var total = price * qty * (1 + fees);\r",
											"    if (strict) {\r",
											"      pm.expect(total, \"totalCost > BUYING_POWER (strict)\").to.be.above(bp);\r",
											"    } else {\r",
											"      if (!(total > bp)) console.warn(\"Optional check: totalCost <= BUYING_POWER (not asserting). total=\", total, \"bp=\", bp);\r",
											"    }\r",
											"  } else {\r",
											"    console.warn(\"Optional cash check skipped: missing price/qty or BUYING_POWER.\");\r",
											"  }\r",
											"});\r",
											"\r",
											"// Save env\r",
											"pm.environment.set(\"SAVE_ORDER_ERR_CODE\",\"16\");\r",
											"pm.environment.set(\"SAVE_ORDER_ERR_DESC\", String(rs.resDesc || \"\"));\r",
											"\r",
											"// Minimal schema\r",
											"pm.test(\"Schema (minimal) validates\", function(){\r",
											"  var schema = {\r",
											"    type: \"object\",\r",
											"    required: [\"responseStatus\"],\r",
											"    properties: {\r",
											"      responseStatus: {\r",
											"        type: \"object\",\r",
											"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
											"        properties: {\r",
											"          source: {\"const\":\"SAVE_ORDER\"},\r",
											"          resCode: {\"const\":\"16\"},\r",
											"          resCode1: {\"const\":\"16\"}\r",
											"        }\r",
											"      }\r",
											"    }\r",
											"  };\r",
											"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
											"});\r",
											"\r",
											"// Optional: request Srv guard\r",
											"pm.test(\"Request Srv is SAVE_ORDER\", function(){\r",
											"  try {\r",
											"    var req = pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {};\r",
											"    pm.expect((req || {}).Srv).to.eql(\"SAVE_ORDER\");\r",
											"  } catch(e){ console.warn(\"Could not parse request body:\", e.message); }\r",
											"});\r",
											"\r",
											"console.log(\"❌ SAVE_ORDER insufficient balance (16)\");\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Accept",
										"value": "application/json",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\r\n    \"Srv\": \"SAVE_ORDER\",\r\n    \"Message\": {\r\n        \"SaveOrdRequest\": {\r\n            \"ordType\": \"BUY\",\r\n            \"nin\": \"{{NIN}}\",\r\n            \"sym\": \"QNNS\",\r\n            \"shrsNo\": \"100000000\",\r\n            \"shrPrc\": \"10\",\r\n            \"mkPrc\": \"N\",\r\n            \"mPay_type\": \"KB\",\r\n            \"ordVald\": \"1\",\r\n            \"expirationDateTime\": \"\",\r\n            \"usrId\": \"{{UserID}}\",\r\n            \"userType\": \"INVESTOR\",\r\n            \"investorType\": \"INVESTOR\",\r\n            \"lang\": \"ARB\",\r\n            \"orderSource\": \"WEB_ORDERS.25\",\r\n            \"stopPrice\": \"\",\r\n            \"fixType\": \"2\",\r\n            \"discloseVolume\": \"0\",\r\n            \"clientAltIP\": \"{{ClientAltIP}}\",\r\n            \"clientUserIP\": \"10.80.81.158\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"10-08-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{BaseURL}}{{Oracle19}}",
									"host": [
										"{{BaseURL}}{{Oracle19}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "Save Order Wrong Price",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"/**\r",
											" * SAVE_ORDER – Negative: Wrong price\r",
											" * Expect:\r",
											" *  - HTTP 200\r",
											" *  - responseStatus.resCode/resCode1 = \"15\"\r",
											" *  - source=\"SAVE_ORDER\"\r",
											" *  - Arabic message like \"خطأ في السعر\"\r",
											" *  - No business payload\r",
											" *\r",
											" * Saves:\r",
											" *  SAVE_ORDER_ERR_CODE=15, SAVE_ORDER_ERR_DESC\r",
											" *\r",
											" * Optional price-band checks (Env/Globals):\r",
											" *  - PRICE_LIMIT_UP, PRICE_LIMIT_DOWN  (numbers as strings)\r",
											" *  - STRICT_RANGE_CHECK = Y|N (default N) -> if Y, assert price is outside [down, up]\r",
											" */\r",
											"\r",
											"pm.test(\"HTTP 200\", function(){ pm.response.to.have.status(200); });\r",
											"\r",
											"pm.test(\"Content-Type JSON\", function(){\r",
											"  pm.response.to.have.header(\"Content-Type\");\r",
											"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
											"});\r",
											"\r",
											"// Parse\r",
											"var json;\r",
											"pm.test(\"Body is JSON\", function(){\r",
											"  json = pm.response.json();\r",
											"  pm.expect(json).to.be.an(\"object\");\r",
											"});\r",
											"\r",
											"// Helpers\r",
											"function trim(s){ return String(s == null ? \"\" : s).replace(/^\\s+|\\s+$/g,\"\"); }\r",
											"function isNumStr(v){ return typeof v === \"string\" && /^-?\\d+(\\.\\d+)?$/.test(v); }\r",
											"function getFlag(name, defVal){\r",
											"  var v = pm.environment.get(name) || pm.globals.get(name);\r",
											"  v = (v == null ? \"\" : String(v)).toUpperCase();\r",
											"  if (v !== \"Y\" && v !== \"N\") return defVal;\r",
											"  return v;\r",
											"}\r",
											"\r",
											"// Envelope\r",
											"var rs = json.responseStatus || {};\r",
											"pm.test(\"responseStatus indicates wrong price (15)\", function(){\r",
											"  pm.expect(rs.source).to.eql(\"SAVE_ORDER\");\r",
											"  pm.expect(rs.resCode).to.eql(\"15\");\r",
											"  pm.expect(rs.resCode1).to.eql(\"15\");\r",
											"  var d0 = trim(rs.resDesc), d1 = trim(rs.resDesc1);\r",
											"  pm.expect(/خطأ\\s*في\\s*السعر/.test(d0) || /خطأ\\s*في\\s*السعر/.test(d1), \"Arabic message should say wrong price\").to.be.true;\r",
											"});\r",
											"\r",
											"// No business payload\r",
											"pm.test(\"No business payload on error\", function(){\r",
											"  var msg = json.message;\r",
											"  var empty = (msg == null) || (typeof msg === \"object\" && Object.keys(msg).length === 0);\r",
											"  pm.expect(empty, \"message should be absent or empty for error\").to.be.true;\r",
											"});\r",
											"\r",
											"// Optional: price outside allowed band (strict or warn)\r",
											"pm.test(\"Optional: price outside [limitDown, limitUp] (if provided)\", function(){\r",
											"  var strict = getFlag(\"STRICT_RANGE_CHECK\", \"N\") === \"Y\";\r",
											"  var body = {};\r",
											"  try { body = pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {}; } catch(e){}\r",
											"  function findFirstByKey(o, regex){\r",
											"    if (!o || typeof o !== \"object\") return null;\r",
											"    for (var k in o){\r",
											"      if (!o.hasOwnProperty(k)) continue;\r",
											"      var v = o[k];\r",
											"      if (regex.test(String(k)) && (typeof v === \"number\" || isNumStr(String(v)))) return Number(v);\r",
											"      if (v && typeof v === \"object\"){ var t = findFirstByKey(v, regex); if (t !== null) return t; }\r",
											"    }\r",
											"    return null;\r",
											"  }\r",
											"  var price = findFirstByKey(body, /^(price|orderPrice|prc)$/i);\r",
											"  var upStr   = pm.environment.get(\"PRICE_LIMIT_UP\")   || pm.globals.get(\"PRICE_LIMIT_UP\")   || \"\";\r",
											"  var downStr = pm.environment.get(\"PRICE_LIMIT_DOWN\") || pm.globals.get(\"PRICE_LIMIT_DOWN\") || \"\";\r",
											"  if (price !== null && (isNumStr(upStr) || isNumStr(downStr))) {\r",
											"    var up = isNumStr(upStr) ? Number(upStr) : +Infinity;\r",
											"    var dn = isNumStr(downStr) ? Number(downStr) : -Infinity;\r",
											"    var outside = (price > up) || (price < dn);\r",
											"    if (strict) {\r",
											"      pm.expect(outside, \"price must be outside [\"+dn+\", \"+up+\"] (strict)\").to.be.true;\r",
											"    } else if (!outside) {\r",
											"      console.warn(\"Optional range check: price within band; backend still returned 'wrong price'. price=\", price, \"band=[\", dn, \",\", up, \"]\");\r",
											"    }\r",
											"  } else {\r",
											"    console.warn(\"Optional range check skipped: missing price or limits.\");\r",
											"  }\r",
											"});\r",
											"\r",
											"// Save env\r",
											"pm.environment.set(\"SAVE_ORDER_ERR_CODE\",\"15\");\r",
											"pm.environment.set(\"SAVE_ORDER_ERR_DESC\", String(rs.resDesc || \"\"));\r",
											"\r",
											"// Minimal schema\r",
											"pm.test(\"Schema (minimal) validates\", function(){\r",
											"  var schema = {\r",
											"    type: \"object\",\r",
											"    required: [\"responseStatus\"],\r",
											"    properties: {\r",
											"      responseStatus: {\r",
											"        type: \"object\",\r",
											"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
											"        properties: {\r",
											"          source: {\"const\":\"SAVE_ORDER\"},\r",
											"          resCode: {\"const\":\"15\"},\r",
											"          resCode1: {\"const\":\"15\"}\r",
											"        }\r",
											"      }\r",
											"    }\r",
											"  };\r",
											"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
											"});\r",
											"\r",
											"// Optional: request Srv guard\r",
											"pm.test(\"Request Srv is SAVE_ORDER\", function(){\r",
											"  try {\r",
											"    var req = pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {};\r",
											"    pm.expect((req || {}).Srv).to.eql(\"SAVE_ORDER\");\r",
											"  } catch(e){ console.warn(\"Could not parse request body:\", e.message); }\r",
											"});\r",
											"\r",
											"console.log(\"❌ SAVE_ORDER wrong price (15)\");\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Accept",
										"value": "application/json",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\r\n    \"Srv\": \"SAVE_ORDER\",\r\n    \"Message\": {\r\n        \"SaveOrdRequest\": {\r\n            \"ordType\": \"BUY\",\r\n            \"nin\": \"{{NIN}}\",\r\n            \"sym\": \"QNNS\",\r\n            \"shrsNo\": \"100\",\r\n            \"shrPrc\": \"111114\",\r\n            \"mkPrc\": \"N\",\r\n            \"mPay_type\": \"KB\",\r\n            \"ordVald\": \"1\",\r\n            \"expirationDateTime\": \"\",\r\n            \"usrId\": \"{{UserID}}\",\r\n            \"userType\": \"INVESTOR\",\r\n            \"investorType\": \"INVESTOR\",\r\n            \"lang\": \"ARB\",\r\n            \"orderSource\": \"WEB_ORDERS.25\",\r\n            \"stopPrice\": \"\",\r\n            \"fixType\": \"2\",\r\n            \"discloseVolume\": \"0\",\r\n            \"clientAltIP\": \"{{ClientAltIP}}\",\r\n            \"clientUserIP\": \"10.80.81.158\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"10-08-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{BaseURL}}{{Oracle19}}",
									"host": [
										"{{BaseURL}}{{Oracle19}}"
									]
								}
							},
							"response": []
						}
					]
				}
			]
		},
		{
			"name": "20. Trading - Synthetic Orders",
			"item": [
				{
					"name": "Synthetic Orders",
					"item": [
						{
							"name": "Take Profit",
							"item": [
								{
									"name": "Login",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"// Check if the status code is 200\r",
													"pm.test(\"Status code is 200\", function () {\r",
													"    pm.response.to.have.status(200);\r",
													"});\r",
													"\r",
													"// Check if response code is 0\r",
													"pm.test(\"Response code is 0\", function () {\r",
													"    var jsonData = pm.response.json(); // Parse JSON response\r",
													"    pm.expect(jsonData.responseStatus.resCode).to.equal(\"0\");\r",
													"});\r",
													"\r",
													"// Check if response description is \"Successful Operation\"\r",
													"pm.test(\"Response description is 'Successful Operation'\", function () {\r",
													"    var jsonData = pm.response.json();\r",
													"    pm.expect(jsonData.responseStatus.resDesc).to.equal(\"Successful Operation\");\r",
													"});\r",
													"\r",
													"// Check if login is successful and capture NIN\r",
													"pm.test(\"Login successful and NIN captured\", function () {\r",
													"    var jsonData = pm.response.json();\r",
													"    var accounts = jsonData.message.logResponse.accounts.account;\r",
													"\r",
													"    if (accounts.length > 0) {\r",
													"        var nin = accounts[0].nin; // Extract NIN\r",
													"        pm.expect(nin).to.not.be.undefined; // Ensure it's not empty\r",
													"\r",
													"        // Store in environment variables\r",
													"        pm.environment.set(\"NIN\", nin);\r",
													"        pm.environment.set(\"UserID\", nin); // Store the same value in UserID\r",
													"\r",
													"        console.log(\"Captured NIN/UserID:\", nin);\r",
													"    } else {\r",
													"        pm.expect.fail(\"NIN not found in the response.\");\r",
													"    }\r",
													"});\r",
													"\r",
													"// Check if login is successful and SessionID is created\r",
													"pm.test(\"Login successful and SessionID created\", function () {\r",
													"    var jsonData = pm.response.json();\r",
													"    var sessionID = jsonData.message.logResponse.sessionID;\r",
													"\r",
													"    pm.expect(sessionID).to.not.be.undefined; // Assert SessionID exists\r",
													"});\r",
													"\r",
													"// Verify Content-Type header is 'application/json'\r",
													"pm.test(\"Content-Type header is 'application/json'\", function () {\r",
													"    pm.expect(pm.response.headers.get(\"Content-Type\")).to.include(\"application/json\");\r",
													"});\r",
													"\r",
													"// Check if login is successful and capture SessionID\r",
													"pm.test(\"Login successful and SessionID captured\", function () {\r",
													"    var jsonData = pm.response.json();\r",
													"    var sessionID = jsonData.message.logResponse.sessionID;\r",
													"\r",
													"    pm.expect(sessionID).to.not.be.undefined; // Assert SessionID exists\r",
													"    pm.environment.set(\"SessionID\", sessionID); // Save SessionID to environment\r",
													"});\r",
													"\r",
													"// Parse the response JSON\r",
													"var jsonData = pm.response.json();\r",
													"\r",
													"// Verify that the response contains the expected roles\r",
													"pm.test(\"Verify roles in response\", function () {\r",
													"    var roles = jsonData.message.logResponse.roles.role;\r",
													"\r",
													"    // Define expected roles\r",
													"    var expectedRoles = [\"UPDATE_ORDER\", \"SAVE_ORDER\", \"REPORTS\", \"CANCEL_ORDER\"];\r",
													"\r",
													"    // Ensure roles exist in the response\r",
													"    pm.expect(roles).to.be.an(\"array\").that.is.not.empty;\r",
													"\r",
													"    // Check that all expected roles exist in the response\r",
													"    expectedRoles.forEach(role => {\r",
													"        pm.expect(roles).to.include(role, `Missing role: ${role}`);\r",
													"    });\r",
													"\r",
													"    console.log(\"✅ Roles verified successfully:\", roles);\r",
													"});\r",
													""
												],
												"type": "text/javascript",
												"packages": {},
												"requests": {}
											}
										},
										{
											"listen": "prerequest",
											"script": {
												"exec": [
													"// Get current timestamp in ISO format\r",
													"var timestamp = new Date().toISOString();\r",
													"\r",
													"// Store timestamp in Postman environment\r",
													"pm.environment.set(\"currentTimestamp\", timestamp);\r",
													"\r",
													"// Log the timestamp\r",
													"console.log(\"Timestamp Set:\", timestamp);\r",
													""
												],
												"type": "text/javascript",
												"packages": {},
												"requests": {}
											}
										}
									],
									"request": {
										"auth": {
											"type": "noauth"
										},
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json",
												"type": "text"
											},
											{
												"key": "Accept",
												"value": "application/json",
												"type": "text"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\r\n    \"Srv\": \"Login\",\r\n    \"Message\": {\r\n        \"Login\": {\r\n            \"UserName\": \"80509\",\r\n            \"Password\": \"{{Password}}\",\r\n            \"Lang\": \"ARB\"\r\n        }\r\n    },\r\n    \"Version\": \"1.0\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"10-08-2025\"\r\n}",
											"options": {
												"raw": {
													"language": "json"
												}
											}
										},
										"url": {
											"raw": "{{BaseURL}}{{Oracle19}}",
											"host": [
												"{{BaseURL}}{{Oracle19}}"
											]
										}
									},
									"response": []
								},
								{
									"name": "TP Save Synthetic Order",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"// ✅ 1. Check status code\r",
													"pm.test(\"Status code is 200\", function () {\r",
													"    pm.response.to.have.status(200);\r",
													"});\r",
													"\r",
													"// ✅ 2. Parse JSON once for reuse\r",
													"const jsonData = pm.response.json();\r",
													"\r",
													"// ✅ 3. Check for resCode 0 (success) OR handle resCode 15 (price error)\r",
													"pm.test(\"Validate response status based on resCode\", function () {\r",
													"    const resCode = jsonData.responseStatus.resCode;\r",
													"    const resDesc = jsonData.responseStatus.resDesc;\r",
													"\r",
													"    if (resCode === \"0\") {\r",
													"        pm.expect(resDesc).to.eql(\"Successful Operation\");\r",
													"    } else if (resCode === \"15\" && resDesc === \"خطأ في السعر\") {\r",
													"        console.warn(\"Price error detected: resCode 15 - خطأ في السعر\");\r",
													"        pm.expect(resCode).to.eql(\"15\"); // Passes with correct error code\r",
													"    } else {\r",
													"        console.warn(\"Unexpected resCode:\", resCode, \"-\", resDesc);\r",
													"        pm.expect.fail(`Unhandled resCode: ${resCode} - ${resDesc}`);\r",
													"    }\r",
													"});\r",
													"\r",
													"// ✅ 4. Check nested response code if available\r",
													"pm.test(\"Check nested resCode1\", function () {\r",
													"    const resCode1 = jsonData.responseStatus.resCode1;\r",
													"    const resDesc1 = jsonData.responseStatus.resDesc1;\r",
													"\r",
													"    if (resCode1 === \"0\") {\r",
													"        pm.expect(resDesc1).to.eql(\"Successful Operation\");\r",
													"    } else if (resCode1 === \"15\" && resDesc1 === \"خطأ في السعر\") {\r",
													"        console.warn(\"Nested price error: resCode1 15 - خطأ في السعر\");\r",
													"        pm.expect(resCode1).to.eql(\"15\");\r",
													"    } else {\r",
													"        console.warn(\"Unhandled nested resCode1:\", resCode1, \"-\", resDesc1);\r",
													"    }\r",
													"});\r",
													"\r",
													"// ✅ 5. Capture `sym` from request body and save to environment\r",
													"pm.test(\"Capture sym from request and save to environment\", function () {\r",
													"    try {\r",
													"        const requestBody = JSON.parse(pm.request.body.raw);\r",
													"        const sym = requestBody.Message.SaveSyntheticOrdRequest.sym;\r",
													"\r",
													"        pm.expect(sym).to.not.be.undefined;\r",
													"        pm.environment.set(\"Symbol\", sym);\r",
													"        console.log(\"Captured sym:\", sym);\r",
													"    } catch (e) {\r",
													"        console.warn(\"Failed to capture sym. Error:\", e.message);\r",
													"        pm.expect.fail(\"Request body structure may not match expected format.\");\r",
													"    }\r",
													"});\r",
													"\r",
													"\r",
													"// ✅ 6. Capture NewSLNO if order is successful\r",
													"pm.test(\"Capture NewSLNO if available\", function () {\r",
													"    if (jsonData.message && jsonData.message.saveSyntheticOrdResponse) {\r",
													"        const newSLNO = jsonData.message.saveSyntheticOrdResponse.newSLNO;\r",
													"\r",
													"        if (newSLNO) {\r",
													"            pm.environment.set(\"NewSLNO\", newSLNO);\r",
													"            console.log(\"Captured NewSLNO:\", newSLNO);\r",
													"            pm.expect(newSLNO).to.not.be.undefined;\r",
													"        } else {\r",
													"            console.warn(\"NewSLNO is missing in response.\");\r",
													"        }\r",
													"    } else {\r",
													"        console.warn(\"saveSyntheticOrdResponse not found, likely due to error response.\");\r",
													"    }\r",
													"});\r",
													"\r",
													""
												],
												"type": "text/javascript",
												"packages": {},
												"requests": {}
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Accept",
												"value": "application/json",
												"type": "text"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\r\n    \"Srv\": \"SAVE_SYNTHETIC_ORDER\",\r\n    \"Message\": {\r\n        \"SaveSyntheticOrdRequest\": {\r\n            \"ordType\": \"BUY\",\r\n            \"nin\": \"{{NIN}}\",\r\n            \"sym\": \"QNNS\",\r\n            \"shrsNo\": \"10\",\r\n            \"shrPrc\": \"10.2\",\r\n            \"mkPrc\": \"N\",\r\n            \"mPay_type\": \"KB\",\r\n            \"ordVald\": \"1\",\r\n            \"expirationDateTime\": \"\",\r\n            \"usrId\": \"{{UserID}}\",\r\n            \"userType\": \"INVESTOR\",\r\n            \"investorType\": \"INVESTOR\",\r\n            \"lang\": \"ARB\",\r\n            \"orderSource\": \"WEB_ORDERS.25\",\r\n            \"stopPrice\": \"\",\r\n            \"fixType\": \"2\",\r\n            \"discloseVolume\": \"0\",\r\n            \"clientAltIP\": \"{{ClientAltIP}}\",\r\n            \"clientUserIP\": \"10.80.81.158\",\r\n            \"stopLossActivationPrice\": \"\",\r\n            \"stopLossLimitPrice\": \"\",\r\n            \"takeProfitPrice\": \"10.50\",\r\n            \"syntOrderType\": \"TakeProfit\",\r\n            \"bestPriceLimitPrice\": \"\",\r\n            \"convertBestPriceToMPOrder\": \"N\"\r\n        }\r\n    },\r\n    \"Version\": \"2\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"10-08-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}",
											"options": {
												"raw": {
													"language": "json"
												}
											}
										},
										"url": {
											"raw": "{{BaseURL}}{{Oracle19}}",
											"host": [
												"{{BaseURL}}{{Oracle19}}"
											]
										}
									},
									"response": []
								},
								{
									"name": "TP Update Synthetic Order",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"// ✅ 1. Check status code\r",
													"pm.test(\"Status code is 200\", function () {\r",
													"    pm.response.to.have.status(200);\r",
													"});\r",
													"\r",
													"// ✅ 2. Parse JSON once for reuse\r",
													"const jsonData = pm.response.json();\r",
													"\r",
													"// ✅ 3. Check for resCode 0 (success) OR handle resCode 15 (price error)\r",
													"pm.test(\"Validate response status based on resCode\", function () {\r",
													"    const resCode = jsonData.responseStatus.resCode;\r",
													"    const resDesc = jsonData.responseStatus.resDesc;\r",
													"\r",
													"    if (resCode === \"0\") {\r",
													"        pm.expect(resDesc).to.eql(\"Successful Operation\");\r",
													"\r",
													"        // ✅ Safely check for the \"done\" flag in the response\r",
													"        const doneFlag = jsonData.message?.updateSyntheticOrderResponse?.done;\r",
													"        pm.expect(doneFlag).to.eql(\"OK\");\r",
													"        console.log(\"✅ Order updated successfully.\");\r",
													"    } else if (resCode === \"15\" && resDesc === \"خطأ في السعر\") {\r",
													"        console.warn(\"Price error detected: resCode 15 - خطأ في السعر\");\r",
													"        pm.expect(resCode).to.eql(\"15\"); // Mark as expected handled error\r",
													"    } else {\r",
													"        console.warn(\"Unexpected resCode:\", resCode, \"-\", resDesc);\r",
													"        pm.expect.fail(`Unhandled resCode: ${resCode} - ${resDesc}`);\r",
													"    }\r",
													"});\r",
													"\r",
													"// ✅ 4. Check nested response code if available\r",
													"pm.test(\"Check nested resCode1\", function () {\r",
													"    const resCode1 = jsonData.responseStatus.resCode1;\r",
													"    const resDesc1 = jsonData.responseStatus.resDesc1;\r",
													"\r",
													"    if (resCode1 === \"0\") {\r",
													"        pm.expect(resDesc1).to.eql(\"Successful Operation\");\r",
													"    } else if (resCode1 === \"15\" && resDesc1 === \"خطأ في السعر\") {\r",
													"        console.warn(\"Nested price error: resCode1 15 - خطأ في السعر\");\r",
													"        pm.expect(resCode1).to.eql(\"15\");\r",
													"    } else {\r",
													"        console.warn(\"Unhandled nested resCode1:\", resCode1, \"-\", resDesc1);\r",
													"    }\r",
													"});\r",
													"\r",
													"// ✅ 5. Capture `sym` from request body and save to environment\r",
													"pm.test(\"Capture sym from request and save to environment\", function () {\r",
													"    try {\r",
													"        const requestBody = JSON.parse(pm.request.body.raw);\r",
													"        const sym = requestBody.Message.UpdateSyntheticOrderRequest.sym;\r",
													"\r",
													"        pm.expect(sym).to.not.be.undefined;\r",
													"        pm.environment.set(\"Symbol\", sym);\r",
													"        console.log(\"Captured sym:\", sym);\r",
													"    } catch (e) {\r",
													"        console.warn(\"Failed to capture sym. Error:\", e.message);\r",
													"        pm.expect.fail(\"Request body structure may not match expected format.\");\r",
													"    }\r",
													"});\r",
													"\r",
													"\r",
													"// ✅ 6. Capture NewSLNO if order is successful\r",
													"pm.test(\"Capture NewSLNO if available\", function () {\r",
													"    if (jsonData.message && jsonData.message.saveOrdResponse) {\r",
													"        const newSLNO = jsonData.message.saveOrdResponse.newSLNO;\r",
													"\r",
													"        if (newSLNO) {\r",
													"            pm.environment.set(\"NewSLNO\", newSLNO);\r",
													"            console.log(\"Captured NewSLNO:\", newSLNO);\r",
													"            pm.expect(newSLNO).to.not.be.undefined;\r",
													"        } else {\r",
													"            console.warn(\"NewSLNO is missing in response.\");\r",
													"        }\r",
													"    } else {\r",
													"        console.warn(\"updateOrdResponse not found, likely due to error response.\");\r",
													"    }\r",
													"});\r",
													""
												],
												"type": "text/javascript",
												"packages": {},
												"requests": {}
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Accept",
												"value": "application/json",
												"type": "text"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\r\n    \"Srv\": \"UPDATE_SYNTHETIC_ORDER\",\r\n    \"Message\": {\r\n        \"UpdateSyntheticOrderRequest\": {\r\n            \"sLNO\": \"{{NewSLNO}}\",\r\n            \"ordType\": \"SELL\",\r\n            \"nin\": \"{{NIN}}\",\r\n            \"sym\": \"{{Symbol}}\",\r\n            \"shrsNo\": \"111\",\r\n            \"shrPrc\": \"10.25\",\r\n            \"mkPrc\": \"N\",\r\n            \"ordVald\": \"0\",\r\n            \"expirationDateTime\": \"\",\r\n            \"userId\": \"{{UserID}}\",\r\n            \"userType\": \"INVESTOR\",\r\n            \"inv_Type\": \"INVESTOR\",\r\n            \"lang\": \"ARB\",\r\n            \"stopPrice\": \"\",\r\n            \"fixType\": \"2\",\r\n            \"discloseVolume\": \"0\",\r\n            \"clientAltIP\": \"{{ClientAltIP}}\",\r\n            \"clientUserIP\": \"10.80.81.158\",\r\n            \"stopLossActivationPrice\": \"\",\r\n            \"stopLossLimitPrice\": \"\",\r\n            \"takeProfitPrice\": \"10.75\",\r\n            \"syntOrderType\": \"\",\r\n            \"bestPriceLimitPrice\": \"\",\r\n            \"convertBestPriceToMPOrder\": \"N\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"10-08-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}",
											"options": {
												"raw": {
													"language": "json"
												}
											}
										},
										"url": {
											"raw": "{{BaseURL}}{{Oracle19}}",
											"host": [
												"{{BaseURL}}{{Oracle19}}"
											]
										}
									},
									"response": []
								},
								{
									"name": "Cancel Synthetic Order",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"/**\r",
													" * CANCEL_SYNTHETIC_ORDER / CANCEL_ORDER – unified validator\r",
													" * Handles:\r",
													" *   - Success: resCode \"0\" -> message.(cancelSyntheticOrderResponse|canOrderResponse|cancelOrderResponse).done === \"OK\"\r",
													" *   - Not allowed / already cancelled: resCode \"17\" (Arabic or English message accepted)\r",
													" * Saves:\r",
													" *   - CANCEL_DONE (\"OK\" on success) \r",
													" */\r",
													"\r",
													"pm.test(\"HTTP 200\", function () {\r",
													"  pm.response.to.have.status(200);\r",
													"});\r",
													"\r",
													"pm.test(\"Content-Type is JSON\", function () {\r",
													"  pm.response.to.have.header(\"Content-Type\");\r",
													"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
													"});\r",
													"\r",
													"let json;\r",
													"pm.test(\"Body is JSON\", function () {\r",
													"  json = pm.response.json();\r",
													"  pm.expect(json).to.be.an(\"object\");\r",
													"});\r",
													"\r",
													"// Envelope\r",
													"pm.test(\"Envelope present\", function () {\r",
													"  const rs = json.responseStatus || {};\r",
													"  pm.expect(rs).to.have.property(\"resCode\");\r",
													"  pm.expect(rs).to.have.property(\"resDesc\");\r",
													"  // If the API returns a specific source, accept either \"CANCEL_SYNTHETIC_ORDER\" or legacy variants\r",
													"  if (rs.source) {\r",
													"    pm.expect([\"CANCEL_SYNTHETIC_ORDER\", \"CANCEL_ORDER\"]).to.include(rs.source);\r",
													"  }\r",
													"});\r",
													"\r",
													"// Helper to get the response node safely (covers different naming variants)\r",
													"function getCancelNode(j) {\r",
													"  const msg = (j && j.message) || {};\r",
													"  return msg.cancelSyntheticOrderResponse || msg.canOrderResponse || msg.cancelOrderResponse || null;\r",
													"}\r",
													"\r",
													"// Branch logic\r",
													"pm.test(\"Handle CANCEL_ORDER response codes correctly\", function () {\r",
													"  const rs = json.responseStatus || {};\r",
													"  const code = String(rs.resCode || \"\");\r",
													"  const desc = String(rs.resDesc || \"\");\r",
													"  const node = getCancelNode(json);\r",
													"\r",
													"  if (code === \"0\") {\r",
													"    pm.expect(desc).to.eql(\"Successful Operation\");\r",
													"    pm.expect(node, \"cancel response node should exist on success\").to.be.an(\"object\");\r",
													"    pm.expect(node).to.have.property(\"done\");\r",
													"    pm.expect(String(node.done)).to.eql(\"OK\");\r",
													"    pm.environment.set(\"CANCEL_DONE\", \"OK\");\r",
													"    console.log(\"✅ Order cancelled successfully.\");\r",
													"  } else if (code === \"17\") {\r",
													"    // Accept Arabic: \"غير مسموح بالعمليه\" or English fallback \"Operation Not Allowed\"\r",
													"    const ok = desc === \"غير مسموح بالعمليه\" || desc === \"Operation Not Allowed\";\r",
													"    pm.expect(ok, \"resDesc should indicate not allowed / already cancelled\").to.be.true;\r",
													"    pm.environment.unset(\"CANCEL_DONE\");\r",
													"    console.warn(\"⚠️ Order already cancelled or not allowed (resCode 17).\");\r",
													"  } else {\r",
													"    console.warn(\"⚠️ Unexpected resCode:\", code, \"-\", desc);\r",
													"    // No hard assertion here to avoid false failures on new business codes\r",
													"  }\r",
													"});\r",
													"\r",
													"// Minimal schema (relaxed)\r",
													"pm.test(\"Schema (relaxed) validates\", function () {\r",
													"  const schema = {\r",
													"    type: \"object\",\r",
													"    required: [\"responseStatus\", \"message\"],\r",
													"    properties: {\r",
													"      responseStatus: {\r",
													"        type: \"object\",\r",
													"        required: [\"resCode\", \"resDesc\"],\r",
													"        properties: {\r",
													"          resCode: { type: \"string\" },\r",
													"          resDesc: { type: \"string\" },\r",
													"          source:  { type: \"string\" }\r",
													"        }\r",
													"      },\r",
													"      message: { type: \"object\" }\r",
													"    }\r",
													"  };\r",
													"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
													"});\r",
													""
												],
												"type": "text/javascript",
												"packages": {},
												"requests": {}
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Accept",
												"value": "application/json",
												"type": "text"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\r\n   \"Srv\": \"CANCEL_SYNTHETIC_ORDER\",\r\n    \"Message\": {\r\n        \"CancelSyntheticOrderRequest\": {\r\n            \"nin\": \"{{NIN}}\",\r\n            \"slno\": \"{{NewSLNO}}\",\r\n            \"userId\": \"{{UserID}}\",\r\n            \"userType\": \"INVESTOR\",\r\n            \"lang\": \"ARB\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"10-08-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}\r\n",
											"options": {
												"raw": {
													"language": "json"
												}
											}
										},
										"url": {
											"raw": "{{BaseURL}}{{Oracle19}}",
											"host": [
												"{{BaseURL}}{{Oracle19}}"
											]
										}
									},
									"response": []
								},
								{
									"name": "Get Order",
									"protocolProfileBehavior": {
										"disableBodyPruning": true
									},
									"request": {
										"method": "GET",
										"header": [],
										"body": {
											"mode": "raw",
											"raw": "{\r\n    \"Srv\": \"GETORDERS\",\r\n    \"Message\": {\r\n        \"GetOrderRequest\": {\r\n            \"searchWay\": \"SLNO\",\r\n            \"nin\": \"{{NIN}}\",\r\n            \"bySlNO\": \"{{NewSLNO}}\",\r\n            \"byDate\": \"\",\r\n            \"userId\": \"{{NIN}}\",\r\n            \"userType\": \"INVESTOR\",\r\n            \"lang\": \"ENG\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"10-08-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}",
											"options": {
												"raw": {
													"language": "json"
												}
											}
										},
										"url": {
											"raw": "https://devuat.thegroup.com.qa/preprod/process",
											"protocol": "https",
											"host": [
												"devuat",
												"thegroup",
												"com",
												"qa"
											],
											"path": [
												"preprod",
												"process"
											]
										}
									},
									"response": []
								}
							]
						},
						{
							"name": "StopLoss",
							"item": [
								{
									"name": "Login",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"// Check if the status code is 200\r",
													"pm.test(\"Status code is 200\", function () {\r",
													"    pm.response.to.have.status(200);\r",
													"});\r",
													"\r",
													"// Check if response code is 0\r",
													"pm.test(\"Response code is 0\", function () {\r",
													"    var jsonData = pm.response.json(); // Parse JSON response\r",
													"    pm.expect(jsonData.responseStatus.resCode).to.equal(\"0\");\r",
													"});\r",
													"\r",
													"// Check if response description is \"Successful Operation\"\r",
													"pm.test(\"Response description is 'Successful Operation'\", function () {\r",
													"    var jsonData = pm.response.json();\r",
													"    pm.expect(jsonData.responseStatus.resDesc).to.equal(\"Successful Operation\");\r",
													"});\r",
													"\r",
													"// Check if login is successful and capture NIN\r",
													"pm.test(\"Login successful and NIN captured\", function () {\r",
													"    var jsonData = pm.response.json();\r",
													"    var accounts = jsonData.message.logResponse.accounts.account;\r",
													"\r",
													"    if (accounts.length > 0) {\r",
													"        var nin = accounts[0].nin; // Extract NIN\r",
													"        pm.expect(nin).to.not.be.undefined; // Ensure it's not empty\r",
													"\r",
													"        // Store in environment variables\r",
													"        pm.environment.set(\"NIN\", nin);\r",
													"        pm.environment.set(\"UserID\", nin); // Store the same value in UserID\r",
													"\r",
													"        console.log(\"Captured NIN/UserID:\", nin);\r",
													"    } else {\r",
													"        pm.expect.fail(\"NIN not found in the response.\");\r",
													"    }\r",
													"});\r",
													"\r",
													"// Check if login is successful and SessionID is created\r",
													"pm.test(\"Login successful and SessionID created\", function () {\r",
													"    var jsonData = pm.response.json();\r",
													"    var sessionID = jsonData.message.logResponse.sessionID;\r",
													"\r",
													"    pm.expect(sessionID).to.not.be.undefined; // Assert SessionID exists\r",
													"});\r",
													"\r",
													"// Verify Content-Type header is 'application/json'\r",
													"pm.test(\"Content-Type header is 'application/json'\", function () {\r",
													"    pm.expect(pm.response.headers.get(\"Content-Type\")).to.include(\"application/json\");\r",
													"});\r",
													"\r",
													"// Check if login is successful and capture SessionID\r",
													"pm.test(\"Login successful and SessionID captured\", function () {\r",
													"    var jsonData = pm.response.json();\r",
													"    var sessionID = jsonData.message.logResponse.sessionID;\r",
													"\r",
													"    pm.expect(sessionID).to.not.be.undefined; // Assert SessionID exists\r",
													"    pm.environment.set(\"SessionID\", sessionID); // Save SessionID to environment\r",
													"});\r",
													"\r",
													"// Parse the response JSON\r",
													"var jsonData = pm.response.json();\r",
													"\r",
													"// Verify that the response contains the expected roles\r",
													"pm.test(\"Verify roles in response\", function () {\r",
													"    var roles = jsonData.message.logResponse.roles.role;\r",
													"\r",
													"    // Define expected roles\r",
													"    var expectedRoles = [\"UPDATE_ORDER\", \"SAVE_ORDER\", \"REPORTS\", \"CANCEL_ORDER\"];\r",
													"\r",
													"    // Ensure roles exist in the response\r",
													"    pm.expect(roles).to.be.an(\"array\").that.is.not.empty;\r",
													"\r",
													"    // Check that all expected roles exist in the response\r",
													"    expectedRoles.forEach(role => {\r",
													"        pm.expect(roles).to.include(role, `Missing role: ${role}`);\r",
													"    });\r",
													"\r",
													"    console.log(\"✅ Roles verified successfully:\", roles);\r",
													"});\r",
													""
												],
												"type": "text/javascript",
												"packages": {},
												"requests": {}
											}
										},
										{
											"listen": "prerequest",
											"script": {
												"exec": [
													"// Get current timestamp in ISO format\r",
													"var timestamp = new Date().toISOString();\r",
													"\r",
													"// Store timestamp in Postman environment\r",
													"pm.environment.set(\"currentTimestamp\", timestamp);\r",
													"\r",
													"// Log the timestamp\r",
													"console.log(\"Timestamp Set:\", timestamp);\r",
													""
												],
												"type": "text/javascript",
												"packages": {},
												"requests": {}
											}
										}
									],
									"request": {
										"auth": {
											"type": "noauth"
										},
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json",
												"type": "text"
											},
											{
												"key": "Accept",
												"value": "application/json",
												"type": "text"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\r\n    \"Srv\": \"Login\",\r\n    \"Message\": {\r\n        \"Login\": {\r\n            \"UserName\": \"1218\",\r\n            \"Password\": \"{{Password}}\",\r\n            \"Lang\": \"ARB\"\r\n        }\r\n    },\r\n    \"Version\": \"1.0\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"10-08-2025\"\r\n}",
											"options": {
												"raw": {
													"language": "json"
												}
											}
										},
										"url": {
											"raw": "{{BaseURL}}{{Oracle19}}",
											"host": [
												"{{BaseURL}}{{Oracle19}}"
											]
										}
									},
									"response": []
								},
								{
									"name": "SLoss Save Synthetic Order",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"// ✅ 1. Check status code\r",
													"pm.test(\"Status code is 200\", function () {\r",
													"    pm.response.to.have.status(200);\r",
													"});\r",
													"\r",
													"// ✅ 2. Parse JSON once for reuse\r",
													"const jsonData = pm.response.json();\r",
													"\r",
													"// ✅ 3. Check for resCode 0 (success) OR handle resCode 15 (price error)\r",
													"pm.test(\"Validate response status based on resCode\", function () {\r",
													"    const resCode = jsonData.responseStatus.resCode;\r",
													"    const resDesc = jsonData.responseStatus.resDesc;\r",
													"\r",
													"    if (resCode === \"0\") {\r",
													"        pm.expect(resDesc).to.eql(\"Successful Operation\");\r",
													"    } else if (resCode === \"15\" && resDesc === \"خطأ في السعر\") {\r",
													"        console.warn(\"Price error detected: resCode 15 - خطأ في السعر\");\r",
													"        pm.expect(resCode).to.eql(\"15\"); // Passes with correct error code\r",
													"    } else {\r",
													"        console.warn(\"Unexpected resCode:\", resCode, \"-\", resDesc);\r",
													"        pm.expect.fail(`Unhandled resCode: ${resCode} - ${resDesc}`);\r",
													"    }\r",
													"});\r",
													"\r",
													"// ✅ 4. Check nested response code if available\r",
													"pm.test(\"Check nested resCode1\", function () {\r",
													"    const resCode1 = jsonData.responseStatus.resCode1;\r",
													"    const resDesc1 = jsonData.responseStatus.resDesc1;\r",
													"\r",
													"    if (resCode1 === \"0\") {\r",
													"        pm.expect(resDesc1).to.eql(\"Successful Operation\");\r",
													"    } else if (resCode1 === \"15\" && resDesc1 === \"خطأ في السعر\") {\r",
													"        console.warn(\"Nested price error: resCode1 15 - خطأ في السعر\");\r",
													"        pm.expect(resCode1).to.eql(\"15\");\r",
													"    } else {\r",
													"        console.warn(\"Unhandled nested resCode1:\", resCode1, \"-\", resDesc1);\r",
													"    }\r",
													"});\r",
													"\r",
													"// ✅ 5. Capture `sym` from request body and save to environment\r",
													"pm.test(\"Capture sym from request and save to environment\", function () {\r",
													"    try {\r",
													"        const requestBody = JSON.parse(pm.request.body.raw);\r",
													"        const sym = requestBody.Message.SaveSyntheticOrdRequest.sym;\r",
													"\r",
													"        pm.expect(sym).to.not.be.undefined;\r",
													"        pm.environment.set(\"Symbol\", sym);\r",
													"        console.log(\"Captured sym:\", sym);\r",
													"    } catch (e) {\r",
													"        console.warn(\"Failed to capture sym. Error:\", e.message);\r",
													"        pm.expect.fail(\"Request body structure may not match expected format.\");\r",
													"    }\r",
													"});\r",
													"\r",
													"\r",
													"// ✅ 6. Capture NewSLNO if order is successful\r",
													"pm.test(\"Capture NewSLNO if available\", function () {\r",
													"    if (jsonData.message && jsonData.message.saveSyntheticOrdResponse) {\r",
													"        const newSLNO = jsonData.message.saveSyntheticOrdResponse.newSLNO;\r",
													"\r",
													"        if (newSLNO) {\r",
													"            pm.environment.set(\"NewSLNO\", newSLNO);\r",
													"            console.log(\"Captured NewSLNO:\", newSLNO);\r",
													"            pm.expect(newSLNO).to.not.be.undefined;\r",
													"        } else {\r",
													"            console.warn(\"NewSLNO is missing in response.\");\r",
													"        }\r",
													"    } else {\r",
													"        console.warn(\"saveSyntheticOrdResponse not found, likely due to error response.\");\r",
													"    }\r",
													"});\r",
													""
												],
												"type": "text/javascript",
												"packages": {},
												"requests": {}
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Accept",
												"value": "application/json",
												"type": "text"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\r\n    \"Srv\": \"SAVE_SYNTHETIC_ORDER\",\r\n    \"Message\": {\r\n        \"SaveSyntheticOrdRequest\": {\r\n            \"ordType\": \"SELL\",\r\n            \"nin\": \"{{NIN}}\",\r\n            \"sym\": \"QNNS\",\r\n            \"shrsNo\": \"100\",\r\n            \"shrPrc\": \"10\",\r\n            \"mkPrc\": \"N\",\r\n            \"mPay_type\": \"KB\",\r\n            \"ordVald\": \"0\",\r\n            \"expirationDateTime\": \"\",\r\n            \"usrId\": \"{{UserID}}\",\r\n            \"userType\": \"INVESTOR\",\r\n            \"investorType\": \"INVESTOR\",\r\n            \"lang\": \"ARB\",\r\n            \"orderSource\": \"WEB_ORDERS.25\",\r\n            \"stopPrice\": \"\",\r\n            \"fixType\": \"2\",\r\n            \"discloseVolume\": \"0\",\r\n            \"clientAltIP\": \"{{ClientAltIP}}\",\r\n            \"clientUserIP\": \"10.80.81.158\",\r\n            \"stopLossActivationPrice\": \"9.75\",\r\n            \"stopLossLimitPrice\": \"MP\",\r\n            \"takeProfitPrice\": \"\",\r\n            \"syntOrderType\": \"StopLoss\",\r\n            \"bestPriceLimitPrice\": \"\",\r\n            \"convertBestPriceToMPOrder\": \"N\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"10-08-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}",
											"options": {
												"raw": {
													"language": "json"
												}
											}
										},
										"url": {
											"raw": "{{BaseURL}}{{Oracle19}}",
											"host": [
												"{{BaseURL}}{{Oracle19}}"
											]
										}
									},
									"response": []
								},
								{
									"name": "SLoss Update Synthetic Order",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"// ✅ 1. Check status code\r",
													"pm.test(\"Status code is 200\", function () {\r",
													"    pm.response.to.have.status(200);\r",
													"});\r",
													"\r",
													"// ✅ 2. Parse JSON once for reuse\r",
													"const jsonData = pm.response.json();\r",
													"\r",
													"// ✅ 3. Check for resCode 0 (success) OR handle resCode 15 (price error) or resCode 17 (operation not allowed)\r",
													"pm.test(\"Validate response status based on resCode\", function () {\r",
													"    const resCode = jsonData.responseStatus.resCode;\r",
													"    const resDesc = jsonData.responseStatus.resDesc;\r",
													"\r",
													"    if (resCode === \"0\") {\r",
													"        pm.expect(resDesc).to.eql(\"Successful Operation\");\r",
													"\r",
													"        // ✅ Safely check for the \"done\" flag in the response\r",
													"        const doneFlag = jsonData.message?.updateSyntheticOrderResponse?.done;\r",
													"        pm.expect(doneFlag).to.eql(\"OK\");\r",
													"        console.log(\"✅ Order updated successfully.\");\r",
													"    } else if (resCode === \"15\" && resDesc === \"خطأ في السعر\") {\r",
													"        console.warn(\"Price error detected: resCode 15 - خطأ في السعر\");\r",
													"        pm.expect(resCode).to.eql(\"15\"); // Mark as expected handled error\r",
													"    } else if (resCode === \"17\" && resDesc === \"غير مسموح بالعمليه\") {\r",
													"        console.warn(\"Operation not allowed: resCode 17 - غير مسموح بالعمليه\");\r",
													"        pm.expect(resCode).to.eql(\"17\"); // Mark as expected handled error\r",
													"    } else {\r",
													"        console.warn(\"Unexpected resCode:\", resCode, \"-\", resDesc);\r",
													"        pm.expect.fail(`Unhandled resCode: ${resCode} - ${resDesc}`);\r",
													"    }\r",
													"});\r",
													"\r",
													"// ✅ 4. Check nested response code if available\r",
													"pm.test(\"Check nested resCode1\", function () {\r",
													"    const resCode1 = jsonData.responseStatus.resCode1;\r",
													"    const resDesc1 = jsonData.responseStatus.resDesc1;\r",
													"\r",
													"    if (resCode1 === \"0\") {\r",
													"        pm.expect(resDesc1).to.eql(\"Successful Operation\");\r",
													"    } else if (resCode1 === \"15\" && resDesc1 === \"خطأ في السعر\") {\r",
													"        console.warn(\"Nested price error: resCode1 15 - خطأ في السعر\");\r",
													"        pm.expect(resCode1).to.eql(\"15\");\r",
													"    } else {\r",
													"        console.warn(\"Unhandled nested resCode1:\", resCode1, \"-\", resDesc1);\r",
													"    }\r",
													"});\r",
													"\r",
													"// ✅ 5. Capture `sym` from request body and save to environment\r",
													"pm.test(\"Capture sym from request and save to environment\", function () {\r",
													"    try {\r",
													"        const requestBody = JSON.parse(pm.request.body.raw);\r",
													"        const sym = requestBody.Message.UpdateSyntheticOrderRequest.sym;\r",
													"\r",
													"        pm.expect(sym).to.not.be.undefined;\r",
													"        pm.environment.set(\"Symbol\", sym);\r",
													"        console.log(\"Captured sym:\", sym);\r",
													"    } catch (e) {\r",
													"        console.warn(\"Failed to capture sym. Error:\", e.message);\r",
													"        pm.expect.fail(\"Request body structure may not match expected format.\");\r",
													"    }\r",
													"});\r",
													"\r",
													"\r",
													"// ✅ 6. Capture NewSLNO if order is successful\r",
													"pm.test(\"Capture NewSLNO if available\", function () {\r",
													"    if (jsonData.message && jsonData.message.saveSyntheticOrdResponse) {\r",
													"        const newSLNO = jsonData.message.saveSyntheticOrdResponse.newSLNO;\r",
													"\r",
													"        if (newSLNO) {\r",
													"            pm.environment.set(\"NewSLNO\", newSLNO);\r",
													"            console.log(\"Captured NewSLNO:\", newSLNO);\r",
													"            pm.expect(newSLNO).to.not.be.undefined;\r",
													"        } else {\r",
													"            console.warn(\"NewSLNO is missing in response.\");\r",
													"        }\r",
													"    } else {\r",
													"        console.warn(\"saveSyntheticOrdResponse not found, likely due to error response.\");\r",
													"    }\r",
													"});\r",
													""
												],
												"type": "text/javascript",
												"packages": {},
												"requests": {}
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Accept",
												"value": "application/json",
												"type": "text"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\r\n    \"Srv\": \"UPDATE_SYNTHETIC_ORDER\",\r\n    \"Message\": {\r\n        \"UpdateSyntheticOrderRequest\": {\r\n            \"sLNO\": \"{{NewSLNO}}\",\r\n            \"ordType\": \"SELL\",\r\n            \"nin\": \"{{NIN}}\",\r\n            \"sym\": \"{{Symbol}}\",\r\n            \"shrsNo\": \"111\",\r\n            \"shrPrc\": \"10.25\",\r\n            \"mkPrc\": \"N\",\r\n            \"ordVald\": \"0\",\r\n            \"expirationDateTime\": \"\",\r\n            \"userId\": \"{{UserID}}\",\r\n            \"userType\": \"INVESTOR\",\r\n            \"inv_Type\": \"INVESTOR\",\r\n            \"lang\": \"ARB\",\r\n            \"stopPrice\": \"\",\r\n            \"fixType\": \"2\",\r\n            \"discloseVolume\": \"0\",\r\n            \"clientAltIP\": \"{{ClientAltIP}}\",\r\n            \"clientUserIP\": \"10.80.81.158\",\r\n            \"stopLossActivationPrice\": \"9.5\",\r\n            \"stopLossLimitPrice\": \"MP\",\r\n            \"takeProfitPrice\": \"\",\r\n            \"syntOrderType\": \"StopLoss\",\r\n            \"bestPriceLimitPrice\": \"\",\r\n            \"convertBestPriceToMPOrder\": \"N\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"10-08-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}",
											"options": {
												"raw": {
													"language": "json"
												}
											}
										},
										"url": {
											"raw": "{{BaseURL}}{{Oracle19}}",
											"host": [
												"{{BaseURL}}{{Oracle19}}"
											]
										}
									},
									"response": []
								},
								{
									"name": "Cancel Synthetic Order",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"/**\r",
													" * CANCEL_SYNTHETIC_ORDER / CANCEL_ORDER – unified validator\r",
													" * Handles:\r",
													" *   - Success: resCode \"0\" -> message.(cancelSyntheticOrderResponse|canOrderResponse|cancelOrderResponse).done === \"OK\"\r",
													" *   - Not allowed / already cancelled: resCode \"17\" (Arabic or English message accepted)\r",
													" * Saves:\r",
													" *   - CANCEL_DONE (\"OK\" on success) \r",
													" */\r",
													"\r",
													"pm.test(\"HTTP 200\", function () {\r",
													"  pm.response.to.have.status(200);\r",
													"});\r",
													"\r",
													"pm.test(\"Content-Type is JSON\", function () {\r",
													"  pm.response.to.have.header(\"Content-Type\");\r",
													"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
													"});\r",
													"\r",
													"let json;\r",
													"pm.test(\"Body is JSON\", function () {\r",
													"  json = pm.response.json();\r",
													"  pm.expect(json).to.be.an(\"object\");\r",
													"});\r",
													"\r",
													"// Envelope\r",
													"pm.test(\"Envelope present\", function () {\r",
													"  const rs = json.responseStatus || {};\r",
													"  pm.expect(rs).to.have.property(\"resCode\");\r",
													"  pm.expect(rs).to.have.property(\"resDesc\");\r",
													"  // If the API returns a specific source, accept either \"CANCEL_SYNTHETIC_ORDER\" or legacy variants\r",
													"  if (rs.source) {\r",
													"    pm.expect([\"CANCEL_SYNTHETIC_ORDER\", \"CANCEL_ORDER\"]).to.include(rs.source);\r",
													"  }\r",
													"});\r",
													"\r",
													"// Helper to get the response node safely (covers different naming variants)\r",
													"function getCancelNode(j) {\r",
													"  const msg = (j && j.message) || {};\r",
													"  return msg.cancelSyntheticOrderResponse || msg.canOrderResponse || msg.cancelOrderResponse || null;\r",
													"}\r",
													"\r",
													"// Branch logic\r",
													"pm.test(\"Handle CANCEL_ORDER response codes correctly\", function () {\r",
													"  const rs = json.responseStatus || {};\r",
													"  const code = String(rs.resCode || \"\");\r",
													"  const desc = String(rs.resDesc || \"\");\r",
													"  const node = getCancelNode(json);\r",
													"\r",
													"  if (code === \"0\") {\r",
													"    pm.expect(desc).to.eql(\"Successful Operation\");\r",
													"    pm.expect(node, \"cancel response node should exist on success\").to.be.an(\"object\");\r",
													"    pm.expect(node).to.have.property(\"done\");\r",
													"    pm.expect(String(node.done)).to.eql(\"OK\");\r",
													"    pm.environment.set(\"CANCEL_DONE\", \"OK\");\r",
													"    console.log(\"✅ Order cancelled successfully.\");\r",
													"  } else if (code === \"17\") {\r",
													"    // Accept Arabic: \"غير مسموح بالعمليه\" or English fallback \"Operation Not Allowed\"\r",
													"    const ok = desc === \"غير مسموح بالعمليه\" || desc === \"Operation Not Allowed\";\r",
													"    pm.expect(ok, \"resDesc should indicate not allowed / already cancelled\").to.be.true;\r",
													"    pm.environment.unset(\"CANCEL_DONE\");\r",
													"    console.warn(\"⚠️ Order already cancelled or not allowed (resCode 17).\");\r",
													"  } else {\r",
													"    console.warn(\"⚠️ Unexpected resCode:\", code, \"-\", desc);\r",
													"    // No hard assertion here to avoid false failures on new business codes\r",
													"  }\r",
													"});\r",
													"\r",
													"// Minimal schema (relaxed)\r",
													"pm.test(\"Schema (relaxed) validates\", function () {\r",
													"  const schema = {\r",
													"    type: \"object\",\r",
													"    required: [\"responseStatus\", \"message\"],\r",
													"    properties: {\r",
													"      responseStatus: {\r",
													"        type: \"object\",\r",
													"        required: [\"resCode\", \"resDesc\"],\r",
													"        properties: {\r",
													"          resCode: { type: \"string\" },\r",
													"          resDesc: { type: \"string\" },\r",
													"          source:  { type: \"string\" }\r",
													"        }\r",
													"      },\r",
													"      message: { type: \"object\" }\r",
													"    }\r",
													"  };\r",
													"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
													"});\r",
													""
												],
												"type": "text/javascript",
												"packages": {},
												"requests": {}
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Accept",
												"value": "application/json",
												"type": "text"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\r\n   \"Srv\": \"CANCEL_SYNTHETIC_ORDER\",\r\n    \"Message\": {\r\n        \"CancelSyntheticOrderRequest\": {\r\n            \"nin\": \"{{NIN}}\",\r\n            \"slno\": \"{{NewSLNO}}\",\r\n            \"userId\": \"{{UserID}}\",\r\n            \"userType\": \"INVESTOR\",\r\n            \"lang\": \"ARB\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"10-08-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}\r\n",
											"options": {
												"raw": {
													"language": "json"
												}
											}
										},
										"url": {
											"raw": "{{BaseURL}}{{Oracle19}}",
											"host": [
												"{{BaseURL}}{{Oracle19}}"
											]
										}
									},
									"response": []
								},
								{
									"name": "Get Order",
									"protocolProfileBehavior": {
										"disableBodyPruning": true
									},
									"request": {
										"method": "GET",
										"header": [
											{
												"key": "Accept",
												"value": "application/json",
												"type": "text"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\r\n    \"Srv\": \"GETORDERS\",\r\n    \"Message\": {\r\n        \"GetOrderRequest\": {\r\n            \"searchWay\": \"SLNO\",\r\n            \"nin\": \"{{NIN}}\",\r\n            \"bySlNO\": \"{{NewSLNO}}\",\r\n            \"byDate\": \"\",\r\n            \"userId\": \"{{NIN}}\",\r\n            \"userType\": \"INVESTOR\",\r\n            \"lang\": \"ENG\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"10-08-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}",
											"options": {
												"raw": {
													"language": "json"
												}
											}
										},
										"url": {
											"raw": "{{BaseURL}}{{Oracle19}}",
											"host": [
												"{{BaseURL}}{{Oracle19}}"
											]
										}
									},
									"response": []
								}
							]
						},
						{
							"name": "StopLimit",
							"item": [
								{
									"name": "Login",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"// Check if the status code is 200\r",
													"pm.test(\"Status code is 200\", function () {\r",
													"    pm.response.to.have.status(200);\r",
													"});\r",
													"\r",
													"// Check if response code is 0\r",
													"pm.test(\"Response code is 0\", function () {\r",
													"    var jsonData = pm.response.json(); // Parse JSON response\r",
													"    pm.expect(jsonData.responseStatus.resCode).to.equal(\"0\");\r",
													"});\r",
													"\r",
													"// Check if response description is \"Successful Operation\"\r",
													"pm.test(\"Response description is 'Successful Operation'\", function () {\r",
													"    var jsonData = pm.response.json();\r",
													"    pm.expect(jsonData.responseStatus.resDesc).to.equal(\"Successful Operation\");\r",
													"});\r",
													"\r",
													"// Check if login is successful and capture NIN\r",
													"pm.test(\"Login successful and NIN captured\", function () {\r",
													"    var jsonData = pm.response.json();\r",
													"    var accounts = jsonData.message.logResponse.accounts.account;\r",
													"\r",
													"    if (accounts.length > 0) {\r",
													"        var nin = accounts[0].nin; // Extract NIN\r",
													"        pm.expect(nin).to.not.be.undefined; // Ensure it's not empty\r",
													"\r",
													"        // Store in environment variables\r",
													"        pm.environment.set(\"NIN\", nin);\r",
													"        pm.environment.set(\"UserID\", nin); // Store the same value in UserID\r",
													"\r",
													"        console.log(\"Captured NIN/UserID:\", nin);\r",
													"    } else {\r",
													"        pm.expect.fail(\"NIN not found in the response.\");\r",
													"    }\r",
													"});\r",
													"\r",
													"// Check if login is successful and SessionID is created\r",
													"pm.test(\"Login successful and SessionID created\", function () {\r",
													"    var jsonData = pm.response.json();\r",
													"    var sessionID = jsonData.message.logResponse.sessionID;\r",
													"\r",
													"    pm.expect(sessionID).to.not.be.undefined; // Assert SessionID exists\r",
													"});\r",
													"\r",
													"// Verify Content-Type header is 'application/json'\r",
													"pm.test(\"Content-Type header is 'application/json'\", function () {\r",
													"    pm.expect(pm.response.headers.get(\"Content-Type\")).to.include(\"application/json\");\r",
													"});\r",
													"\r",
													"// Check if login is successful and capture SessionID\r",
													"pm.test(\"Login successful and SessionID captured\", function () {\r",
													"    var jsonData = pm.response.json();\r",
													"    var sessionID = jsonData.message.logResponse.sessionID;\r",
													"\r",
													"    pm.expect(sessionID).to.not.be.undefined; // Assert SessionID exists\r",
													"    pm.environment.set(\"SessionID\", sessionID); // Save SessionID to environment\r",
													"});\r",
													"\r",
													"// Parse the response JSON\r",
													"var jsonData = pm.response.json();\r",
													"\r",
													"// Verify that the response contains the expected roles\r",
													"pm.test(\"Verify roles in response\", function () {\r",
													"    var roles = jsonData.message.logResponse.roles.role;\r",
													"\r",
													"    // Define expected roles\r",
													"    var expectedRoles = [\"UPDATE_ORDER\", \"SAVE_ORDER\", \"REPORTS\", \"CANCEL_ORDER\"];\r",
													"\r",
													"    // Ensure roles exist in the response\r",
													"    pm.expect(roles).to.be.an(\"array\").that.is.not.empty;\r",
													"\r",
													"    // Check that all expected roles exist in the response\r",
													"    expectedRoles.forEach(role => {\r",
													"        pm.expect(roles).to.include(role, `Missing role: ${role}`);\r",
													"    });\r",
													"\r",
													"    console.log(\"✅ Roles verified successfully:\", roles);\r",
													"});\r",
													""
												],
												"type": "text/javascript",
												"packages": {},
												"requests": {}
											}
										},
										{
											"listen": "prerequest",
											"script": {
												"exec": [
													"// Get current timestamp in ISO format\r",
													"var timestamp = new Date().toISOString();\r",
													"\r",
													"// Store timestamp in Postman environment\r",
													"pm.environment.set(\"currentTimestamp\", timestamp);\r",
													"\r",
													"// Log the timestamp\r",
													"console.log(\"Timestamp Set:\", timestamp);\r",
													""
												],
												"type": "text/javascript",
												"packages": {},
												"requests": {}
											}
										}
									],
									"request": {
										"auth": {
											"type": "noauth"
										},
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json",
												"type": "text"
											},
											{
												"key": "Accept",
												"value": "application/json",
												"type": "text"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\r\n    \"Srv\": \"Login\",\r\n    \"Message\": {\r\n        \"Login\": {\r\n            \"UserName\": \"1218\",\r\n            \"Password\": \"{{Password}}\",\r\n            \"Lang\": \"ARB\"\r\n        }\r\n    },\r\n    \"Version\": \"1.0\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"10-08-2025\"\r\n}",
											"options": {
												"raw": {
													"language": "json"
												}
											}
										},
										"url": {
											"raw": "{{BaseURL}}{{Oracle19}}",
											"host": [
												"{{BaseURL}}{{Oracle19}}"
											]
										}
									},
									"response": []
								},
								{
									"name": "SLimit Save Synthetic Order",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"// ✅ 1. Check status code\r",
													"pm.test(\"Status code is 200\", function () {\r",
													"    pm.response.to.have.status(200);\r",
													"});\r",
													"\r",
													"// ✅ 2. Parse JSON once for reuse\r",
													"const jsonData = pm.response.json();\r",
													"\r",
													"// ✅ 3. Check for resCode 0 (success) OR handle resCode 15 (price error)\r",
													"pm.test(\"Validate response status based on resCode\", function () {\r",
													"    const resCode = jsonData.responseStatus.resCode;\r",
													"    const resDesc = jsonData.responseStatus.resDesc;\r",
													"\r",
													"    if (resCode === \"0\") {\r",
													"        pm.expect(resDesc).to.eql(\"Successful Operation\");\r",
													"    } else if (resCode === \"15\" && resDesc === \"خطأ في السعر\") {\r",
													"        console.warn(\"Price error detected: resCode 15 - خطأ في السعر\");\r",
													"        pm.expect(resCode).to.eql(\"15\"); // Passes with correct error code\r",
													"    } else {\r",
													"        console.warn(\"Unexpected resCode:\", resCode, \"-\", resDesc);\r",
													"        pm.expect.fail(`Unhandled resCode: ${resCode} - ${resDesc}`);\r",
													"    }\r",
													"});\r",
													"\r",
													"// ✅ 4. Check nested response code if available\r",
													"pm.test(\"Check nested resCode1\", function () {\r",
													"    const resCode1 = jsonData.responseStatus.resCode1;\r",
													"    const resDesc1 = jsonData.responseStatus.resDesc1;\r",
													"\r",
													"    if (resCode1 === \"0\") {\r",
													"        pm.expect(resDesc1).to.eql(\"Successful Operation\");\r",
													"    } else if (resCode1 === \"15\" && resDesc1 === \"خطأ في السعر\") {\r",
													"        console.warn(\"Nested price error: resCode1 15 - خطأ في السعر\");\r",
													"        pm.expect(resCode1).to.eql(\"15\");\r",
													"    } else {\r",
													"        console.warn(\"Unhandled nested resCode1:\", resCode1, \"-\", resDesc1);\r",
													"    }\r",
													"});\r",
													"\r",
													"// ✅ 5. Capture `sym` from request body and save to environment\r",
													"pm.test(\"Capture sym from request and save to environment\", function () {\r",
													"    try {\r",
													"        const requestBody = JSON.parse(pm.request.body.raw);\r",
													"        const sym = requestBody.Message.SaveSyntheticOrdRequest.sym;\r",
													"\r",
													"        pm.expect(sym).to.not.be.undefined;\r",
													"        pm.environment.set(\"Symbol\", sym);\r",
													"        console.log(\"Captured sym:\", sym);\r",
													"    } catch (e) {\r",
													"        console.warn(\"Failed to capture sym. Error:\", e.message);\r",
													"        pm.expect.fail(\"Request body structure may not match expected format.\");\r",
													"    }\r",
													"});\r",
													"\r",
													"\r",
													"// ✅ 6. Capture NewSLNO if order is successful\r",
													"pm.test(\"Capture NewSLNO if available\", function () {\r",
													"    if (jsonData.message && jsonData.message.saveSyntheticOrdResponse) {\r",
													"        const newSLNO = jsonData.message.saveSyntheticOrdResponse.newSLNO;\r",
													"\r",
													"        if (newSLNO) {\r",
													"            pm.environment.set(\"NewSLNO\", newSLNO);\r",
													"            console.log(\"Captured NewSLNO:\", newSLNO);\r",
													"            pm.expect(newSLNO).to.not.be.undefined;\r",
													"        } else {\r",
													"            console.warn(\"NewSLNO is missing in response.\");\r",
													"        }\r",
													"    } else {\r",
													"        console.warn(\"saveSyntheticOrdResponse not found, likely due to error response.\");\r",
													"    }\r",
													"});\r",
													"\r",
													""
												],
												"type": "text/javascript",
												"packages": {},
												"requests": {}
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Accept",
												"value": "application/json",
												"type": "text"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\r\n    \"Srv\": \"SAVE_SYNTHETIC_ORDER\",\r\n    \"Message\": {\r\n        \"SaveSyntheticOrdRequest\": {\r\n            \"ordType\": \"BUY\",\r\n            \"nin\": \"{{NIN}}\",\r\n            \"sym\": \"QNNS\",\r\n            \"shrsNo\": \"100\",\r\n            \"shrPrc\": \"10\",\r\n            \"mkPrc\": \"N\",\r\n            \"mPay_type\": \"KB\",\r\n            \"ordVald\": \"0\",\r\n            \"expirationDateTime\": \"\",\r\n            \"usrId\": \"{{UserID}}\",\r\n            \"userType\": \"INVESTOR\",\r\n            \"investorType\": \"INVESTOR\",\r\n            \"lang\": \"ARB\",\r\n            \"orderSource\": \"WEB_ORDERS.25\",\r\n            \"stopPrice\": \"\",\r\n            \"fixType\": \"2\",\r\n            \"discloseVolume\": \"0\",\r\n            \"clientAltIP\": \"{{ClientAltIP}}\",\r\n            \"clientUserIP\": \"10.80.81.158\",\r\n            \"stopLossActivationPrice\": \"9.50\",\r\n            \"stopLossLimitPrice\": \"9.25\",\r\n            \"takeProfitPrice\": \"\",\r\n            \"syntOrderType\": \"StopLoss\",\r\n            \"bestPriceLimitPrice\": \"\",\r\n            \"convertBestPriceToMPOrder\": \"N\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"10-08-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}",
											"options": {
												"raw": {
													"language": "json"
												}
											}
										},
										"url": {
											"raw": "{{BaseURL}}{{Oracle19}}",
											"host": [
												"{{BaseURL}}{{Oracle19}}"
											]
										}
									},
									"response": []
								},
								{
									"name": "SLimit Update Synthetic Order",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"// ✅ 1. Check status code\r",
													"pm.test(\"Status code is 200\", function () {\r",
													"    pm.response.to.have.status(200);\r",
													"});\r",
													"\r",
													"// ✅ 2. Parse JSON once for reuse\r",
													"const jsonData = pm.response.json();\r",
													"\r",
													"// ✅ 3. Check for resCode 0 (success) OR handle resCode 15 (price error) or resCode 17 (operation not allowed)\r",
													"pm.test(\"Validate response status based on resCode\", function () {\r",
													"    const resCode = jsonData.responseStatus.resCode;\r",
													"    const resDesc = jsonData.responseStatus.resDesc;\r",
													"\r",
													"    if (resCode === \"0\") {\r",
													"        pm.expect(resDesc).to.eql(\"Successful Operation\");\r",
													"\r",
													"        // ✅ Safely check for the \"done\" flag in the response\r",
													"        const doneFlag = jsonData.message?.updateSyntheticOrderResponse?.done;\r",
													"        pm.expect(doneFlag).to.eql(\"OK\");\r",
													"        console.log(\"✅ Order updated successfully.\");\r",
													"    } else if (resCode === \"15\" && resDesc === \"خطأ في السعر\") {\r",
													"        console.warn(\"Price error detected: resCode 15 - خطأ في السعر\");\r",
													"        pm.expect(resCode).to.eql(\"15\"); // Mark as expected handled error\r",
													"    } else if (resCode === \"17\" && resDesc === \"غير مسموح بالعمليه\") {\r",
													"        console.warn(\"Operation not allowed: resCode 17 - غير مسموح بالعمليه\");\r",
													"        pm.expect(resCode).to.eql(\"17\"); // Mark as expected handled error\r",
													"    } else {\r",
													"        console.warn(\"Unexpected resCode:\", resCode, \"-\", resDesc);\r",
													"        pm.expect.fail(`Unhandled resCode: ${resCode} - ${resDesc}`);\r",
													"    }\r",
													"});\r",
													"\r",
													"// ✅ 4. Check nested response code if available\r",
													"pm.test(\"Check nested resCode1\", function () {\r",
													"    const resCode1 = jsonData.responseStatus.resCode1;\r",
													"    const resDesc1 = jsonData.responseStatus.resDesc1;\r",
													"\r",
													"    if (resCode1 === \"0\") {\r",
													"        pm.expect(resDesc1).to.eql(\"Successful Operation\");\r",
													"    } else if (resCode1 === \"15\" && resDesc1 === \"خطأ في السعر\") {\r",
													"        console.warn(\"Nested price error: resCode1 15 - خطأ في السعر\");\r",
													"        pm.expect(resCode1).to.eql(\"15\");\r",
													"    } else {\r",
													"        console.warn(\"Unhandled nested resCode1:\", resCode1, \"-\", resDesc1);\r",
													"    }\r",
													"});\r",
													"\r",
													"// ✅ 5. Capture `sym` from request body and save to environment\r",
													"pm.test(\"Capture sym from request and save to environment\", function () {\r",
													"    try {\r",
													"        const requestBody = JSON.parse(pm.request.body.raw);\r",
													"        const sym = requestBody.Message.UpdateSyntheticOrderRequest.sym;\r",
													"\r",
													"        pm.expect(sym).to.not.be.undefined;\r",
													"        pm.environment.set(\"Symbol\", sym);\r",
													"        console.log(\"Captured sym:\", sym);\r",
													"    } catch (e) {\r",
													"        console.warn(\"Failed to capture sym. Error:\", e.message);\r",
													"        pm.expect.fail(\"Request body structure may not match expected format.\");\r",
													"    }\r",
													"});\r",
													"\r",
													"\r",
													"// ✅ 6. Capture NewSLNO if order is successful\r",
													"pm.test(\"Capture NewSLNO if available\", function () {\r",
													"    if (jsonData.message && jsonData.message.saveSyntheticOrdResponse) {\r",
													"        const newSLNO = jsonData.message.saveSyntheticOrdResponse.newSLNO;\r",
													"\r",
													"        if (newSLNO) {\r",
													"            pm.environment.set(\"NewSLNO\", newSLNO);\r",
													"            console.log(\"Captured NewSLNO:\", newSLNO);\r",
													"            pm.expect(newSLNO).to.not.be.undefined;\r",
													"        } else {\r",
													"            console.warn(\"NewSLNO is missing in response.\");\r",
													"        }\r",
													"    } else {\r",
													"        console.warn(\"saveSyntheticOrdResponse not found, likely due to error response.\");\r",
													"    }\r",
													"});\r",
													""
												],
												"type": "text/javascript",
												"packages": {},
												"requests": {}
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Accept",
												"value": "application/json",
												"type": "text"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\r\n    \"Srv\": \"UPDATE_SYNTHETIC_ORDER\",\r\n    \"Message\": {\r\n        \"UpdateSyntheticOrderRequest\": {\r\n            \"sLNO\": \"{{NewSLNO}}\",\r\n            \"ordType\": \"\",\r\n            \"nin\": \"{{NIN}}\",\r\n            \"sym\": \"{{Symbol}}\",\r\n            \"shrsNo\": \"111\",\r\n            \"shrPrc\": \"9.5\",\r\n            \"mkPrc\": \"N\",\r\n            \"ordVald\": \"0\",\r\n            \"expirationDateTime\": \"\",\r\n            \"userId\": \"{{UserID}}\",\r\n            \"userType\": \"INVESTOR\",\r\n            \"inv_Type\": \"INVESTOR\",\r\n            \"lang\": \"ARB\",\r\n            \"stopPrice\": \"\",\r\n            \"fixType\": \"2\",\r\n            \"discloseVolume\": \"0\",\r\n            \"clientAltIP\": \"{{ClientAltIP}}\",\r\n            \"clientUserIP\": \"10.80.81.158\",\r\n            \"stopLossActivationPrice\": \"9.25\",\r\n            \"stopLossLimitPrice\": \"9.00\",\r\n            \"takeProfitPrice\": \"\",\r\n            \"syntOrderType\": \"StopLoss\",\r\n            \"bestPriceLimitPrice\": \"\",\r\n            \"convertBestPriceToMPOrder\": \"N\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"10-08-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}",
											"options": {
												"raw": {
													"language": "json"
												}
											}
										},
										"url": {
											"raw": "{{BaseURL}}{{Oracle19}}",
											"host": [
												"{{BaseURL}}{{Oracle19}}"
											]
										}
									},
									"response": []
								},
								{
									"name": "Cancel Synthetic Order Copy",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"/**\r",
													" * CANCEL_SYNTHETIC_ORDER / CANCEL_ORDER – unified validator\r",
													" * Handles:\r",
													" *   - Success: resCode \"0\" -> message.(cancelSyntheticOrderResponse|canOrderResponse|cancelOrderResponse).done === \"OK\"\r",
													" *   - Not allowed / already cancelled: resCode \"17\" (Arabic or English message accepted)\r",
													" * Saves:\r",
													" *   - CANCEL_DONE (\"OK\" on success) \r",
													" */\r",
													"\r",
													"pm.test(\"HTTP 200\", function () {\r",
													"  pm.response.to.have.status(200);\r",
													"});\r",
													"\r",
													"pm.test(\"Content-Type is JSON\", function () {\r",
													"  pm.response.to.have.header(\"Content-Type\");\r",
													"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
													"});\r",
													"\r",
													"let json;\r",
													"pm.test(\"Body is JSON\", function () {\r",
													"  json = pm.response.json();\r",
													"  pm.expect(json).to.be.an(\"object\");\r",
													"});\r",
													"\r",
													"// Envelope\r",
													"pm.test(\"Envelope present\", function () {\r",
													"  const rs = json.responseStatus || {};\r",
													"  pm.expect(rs).to.have.property(\"resCode\");\r",
													"  pm.expect(rs).to.have.property(\"resDesc\");\r",
													"  // If the API returns a specific source, accept either \"CANCEL_SYNTHETIC_ORDER\" or legacy variants\r",
													"  if (rs.source) {\r",
													"    pm.expect([\"CANCEL_SYNTHETIC_ORDER\", \"CANCEL_ORDER\"]).to.include(rs.source);\r",
													"  }\r",
													"});\r",
													"\r",
													"// Helper to get the response node safely (covers different naming variants)\r",
													"function getCancelNode(j) {\r",
													"  const msg = (j && j.message) || {};\r",
													"  return msg.cancelSyntheticOrderResponse || msg.canOrderResponse || msg.cancelOrderResponse || null;\r",
													"}\r",
													"\r",
													"// Branch logic\r",
													"pm.test(\"Handle CANCEL_ORDER response codes correctly\", function () {\r",
													"  const rs = json.responseStatus || {};\r",
													"  const code = String(rs.resCode || \"\");\r",
													"  const desc = String(rs.resDesc || \"\");\r",
													"  const node = getCancelNode(json);\r",
													"\r",
													"  if (code === \"0\") {\r",
													"    pm.expect(desc).to.eql(\"Successful Operation\");\r",
													"    pm.expect(node, \"cancel response node should exist on success\").to.be.an(\"object\");\r",
													"    pm.expect(node).to.have.property(\"done\");\r",
													"    pm.expect(String(node.done)).to.eql(\"OK\");\r",
													"    pm.environment.set(\"CANCEL_DONE\", \"OK\");\r",
													"    console.log(\"✅ Order cancelled successfully.\");\r",
													"  } else if (code === \"17\") {\r",
													"    // Accept Arabic: \"غير مسموح بالعمليه\" or English fallback \"Operation Not Allowed\"\r",
													"    const ok = desc === \"غير مسموح بالعمليه\" || desc === \"Operation Not Allowed\";\r",
													"    pm.expect(ok, \"resDesc should indicate not allowed / already cancelled\").to.be.true;\r",
													"    pm.environment.unset(\"CANCEL_DONE\");\r",
													"    console.warn(\"⚠️ Order already cancelled or not allowed (resCode 17).\");\r",
													"  } else {\r",
													"    console.warn(\"⚠️ Unexpected resCode:\", code, \"-\", desc);\r",
													"    // No hard assertion here to avoid false failures on new business codes\r",
													"  }\r",
													"});\r",
													"\r",
													"// Minimal schema (relaxed)\r",
													"pm.test(\"Schema (relaxed) validates\", function () {\r",
													"  const schema = {\r",
													"    type: \"object\",\r",
													"    required: [\"responseStatus\", \"message\"],\r",
													"    properties: {\r",
													"      responseStatus: {\r",
													"        type: \"object\",\r",
													"        required: [\"resCode\", \"resDesc\"],\r",
													"        properties: {\r",
													"          resCode: { type: \"string\" },\r",
													"          resDesc: { type: \"string\" },\r",
													"          source:  { type: \"string\" }\r",
													"        }\r",
													"      },\r",
													"      message: { type: \"object\" }\r",
													"    }\r",
													"  };\r",
													"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
													"});\r",
													""
												],
												"type": "text/javascript",
												"packages": {},
												"requests": {}
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Accept",
												"value": "application/json",
												"type": "text"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\r\n   \"Srv\": \"CANCEL_SYNTHETIC_ORDER\",\r\n    \"Message\": {\r\n        \"CancelSyntheticOrderRequest\": {\r\n            \"nin\": \"{{NIN}}\",\r\n            \"slno\": \"{{NewSLNO}}\",\r\n            \"userId\": \"{{UserID}}\",\r\n            \"userType\": \"INVESTOR\",\r\n            \"lang\": \"ARB\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"10-08-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}\r\n",
											"options": {
												"raw": {
													"language": "json"
												}
											}
										},
										"url": {
											"raw": "{{BaseURL}}{{Oracle19}}",
											"host": [
												"{{BaseURL}}{{Oracle19}}"
											]
										}
									},
									"response": []
								},
								{
									"name": "Get Order",
									"protocolProfileBehavior": {
										"disableBodyPruning": true
									},
									"request": {
										"method": "GET",
										"header": [
											{
												"key": "Accept",
												"value": "application/json",
												"type": "text"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\r\n    \"Srv\": \"GETORDERS\",\r\n    \"Message\": {\r\n        \"GetOrderRequest\": {\r\n            \"searchWay\": \"SLNO\",\r\n            \"nin\": \"{{NIN}}\",\r\n            \"bySlNO\": \"{{NewSLNO}}\",\r\n            \"byDate\": \"\",\r\n            \"userId\": \"{{NIN}}\",\r\n            \"userType\": \"INVESTOR\",\r\n            \"lang\": \"ENG\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"10-08-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}",
											"options": {
												"raw": {
													"language": "json"
												}
											}
										},
										"url": {
											"raw": "{{BaseURL}}{{Oracle19}}",
											"host": [
												"{{BaseURL}}{{Oracle19}}"
											]
										}
									},
									"response": []
								}
							]
						}
					]
				},
				{
					"name": "Error handling",
					"item": [
						{
							"name": "TP Save Synthetic Order insufficient balance",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"/**\r",
											" * SAVE_SYNTHETIC_ORDER – Negative: Insufficient balance\r",
											" * Expect:\r",
											" *  - HTTP 200\r",
											" *  - responseStatus.resCode/resCode1 = \"16\"\r",
											" *  - source=\"SAVE_SYNTHETIC_ORDER\"\r",
											" *  - Arabic message like \"رصيد غير كافي\"\r",
											" *  - No business payload\r",
											" *\r",
											" * Saves:\r",
											" *  SAVE_SYNTHETIC_ORDER_ERR_CODE=16, SAVE_SYNTHETIC_ORDER_ERR_DESC\r",
											" *\r",
											" * Optional soft cross-checks (set in Env/Globals if you want strict assertions):\r",
											" *  - BUYING_POWER (number) and FEES_RATE (e.g., 0.00275)\r",
											" *  - STRICT_CASH_CHECK = Y|N (default N) -> if Y, assert totalCost > BUYING_POWER\r",
											" */\r",
											"\r",
											"pm.test(\"HTTP 200\", function(){ pm.response.to.have.status(200); });\r",
											"\r",
											"pm.test(\"Content-Type JSON\", function(){\r",
											"  pm.response.to.have.header(\"Content-Type\");\r",
											"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
											"});\r",
											"\r",
											"// Parse\r",
											"var json;\r",
											"pm.test(\"Body is JSON\", function(){\r",
											"  json = pm.response.json();\r",
											"  pm.expect(json).to.be.an(\"object\");\r",
											"});\r",
											"\r",
											"// Helpers\r",
											"function trim(s){ return String(s == null ? \"\" : s).replace(/^\\s+|\\s+$/g,\"\"); }\r",
											"function isNumStr(v){ return typeof v === \"string\" && /^-?\\d+(\\.\\d+)?$/.test(v); }\r",
											"function getFlag(name, defVal){\r",
											"  var v = pm.environment.get(name) || pm.globals.get(name);\r",
											"  v = (v == null ? \"\" : String(v)).toUpperCase();\r",
											"  if (v !== \"Y\" && v !== \"N\") return defVal;\r",
											"  return v;\r",
											"}\r",
											"\r",
											"// Envelope\r",
											"var rs = json.responseStatus || {};\r",
											"pm.test(\"responseStatus indicates insufficient balance (16)\", function(){\r",
											"  pm.expect(rs.source).to.eql(\"SAVE_SYNTHETIC_ORDER\");\r",
											"  pm.expect(rs.resCode).to.eql(\"16\");\r",
											"  pm.expect(rs.resCode1).to.eql(\"16\");\r",
											"  var d0 = trim(rs.resDesc), d1 = trim(rs.resDesc1);\r",
											"  pm.expect(/رصيد\\s*غير\\s*كافي/.test(d0) || /رصيد\\s*غير\\s*كافي/.test(d1), \"Arabic message should say insufficient balance\").to.be.true;\r",
											"});\r",
											"\r",
											"// No business payload\r",
											"pm.test(\"No business payload on error\", function(){\r",
											"  var msg = json.message;\r",
											"  var empty = (msg == null) || (typeof msg === \"object\" && Object.keys(msg).length === 0);\r",
											"  pm.expect(empty, \"message should be absent or empty for error\").to.be.true;\r",
											"});\r",
											"\r",
											"// Optional soft cross-check: (price * qty) * (1 + fees) > BUYING_POWER\r",
											"pm.test(\"Optional: total cost exceeds buying power (if configured)\", function(){\r",
											"  var strict = getFlag(\"STRICT_CASH_CHECK\",\"N\") === \"Y\";\r",
											"  // pull request body\r",
											"  var body = {};\r",
											"  try { body = pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {}; } catch(e){}\r",
											"  // find price/qty\r",
											"  function findFirstByKey(o, regex){\r",
											"    if (!o || typeof o !== \"object\") return null;\r",
											"    for (var k in o){\r",
											"      if (!o.hasOwnProperty(k)) continue;\r",
											"      var v = o[k];\r",
											"      if (regex.test(String(k)) && (typeof v === \"number\" || isNumStr(String(v)))) return Number(v);\r",
											"      if (v && typeof v === \"object\"){ var t = findFirstByKey(v, regex); if (t !== null) return t; }\r",
											"    }\r",
											"    return null;\r",
											"  }\r",
											"  var price = findFirstByKey(body, /^(price|orderPrice|prc)$/i);\r",
											"  var qty   = findFirstByKey(body, /^(qty|quantity|orderQty|qnt)$/i);\r",
											"  var bpStr = pm.environment.get(\"BUYING_POWER\") || pm.globals.get(\"BUYING_POWER\") ||\r",
											"              pm.environment.get(\"AVAILABLE_BUYING_POWER\") || pm.globals.get(\"AVAILABLE_BUYING_POWER\") || \"\";\r",
											"  var feeStr = pm.environment.get(\"FEES_RATE\") || pm.globals.get(\"FEES_RATE\") || \"0\";\r",
											"  if (price !== null && qty !== null && (isNumStr(bpStr) || typeof bpStr === \"number\")) {\r",
											"    var bp = Number(bpStr);\r",
											"    var fees = Number(feeStr) || 0;\r",
											"    var total = price * qty * (1 + fees);\r",
											"    if (strict) {\r",
											"      pm.expect(total, \"totalCost > BUYING_POWER (strict)\").to.be.above(bp);\r",
											"    } else {\r",
											"      if (!(total > bp)) console.warn(\"Optional check: totalCost <= BUYING_POWER (not asserting). total=\", total, \"bp=\", bp);\r",
											"    }\r",
											"  } else {\r",
											"    console.warn(\"Optional cash check skipped: missing price/qty or BUYING_POWER.\");\r",
											"  }\r",
											"});\r",
											"\r",
											"// Save env\r",
											"pm.environment.set(\"SAVE_ORDER_ERR_CODE\",\"16\");\r",
											"pm.environment.set(\"SAVE_ORDER_ERR_DESC\", String(rs.resDesc || \"\"));\r",
											"\r",
											"// Minimal schema\r",
											"pm.test(\"Schema (minimal) validates\", function(){\r",
											"  var schema = {\r",
											"    type: \"object\",\r",
											"    required: [\"responseStatus\"],\r",
											"    properties: {\r",
											"      responseStatus: {\r",
											"        type: \"object\",\r",
											"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
											"        properties: {\r",
											"          source: {\"const\":\"SAVE_ORDER\"},\r",
											"          resCode: {\"const\":\"16\"},\r",
											"          resCode1: {\"const\":\"16\"}\r",
											"        }\r",
											"      }\r",
											"    }\r",
											"  };\r",
											"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
											"});\r",
											"\r",
											"// Optional: request Srv guard\r",
											"pm.test(\"Request Srv is SAVE_ORDER\", function(){\r",
											"  try {\r",
											"    var req = pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {};\r",
											"    pm.expect((req || {}).Srv).to.eql(\"SAVE_ORDER\");\r",
											"  } catch(e){ console.warn(\"Could not parse request body:\", e.message); }\r",
											"});\r",
											"\r",
											"console.log(\"❌ SAVE_ORDER insufficient balance (16)\");\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Accept",
										"value": "application/json",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\r\n    \"Srv\": \"SAVE_SYNTHETIC_ORDER\",\r\n    \"Message\": {\r\n        \"SaveSyntheticOrdRequest\": {\r\n            \"ordType\": \"BUY\",\r\n            \"nin\": \"{{NIN}}\",\r\n            \"sym\": \"QNNS\",\r\n            \"shrsNo\": \"1000000000\",\r\n            \"shrPrc\": \"10.2\",\r\n            \"mkPrc\": \"N\",\r\n            \"mPay_type\": \"KB\",\r\n            \"ordVald\": \"1\",\r\n            \"expirationDateTime\": \"\",\r\n            \"usrId\": \"{{UserID}}\",\r\n            \"userType\": \"INVESTOR\",\r\n            \"investorType\": \"INVESTOR\",\r\n            \"lang\": \"ARB\",\r\n            \"orderSource\": \"WEB_ORDERS.25\",\r\n            \"stopPrice\": \"\",\r\n            \"fixType\": \"2\",\r\n            \"discloseVolume\": \"0\",\r\n            \"clientAltIP\": \"{{ClientAltIP}}\",\r\n            \"clientUserIP\": \"10.80.81.158\",\r\n            \"stopLossActivationPrice\": \"\",\r\n            \"stopLossLimitPrice\": \"\",\r\n            \"takeProfitPrice\": \"10.5\",\r\n            \"syntOrderType\": \"TakeProfit\",\r\n            \"bestPriceLimitPrice\": \"\",\r\n            \"convertBestPriceToMPOrder\": \"N\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"10-08-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{BaseURL}}{{Oracle19}}",
									"host": [
										"{{BaseURL}}{{Oracle19}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "TP Save Synthetic Order Wrong Price",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"/**\r",
											" * SAVE_SYNTHETIC_ORDER – Negative: Wrong price\r",
											" * Expect:\r",
											" *  - HTTP 200\r",
											" *  - responseStatus.resCode/resCode1 = \"15\"\r",
											" *  - source=\"SAVE_SYNTHETIC_ORDER\"\r",
											" *  - Arabic message like \"خطأ في السعر\"\r",
											" *  - No business payload\r",
											" *\r",
											" * Saves:\r",
											" *  SAVE_SYNTHETIC_ORDER_ERR_CODE=15,SAVE_SYNTHETIC_ORDER_ERR_DESC\r",
											" *\r",
											" * Optional price-band checks (Env/Globals):\r",
											" *  - PRICE_LIMIT_UP, PRICE_LIMIT_DOWN  (numbers as strings)\r",
											" *  - STRICT_RANGE_CHECK = Y|N (default N) -> if Y, assert price is outside [down, up]\r",
											" */\r",
											"\r",
											"pm.test(\"HTTP 200\", function(){ pm.response.to.have.status(200); });\r",
											"\r",
											"pm.test(\"Content-Type JSON\", function(){\r",
											"  pm.response.to.have.header(\"Content-Type\");\r",
											"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
											"});\r",
											"\r",
											"// Parse\r",
											"var json;\r",
											"pm.test(\"Body is JSON\", function(){\r",
											"  json = pm.response.json();\r",
											"  pm.expect(json).to.be.an(\"object\");\r",
											"});\r",
											"\r",
											"// Helpers\r",
											"function trim(s){ return String(s == null ? \"\" : s).replace(/^\\s+|\\s+$/g,\"\"); }\r",
											"function isNumStr(v){ return typeof v === \"string\" && /^-?\\d+(\\.\\d+)?$/.test(v); }\r",
											"function getFlag(name, defVal){\r",
											"  var v = pm.environment.get(name) || pm.globals.get(name);\r",
											"  v = (v == null ? \"\" : String(v)).toUpperCase();\r",
											"  if (v !== \"Y\" && v !== \"N\") return defVal;\r",
											"  return v;\r",
											"}\r",
											"\r",
											"// Envelope\r",
											"var rs = json.responseStatus || {};\r",
											"pm.test(\"responseStatus indicates wrong price (15)\", function(){\r",
											"  pm.expect(rs.source).to.eql(\"SAVE_SYNTHETIC_ORDER\");\r",
											"  pm.expect(rs.resCode).to.eql(\"15\");\r",
											"  pm.expect(rs.resCode1).to.eql(\"15\");\r",
											"  var d0 = trim(rs.resDesc), d1 = trim(rs.resDesc1);\r",
											"  pm.expect(/خطأ\\s*في\\s*السعر/.test(d0) || /خطأ\\s*في\\s*السعر/.test(d1), \"Arabic message should say wrong price\").to.be.true;\r",
											"});\r",
											"\r",
											"// No business payload\r",
											"pm.test(\"No business payload on error\", function(){\r",
											"  var msg = json.message;\r",
											"  var empty = (msg == null) || (typeof msg === \"object\" && Object.keys(msg).length === 0);\r",
											"  pm.expect(empty, \"message should be absent or empty for error\").to.be.true;\r",
											"});\r",
											"\r",
											"// Optional: price outside allowed band (strict or warn)\r",
											"pm.test(\"Optional: price outside [limitDown, limitUp] (if provided)\", function(){\r",
											"  var strict = getFlag(\"STRICT_RANGE_CHECK\", \"N\") === \"Y\";\r",
											"  var body = {};\r",
											"  try { body = pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {}; } catch(e){}\r",
											"  function findFirstByKey(o, regex){\r",
											"    if (!o || typeof o !== \"object\") return null;\r",
											"    for (var k in o){\r",
											"      if (!o.hasOwnProperty(k)) continue;\r",
											"      var v = o[k];\r",
											"      if (regex.test(String(k)) && (typeof v === \"number\" || isNumStr(String(v)))) return Number(v);\r",
											"      if (v && typeof v === \"object\"){ var t = findFirstByKey(v, regex); if (t !== null) return t; }\r",
											"    }\r",
											"    return null;\r",
											"  }\r",
											"  var price = findFirstByKey(body, /^(price|orderPrice|prc)$/i);\r",
											"  var upStr   = pm.environment.get(\"PRICE_LIMIT_UP\")   || pm.globals.get(\"PRICE_LIMIT_UP\")   || \"\";\r",
											"  var downStr = pm.environment.get(\"PRICE_LIMIT_DOWN\") || pm.globals.get(\"PRICE_LIMIT_DOWN\") || \"\";\r",
											"  if (price !== null && (isNumStr(upStr) || isNumStr(downStr))) {\r",
											"    var up = isNumStr(upStr) ? Number(upStr) : +Infinity;\r",
											"    var dn = isNumStr(downStr) ? Number(downStr) : -Infinity;\r",
											"    var outside = (price > up) || (price < dn);\r",
											"    if (strict) {\r",
											"      pm.expect(outside, \"price must be outside [\"+dn+\", \"+up+\"] (strict)\").to.be.true;\r",
											"    } else if (!outside) {\r",
											"      console.warn(\"Optional range check: price within band; backend still returned 'wrong price'. price=\", price, \"band=[\", dn, \",\", up, \"]\");\r",
											"    }\r",
											"  } else {\r",
											"    console.warn(\"Optional range check skipped: missing price or limits.\");\r",
											"  }\r",
											"});\r",
											"\r",
											"// Save env\r",
											"pm.environment.set(\"SAVE_ORDER_ERR_CODE\",\"15\");\r",
											"pm.environment.set(\"SAVE_ORDER_ERR_DESC\", String(rs.resDesc || \"\"));\r",
											"\r",
											"// Minimal schema\r",
											"pm.test(\"Schema (minimal) validates\", function(){\r",
											"  var schema = {\r",
											"    type: \"object\",\r",
											"    required: [\"responseStatus\"],\r",
											"    properties: {\r",
											"      responseStatus: {\r",
											"        type: \"object\",\r",
											"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
											"        properties: {\r",
											"          source: {\"const\":\"SAVE_ORDER\"},\r",
											"          resCode: {\"const\":\"15\"},\r",
											"          resCode1: {\"const\":\"15\"}\r",
											"        }\r",
											"      }\r",
											"    }\r",
											"  };\r",
											"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
											"});\r",
											"\r",
											"// Optional: request Srv guard\r",
											"pm.test(\"Request Srv is SAVE_ORDER\", function(){\r",
											"  try {\r",
											"    var req = pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {};\r",
											"    pm.expect((req || {}).Srv).to.eql(\"SAVE_ORDER\");\r",
											"  } catch(e){ console.warn(\"Could not parse request body:\", e.message); }\r",
											"});\r",
											"\r",
											"console.log(\"❌ SAVE_ORDER wrong price (15)\");\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Accept",
										"value": "application/json",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\r\n    \"Srv\": \"SAVE_SYNTHETIC_ORDER\",\r\n    \"Message\": {\r\n        \"SaveSyntheticOrdRequest\": {\r\n            \"ordType\": \"BUY\",\r\n            \"nin\": \"{{NIN}}\",\r\n            \"sym\": \"QGTS\",\r\n            \"shrsNo\": \"100\",\r\n            \"shrPrc\": \"13000000.2\",\r\n            \"mkPrc\": \"N\",\r\n            \"mPay_type\": \"KB\",\r\n            \"ordVald\": \"1\",\r\n            \"expirationDateTime\": \"\",\r\n            \"usrId\": \"{{UserID}}\",\r\n            \"userType\": \"INVESTOR\",\r\n            \"investorType\": \"INVESTOR\",\r\n            \"lang\": \"ARB\",\r\n            \"orderSource\": \"WEB_ORDERS.25\",\r\n            \"stopPrice\": \"\",\r\n            \"fixType\": \"2\",\r\n            \"discloseVolume\": \"0\",\r\n            \"clientAltIP\": \"{{ClientAltIP}}\",\r\n            \"clientUserIP\": \"10.80.81.158\",\r\n            \"stopLossActivationPrice\": \"\",\r\n            \"stopLossLimitPrice\": \"\",\r\n            \"takeProfitPrice\": \"12\",\r\n            \"syntOrderType\": \"TakeProfit\",\r\n            \"bestPriceLimitPrice\": \"\",\r\n            \"convertBestPriceToMPOrder\": \"N\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"10-08-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{BaseURL}}{{Oracle19}}",
									"host": [
										"{{BaseURL}}{{Oracle19}}"
									]
								}
							},
							"response": []
						}
					]
				}
			]
		},
		{
			"name": "21. OTP",
			"item": [
				{
					"name": "Transfer to the GROUP",
					"item": [
						{
							"name": "Transfer to The Group",
							"item": [
								{
									"name": "1. Get Banks info",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"/**\r",
													" * BNKBAL – Bank balances & info (ES5)\r",
													" * Validates:\r",
													" *  - HTTP 200, JSON, envelope codes 0/0, source=\"BNKBAL\"\r",
													" *  - bnkInfoResponse existence and key formats\r",
													" *  - Balance fields are numeric strings; negatives allowed by default (toggle strict)\r",
													" *  - banksInfo.bnkInfoRec / bnkTransfers.bnkTransferRec array shapes\r",
													" *  - financierInfo & fundInfo consistency; creditRatio accepts ratio or percent\r",
													" *  - financierInfo fields accept null/\"null\"/\"\" gracefully\r",
													" * Keeps your extracts:\r",
													" *  - accountSeq_i, bnkCode_i, accountCode_i, transferTimeId_i, bankCount\r",
													" *\r",
													" * Optional toggles (Env/Globals):\r",
													" *  - ENFORCE_NON_NEG_BALANCES = Y|N (default N) -> force balances >= 0\r",
													" */\r",
													"\r",
													"// 1) Status code\r",
													"pm.test(\"Status code is 200\", function () {\r",
													"  pm.response.to.have.status(200);\r",
													"});\r",
													"\r",
													"// 2) Envelope base checks\r",
													"pm.test(\"resCode is 0 and resDesc is Successful Operation\", function () {\r",
													"  var resStatus = (pm.response.json() || {}).responseStatus || {};\r",
													"  pm.expect(resStatus.resCode).to.eql(\"0\");\r",
													"  pm.expect(resStatus.resDesc).to.eql(\"Successful Operation\");\r",
													"});\r",
													"\r",
													"// 3) Extract and set bank info (kept as-is)\r",
													"var __json_for_extract = pm.response.json() || {};\r",
													"var __bnkInfoList = ((((__json_for_extract.message || {}).bnkInfoResponse || {}).banksInfo || {}).bnkInfoRec);\r",
													"\r",
													"if (Array.isArray(__bnkInfoList)) {\r",
													"  // Clear previous values\r",
													"  pm.environment.unset(\"bankCount\");\r",
													"\r",
													"  for (var i = 0; i < __bnkInfoList.length; i++) {\r",
													"    var bnk = __bnkInfoList[i] || {};\r",
													"    pm.environment.set(\"accountSeq_\" + (i + 1), String(bnk.accountSeq || \"\"));\r",
													"    pm.environment.set(\"bnkCode_\" + (i + 1), String(bnk.bnkCode || \"\"));\r",
													"    pm.environment.set(\"accountCode_\" + (i + 1), String(bnk.accountCode || \"\"));\r",
													"    pm.environment.set(\"transferTimeId_\" + (i + 1), String(bnk.transferTimeId || \"\"));\r",
													"  }\r",
													"  pm.environment.set(\"bankCount\", String(__bnkInfoList.length));\r",
													"} else {\r",
													"  console.warn(\"banksInfo.bnkInfoRec not found or invalid\");\r",
													"}\r",
													"\r",
													"// Basic header check\r",
													"pm.test(\"Content-Type is JSON\", function () {\r",
													"  pm.response.to.have.header(\"Content-Type\");\r",
													"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
													"});\r",
													"\r",
													"// Parse once & helpers\r",
													"var json = pm.response.json() || {};\r",
													"var rs   = json.responseStatus || {};\r",
													"var bnr  = (json.message || {}).bnkInfoResponse || {};\r",
													"\r",
													"function isNumericStr(v) {\r",
													"  if (typeof v === \"number\") return isFinite(v);\r",
													"  return typeof v === \"string\" && /^-?\\d+(\\.\\d+)?$/.test(v);\r",
													"}\r",
													"function isIntStr(v) {\r",
													"  if (typeof v === \"number\") return Number.isInteger(v);\r",
													"  return typeof v === \"string\" && /^-?\\d+$/.test(v);\r",
													"}\r",
													"function isYN(v)  { return String(v) === \"Y\" || String(v) === \"N\"; }\r",
													"function isNullish(v) {\r",
													"  return v === null || typeof v === \"undefined\" || String(v).trim().toUpperCase() === \"NULL\" || String(v).trim() === \"\";\r",
													"}\r",
													"\r",
													"// Envelope completeness\r",
													"pm.test(\"Envelope complete (BNKBAL)\", function () {\r",
													"  pm.expect(rs.resCode).to.eql(\"0\");\r",
													"  pm.expect(rs.resDesc).to.eql(\"Successful Operation\");\r",
													"  pm.expect(rs.source).to.eql(\"BNKBAL\");\r",
													"  pm.expect(rs.resCode1).to.eql(\"0\");\r",
													"  pm.expect(rs.resDesc1).to.eql(\"Successful Operation\");\r",
													"});\r",
													"\r",
													"// Core node exists\r",
													"pm.test(\"bnkInfoResponse exists\", function () {\r",
													"  pm.expect(bnr).to.be.an(\"object\");\r",
													"});\r",
													"\r",
													"// Name (if provided)\r",
													"pm.test(\"Customer name (if present) is a non-empty string\", function () {\r",
													"  if (typeof bnr.name !== \"undefined\") {\r",
													"    pm.expect(bnr.name).to.be.a(\"string\").and.to.not.equal(\"\");\r",
													"  }\r",
													"});\r",
													"\r",
													"// Balance fields – allow negatives by default (set ENFORCE_NON_NEG_BALANCES=Y to force >=0)\r",
													"pm.test(\"All balance fields are numeric strings (with optional non-negative enforcement)\", function () {\r",
													"  var keys = [\r",
													"    \"buybal1\",\"currentBal\",\"buyBal\",\"buyBal1\",\"onLineBal1\",\"maxBalance1\",\"unclearedBal\",\r",
													"    \"tradeBal\",\"t3Bal\",\"chqColl\",\"onlineBal\",\"todayDepo\",\"todayDepos\",\"allowedBal\",\r",
													"    \"postponed\",\"reservedFawriBalance\",\"maxbalance\",\"newMaxBalance\"\r",
													"  ];\r",
													"  var enforce = String(pm.environment.get(\"ENFORCE_NON_NEG_BALANCES\") || pm.globals.get(\"ENFORCE_NON_NEG_BALANCES\") || \"N\").toUpperCase() === \"Y\";\r",
													"\r",
													"  for (var i=0;i<keys.length;i++){\r",
													"    var k = keys[i];\r",
													"    if (typeof bnr[k] !== \"undefined\") {\r",
													"      pm.expect(isNumericStr(bnr[k]), k + \" must be numeric\").to.be.true;\r",
													"      if (enforce) {\r",
													"        pm.expect(Number(bnr[k]), k + \" must be >= 0 (strict mode)\").to.be.at.least(0);\r",
													"      }\r",
													"    }\r",
													"  }\r",
													"});\r",
													"\r",
													"// banksInfo array and each record format\r",
													"pm.test(\"banksInfo.bnkInfoRec is array (can be empty)\", function () {\r",
													"  var arr = (((bnr || {}).banksInfo || {}).bnkInfoRec);\r",
													"  pm.expect(arr, \"bnkInfoRec\").to.be.an(\"array\");\r",
													"});\r",
													"\r",
													"(function validateBankRecords(){\r",
													"  var arr = (((bnr || {}).banksInfo || {}).bnkInfoRec) || [];\r",
													"  if (!Array.isArray(arr) || arr.length === 0) return;\r",
													"\r",
													"  for (var i=0;i<arr.length;i++){\r",
													"    var rec = arr[i] || {};\r",
													"\r",
													"    pm.expect(String(rec.accountSeq || \"\"), \"accountSeq\").to.match(/^\\d+$/);\r",
													"\r",
													"    // bankCode: allow alphanumeric 2–10 chars (covers \"QNB\" and \"535\")\r",
													"    if (typeof rec.bankCode !== \"undefined\") {\r",
													"      var bc = String(rec.bankCode || \"\").trim().toUpperCase();\r",
													"      pm.expect(bc, \"bankCode non-empty\").to.not.equal(\"\");\r",
													"      pm.expect(bc, \"bankCode format A–Z/0–9, len 2–10\").to.match(/^[A-Z0-9]{2,10}$/);\r",
													"    }\r",
													"\r",
													"    // SWIFT/BIC strict: 8 or 11 alnum\r",
													"    pm.expect(String(rec.bnkCode || \"\"), \"bnkCode (SWIFT/BIC)\").to.match(/^[A-Z0-9]{8}([A-Z0-9]{3})?$/);\r",
													"\r",
													"    pm.expect(rec.bnkName, \"bnkName\").to.be.a(\"string\").and.not.empty;\r",
													"    pm.expect(rec.accountCode, \"accountCode\").to.be.a(\"string\").and.not.empty;\r",
													"\r",
													"    // accountType: accept BOTH/DEBIT/CREDIT/NO/TOBNK\r",
													"    if (typeof rec.accountType !== \"undefined\") {\r",
													"      pm.expect([\"BOTH\",\"DEBIT\",\"CREDIT\",\"NO\",\"TOBNK\"], \"accountType\")\r",
													"        .to.include(String(rec.accountType).toUpperCase());\r",
													"    }\r",
													"\r",
													"    // status\r",
													"    pm.expect(String(rec.accountStatus || \"\"), \"accountStatus\").to.match(/^\\d+$/);\r",
													"    pm.expect(rec.accountStatusDesc, \"accountStatusDesc\").to.be.a(\"string\").and.not.empty;\r",
													"\r",
													"    if (typeof rec.isSahlPlus !== \"undefined\") {\r",
													"      pm.expect(isYN(String(rec.isSahlPlus)), \"isSahlPlus\").to.be.true;\r",
													"    }\r",
													"\r",
													"    // transferTimeId can be long token; just ensure string & non-empty\r",
													"    pm.expect(rec.transferTimeId, \"transferTimeId\").to.be.a(\"string\").and.not.empty;\r",
													"  }\r",
													"})();\r",
													"\r",
													"// bnkTransfers shape\r",
													"pm.test(\"bnkTransfers.bnkTransferRec is array (may be empty)\", function () {\r",
													"  var tr = (((bnr || {}).bnkTransfers || {}).bnkTransferRec);\r",
													"  pm.expect(tr, \"bnkTransferRec\").to.be.an(\"array\");\r",
													"});\r",
													"\r",
													"// financierInfo (if present) – tolerant of null/\"null\"/\"\"\r",
													"pm.test(\"financierInfo (if present) has valid fields\", function () {\r",
													"  var fi = bnr.financierInfo;\r",
													"  if (fi && typeof fi === \"object\") {\r",
													"    if (!isNullish(fi.financierID)) {\r",
													"      pm.expect(String(fi.financierID)).to.match(/^\\d+$/);\r",
													"    }\r",
													"\r",
													"    if (!isNullish(fi.isActive)) {\r",
													"      pm.expect(isYN(String(fi.isActive))).to.be.true;\r",
													"    }\r",
													"\r",
													"    if (!isNullish(fi.isOrdersEnabled)) {\r",
													"      pm.expect(isYN(String(fi.isOrdersEnabled))).to.be.true;\r",
													"    }\r",
													"\r",
													"    if (!isNullish(fi.riskFeesType)) {\r",
													"      pm.expect([\"0\",\"1\",\"2\",\"3\"]).to.include(String(fi.riskFeesType));\r",
													"    }\r",
													"    // riskFeesValue: validate only when present & not nullish\r",
													"    if (!isNullish(fi.riskFeesValue)) {\r",
													"      pm.expect(isNumericStr(fi.riskFeesValue)).to.be.true;\r",
													"      pm.expect(Number(fi.riskFeesValue)).to.be.at.least(0);\r",
													"    }\r",
													"\r",
													"    if (!isNullish(fi.financierAllowancePeriod)) {\r",
													"      pm.expect(isIntStr(fi.financierAllowancePeriod)).to.be.true;\r",
													"      pm.expect(Number(fi.financierAllowancePeriod)).to.be.at.least(0);\r",
													"    }\r",
													"  }\r",
													"});\r",
													"\r",
													"// fundInfo (margin block; can be N or Y)\r",
													"pm.test(\"fundInfo (if present) is consistent\", function () {\r",
													"  var f = bnr.fundInfo;\r",
													"  if (f && typeof f === \"object\") {\r",
													"    pm.expect(isYN(String(f.isFundClient)), \"isFundClient Y/N\").to.be.true;\r",
													"\r",
													"    if (f.isFundClient === \"Y\") {\r",
													"      var numKeys = [\r",
													"        \"fundDebt\",\"fundAvailableCredit\",\"cashBalanceNotCollected\",\"fundedAmountInMarket\",\r",
													"        \"creditRatio\",\"collectedBalance\",\"actualFunded\",\"shareAvCredit\"\r",
													"      ];\r",
													"      for (var i=0;i<numKeys.length;i++){\r",
													"        var k = numKeys[i];\r",
													"        pm.expect(isNumericStr(String(f[k])), \"fundInfo.\"+k+\" numeric\").to.be.true;\r",
													"        pm.expect(Number(f[k]), \"fundInfo.\"+k+\" >= 0\").to.be.at.least(0);\r",
													"      }\r",
													"\r",
													"      // creditRatio sanity: accept ratio [0..1] OR percent [0..100]\r",
													"      if (!isNullish(f.creditRatio)) {\r",
													"        var cr = Number(f.creditRatio);\r",
													"        if (cr > 1) {\r",
													"          pm.expect(cr, \"creditRatio% in [0, 100]\").to.be.at.least(0).and.at.most(100);\r",
													"          pm.environment.set(\"CREDIT_RATIO\", String(cr / 100));     // normalized 0..1\r",
													"          pm.environment.set(\"CREDIT_RATIO_PCT\", String(cr));       // as percent\r",
													"        } else {\r",
													"          pm.expect(cr, \"creditRatio in [0, 1]\").to.be.at.least(0).and.at.most(1);\r",
													"          pm.environment.set(\"CREDIT_RATIO\", String(cr));           // normalized 0..1\r",
													"          pm.environment.set(\"CREDIT_RATIO_PCT\", String(cr * 100)); // as percent\r",
													"        }\r",
													"      }\r",
													"\r",
													"      if (!isNullish(f.isActiveFundClient)) {\r",
													"        pm.expect(isYN(String(f.isActiveFundClient))).to.be.true;\r",
													"      }\r",
													"    }\r",
													"  }\r",
													"});\r",
													"\r",
													"// resType should reflect request's AccRegisterType (when provided)\r",
													"pm.test(\"resType matches AccRegisterType from request (when provided)\", function () {\r",
													"  var reqBody;\r",
													"  try { reqBody = pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {}; } catch(e){}\r",
													"  var accType = (((reqBody || {}).Message || {}).BalDlsRequest || {}).AccRegisterType;\r",
													"  if (accType) {\r",
													"    pm.expect(bnr.resType, \"resType\").to.eql(String(accType));\r",
													"  }\r",
													"});\r",
													"\r",
													"// Guardrails: request Srv should be BNKBAL\r",
													"pm.test(\"Request Srv is BNKBAL\", function () {\r",
													"  var reqBody;\r",
													"  try { reqBody = pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {}; } catch(e){}\r",
													"  pm.expect((reqBody || {}).Srv).to.eql(\"BNKBAL\");\r",
													"});\r",
													"\r",
													"// Minimal schema (tv4)\r",
													"pm.test(\"Schema (minimal) validates\", function () {\r",
													"  var schema = {\r",
													"    type: \"object\",\r",
													"    required: [\"responseStatus\",\"message\"],\r",
													"    properties: {\r",
													"      responseStatus: {\r",
													"        type: \"object\",\r",
													"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
													"        properties: {\r",
													"          resCode:  { \"const\": \"0\" },\r",
													"          resDesc:  { \"const\": \"Successful Operation\" },\r",
													"          source:   { \"const\": \"BNKBAL\" },\r",
													"          resCode1: { \"const\": \"0\" },\r",
													"          resDesc1: { \"const\": \"Successful Operation\" }\r",
													"        }\r",
													"      },\r",
													"      message: {\r",
													"        type: \"object\",\r",
													"        required: [\"bnkInfoResponse\"],\r",
													"        properties: {\r",
													"          bnkInfoResponse: { type: \"object\" }\r",
													"        }\r",
													"      }\r",
													"    }\r",
													"  };\r",
													"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
													"});\r",
													"\r",
													"// Extra: store a few more env helpers (without touching your extract keys)\r",
													"(function storeExtras(){\r",
													"  var arr = (((bnr || {}).banksInfo || {}).bnkInfoRec) || [];\r",
													"  if (arr.length > 0) {\r",
													"    pm.environment.set(\"firstBankCode\", String(arr[0].bankCode || \"\"));\r",
													"    pm.environment.set(\"firstBankSwift\", String(arr[0].bnkCode || \"\"));\r",
													"    pm.environment.set(\"firstAccountStatus\", String(arr[0].accountStatus || \"\"));\r",
													"  }\r",
													"  pm.environment.set(\"bnkTransfersCount\", String(((((bnr || {}).bnkTransfers || {}).bnkTransferRec) || []).length));\r",
													"})();\r",
													"\r",
													"console.log(\"✅ BNKBAL validated.\",\r",
													"            \"bankCount:\", pm.environment.get(\"bankCount\"),\r",
													"            \"transfers:\", pm.environment.get(\"bnkTransfersCount\"),\r",
													"            \"creditRatio(norm):\", pm.environment.get(\"CREDIT_RATIO\"),\r",
													"            \"creditRatio(%) \", pm.environment.get(\"CREDIT_RATIO_PCT\"));\r",
													""
												],
												"type": "text/javascript",
												"packages": {},
												"requests": {}
											}
										}
									],
									"request": {
										"auth": {
											"type": "noauth"
										},
										"method": "POST",
										"header": [
											{
												"key": "Accept",
												"value": "application/json",
												"type": "text"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\r\n    \"Srv\": \"BNKBAL\",\r\n    \"Message\": {\r\n        \"BalDlsRequest\": {\r\n            \"NIN\": \"{{NIN}}\",\r\n            \"UserId\": \"{{UserID}}\",\r\n            \"UserType\": \"INVESTOR\",\r\n            \"AccRegisterType\": \"ALL\",\r\n            \"Lang\": \"ARB\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"30-04-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}\r\n\r\n\r\n",
											"options": {
												"raw": {
													"language": "json"
												}
											}
										},
										"url": {
											"raw": "{{BaseURL}}{{Oracle19}}",
											"host": [
												"{{BaseURL}}{{Oracle19}}"
											]
										}
									},
									"response": []
								},
								{
									"name": "2. Confirm Deposit Transfer",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"/**\r",
													" * BNKCHKTRANSFERNEW – Confirm Transfer (Popup) validation (ES5)\r",
													" * Validates:\r",
													" *  - Envelope: resCode/resCode1=0, source=\"BNKCHKTRANSFERNEW\"\r",
													" *  - Fields: trnxFees, trnxIsPossible, maximumAmount, hintMessage, urgentFees\r",
													" *  - Numeric strings >= 0 (supports scientific notation); trnxIsPossible is Y/N\r",
													" *  - Optional business rules via env toggles (see header comment)\r",
													" * Saves to env:\r",
													" *  TRX_IS_POSSIBLE, TRX_MAX_AMOUNT, TRX_MAX_AMOUNT_NUM, TRX_FEES, TRX_FEES_NUM,\r",
													" *  TRX_URGENT_FEES, TRX_URGENT_FEES_NUM, TRX_HINT\r",
													" */\r",
													"\r",
													"pm.test(\"HTTP 200\", function () {\r",
													"  pm.response.to.have.status(200);\r",
													"});\r",
													"\r",
													"pm.test(\"Content-Type is JSON\", function () {\r",
													"  pm.response.to.have.header(\"Content-Type\");\r",
													"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
													"});\r",
													"\r",
													"// Parse\r",
													"var json;\r",
													"pm.test(\"Body is valid JSON\", function () {\r",
													"  json = pm.response.json();\r",
													"  pm.expect(json).to.be.an(\"object\");\r",
													"});\r",
													"\r",
													"// Envelope\r",
													"pm.test(\"responseStatus OK (BNKCHKTRANSFERNEW)\", function () {\r",
													"  var rs = json.responseStatus || {};\r",
													"  pm.expect(rs.resCode).to.eql(\"0\");\r",
													"  pm.expect(rs.resDesc).to.eql(\"Successful Operation\");\r",
													"  pm.expect(rs.source).to.eql(\"BNKCHKTRANSFERNEW\");\r",
													"  pm.expect(rs.resCode1).to.eql(\"0\");\r",
													"  pm.expect(rs.resDesc1).to.eql(\"Successful Operation\");\r",
													"});\r",
													"\r",
													"// Node\r",
													"var node = (((json || {}).message || {}).isBankTransferResponse) || {};\r",
													"pm.test(\"isBankTransferResponse exists\", function () {\r",
													"  pm.expect(node).to.be.an(\"object\");\r",
													"  pm.expect(node).to.have.property(\"trnxFees\");\r",
													"  pm.expect(node).to.have.property(\"trnxIsPossible\");\r",
													"  pm.expect(node).to.have.property(\"maximumAmount\");\r",
													"  pm.expect(node).to.have.property(\"hintMessage\");\r",
													"  pm.expect(node).to.have.property(\"urgentFees\");\r",
													"});\r",
													"\r",
													"// Helpers (ES5)\r",
													"// Accepts: integers, decimals, and scientific notation (e.g., 1.23E8, -4e-3)\r",
													"function isNumericStr(v) {\r",
													"  if (typeof v === \"number\") return isFinite(v);\r",
													"  var s = String(v || \"\").trim();\r",
													"  return /^-?(?:\\d+\\.?\\d*|\\d*\\.\\d+)(?:[eE][+\\-]?\\d+)?$/.test(s);\r",
													"}\r",
													"function toNumberSafe(v) { return Number(String(v || \"\").trim()); }\r",
													"function isYN(v) { return v === \"Y\" || v === \"N\"; }\r",
													"function getFlag(name, defVal) {\r",
													"  var v = pm.environment.get(name) || pm.globals.get(name);\r",
													"  v = (v == null ? \"\" : String(v)).toUpperCase();\r",
													"  if (v !== \"Y\" && v !== \"N\") return defVal;\r",
													"  return v;\r",
													"}\r",
													"\r",
													"// Field validations\r",
													"pm.test(\"trnxFees & urgentFees are numeric strings >= 0\", function () {\r",
													"  pm.expect(isNumericStr(node.trnxFees), \"trnxFees must be numeric string\").to.be.true;\r",
													"  pm.expect(isNumericStr(node.urgentFees), \"urgentFees must be numeric string\").to.be.true;\r",
													"  pm.expect(toNumberSafe(node.trnxFees), \"trnxFees >= 0\").to.be.at.least(0);\r",
													"  pm.expect(toNumberSafe(node.urgentFees), \"urgentFees >= 0\").to.be.at.least(0);\r",
													"});\r",
													"\r",
													"pm.test(\"trnxIsPossible is Y/N\", function () {\r",
													"  pm.expect(isYN(node.trnxIsPossible), \"trnxIsPossible must be 'Y' or 'N'\").to.be.true;\r",
													"});\r",
													"\r",
													"pm.test(\"maximumAmount is numeric string >= 0\", function () {\r",
													"  pm.expect(isNumericStr(node.maximumAmount), \"maximumAmount must be numeric string\").to.be.true;\r",
													"  pm.expect(toNumberSafe(node.maximumAmount), \"maximumAmount >= 0\").to.be.at.least(0);\r",
													"});\r",
													"\r",
													"pm.test(\"hintMessage is a string (may be empty on success)\", function () {\r",
													"  pm.expect(typeof node.hintMessage).to.eql(\"string\");\r",
													"});\r",
													"\r",
													"// Business rules (configurable)\r",
													"pm.test(\"Business rules for trnxIsPossible\", function () {\r",
													"  var requireMaxWhenY = getFlag(\"REQUIRE_MAX_GT_ZERO_WHEN_Y\", \"Y\") === \"Y\";\r",
													"  var requireHintOnFail = getFlag(\"REQUIRE_HINT_ON_FAIL\", \"Y\") === \"Y\";\r",
													"  var allowNonZeroWhenN = getFlag(\"ALLOW_NONZERO_MAX_WHEN_N\", \"N\") === \"N\" ? false : true;\r",
													"\r",
													"  var isPossible = node.trnxIsPossible === \"Y\";\r",
													"  var maxNum = toNumberSafe(node.maximumAmount);\r",
													"  var hint = String(node.hintMessage || \"\");\r",
													"\r",
													"  if (isPossible) {\r",
													"    if (requireMaxWhenY) {\r",
													"      pm.expect(maxNum, \"When possible=Y, maximumAmount must be > 0\").to.be.above(0);\r",
													"    }\r",
													"    if (hint && hint.replace(/\\s+/g,\"\").length > 0) {\r",
													"      console.warn(\"Hint provided even though trnxIsPossible=Y:\", hint);\r",
													"    }\r",
													"  } else {\r",
													"    if (requireHintOnFail) {\r",
													"      pm.expect(hint.replace(/\\s+/g,\"\").length, \"When possible=N, hintMessage should be non-empty\").to.be.greaterThan(0);\r",
													"    }\r",
													"    if (!allowNonZeroWhenN) {\r",
													"      pm.expect(maxNum, \"When possible=N, maximumAmount should be 0\").to.eql(0);\r",
													"    }\r",
													"  }\r",
													"});\r",
													"\r",
													"// Save to environment\r",
													"(function saveEnv(){\r",
													"  pm.environment.set(\"TRX_IS_POSSIBLE\", String(node.trnxIsPossible || \"\"));\r",
													"  pm.environment.set(\"TRX_MAX_AMOUNT\", String(node.maximumAmount || \"\"));\r",
													"  pm.environment.set(\"TRX_MAX_AMOUNT_NUM\", String(toNumberSafe(node.maximumAmount)));\r",
													"  pm.environment.set(\"TRX_FEES\", String(node.trnxFees || \"\"));\r",
													"  pm.environment.set(\"TRX_FEES_NUM\", String(toNumberSafe(node.trnxFees)));\r",
													"  pm.environment.set(\"TRX_URGENT_FEES\", String(node.urgentFees || \"\"));\r",
													"  pm.environment.set(\"TRX_URGENT_FEES_NUM\", String(toNumberSafe(node.urgentFees)));\r",
													"  pm.environment.set(\"TRX_HINT\", String(node.hintMessage || \"\"));\r",
													"})();\r",
													"\r",
													"// Minimal schema (tv4)\r",
													"pm.test(\"Schema (minimal) validates\", function () {\r",
													"  var schema = {\r",
													"    type: \"object\",\r",
													"    required: [\"responseStatus\",\"message\"],\r",
													"    properties: {\r",
													"      responseStatus: {\r",
													"        type: \"object\",\r",
													"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
													"        properties: {\r",
													"          resCode:  { \"const\": \"0\" },\r",
													"          resDesc:  { \"const\": \"Successful Operation\" },\r",
													"          source:   { \"const\": \"BNKCHKTRANSFERNEW\" },\r",
													"          resCode1: { \"const\": \"0\" },\r",
													"          resDesc1: { \"const\": \"Successful Operation\" }\r",
													"        }\r",
													"      },\r",
													"      message: {\r",
													"        type: \"object\",\r",
													"        required: [\"isBankTransferResponse\"],\r",
													"        properties: {\r",
													"          isBankTransferResponse: {\r",
													"            type: \"object\",\r",
													"            required: [\"trnxFees\",\"trnxIsPossible\",\"maximumAmount\",\"hintMessage\",\"urgentFees\"],\r",
													"            properties: {\r",
													"              trnxFees:       { type: \"string\" },\r",
													"              trnxIsPossible: { type: \"string\" },\r",
													"              maximumAmount:  { type: \"string\" },\r",
													"              hintMessage:    { type: \"string\" },\r",
													"              urgentFees:     { type: \"string\" }\r",
													"            }\r",
													"          }\r",
													"        }\r",
													"      }\r",
													"    }\r",
													"  };\r",
													"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
													"});\r",
													"\r",
													"// Visualizer (compact)\r",
													"(function render(){\r",
													"  var template =\r",
													"    '<style>.t{font-family:system-ui,Segoe UI,Roboto,Arial;font-size:14px;color:#333;width:100%;border-collapse:collapse}' +\r",
													"    '.t th,.t td{border:1px solid #87ceeb;padding:6px;text-align:left}.t th{background:#87ceeb}' +\r",
													"    '.good{color:#0a8f08}.bad{color:#b00020}</style>' +\r",
													"    '<h3>Confirm Transfer</h3>' +\r",
													"    '<table class=\"t\"><tbody>' +\r",
													"    '<tr><th>trnxIsPossible</th><td class=\"{{possibleCls}}\">{{trnxIsPossible}}</td></tr>' +\r",
													"    '<tr><th>maximumAmount</th><td>{{maximumAmount}}</td></tr>' +\r",
													"    '<tr><th>trnxFees</th><td>{{trnxFees}}</td></tr>' +\r",
													"    '<tr><th>urgentFees</th><td>{{urgentFees}}</td></tr>' +\r",
													"    '<tr><th>hintMessage</th><td>{{hintMessage}}</td></tr>' +\r",
													"    '</tbody></table>';\r",
													"\r",
													"  var possibleCls = (node.trnxIsPossible === \"Y\") ? \"good\" : \"bad\";\r",
													"  pm.visualizer.set(template, {\r",
													"    trnxIsPossible: String(node.trnxIsPossible || \"\"),\r",
													"    maximumAmount: String(node.maximumAmount || \"\"),\r",
													"    trnxFees: String(node.trnxFees || \"\"),\r",
													"    urgentFees: String(node.urgentFees || \"\"),\r",
													"    hintMessage: String(node.hintMessage || \"\"),\r",
													"    possibleCls: possibleCls\r",
													"  });\r",
													"})();\r",
													"\r",
													"console.log(\r",
													"  \"✅ BNKCHKTRANSFERNEW validated.\",\r",
													"  \"possible=\", node.trnxIsPossible,\r",
													"  \"max(raw)=\", node.maximumAmount,\r",
													"  \"max(num)=\", Number(String(node.maximumAmount || \"\").trim())\r",
													");\r",
													""
												],
												"type": "text/javascript",
												"packages": {},
												"requests": {}
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Accept",
												"value": "application/json",
												"type": "text"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\r\n    \"Srv\": \"BNKCHKTRANSFERNEW\",\r\n    \"Message\": {\r\n        \"IsBankTransferRequest\": {\r\n            \"swiftCode\": \"{{bnkCode_1}}\",\r\n            \"accountNO\": \"{{accountSeq_1}}\",\r\n            \"amount\": \"5000\",\r\n            \"nin\": \"{{NIN}}\",\r\n            \"userId\": \"{{UserID}}\",\r\n            \"userType\": \"INVESTOR\",\r\n            \"lang\": \"ARB\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"30-04-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}",
											"options": {
												"raw": {
													"language": "json"
												}
											}
										},
										"url": {
											"raw": "{{BaseURL}}{{Oracle19}}",
											"host": [
												"{{BaseURL}}{{Oracle19}}"
											]
										}
									},
									"response": []
								},
								{
									"name": "3. Fire - Deposit in The Group",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"/**\r",
													" * BNKTRANSFERNEW – Bank transfer from (ES5)\r",
													" * Validates:\r",
													" *  - Envelope: resCode/resCode1=0, source=\"BNKTRANSFERNEW\"\r",
													" *  - Node: getBankTransferResponse with required keys (all strings)\r",
													" *  - showHint in {Y,N} and conditional rules\r",
													" *  - OTP config: otpLength=\"4\", otpExpiryPeriod=\"300\", otpResendPeriod=\"60\"\r",
													" * Saves env:\r",
													" *  BANK_TRANSFER_CODE, BANK_SHOW_HINT, BANK_HINT_MESSAGE,\r",
													" *  BANK_CONFIRM_MSG, BANK_TRN_GUID, BANK_OTP_TOKEN,\r",
													" *  resTrnGUID (direct alias)\r",
													" */\r",
													"\r",
													"pm.test(\"HTTP 200\", function () {\r",
													"  pm.response.to.have.status(200);\r",
													"});\r",
													"\r",
													"pm.test(\"Content-Type is JSON\", function () {\r",
													"  pm.response.to.have.header(\"Content-Type\");\r",
													"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
													"});\r",
													"\r",
													"// Parse\r",
													"var json;\r",
													"pm.test(\"Body is valid JSON\", function () {\r",
													"  json = pm.response.json();\r",
													"  pm.expect(json).to.be.an(\"object\");\r",
													"});\r",
													"\r",
													"// Envelope\r",
													"pm.test(\"responseStatus OK (BNKTRANSFERNEW)\", function () {\r",
													"  var rs = json.responseStatus || {};\r",
													"  pm.expect(rs.resCode).to.eql(\"0\");\r",
													"  pm.expect(rs.resDesc).to.eql(\"Successful Operation\");\r",
													"  pm.expect(rs.source).to.eql(\"BNKTRANSFERNEW\");\r",
													"  pm.expect(rs.resCode1).to.eql(\"0\");\r",
													"  pm.expect(rs.resDesc1).to.eql(\"Successful Operation\");\r",
													"});\r",
													"\r",
													"// Node\r",
													"var node = (((json || {}).message || {}).getBankTransferResponse) || {};\r",
													"pm.test(\"getBankTransferResponse exists & has required keys\", function () {\r",
													"  pm.expect(node).to.be.an(\"object\");\r",
													"  var keys = [\r",
													"    \"transferCode\",\"showHint\",\"hintMessage\",\"resConfirmMessage\",\"resTrnGUID\",\"otpToken\",\r",
													"    \"otpLength\",\"otpExpiryPeriod\",\"otpResendPeriod\"\r",
													"  ];\r",
													"  for (var i=0;i<keys.length;i++){\r",
													"    pm.expect(node, \"Missing key: \" + keys[i]).to.have.property(keys[i]);\r",
													"    pm.expect(typeof node[keys[i]], keys[i] + \" must be string\").to.eql(\"string\");\r",
													"  }\r",
													"});\r",
													"\r",
													"// Helpers\r",
													"function isYN(v){ return v === \"Y\" || v === \"N\"; }\r",
													"function getFlag(name, defVal){\r",
													"  var v = pm.environment.get(name) || pm.globals.get(name);\r",
													"  v = (v == null ? \"\" : String(v)).toUpperCase();\r",
													"  if (v !== \"Y\" && v !== \"N\") return defVal;\r",
													"  return v;\r",
													"}\r",
													"\r",
													"// showHint logic\r",
													"pm.test(\"showHint is Y/N\", function () {\r",
													"  pm.expect(isYN(node.showHint), \"showHint must be 'Y' or 'N'\").to.be.true;\r",
													"});\r",
													"\r",
													"// Confirm message (Arabic success text)\r",
													"pm.test(\"resConfirmMessage (required by policy or optional)\", function () {\r",
													"  var requireMsg = getFlag(\"REQUIRE_CONFIRM_MESSAGE\", \"Y\") === \"Y\";\r",
													"  var msg = String(node.resConfirmMessage || \"\");\r",
													"  if (requireMsg) {\r",
													"    pm.expect(msg.replace(/\\s+/g,\"\").length, \"resConfirmMessage should be non-empty\").to.be.greaterThan(0);\r",
													"    var ok =\r",
													"      /تم\\s*قبول\\s*طلب\\s*التحويل/.test(msg) ||\r",
													"      /تم\\s*قبول/.test(msg);\r",
													"    pm.expect(ok, \"resConfirmMessage should indicate success in Arabic\").to.be.true;\r",
													"  }\r",
													"});\r",
													"\r",
													"// OTP configuration checks (exact values)\r",
													"pm.test(\"OTP config: otpLength='4', otpExpiryPeriod='300', otpResendPeriod='60'\", function () {\r",
													"  pm.expect(String(node.otpLength)).to.eql(\"4\");\r",
													"  pm.expect(String(node.otpExpiryPeriod)).to.eql(\"300\");\r",
													"  pm.expect(String(node.otpResendPeriod)).to.eql(\"60\");\r",
													"});\r",
													"\r",
													"// Conditional rules for hint / otp\r",
													"pm.test(\"Hint & OTP conditional rules\", function () {\r",
													"  var requireHintOnY   = getFlag(\"REQUIRE_HINT_ON_Y\", \"N\") === \"Y\";\r",
													"  var requireOtpOnHint = getFlag(\"REQUIRE_OTP_WHEN_HINT\", \"N\") === \"Y\";\r",
													"  var requireEmptyOtpWhenNoHint = getFlag(\"REQUIRE_EMPTY_OTP_WHEN_NOHINT\", \"N\") === \"Y\";\r",
													"\r",
													"  var showHintY = node.showHint === \"Y\";\r",
													"  var hint = String(node.hintMessage || \"\");\r",
													"  var otp  = String(node.otpToken || \"\");\r",
													"\r",
													"  if (showHintY) {\r",
													"    if (requireHintOnY) {\r",
													"      pm.expect(hint.replace(/\\s+/g,\"\").length, \"showHint=Y -> hintMessage must be non-empty\").to.be.greaterThan(0);\r",
													"    }\r",
													"    if (requireOtpOnHint) {\r",
													"      pm.expect(otp.replace(/\\s+/g,\"\").length, \"showHint=Y -> otpToken must be non-empty\").to.be.greaterThan(0);\r",
													"    }\r",
													"  } else {\r",
													"    if (requireEmptyOtpWhenNoHint) {\r",
													"      pm.expect(otp.replace(/\\s+/g,\"\").length, \"showHint=N -> otpToken should be empty\").to.eql(0);\r",
													"    }\r",
													"  }\r",
													"});\r",
													"\r",
													"// Optional: require GUID when success (config)\r",
													"pm.test(\"Transaction GUID requirement (optional)\", function () {\r",
													"  var requireGuid = getFlag(\"REQUIRE_GUID_ON_SUCCESS\", \"N\") === \"Y\";\r",
													"  if (requireGuid) {\r",
													"    pm.expect(String(node.resTrnGUID || \"\").replace(/\\s+/g,\"\").length, \"resTrnGUID required\").to.be.greaterThan(0);\r",
													"  }\r",
													"});\r",
													"\r",
													"// Save to environment\r",
													"(function saveEnv(){\r",
													"  pm.environment.set(\"BANK_TRANSFER_CODE\", String(node.transferCode || \"\"));\r",
													"  pm.environment.set(\"BANK_SHOW_HINT\", String(node.showHint || \"\"));\r",
													"  pm.environment.set(\"BANK_HINT_MESSAGE\", String(node.hintMessage || \"\"));\r",
													"  pm.environment.set(\"BANK_CONFIRM_MSG\", String(node.resConfirmMessage || \"\"));\r",
													"  pm.environment.set(\"BANK_TRN_GUID\", String(node.resTrnGUID || \"\"));\r",
													"  pm.environment.set(\"BANK_OTP_TOKEN\", String(node.otpToken || \"\"));\r",
													"  // direct alias as requested\r",
													"  pm.environment.set(\"resTrnGUID\", String(node.resTrnGUID || \"\"));\r",
													"})();\r",
													"\r",
													"// Minimal schema (tv4)\r",
													"pm.test(\"Schema (minimal) validates\", function () {\r",
													"  var schema = {\r",
													"    type: \"object\",\r",
													"    required: [\"responseStatus\",\"message\"],\r",
													"    properties: {\r",
													"      responseStatus: {\r",
													"        type: \"object\",\r",
													"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
													"        properties: {\r",
													"          resCode:  { \"const\": \"0\" },\r",
													"          resDesc:  { \"const\": \"Successful Operation\" },\r",
													"          source:   { \"const\": \"BNKTRANSFERNEW\" },\r",
													"          resCode1: { \"const\": \"0\" },\r",
													"          resDesc1: { \"const\": \"Successful Operation\" }\r",
													"        }\r",
													"      },\r",
													"      message: {\r",
													"        type: \"object\",\r",
													"        required: [\"getBankTransferResponse\"],\r",
													"        properties: {\r",
													"          getBankTransferResponse: {\r",
													"            type: \"object\",\r",
													"            required: [\r",
													"              \"transferCode\",\"showHint\",\"hintMessage\",\"resConfirmMessage\",\"resTrnGUID\",\"otpToken\",\r",
													"              \"otpLength\",\"otpExpiryPeriod\",\"otpResendPeriod\"\r",
													"            ],\r",
													"            properties: {\r",
													"              transferCode:      { type: \"string\" },\r",
													"              showHint:          { type: \"string\" },\r",
													"              hintMessage:       { type: \"string\" },\r",
													"              resConfirmMessage: { type: \"string\" },\r",
													"              resTrnGUID:        { type: \"string\" },\r",
													"              otpToken:          { type: \"string\" },\r",
													"              otpLength:         { type: \"string\", \"const\": \"4\" },\r",
													"              otpExpiryPeriod:   { type: \"string\", \"const\": \"300\" },\r",
													"              otpResendPeriod:   { type: \"string\", \"const\": \"60\" }\r",
													"            }\r",
													"          }\r",
													"        }\r",
													"      }\r",
													"    }\r",
													"  };\r",
													"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
													"});\r",
													"\r",
													"// Visualizer (compact)\r",
													"(function render(){\r",
													"  var template =\r",
													"    '<style>.t{font-family:system-ui,Segoe UI,Roboto,Arial;font-size:14px;color:#333;width:100%;border-collapse:collapse}' +\r",
													"    '.t th,.t td{border:1px solid #87ceeb;padding:6px;text-align:left}.t th{background:#87ceeb}' +\r",
													"    '.flagY{color:#0a8f08}.flagN{color:#b00020}</style>' +\r",
													"    '<h3>Bank Transfer – Result</h3>' +\r",
													"    '<table class=\"t\"><tbody>' +\r",
													"    '<tr><th>resConfirmMessage</th><td>{{resConfirmMessage}}</td></tr>' +\r",
													"    '<tr><th>showHint</th><td class=\"{{showHintCls}}\">{{showHint}}</td></tr>' +\r",
													"    '<tr><th>hintMessage</th><td>{{hintMessage}}</td></tr>' +\r",
													"    '<tr><th>transferCode</th><td>{{transferCode}}</td></tr>' +\r",
													"    '<tr><th>resTrnGUID</th><td>{{resTrnGUID}}</td></tr>' +\r",
													"    '<tr><th>otpToken</th><td>{{otpToken}}</td></tr>' +\r",
													"    '<tr><th>otpLength</th><td>{{otpLength}}</td></tr>' +\r",
													"    '<tr><th>otpExpiryPeriod</th><td>{{otpExpiryPeriod}}</td></tr>' +\r",
													"    '<tr><th>otpResendPeriod</th><td>{{otpResendPeriod}}</td></tr>' +\r",
													"    '</tbody></table>';\r",
													"\r",
													"  pm.visualizer.set(template, {\r",
													"    resConfirmMessage: String(node.resConfirmMessage || \"\"),\r",
													"    showHint: String(node.showHint || \"\"),\r",
													"    hintMessage: String(node.hintMessage || \"\"),\r",
													"    transferCode: String(node.transferCode || \"\"),\r",
													"    resTrnGUID: String(node.resTrnGUID || \"\"),\r",
													"    otpToken: String(node.otpToken || \"\"),\r",
													"    otpLength: String(node.otpLength || \"\"),\r",
													"    otpExpiryPeriod: String(node.otpExpiryPeriod || \"\"),\r",
													"    otpResendPeriod: String(node.otpResendPeriod || \"\"),\r",
													"    showHintCls: (node.showHint === \"Y\") ? \"flagY\" : \"flagN\"\r",
													"  });\r",
													"})();\r",
													"\r",
													"console.log(\"✅ BNKTRANSFERNEW validated.\", \"showHint=\", node.showHint, \"resTrnGUID=\", node.resTrnGUID);\r",
													""
												],
												"type": "text/javascript",
												"packages": {},
												"requests": {}
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Accept",
												"value": "application/json",
												"type": "text"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\r\n    \"Srv\": \"BNKTRANSFERNEW\",\r\n    \"Message\": {\r\n        \"BankTransferRequest\": {\r\n            \"nin\": \"{{NIN}}\",\r\n            \"userId\": \"{{UserID}}\",\r\n            \"userType\": \"INVESTOR\",\r\n            \"accountNO\": \"{{accountCode_1}}\",\r\n            \"amount\": 5000,\r\n            \"swiftCode\": \"{{bnkCode_1}}\",\r\n            \"transferType\": \"FROM\",\r\n            \"accountStatus\": \"4\",\r\n            \"transferTimeId\": \"{{transferTimeId_1}}\",\r\n            \"lang\": \"ARB\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"30-04-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}",
											"options": {
												"raw": {
													"language": "json"
												}
											}
										},
										"url": {
											"raw": "{{BaseURL}}{{Oracle19}}",
											"host": [
												"{{BaseURL}}{{Oracle19}}"
											]
										}
									},
									"response": []
								},
								{
									"name": "4. TRN_CONFIRMCANOTP",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"/**\r",
													" * TRN_CONFIRMCANOTP – Confirm OTP for transfer to group account (Unified)\r",
													" *\r",
													" * Scenarios handled:\r",
													" *  A) Success (Approved):   resCode=\"0\"      -> transferInfoResponse.requestStatus=\"APRV\"\r",
													" *  B) Already confirmed:    resCode=\"190\"    -> تم تأكيد طلب التحويل من قبل\r",
													" *  C) No request:           resCode=\"16100\"  -> لا يوجد طلب لتسجيل الحساب البنكي لهذا العميل\r",
													" *  D) Success (Cancelled):  resCode=\"0\"      -> transferInfoResponse.requestStatus=\"CAN\"\r",
													" *  E) Invalid transfer data:resCode=\"16113\"  -> خطأ في بيانات التحويل\r",
													" *  F) Invalid OTP:          resCode=\"110070\" -> كلمة المرور لمرة واحدة غير صالحة\r",
													" *\r",
													" * Saves (depending on scenario):\r",
													" *  TRN_CONFIRM_SCENARIO ∈ { SUCCESS_APRV, SUCCESS_CAN, ALREADY_CONFIRMED, NO_REQUEST, INVALID_TRANSFER_DATA, INVALID_OTP }\r",
													" *  TRN_CONFIRM_DESC     = responseStatus.resDesc (or resDesc1)\r",
													" *  TRN_NIN, TRN_GUID, TRN_REQ_STATUS, TRN_REQ_STATUS_LABEL (on success)\r",
													" */\r",
													"\r",
													"pm.test(\"HTTP 200\", function () { pm.response.to.have.status(200); });\r",
													"\r",
													"pm.test(\"Content-Type is JSON\", function () {\r",
													"  pm.response.to.have.header(\"Content-Type\");\r",
													"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
													"});\r",
													"\r",
													"// Parse\r",
													"var json;\r",
													"pm.test(\"Body is JSON\", function () {\r",
													"  json = pm.response.json();\r",
													"  pm.expect(json).to.be.an(\"object\");\r",
													"});\r",
													"\r",
													"// Helpers\r",
													"function trim(s){ return String(s == null ? \"\" : s).replace(/^\\s+|\\s+$/g,\"\"); }\r",
													"function getFlag(name, defVal){\r",
													"  var v = pm.environment.get(name) || pm.globals.get(name);\r",
													"  v = (v == null ? \"\" : String(v)).toUpperCase();\r",
													"  if (v !== \"Y\" && v !== \"N\") return defVal;\r",
													"  return v;\r",
													"}\r",
													"function isGuidLike(s){ return /^[A-Za-z0-9_-]{10,40}$/.test(String(s || \"\")); } // backend GUID style\r",
													"\r",
													"// Arabic normalization: remove diacritics/standalone hamza, unify alef forms, collapse spaces\r",
													"function normalizeAr(s){\r",
													"  s = String(s || \"\");\r",
													"  // remove tashkeel & symbols\r",
													"  s = s.replace(/[\\u064B-\\u0652\\u0670\\u0653-\\u0655]/g, \"\");\r",
													"  // unify alef variants and remove standalone hamza\r",
													"  s = s.replace(/[أإآ]/g, \"ا\").replace(/ء/g, \"\");\r",
													"  // collapse spaces\r",
													"  s = s.replace(/\\s+/g, \" \").trim();\r",
													"  return s;\r",
													"}\r",
													"\r",
													"// Envelope\r",
													"var rs = json.responseStatus || {};\r",
													"pm.test(\"Source is TRN_CONFIRMCANOTP\", function(){\r",
													"  pm.expect(rs.source).to.eql(\"TRN_CONFIRMCANOTP\");\r",
													"});\r",
													"\r",
													"// Accept all known res codes\r",
													"pm.test(\"resCode is one of expected\", function(){\r",
													"  var allowed = [\"0\",\"190\",\"16100\",\"16113\",\"110070\"];\r",
													"  pm.expect(allowed).to.include(String(rs.resCode));\r",
													"  pm.expect(allowed).to.include(String(rs.resCode1));\r",
													"});\r",
													"\r",
													"// Branch scenario\r",
													"var scenario =\r",
													"  (rs.resCode === \"0\") ? \"SUCCESS\" :\r",
													"  (rs.resCode === \"190\") ? \"ALREADY_CONFIRMED\" :\r",
													"  (rs.resCode === \"16100\") ? \"NO_REQUEST\" :\r",
													"  (rs.resCode === \"16113\") ? \"INVALID_TRANSFER_DATA\" :\r",
													"  (rs.resCode === \"110070\") ? \"INVALID_OTP\" :\r",
													"  \"UNKNOWN\";\r",
													"\r",
													"// ---------- Scenario A/D: Success (APRV or CAN) ----------\r",
													"pm.test(\"Scenario A/D – Success payload (APRV or CAN)\", function(){\r",
													"  if (scenario !== \"SUCCESS\") { this.skip && this.skip(); return; }\r",
													"\r",
													"  var node = (((json || {}).message || {}).transferInfoResponse) || {};\r",
													"  pm.expect(node, \"transferInfoResponse exists\").to.be.an(\"object\");\r",
													"\r",
													"  [\"nin\",\"guid\",\"requestStatus\"].forEach(function(k){\r",
													"    pm.expect(node, \"Missing key: \" + k).to.have.property(k);\r",
													"    pm.expect(String(node[k]).length, k + \" non-empty\").to.be.greaterThan(0);\r",
													"  });\r",
													"\r",
													"  var status = String(node.requestStatus || \"\").toUpperCase();\r",
													"  pm.expect([\"APRV\",\"CAN\"]).to.include(status);\r",
													"  pm.expect(isGuidLike(node.guid), \"guid token format\").to.be.true;\r",
													"\r",
													"  var assertNin = getFlag(\"ASSERT_NIN\",\"N\") === \"Y\";\r",
													"  var envNin = pm.environment.get(\"NIN\") || pm.globals.get(\"NIN\") || \"\";\r",
													"  if (assertNin && envNin) {\r",
													"    pm.expect(String(node.nin), \"nin matches ENV NIN\").to.eql(String(envNin));\r",
													"  }\r",
													"\r",
													"  var label = (status === \"APRV\") ? \"APPROVED\" : \"CANCELLED\";\r",
													"  var scenarioTag = (status === \"APRV\") ? \"SUCCESS_APRV\" : \"SUCCESS_CAN\";\r",
													"\r",
													"  pm.environment.set(\"TRN_CONFIRM_SCENARIO\", scenarioTag);\r",
													"  pm.environment.set(\"TRN_CONFIRM_DESC\", trim(rs.resDesc || rs.resDesc1 || \"\"));\r",
													"  pm.environment.set(\"TRN_NIN\", String(node.nin || \"\"));\r",
													"  pm.environment.set(\"TRN_GUID\", String(node.guid || \"\"));\r",
													"  pm.environment.set(\"TRN_REQ_STATUS\", status);\r",
													"  pm.environment.set(\"TRN_REQ_STATUS_LABEL\", label);\r",
													"});\r",
													"\r",
													"// ---------- Scenario B: Already confirmed ----------\r",
													"pm.test(\"Scenario B – Already confirmed (if applicable)\", function(){\r",
													"  if (scenario !== \"ALREADY_CONFIRMED\") { this.skip && this.skip(); return; }\r",
													"  var d0 = trim(rs.resDesc), d1 = trim(rs.resDesc1);\r",
													"  var ok = /تم\\s*تأكيد\\s*طلب\\s*التحويل\\s*من\\s*قبل/.test(d0) &&\r",
													"           /تم\\s*تأكيد\\s*طلب\\s*التحويل\\s*من\\s*قبل/.test(d1);\r",
													"  pm.expect(ok, \"Arabic message: 'already confirmed'\").to.be.true;\r",
													"\r",
													"  pm.environment.set(\"TRN_CONFIRM_SCENARIO\",\"ALREADY_CONFIRMED\");\r",
													"  pm.environment.set(\"TRN_CONFIRM_DESC\", d0 || d1);\r",
													"  pm.environment.unset(\"TRN_NIN\");\r",
													"  pm.environment.unset(\"TRN_GUID\");\r",
													"  pm.environment.unset(\"TRN_REQ_STATUS\");\r",
													"  pm.environment.unset(\"TRN_REQ_STATUS_LABEL\");\r",
													"});\r",
													"\r",
													"// ---------- Scenario C: No request ----------\r",
													"pm.test(\"Scenario C – No bank registration request (if applicable)\", function(){\r",
													"  if (scenario !== \"NO_REQUEST\") { this.skip && this.skip(); return; }\r",
													"  var d0 = trim(rs.resDesc), d1 = trim(rs.resDesc1);\r",
													"  var ok = /لا\\s*يوجد\\s*طلب\\s*لتسجيل\\s*الحساب\\s*البنكي\\s*لهذا\\s*العميل/.test(d0) &&\r",
													"           /لا\\s*يوجد\\s*طلب\\s*لتسجيل\\s*الحساب\\s*ال?بنكي\\s*لهذا\\s*العميل/.test(d1);\r",
													"  pm.expect(ok, \"Arabic message: 'no request for bank registration'\").to.be.true;\r",
													"\r",
													"  pm.environment.set(\"TRN_CONFIRM_SCENARIO\",\"NO_REQUEST\");\r",
													"  pm.environment.set(\"TRN_CONFIRM_DESC\", d0 || d1);\r",
													"  pm.environment.unset(\"TRN_NIN\");\r",
													"  pm.environment.unset(\"TRN_GUID\");\r",
													"  pm.environment.unset(\"TRN_REQ_STATUS\");\r",
													"  pm.environment.unset(\"TRN_REQ_STATUS_LABEL\");\r",
													"});\r",
													"\r",
													"// ---------- Scenario E: Invalid transfer data ----------\r",
													"pm.test(\"Scenario E – Invalid transfer data (if applicable)\", function(){\r",
													"  if (scenario !== \"INVALID_TRANSFER_DATA\") { this.skip && this.skip(); return; }\r",
													"\r",
													"  var d0 = trim(rs.resDesc), d1 = trim(rs.resDesc1);\r",
													"  // Normalize Arabic (remove diacritics/hamza variants) and match canonical text\r",
													"  var n0 = normalizeAr(d0), n1 = normalizeAr(d1);\r",
													"  var canon = normalizeAr(\"خطأ في بيانات التحويل\");\r",
													"  var ok = (n0 === canon) && (n1 === canon);\r",
													"  pm.expect(ok, \"Arabic message: 'invalid transfer data'\").to.be.true;\r",
													"\r",
													"  pm.environment.set(\"TRN_CONFIRM_SCENARIO\",\"INVALID_TRANSFER_DATA\");\r",
													"  pm.environment.set(\"TRN_CONFIRM_DESC\", d0 || d1);\r",
													"  pm.environment.unset(\"TRN_NIN\");\r",
													"  pm.environment.unset(\"TRN_GUID\");\r",
													"  pm.environment.unset(\"TRN_REQ_STATUS\");\r",
													"  pm.environment.unset(\"TRN_REQ_STATUS_LABEL\");\r",
													"});\r",
													"\r",
													"// ---------- Scenario F: Invalid OTP ----------\r",
													"pm.test(\"Scenario F – Invalid OTP (if applicable)\", function(){\r",
													"  if (scenario !== \"INVALID_OTP\") { this.skip && this.skip(); return; }\r",
													"  var d0 = trim(rs.resDesc), d1 = trim(rs.resDesc1);\r",
													"  var ok = /كلمة\\s*المرور\\s*لمرة\\s*واحدة\\s*غير\\s*صالحة/.test(d0) &&\r",
													"           /كلمة\\s*المرور\\s*لمرة\\s*واحدة\\s*غير\\s*صالحة/.test(d1);\r",
													"  pm.expect(ok, \"Arabic message: 'invalid one-time password'\").to.be.true;\r",
													"\r",
													"  pm.environment.set(\"TRN_CONFIRM_SCENARIO\",\"INVALID_OTP\");\r",
													"  pm.environment.set(\"TRN_CONFIRM_DESC\", d0 || d1);\r",
													"  pm.environment.unset(\"TRN_NIN\");\r",
													"  pm.environment.unset(\"TRN_GUID\");\r",
													"  pm.environment.unset(\"TRN_REQ_STATUS\");\r",
													"  pm.environment.unset(\"TRN_REQ_STATUS_LABEL\");\r",
													"});\r",
													"\r",
													"// Minimal schema (tv4) – include new codes\r",
													"pm.test(\"Schema (minimal) validates\", function(){\r",
													"  var schema = {\r",
													"    type: \"object\",\r",
													"    required: [\"responseStatus\"],\r",
													"    properties: {\r",
													"      responseStatus: {\r",
													"        type: \"object\",\r",
													"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
													"        properties: {\r",
													"          source:  { \"const\": \"TRN_CONFIRMCANOTP\" },\r",
													"          resCode: { \"enum\": [\"0\",\"190\",\"16100\",\"16113\",\"110070\"] },\r",
													"          resCode1:{ \"enum\": [\"0\",\"190\",\"16100\",\"16113\",\"110070\"] }\r",
													"        }\r",
													"      },\r",
													"      message: { type: \"object\" }\r",
													"    }\r",
													"  };\r",
													"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
													"});\r",
													"\r",
													"// Optional: verify request Srv\r",
													"pm.test(\"Request Srv is TRN_CONFIRMCANOTP\", function(){\r",
													"  try {\r",
													"    var body = pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {};\r",
													"    pm.expect((body || {}).Srv).to.eql(\"TRN_CONFIRMCANOTP\");\r",
													"  } catch(e) { console.warn(\"Could not parse request body:\", e.message); }\r",
													"});\r",
													"\r",
													"console.log(\r",
													"  \"TRN_CONFIRMCANOTP\",\r",
													"  \"scenario=\", pm.environment.get(\"TRN_CONFIRM_SCENARIO\") || \"\",\r",
													"  \"status=\", pm.environment.get(\"TRN_REQ_STATUS\") || \"\",\r",
													"  \"guid=\", pm.environment.get(\"TRN_GUID\") || \"(none)\"\r",
													");\r",
													""
												],
												"type": "text/javascript",
												"packages": {},
												"requests": {}
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Accept",
												"value": "application/json",
												"type": "text"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "/** To GEt the OTP\r\nSELECT * FROM SEC_SMS_OUTBOX WHERE NIN = 'NIN' ORDER BY TIME_STAMP DESC \r\n**/\r\n\r\n{\r\n    \"Srv\": \"TRN_CONFIRMCANOTP\",\r\n    \"Message\": {\r\n        \"TrnConfirmCanRequest\": {\r\n            \"confirmAmount\": \"10000\",\r\n            \"isConfirmed\": \"Y\",\r\n            \"confirmOTP\": \"4247\",\r\n            \"confirmGUID\": \"{{resTrnGUID}}\",\r\n            \"confirmLang\": \"ARB\",\r\n            \"confirmNin\": \"{{NIN}}\",\r\n            \"otpToken\": \"SAVE_TRANSFER\",\r\n            \"confirmClientIP\": \"\",\r\n            \"confirmSource\": \"\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"05-10-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}",
											"options": {
												"raw": {
													"language": "json"
												}
											}
										},
										"url": {
											"raw": "{{BaseURL}}{{Oracle19}}",
											"host": [
												"{{BaseURL}}{{Oracle19}}"
											]
										}
									},
									"response": []
								}
							]
						},
						{
							"name": "Transfer to The Group | Resend OTP",
							"item": [
								{
									"name": "1. Get Banks info",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"/**\r",
													" * BNKBAL – Bank balances & info (ES5)\r",
													" * Validates:\r",
													" *  - HTTP 200, JSON, envelope codes 0/0, source=\"BNKBAL\"\r",
													" *  - bnkInfoResponse existence and key formats\r",
													" *  - Balance fields are numeric strings; negatives allowed by default (toggle strict)\r",
													" *  - banksInfo.bnkInfoRec / bnkTransfers.bnkTransferRec array shapes\r",
													" *  - financierInfo & fundInfo consistency; creditRatio accepts ratio or percent\r",
													" *  - financierInfo fields accept null/\"null\"/\"\" gracefully\r",
													" * Keeps your extracts:\r",
													" *  - accountSeq_i, bnkCode_i, accountCode_i, transferTimeId_i, bankCount\r",
													" *\r",
													" * Optional toggles (Env/Globals):\r",
													" *  - ENFORCE_NON_NEG_BALANCES = Y|N (default N) -> force balances >= 0\r",
													" */\r",
													"\r",
													"// 1) Status code\r",
													"pm.test(\"Status code is 200\", function () {\r",
													"  pm.response.to.have.status(200);\r",
													"});\r",
													"\r",
													"// 2) Envelope base checks\r",
													"pm.test(\"resCode is 0 and resDesc is Successful Operation\", function () {\r",
													"  var resStatus = (pm.response.json() || {}).responseStatus || {};\r",
													"  pm.expect(resStatus.resCode).to.eql(\"0\");\r",
													"  pm.expect(resStatus.resDesc).to.eql(\"Successful Operation\");\r",
													"});\r",
													"\r",
													"// 3) Extract and set bank info (kept as-is)\r",
													"var __json_for_extract = pm.response.json() || {};\r",
													"var __bnkInfoList = ((((__json_for_extract.message || {}).bnkInfoResponse || {}).banksInfo || {}).bnkInfoRec);\r",
													"\r",
													"if (Array.isArray(__bnkInfoList)) {\r",
													"  // Clear previous values\r",
													"  pm.environment.unset(\"bankCount\");\r",
													"\r",
													"  for (var i = 0; i < __bnkInfoList.length; i++) {\r",
													"    var bnk = __bnkInfoList[i] || {};\r",
													"    pm.environment.set(\"accountSeq_\" + (i + 1), String(bnk.accountSeq || \"\"));\r",
													"    pm.environment.set(\"bnkCode_\" + (i + 1), String(bnk.bnkCode || \"\"));\r",
													"    pm.environment.set(\"accountCode_\" + (i + 1), String(bnk.accountCode || \"\"));\r",
													"    pm.environment.set(\"transferTimeId_\" + (i + 1), String(bnk.transferTimeId || \"\"));\r",
													"  }\r",
													"  pm.environment.set(\"bankCount\", String(__bnkInfoList.length));\r",
													"} else {\r",
													"  console.warn(\"banksInfo.bnkInfoRec not found or invalid\");\r",
													"}\r",
													"\r",
													"// Basic header check\r",
													"pm.test(\"Content-Type is JSON\", function () {\r",
													"  pm.response.to.have.header(\"Content-Type\");\r",
													"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
													"});\r",
													"\r",
													"// Parse once & helpers\r",
													"var json = pm.response.json() || {};\r",
													"var rs   = json.responseStatus || {};\r",
													"var bnr  = (json.message || {}).bnkInfoResponse || {};\r",
													"\r",
													"function isNumericStr(v) {\r",
													"  if (typeof v === \"number\") return isFinite(v);\r",
													"  return typeof v === \"string\" && /^-?\\d+(\\.\\d+)?$/.test(v);\r",
													"}\r",
													"function isIntStr(v) {\r",
													"  if (typeof v === \"number\") return Number.isInteger(v);\r",
													"  return typeof v === \"string\" && /^-?\\d+$/.test(v);\r",
													"}\r",
													"function isYN(v)  { return String(v) === \"Y\" || String(v) === \"N\"; }\r",
													"function isNullish(v) {\r",
													"  return v === null || typeof v === \"undefined\" || String(v).trim().toUpperCase() === \"NULL\" || String(v).trim() === \"\";\r",
													"}\r",
													"\r",
													"// Envelope completeness\r",
													"pm.test(\"Envelope complete (BNKBAL)\", function () {\r",
													"  pm.expect(rs.resCode).to.eql(\"0\");\r",
													"  pm.expect(rs.resDesc).to.eql(\"Successful Operation\");\r",
													"  pm.expect(rs.source).to.eql(\"BNKBAL\");\r",
													"  pm.expect(rs.resCode1).to.eql(\"0\");\r",
													"  pm.expect(rs.resDesc1).to.eql(\"Successful Operation\");\r",
													"});\r",
													"\r",
													"// Core node exists\r",
													"pm.test(\"bnkInfoResponse exists\", function () {\r",
													"  pm.expect(bnr).to.be.an(\"object\");\r",
													"});\r",
													"\r",
													"// Name (if provided)\r",
													"pm.test(\"Customer name (if present) is a non-empty string\", function () {\r",
													"  if (typeof bnr.name !== \"undefined\") {\r",
													"    pm.expect(bnr.name).to.be.a(\"string\").and.to.not.equal(\"\");\r",
													"  }\r",
													"});\r",
													"\r",
													"// Balance fields – allow negatives by default (set ENFORCE_NON_NEG_BALANCES=Y to force >=0)\r",
													"pm.test(\"All balance fields are numeric strings (with optional non-negative enforcement)\", function () {\r",
													"  var keys = [\r",
													"    \"buybal1\",\"currentBal\",\"buyBal\",\"buyBal1\",\"onLineBal1\",\"maxBalance1\",\"unclearedBal\",\r",
													"    \"tradeBal\",\"t3Bal\",\"chqColl\",\"onlineBal\",\"todayDepo\",\"todayDepos\",\"allowedBal\",\r",
													"    \"postponed\",\"reservedFawriBalance\",\"maxbalance\",\"newMaxBalance\"\r",
													"  ];\r",
													"  var enforce = String(pm.environment.get(\"ENFORCE_NON_NEG_BALANCES\") || pm.globals.get(\"ENFORCE_NON_NEG_BALANCES\") || \"N\").toUpperCase() === \"Y\";\r",
													"\r",
													"  for (var i=0;i<keys.length;i++){\r",
													"    var k = keys[i];\r",
													"    if (typeof bnr[k] !== \"undefined\") {\r",
													"      pm.expect(isNumericStr(bnr[k]), k + \" must be numeric\").to.be.true;\r",
													"      if (enforce) {\r",
													"        pm.expect(Number(bnr[k]), k + \" must be >= 0 (strict mode)\").to.be.at.least(0);\r",
													"      }\r",
													"    }\r",
													"  }\r",
													"});\r",
													"\r",
													"// banksInfo array and each record format\r",
													"pm.test(\"banksInfo.bnkInfoRec is array (can be empty)\", function () {\r",
													"  var arr = (((bnr || {}).banksInfo || {}).bnkInfoRec);\r",
													"  pm.expect(arr, \"bnkInfoRec\").to.be.an(\"array\");\r",
													"});\r",
													"\r",
													"(function validateBankRecords(){\r",
													"  var arr = (((bnr || {}).banksInfo || {}).bnkInfoRec) || [];\r",
													"  if (!Array.isArray(arr) || arr.length === 0) return;\r",
													"\r",
													"  for (var i=0;i<arr.length;i++){\r",
													"    var rec = arr[i] || {};\r",
													"\r",
													"    pm.expect(String(rec.accountSeq || \"\"), \"accountSeq\").to.match(/^\\d+$/);\r",
													"\r",
													"    // bankCode: allow alphanumeric 2–10 chars (covers \"QNB\" and \"535\")\r",
													"    if (typeof rec.bankCode !== \"undefined\") {\r",
													"      var bc = String(rec.bankCode || \"\").trim().toUpperCase();\r",
													"      pm.expect(bc, \"bankCode non-empty\").to.not.equal(\"\");\r",
													"      pm.expect(bc, \"bankCode format A–Z/0–9, len 2–10\").to.match(/^[A-Z0-9]{2,10}$/);\r",
													"    }\r",
													"\r",
													"    // SWIFT/BIC strict: 8 or 11 alnum\r",
													"    pm.expect(String(rec.bnkCode || \"\"), \"bnkCode (SWIFT/BIC)\").to.match(/^[A-Z0-9]{8}([A-Z0-9]{3})?$/);\r",
													"\r",
													"    pm.expect(rec.bnkName, \"bnkName\").to.be.a(\"string\").and.not.empty;\r",
													"    pm.expect(rec.accountCode, \"accountCode\").to.be.a(\"string\").and.not.empty;\r",
													"\r",
													"    // accountType: accept BOTH/DEBIT/CREDIT/NO/TOBNK\r",
													"    if (typeof rec.accountType !== \"undefined\") {\r",
													"      pm.expect([\"BOTH\",\"DEBIT\",\"CREDIT\",\"NO\",\"TOBNK\"], \"accountType\")\r",
													"        .to.include(String(rec.accountType).toUpperCase());\r",
													"    }\r",
													"\r",
													"    // status\r",
													"    pm.expect(String(rec.accountStatus || \"\"), \"accountStatus\").to.match(/^\\d+$/);\r",
													"    pm.expect(rec.accountStatusDesc, \"accountStatusDesc\").to.be.a(\"string\").and.not.empty;\r",
													"\r",
													"    if (typeof rec.isSahlPlus !== \"undefined\") {\r",
													"      pm.expect(isYN(String(rec.isSahlPlus)), \"isSahlPlus\").to.be.true;\r",
													"    }\r",
													"\r",
													"    // transferTimeId can be long token; just ensure string & non-empty\r",
													"    pm.expect(rec.transferTimeId, \"transferTimeId\").to.be.a(\"string\").and.not.empty;\r",
													"  }\r",
													"})();\r",
													"\r",
													"// bnkTransfers shape\r",
													"pm.test(\"bnkTransfers.bnkTransferRec is array (may be empty)\", function () {\r",
													"  var tr = (((bnr || {}).bnkTransfers || {}).bnkTransferRec);\r",
													"  pm.expect(tr, \"bnkTransferRec\").to.be.an(\"array\");\r",
													"});\r",
													"\r",
													"// financierInfo (if present) – tolerant of null/\"null\"/\"\"\r",
													"pm.test(\"financierInfo (if present) has valid fields\", function () {\r",
													"  var fi = bnr.financierInfo;\r",
													"  if (fi && typeof fi === \"object\") {\r",
													"    if (!isNullish(fi.financierID)) {\r",
													"      pm.expect(String(fi.financierID)).to.match(/^\\d+$/);\r",
													"    }\r",
													"\r",
													"    if (!isNullish(fi.isActive)) {\r",
													"      pm.expect(isYN(String(fi.isActive))).to.be.true;\r",
													"    }\r",
													"\r",
													"    if (!isNullish(fi.isOrdersEnabled)) {\r",
													"      pm.expect(isYN(String(fi.isOrdersEnabled))).to.be.true;\r",
													"    }\r",
													"\r",
													"    if (!isNullish(fi.riskFeesType)) {\r",
													"      pm.expect([\"0\",\"1\",\"2\",\"3\"]).to.include(String(fi.riskFeesType));\r",
													"    }\r",
													"    // riskFeesValue: validate only when present & not nullish\r",
													"    if (!isNullish(fi.riskFeesValue)) {\r",
													"      pm.expect(isNumericStr(fi.riskFeesValue)).to.be.true;\r",
													"      pm.expect(Number(fi.riskFeesValue)).to.be.at.least(0);\r",
													"    }\r",
													"\r",
													"    if (!isNullish(fi.financierAllowancePeriod)) {\r",
													"      pm.expect(isIntStr(fi.financierAllowancePeriod)).to.be.true;\r",
													"      pm.expect(Number(fi.financierAllowancePeriod)).to.be.at.least(0);\r",
													"    }\r",
													"  }\r",
													"});\r",
													"\r",
													"// fundInfo (margin block; can be N or Y)\r",
													"pm.test(\"fundInfo (if present) is consistent\", function () {\r",
													"  var f = bnr.fundInfo;\r",
													"  if (f && typeof f === \"object\") {\r",
													"    pm.expect(isYN(String(f.isFundClient)), \"isFundClient Y/N\").to.be.true;\r",
													"\r",
													"    if (f.isFundClient === \"Y\") {\r",
													"      var numKeys = [\r",
													"        \"fundDebt\",\"fundAvailableCredit\",\"cashBalanceNotCollected\",\"fundedAmountInMarket\",\r",
													"        \"creditRatio\",\"collectedBalance\",\"actualFunded\",\"shareAvCredit\"\r",
													"      ];\r",
													"      for (var i=0;i<numKeys.length;i++){\r",
													"        var k = numKeys[i];\r",
													"        pm.expect(isNumericStr(String(f[k])), \"fundInfo.\"+k+\" numeric\").to.be.true;\r",
													"        pm.expect(Number(f[k]), \"fundInfo.\"+k+\" >= 0\").to.be.at.least(0);\r",
													"      }\r",
													"\r",
													"      // creditRatio sanity: accept ratio [0..1] OR percent [0..100]\r",
													"      if (!isNullish(f.creditRatio)) {\r",
													"        var cr = Number(f.creditRatio);\r",
													"        if (cr > 1) {\r",
													"          pm.expect(cr, \"creditRatio% in [0, 100]\").to.be.at.least(0).and.at.most(100);\r",
													"          pm.environment.set(\"CREDIT_RATIO\", String(cr / 100));     // normalized 0..1\r",
													"          pm.environment.set(\"CREDIT_RATIO_PCT\", String(cr));       // as percent\r",
													"        } else {\r",
													"          pm.expect(cr, \"creditRatio in [0, 1]\").to.be.at.least(0).and.at.most(1);\r",
													"          pm.environment.set(\"CREDIT_RATIO\", String(cr));           // normalized 0..1\r",
													"          pm.environment.set(\"CREDIT_RATIO_PCT\", String(cr * 100)); // as percent\r",
													"        }\r",
													"      }\r",
													"\r",
													"      if (!isNullish(f.isActiveFundClient)) {\r",
													"        pm.expect(isYN(String(f.isActiveFundClient))).to.be.true;\r",
													"      }\r",
													"    }\r",
													"  }\r",
													"});\r",
													"\r",
													"// resType should reflect request's AccRegisterType (when provided)\r",
													"pm.test(\"resType matches AccRegisterType from request (when provided)\", function () {\r",
													"  var reqBody;\r",
													"  try { reqBody = pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {}; } catch(e){}\r",
													"  var accType = (((reqBody || {}).Message || {}).BalDlsRequest || {}).AccRegisterType;\r",
													"  if (accType) {\r",
													"    pm.expect(bnr.resType, \"resType\").to.eql(String(accType));\r",
													"  }\r",
													"});\r",
													"\r",
													"// Guardrails: request Srv should be BNKBAL\r",
													"pm.test(\"Request Srv is BNKBAL\", function () {\r",
													"  var reqBody;\r",
													"  try { reqBody = pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {}; } catch(e){}\r",
													"  pm.expect((reqBody || {}).Srv).to.eql(\"BNKBAL\");\r",
													"});\r",
													"\r",
													"// Minimal schema (tv4)\r",
													"pm.test(\"Schema (minimal) validates\", function () {\r",
													"  var schema = {\r",
													"    type: \"object\",\r",
													"    required: [\"responseStatus\",\"message\"],\r",
													"    properties: {\r",
													"      responseStatus: {\r",
													"        type: \"object\",\r",
													"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
													"        properties: {\r",
													"          resCode:  { \"const\": \"0\" },\r",
													"          resDesc:  { \"const\": \"Successful Operation\" },\r",
													"          source:   { \"const\": \"BNKBAL\" },\r",
													"          resCode1: { \"const\": \"0\" },\r",
													"          resDesc1: { \"const\": \"Successful Operation\" }\r",
													"        }\r",
													"      },\r",
													"      message: {\r",
													"        type: \"object\",\r",
													"        required: [\"bnkInfoResponse\"],\r",
													"        properties: {\r",
													"          bnkInfoResponse: { type: \"object\" }\r",
													"        }\r",
													"      }\r",
													"    }\r",
													"  };\r",
													"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
													"});\r",
													"\r",
													"// Extra: store a few more env helpers (without touching your extract keys)\r",
													"(function storeExtras(){\r",
													"  var arr = (((bnr || {}).banksInfo || {}).bnkInfoRec) || [];\r",
													"  if (arr.length > 0) {\r",
													"    pm.environment.set(\"firstBankCode\", String(arr[0].bankCode || \"\"));\r",
													"    pm.environment.set(\"firstBankSwift\", String(arr[0].bnkCode || \"\"));\r",
													"    pm.environment.set(\"firstAccountStatus\", String(arr[0].accountStatus || \"\"));\r",
													"  }\r",
													"  pm.environment.set(\"bnkTransfersCount\", String(((((bnr || {}).bnkTransfers || {}).bnkTransferRec) || []).length));\r",
													"})();\r",
													"\r",
													"console.log(\"✅ BNKBAL validated.\",\r",
													"            \"bankCount:\", pm.environment.get(\"bankCount\"),\r",
													"            \"transfers:\", pm.environment.get(\"bnkTransfersCount\"),\r",
													"            \"creditRatio(norm):\", pm.environment.get(\"CREDIT_RATIO\"),\r",
													"            \"creditRatio(%) \", pm.environment.get(\"CREDIT_RATIO_PCT\"));\r",
													""
												],
												"type": "text/javascript",
												"packages": {},
												"requests": {}
											}
										}
									],
									"request": {
										"auth": {
											"type": "noauth"
										},
										"method": "POST",
										"header": [
											{
												"key": "Accept",
												"value": "application/json",
												"type": "text"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\r\n    \"Srv\": \"BNKBAL\",\r\n    \"Message\": {\r\n        \"BalDlsRequest\": {\r\n            \"NIN\": \"{{NIN}}\",\r\n            \"UserId\": \"{{UserID}}\",\r\n            \"UserType\": \"INVESTOR\",\r\n            \"AccRegisterType\": \"ALL\",\r\n            \"Lang\": \"ARB\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"30-04-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}\r\n\r\n\r\n",
											"options": {
												"raw": {
													"language": "json"
												}
											}
										},
										"url": {
											"raw": "{{BaseURL}}{{Oracle19}}",
											"host": [
												"{{BaseURL}}{{Oracle19}}"
											]
										}
									},
									"response": []
								},
								{
									"name": "2. Confirm Deposit Transfer",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"/**\r",
													" * BNKCHKTRANSFERNEW – Confirm Transfer (Popup) validation (ES5)\r",
													" * Validates:\r",
													" *  - Envelope: resCode/resCode1=0, source=\"BNKCHKTRANSFERNEW\"\r",
													" *  - Fields: trnxFees, trnxIsPossible, maximumAmount, hintMessage, urgentFees\r",
													" *  - Numeric strings >= 0 (supports scientific notation); trnxIsPossible is Y/N\r",
													" *  - Optional business rules via env toggles (see header comment)\r",
													" * Saves to env:\r",
													" *  TRX_IS_POSSIBLE, TRX_MAX_AMOUNT, TRX_MAX_AMOUNT_NUM, TRX_FEES, TRX_FEES_NUM,\r",
													" *  TRX_URGENT_FEES, TRX_URGENT_FEES_NUM, TRX_HINT\r",
													" */\r",
													"\r",
													"pm.test(\"HTTP 200\", function () {\r",
													"  pm.response.to.have.status(200);\r",
													"});\r",
													"\r",
													"pm.test(\"Content-Type is JSON\", function () {\r",
													"  pm.response.to.have.header(\"Content-Type\");\r",
													"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
													"});\r",
													"\r",
													"// Parse\r",
													"var json;\r",
													"pm.test(\"Body is valid JSON\", function () {\r",
													"  json = pm.response.json();\r",
													"  pm.expect(json).to.be.an(\"object\");\r",
													"});\r",
													"\r",
													"// Envelope\r",
													"pm.test(\"responseStatus OK (BNKCHKTRANSFERNEW)\", function () {\r",
													"  var rs = json.responseStatus || {};\r",
													"  pm.expect(rs.resCode).to.eql(\"0\");\r",
													"  pm.expect(rs.resDesc).to.eql(\"Successful Operation\");\r",
													"  pm.expect(rs.source).to.eql(\"BNKCHKTRANSFERNEW\");\r",
													"  pm.expect(rs.resCode1).to.eql(\"0\");\r",
													"  pm.expect(rs.resDesc1).to.eql(\"Successful Operation\");\r",
													"});\r",
													"\r",
													"// Node\r",
													"var node = (((json || {}).message || {}).isBankTransferResponse) || {};\r",
													"pm.test(\"isBankTransferResponse exists\", function () {\r",
													"  pm.expect(node).to.be.an(\"object\");\r",
													"  pm.expect(node).to.have.property(\"trnxFees\");\r",
													"  pm.expect(node).to.have.property(\"trnxIsPossible\");\r",
													"  pm.expect(node).to.have.property(\"maximumAmount\");\r",
													"  pm.expect(node).to.have.property(\"hintMessage\");\r",
													"  pm.expect(node).to.have.property(\"urgentFees\");\r",
													"});\r",
													"\r",
													"// Helpers (ES5)\r",
													"// Accepts: integers, decimals, and scientific notation (e.g., 1.23E8, -4e-3)\r",
													"function isNumericStr(v) {\r",
													"  if (typeof v === \"number\") return isFinite(v);\r",
													"  var s = String(v || \"\").trim();\r",
													"  return /^-?(?:\\d+\\.?\\d*|\\d*\\.\\d+)(?:[eE][+\\-]?\\d+)?$/.test(s);\r",
													"}\r",
													"function toNumberSafe(v) { return Number(String(v || \"\").trim()); }\r",
													"function isYN(v) { return v === \"Y\" || v === \"N\"; }\r",
													"function getFlag(name, defVal) {\r",
													"  var v = pm.environment.get(name) || pm.globals.get(name);\r",
													"  v = (v == null ? \"\" : String(v)).toUpperCase();\r",
													"  if (v !== \"Y\" && v !== \"N\") return defVal;\r",
													"  return v;\r",
													"}\r",
													"\r",
													"// Field validations\r",
													"pm.test(\"trnxFees & urgentFees are numeric strings >= 0\", function () {\r",
													"  pm.expect(isNumericStr(node.trnxFees), \"trnxFees must be numeric string\").to.be.true;\r",
													"  pm.expect(isNumericStr(node.urgentFees), \"urgentFees must be numeric string\").to.be.true;\r",
													"  pm.expect(toNumberSafe(node.trnxFees), \"trnxFees >= 0\").to.be.at.least(0);\r",
													"  pm.expect(toNumberSafe(node.urgentFees), \"urgentFees >= 0\").to.be.at.least(0);\r",
													"});\r",
													"\r",
													"pm.test(\"trnxIsPossible is Y/N\", function () {\r",
													"  pm.expect(isYN(node.trnxIsPossible), \"trnxIsPossible must be 'Y' or 'N'\").to.be.true;\r",
													"});\r",
													"\r",
													"pm.test(\"maximumAmount is numeric string >= 0\", function () {\r",
													"  pm.expect(isNumericStr(node.maximumAmount), \"maximumAmount must be numeric string\").to.be.true;\r",
													"  pm.expect(toNumberSafe(node.maximumAmount), \"maximumAmount >= 0\").to.be.at.least(0);\r",
													"});\r",
													"\r",
													"pm.test(\"hintMessage is a string (may be empty on success)\", function () {\r",
													"  pm.expect(typeof node.hintMessage).to.eql(\"string\");\r",
													"});\r",
													"\r",
													"// Business rules (configurable)\r",
													"pm.test(\"Business rules for trnxIsPossible\", function () {\r",
													"  var requireMaxWhenY = getFlag(\"REQUIRE_MAX_GT_ZERO_WHEN_Y\", \"Y\") === \"Y\";\r",
													"  var requireHintOnFail = getFlag(\"REQUIRE_HINT_ON_FAIL\", \"Y\") === \"Y\";\r",
													"  var allowNonZeroWhenN = getFlag(\"ALLOW_NONZERO_MAX_WHEN_N\", \"N\") === \"N\" ? false : true;\r",
													"\r",
													"  var isPossible = node.trnxIsPossible === \"Y\";\r",
													"  var maxNum = toNumberSafe(node.maximumAmount);\r",
													"  var hint = String(node.hintMessage || \"\");\r",
													"\r",
													"  if (isPossible) {\r",
													"    if (requireMaxWhenY) {\r",
													"      pm.expect(maxNum, \"When possible=Y, maximumAmount must be > 0\").to.be.above(0);\r",
													"    }\r",
													"    if (hint && hint.replace(/\\s+/g,\"\").length > 0) {\r",
													"      console.warn(\"Hint provided even though trnxIsPossible=Y:\", hint);\r",
													"    }\r",
													"  } else {\r",
													"    if (requireHintOnFail) {\r",
													"      pm.expect(hint.replace(/\\s+/g,\"\").length, \"When possible=N, hintMessage should be non-empty\").to.be.greaterThan(0);\r",
													"    }\r",
													"    if (!allowNonZeroWhenN) {\r",
													"      pm.expect(maxNum, \"When possible=N, maximumAmount should be 0\").to.eql(0);\r",
													"    }\r",
													"  }\r",
													"});\r",
													"\r",
													"// Save to environment\r",
													"(function saveEnv(){\r",
													"  pm.environment.set(\"TRX_IS_POSSIBLE\", String(node.trnxIsPossible || \"\"));\r",
													"  pm.environment.set(\"TRX_MAX_AMOUNT\", String(node.maximumAmount || \"\"));\r",
													"  pm.environment.set(\"TRX_MAX_AMOUNT_NUM\", String(toNumberSafe(node.maximumAmount)));\r",
													"  pm.environment.set(\"TRX_FEES\", String(node.trnxFees || \"\"));\r",
													"  pm.environment.set(\"TRX_FEES_NUM\", String(toNumberSafe(node.trnxFees)));\r",
													"  pm.environment.set(\"TRX_URGENT_FEES\", String(node.urgentFees || \"\"));\r",
													"  pm.environment.set(\"TRX_URGENT_FEES_NUM\", String(toNumberSafe(node.urgentFees)));\r",
													"  pm.environment.set(\"TRX_HINT\", String(node.hintMessage || \"\"));\r",
													"})();\r",
													"\r",
													"// Minimal schema (tv4)\r",
													"pm.test(\"Schema (minimal) validates\", function () {\r",
													"  var schema = {\r",
													"    type: \"object\",\r",
													"    required: [\"responseStatus\",\"message\"],\r",
													"    properties: {\r",
													"      responseStatus: {\r",
													"        type: \"object\",\r",
													"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
													"        properties: {\r",
													"          resCode:  { \"const\": \"0\" },\r",
													"          resDesc:  { \"const\": \"Successful Operation\" },\r",
													"          source:   { \"const\": \"BNKCHKTRANSFERNEW\" },\r",
													"          resCode1: { \"const\": \"0\" },\r",
													"          resDesc1: { \"const\": \"Successful Operation\" }\r",
													"        }\r",
													"      },\r",
													"      message: {\r",
													"        type: \"object\",\r",
													"        required: [\"isBankTransferResponse\"],\r",
													"        properties: {\r",
													"          isBankTransferResponse: {\r",
													"            type: \"object\",\r",
													"            required: [\"trnxFees\",\"trnxIsPossible\",\"maximumAmount\",\"hintMessage\",\"urgentFees\"],\r",
													"            properties: {\r",
													"              trnxFees:       { type: \"string\" },\r",
													"              trnxIsPossible: { type: \"string\" },\r",
													"              maximumAmount:  { type: \"string\" },\r",
													"              hintMessage:    { type: \"string\" },\r",
													"              urgentFees:     { type: \"string\" }\r",
													"            }\r",
													"          }\r",
													"        }\r",
													"      }\r",
													"    }\r",
													"  };\r",
													"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
													"});\r",
													"\r",
													"// Visualizer (compact)\r",
													"(function render(){\r",
													"  var template =\r",
													"    '<style>.t{font-family:system-ui,Segoe UI,Roboto,Arial;font-size:14px;color:#333;width:100%;border-collapse:collapse}' +\r",
													"    '.t th,.t td{border:1px solid #87ceeb;padding:6px;text-align:left}.t th{background:#87ceeb}' +\r",
													"    '.good{color:#0a8f08}.bad{color:#b00020}</style>' +\r",
													"    '<h3>Confirm Transfer</h3>' +\r",
													"    '<table class=\"t\"><tbody>' +\r",
													"    '<tr><th>trnxIsPossible</th><td class=\"{{possibleCls}}\">{{trnxIsPossible}}</td></tr>' +\r",
													"    '<tr><th>maximumAmount</th><td>{{maximumAmount}}</td></tr>' +\r",
													"    '<tr><th>trnxFees</th><td>{{trnxFees}}</td></tr>' +\r",
													"    '<tr><th>urgentFees</th><td>{{urgentFees}}</td></tr>' +\r",
													"    '<tr><th>hintMessage</th><td>{{hintMessage}}</td></tr>' +\r",
													"    '</tbody></table>';\r",
													"\r",
													"  var possibleCls = (node.trnxIsPossible === \"Y\") ? \"good\" : \"bad\";\r",
													"  pm.visualizer.set(template, {\r",
													"    trnxIsPossible: String(node.trnxIsPossible || \"\"),\r",
													"    maximumAmount: String(node.maximumAmount || \"\"),\r",
													"    trnxFees: String(node.trnxFees || \"\"),\r",
													"    urgentFees: String(node.urgentFees || \"\"),\r",
													"    hintMessage: String(node.hintMessage || \"\"),\r",
													"    possibleCls: possibleCls\r",
													"  });\r",
													"})();\r",
													"\r",
													"console.log(\r",
													"  \"✅ BNKCHKTRANSFERNEW validated.\",\r",
													"  \"possible=\", node.trnxIsPossible,\r",
													"  \"max(raw)=\", node.maximumAmount,\r",
													"  \"max(num)=\", Number(String(node.maximumAmount || \"\").trim())\r",
													");\r",
													""
												],
												"type": "text/javascript",
												"packages": {},
												"requests": {}
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Accept",
												"value": "application/json",
												"type": "text"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\r\n    \"Srv\": \"BNKCHKTRANSFERNEW\",\r\n    \"Message\": {\r\n        \"IsBankTransferRequest\": {\r\n            \"swiftCode\": \"{{bnkCode_1}}\",\r\n            \"accountNO\": \"{{accountSeq_1}}\",\r\n            \"amount\": \"555\",\r\n            \"nin\": \"{{NIN}}\",\r\n            \"userId\": \"{{UserID}}\",\r\n            \"userType\": \"INVESTOR\",\r\n            \"lang\": \"ARB\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"30-04-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}",
											"options": {
												"raw": {
													"language": "json"
												}
											}
										},
										"url": {
											"raw": "{{BaseURL}}{{Oracle19}}",
											"host": [
												"{{BaseURL}}{{Oracle19}}"
											]
										}
									},
									"response": []
								},
								{
									"name": "3. Fire - Deposit in The Group",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"/**\r",
													" * BNKTRANSFERNEW – Bank transfer from (ES5)\r",
													" * Validates:\r",
													" *  - Envelope: resCode/resCode1=0, source=\"BNKTRANSFERNEW\"\r",
													" *  - Node: getBankTransferResponse with required keys (all strings)\r",
													" *  - showHint in {Y,N} and conditional rules\r",
													" *  - OTP config: otpLength=\"4\", otpExpiryPeriod=\"300\", otpResendPeriod=\"60\"\r",
													" * Saves env:\r",
													" *  BANK_TRANSFER_CODE, BANK_SHOW_HINT, BANK_HINT_MESSAGE,\r",
													" *  BANK_CONFIRM_MSG, BANK_TRN_GUID, BANK_OTP_TOKEN,\r",
													" *  resTrnGUID (direct alias)\r",
													" */\r",
													"\r",
													"pm.test(\"HTTP 200\", function () {\r",
													"  pm.response.to.have.status(200);\r",
													"});\r",
													"\r",
													"pm.test(\"Content-Type is JSON\", function () {\r",
													"  pm.response.to.have.header(\"Content-Type\");\r",
													"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
													"});\r",
													"\r",
													"// Parse\r",
													"var json;\r",
													"pm.test(\"Body is valid JSON\", function () {\r",
													"  json = pm.response.json();\r",
													"  pm.expect(json).to.be.an(\"object\");\r",
													"});\r",
													"\r",
													"// Envelope\r",
													"pm.test(\"responseStatus OK (BNKTRANSFERNEW)\", function () {\r",
													"  var rs = json.responseStatus || {};\r",
													"  pm.expect(rs.resCode).to.eql(\"0\");\r",
													"  pm.expect(rs.resDesc).to.eql(\"Successful Operation\");\r",
													"  pm.expect(rs.source).to.eql(\"BNKTRANSFERNEW\");\r",
													"  pm.expect(rs.resCode1).to.eql(\"0\");\r",
													"  pm.expect(rs.resDesc1).to.eql(\"Successful Operation\");\r",
													"});\r",
													"\r",
													"// Node\r",
													"var node = (((json || {}).message || {}).getBankTransferResponse) || {};\r",
													"pm.test(\"getBankTransferResponse exists & has required keys\", function () {\r",
													"  pm.expect(node).to.be.an(\"object\");\r",
													"  var keys = [\r",
													"    \"transferCode\",\"showHint\",\"hintMessage\",\"resConfirmMessage\",\"resTrnGUID\",\"otpToken\",\r",
													"    \"otpLength\",\"otpExpiryPeriod\",\"otpResendPeriod\"\r",
													"  ];\r",
													"  for (var i=0;i<keys.length;i++){\r",
													"    pm.expect(node, \"Missing key: \" + keys[i]).to.have.property(keys[i]);\r",
													"    pm.expect(typeof node[keys[i]], keys[i] + \" must be string\").to.eql(\"string\");\r",
													"  }\r",
													"});\r",
													"\r",
													"// Helpers\r",
													"function isYN(v){ return v === \"Y\" || v === \"N\"; }\r",
													"function getFlag(name, defVal){\r",
													"  var v = pm.environment.get(name) || pm.globals.get(name);\r",
													"  v = (v == null ? \"\" : String(v)).toUpperCase();\r",
													"  if (v !== \"Y\" && v !== \"N\") return defVal;\r",
													"  return v;\r",
													"}\r",
													"\r",
													"// showHint logic\r",
													"pm.test(\"showHint is Y/N\", function () {\r",
													"  pm.expect(isYN(node.showHint), \"showHint must be 'Y' or 'N'\").to.be.true;\r",
													"});\r",
													"\r",
													"// Confirm message (Arabic success text)\r",
													"pm.test(\"resConfirmMessage (required by policy or optional)\", function () {\r",
													"  var requireMsg = getFlag(\"REQUIRE_CONFIRM_MESSAGE\", \"Y\") === \"Y\";\r",
													"  var msg = String(node.resConfirmMessage || \"\");\r",
													"  if (requireMsg) {\r",
													"    pm.expect(msg.replace(/\\s+/g,\"\").length, \"resConfirmMessage should be non-empty\").to.be.greaterThan(0);\r",
													"    var ok =\r",
													"      /تم\\s*قبول\\s*طلب\\s*التحويل/.test(msg) ||\r",
													"      /تم\\s*قبول/.test(msg);\r",
													"    pm.expect(ok, \"resConfirmMessage should indicate success in Arabic\").to.be.true;\r",
													"  }\r",
													"});\r",
													"\r",
													"// OTP configuration checks (exact values)\r",
													"pm.test(\"OTP config: otpLength='4', otpExpiryPeriod='300', otpResendPeriod='60'\", function () {\r",
													"  pm.expect(String(node.otpLength)).to.eql(\"4\");\r",
													"  pm.expect(String(node.otpExpiryPeriod)).to.eql(\"300\");\r",
													"  pm.expect(String(node.otpResendPeriod)).to.eql(\"60\");\r",
													"});\r",
													"\r",
													"// Conditional rules for hint / otp\r",
													"pm.test(\"Hint & OTP conditional rules\", function () {\r",
													"  var requireHintOnY   = getFlag(\"REQUIRE_HINT_ON_Y\", \"N\") === \"Y\";\r",
													"  var requireOtpOnHint = getFlag(\"REQUIRE_OTP_WHEN_HINT\", \"N\") === \"Y\";\r",
													"  var requireEmptyOtpWhenNoHint = getFlag(\"REQUIRE_EMPTY_OTP_WHEN_NOHINT\", \"N\") === \"Y\";\r",
													"\r",
													"  var showHintY = node.showHint === \"Y\";\r",
													"  var hint = String(node.hintMessage || \"\");\r",
													"  var otp  = String(node.otpToken || \"\");\r",
													"\r",
													"  if (showHintY) {\r",
													"    if (requireHintOnY) {\r",
													"      pm.expect(hint.replace(/\\s+/g,\"\").length, \"showHint=Y -> hintMessage must be non-empty\").to.be.greaterThan(0);\r",
													"    }\r",
													"    if (requireOtpOnHint) {\r",
													"      pm.expect(otp.replace(/\\s+/g,\"\").length, \"showHint=Y -> otpToken must be non-empty\").to.be.greaterThan(0);\r",
													"    }\r",
													"  } else {\r",
													"    if (requireEmptyOtpWhenNoHint) {\r",
													"      pm.expect(otp.replace(/\\s+/g,\"\").length, \"showHint=N -> otpToken should be empty\").to.eql(0);\r",
													"    }\r",
													"  }\r",
													"});\r",
													"\r",
													"// Optional: require GUID when success (config)\r",
													"pm.test(\"Transaction GUID requirement (optional)\", function () {\r",
													"  var requireGuid = getFlag(\"REQUIRE_GUID_ON_SUCCESS\", \"N\") === \"Y\";\r",
													"  if (requireGuid) {\r",
													"    pm.expect(String(node.resTrnGUID || \"\").replace(/\\s+/g,\"\").length, \"resTrnGUID required\").to.be.greaterThan(0);\r",
													"  }\r",
													"});\r",
													"\r",
													"// Save to environment\r",
													"(function saveEnv(){\r",
													"  pm.environment.set(\"BANK_TRANSFER_CODE\", String(node.transferCode || \"\"));\r",
													"  pm.environment.set(\"BANK_SHOW_HINT\", String(node.showHint || \"\"));\r",
													"  pm.environment.set(\"BANK_HINT_MESSAGE\", String(node.hintMessage || \"\"));\r",
													"  pm.environment.set(\"BANK_CONFIRM_MSG\", String(node.resConfirmMessage || \"\"));\r",
													"  pm.environment.set(\"BANK_TRN_GUID\", String(node.resTrnGUID || \"\"));\r",
													"  pm.environment.set(\"BANK_OTP_TOKEN\", String(node.otpToken || \"\"));\r",
													"  // direct alias as requested\r",
													"  pm.environment.set(\"resTrnGUID\", String(node.resTrnGUID || \"\"));\r",
													"})();\r",
													"\r",
													"// Minimal schema (tv4)\r",
													"pm.test(\"Schema (minimal) validates\", function () {\r",
													"  var schema = {\r",
													"    type: \"object\",\r",
													"    required: [\"responseStatus\",\"message\"],\r",
													"    properties: {\r",
													"      responseStatus: {\r",
													"        type: \"object\",\r",
													"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
													"        properties: {\r",
													"          resCode:  { \"const\": \"0\" },\r",
													"          resDesc:  { \"const\": \"Successful Operation\" },\r",
													"          source:   { \"const\": \"BNKTRANSFERNEW\" },\r",
													"          resCode1: { \"const\": \"0\" },\r",
													"          resDesc1: { \"const\": \"Successful Operation\" }\r",
													"        }\r",
													"      },\r",
													"      message: {\r",
													"        type: \"object\",\r",
													"        required: [\"getBankTransferResponse\"],\r",
													"        properties: {\r",
													"          getBankTransferResponse: {\r",
													"            type: \"object\",\r",
													"            required: [\r",
													"              \"transferCode\",\"showHint\",\"hintMessage\",\"resConfirmMessage\",\"resTrnGUID\",\"otpToken\",\r",
													"              \"otpLength\",\"otpExpiryPeriod\",\"otpResendPeriod\"\r",
													"            ],\r",
													"            properties: {\r",
													"              transferCode:      { type: \"string\" },\r",
													"              showHint:          { type: \"string\" },\r",
													"              hintMessage:       { type: \"string\" },\r",
													"              resConfirmMessage: { type: \"string\" },\r",
													"              resTrnGUID:        { type: \"string\" },\r",
													"              otpToken:          { type: \"string\" },\r",
													"              otpLength:         { type: \"string\", \"const\": \"4\" },\r",
													"              otpExpiryPeriod:   { type: \"string\", \"const\": \"300\" },\r",
													"              otpResendPeriod:   { type: \"string\", \"const\": \"60\" }\r",
													"            }\r",
													"          }\r",
													"        }\r",
													"      }\r",
													"    }\r",
													"  };\r",
													"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
													"});\r",
													"\r",
													"// Visualizer (compact)\r",
													"(function render(){\r",
													"  var template =\r",
													"    '<style>.t{font-family:system-ui,Segoe UI,Roboto,Arial;font-size:14px;color:#333;width:100%;border-collapse:collapse}' +\r",
													"    '.t th,.t td{border:1px solid #87ceeb;padding:6px;text-align:left}.t th{background:#87ceeb}' +\r",
													"    '.flagY{color:#0a8f08}.flagN{color:#b00020}</style>' +\r",
													"    '<h3>Bank Transfer – Result</h3>' +\r",
													"    '<table class=\"t\"><tbody>' +\r",
													"    '<tr><th>resConfirmMessage</th><td>{{resConfirmMessage}}</td></tr>' +\r",
													"    '<tr><th>showHint</th><td class=\"{{showHintCls}}\">{{showHint}}</td></tr>' +\r",
													"    '<tr><th>hintMessage</th><td>{{hintMessage}}</td></tr>' +\r",
													"    '<tr><th>transferCode</th><td>{{transferCode}}</td></tr>' +\r",
													"    '<tr><th>resTrnGUID</th><td>{{resTrnGUID}}</td></tr>' +\r",
													"    '<tr><th>otpToken</th><td>{{otpToken}}</td></tr>' +\r",
													"    '<tr><th>otpLength</th><td>{{otpLength}}</td></tr>' +\r",
													"    '<tr><th>otpExpiryPeriod</th><td>{{otpExpiryPeriod}}</td></tr>' +\r",
													"    '<tr><th>otpResendPeriod</th><td>{{otpResendPeriod}}</td></tr>' +\r",
													"    '</tbody></table>';\r",
													"\r",
													"  pm.visualizer.set(template, {\r",
													"    resConfirmMessage: String(node.resConfirmMessage || \"\"),\r",
													"    showHint: String(node.showHint || \"\"),\r",
													"    hintMessage: String(node.hintMessage || \"\"),\r",
													"    transferCode: String(node.transferCode || \"\"),\r",
													"    resTrnGUID: String(node.resTrnGUID || \"\"),\r",
													"    otpToken: String(node.otpToken || \"\"),\r",
													"    otpLength: String(node.otpLength || \"\"),\r",
													"    otpExpiryPeriod: String(node.otpExpiryPeriod || \"\"),\r",
													"    otpResendPeriod: String(node.otpResendPeriod || \"\"),\r",
													"    showHintCls: (node.showHint === \"Y\") ? \"flagY\" : \"flagN\"\r",
													"  });\r",
													"})();\r",
													"\r",
													"console.log(\"✅ BNKTRANSFERNEW validated.\", \"showHint=\", node.showHint, \"resTrnGUID=\", node.resTrnGUID);\r",
													""
												],
												"type": "text/javascript",
												"packages": {},
												"requests": {}
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Accept",
												"value": "application/json",
												"type": "text"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\r\n    \"Srv\": \"BNKTRANSFERNEW\",\r\n    \"Message\": {\r\n        \"BankTransferRequest\": {\r\n            \"nin\": \"{{NIN}}\",\r\n            \"userId\": \"{{UserID}}\",\r\n            \"userType\": \"INVESTOR\",\r\n            \"accountNO\": \"{{accountCode_1}}\",\r\n            \"amount\": 555,\r\n            \"swiftCode\": \"{{bnkCode_1}}\",\r\n            \"transferType\": \"FROM\",\r\n            \"accountStatus\": \"4\",\r\n            \"transferTimeId\": \"{{transferTimeId_1}}\",\r\n            \"lang\": \"ARB\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"30-04-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}",
											"options": {
												"raw": {
													"language": "json"
												}
											}
										},
										"url": {
											"raw": "{{BaseURL}}{{Oracle19}}",
											"host": [
												"{{BaseURL}}{{Oracle19}}"
											]
										}
									},
									"response": []
								},
								{
									"name": "4. TRN_CONFIRMROTP | Resend OTP",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"/**\r",
													" * TRN_CONFIRMROTP – Resend OTP (Unified)\r",
													" *\r",
													" * Scenarios:\r",
													" *  A) Success (resent):      resCode=\"0\"      -> message.resendOtpResponse present\r",
													" *  B) Already confirmed:     resCode=\"190\"    -> Arabic \"تم تأكيد طلب التحويل من قبل\"\r",
													" *  C) No request:            resCode=\"16100\"  -> Arabic \"لا يوجد طلب لتسجيل الحساب البنكي لهذا العميل\"\r",
													" *  D) Resend too soon:       resCode=\"16137\"  -> Arabic \"لا يمكن إعادة إرسال رمز التحقق...\"\r",
													" *\r",
													" * Saves (depending on scenario):\r",
													" *  ROTP_SCENARIO = SUCCESS | ALREADY_CONFIRMED | NO_REQUEST | RESEND_TOO_SOON\r",
													" *  ROTP_DESC     = responseStatus.resDesc (or resDesc1)\r",
													" *  TRN_RESEND_OTP_LENGTH, TRN_RESEND_OTP_EXPIRY, TRN_RESEND_OTP_RESEND, TRN_RESEND_OTP_TOKEN (on success)\r",
													" */\r",
													"\r",
													"pm.test(\"HTTP 200\", function(){ pm.response.to.have.status(200); });\r",
													"\r",
													"pm.test(\"Content-Type is JSON\", function(){\r",
													"  pm.response.to.have.header(\"Content-Type\");\r",
													"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
													"});\r",
													"\r",
													"// Parse\r",
													"var json;\r",
													"pm.test(\"Body is JSON\", function(){\r",
													"  json = pm.response.json();\r",
													"  pm.expect(json).to.be.an(\"object\");\r",
													"});\r",
													"\r",
													"// Helpers\r",
													"function trim(s){ return String(s == null ? \"\" : s).replace(/^\\s+|\\s+$/g,\"\"); }\r",
													"\r",
													"// Envelope\r",
													"var rs = json.responseStatus || {};\r",
													"pm.test(\"Source & codes\", function(){\r",
													"  pm.expect(rs.source).to.eql(\"TRN_CONFIRMROTP\");\r",
													"  pm.expect([\"0\",\"190\",\"16100\",\"16137\"]).to.include(String(rs.resCode));\r",
													"  pm.expect([\"0\",\"190\",\"16100\",\"16137\"]).to.include(String(rs.resCode1));\r",
													"});\r",
													"\r",
													"// Branch scenario\r",
													"var scenario =\r",
													"  rs.resCode === \"0\"      ? \"SUCCESS\" :\r",
													"  rs.resCode === \"190\"    ? \"ALREADY_CONFIRMED\" :\r",
													"  rs.resCode === \"16100\"  ? \"NO_REQUEST\" :\r",
													"                             \"RESEND_TOO_SOON\";\r",
													"\r",
													"// ---------- A) Success (resent) ----------\r",
													"pm.test(\"Scenario A – Success (resent OTP)\", function(){\r",
													"  if (scenario !== \"SUCCESS\") { this.skip && this.skip(); return; }\r",
													"\r",
													"  var node = (((json || {}).message || {}).resendOtpResponse) || {};\r",
													"  pm.expect(node, \"resendOtpResponse exists\").to.be.an(\"object\");\r",
													"\r",
													"  // Required keys & types\r",
													"  var keys = [\"otpExpiryPeriod\",\"otpResendPeriod\",\"otpLength\",\"otpToken\"];\r",
													"  for (var i=0;i<keys.length;i++){\r",
													"    pm.expect(node, \"Missing key: \" + keys[i]).to.have.property(keys[i]);\r",
													"    pm.expect(typeof node[keys[i]], keys[i] + \" must be string\").to.eql(\"string\");\r",
													"  }\r",
													"\r",
													"  // Exact values\r",
													"  pm.expect(String(node.otpLength)).to.eql(\"4\");\r",
													"  pm.expect(String(node.otpExpiryPeriod)).to.eql(\"300\");\r",
													"  pm.expect(String(node.otpResendPeriod)).to.eql(\"60\");\r",
													"  pm.expect(String(node.otpToken)).to.eql(\"SAVE_TRANSFER\");\r",
													"\r",
													"  // Save env\r",
													"  pm.environment.set(\"ROTP_SCENARIO\", \"SUCCESS\");\r",
													"  pm.environment.set(\"ROTP_DESC\", trim(rs.resDesc || rs.resDesc1 || \"\"));\r",
													"  pm.environment.set(\"TRN_RESEND_OTP_LENGTH\", String(node.otpLength || \"\"));\r",
													"  pm.environment.set(\"TRN_RESEND_OTP_EXPIRY\", String(node.otpExpiryPeriod || \"\"));\r",
													"  pm.environment.set(\"TRN_RESEND_OTP_RESEND\", String(node.otpResendPeriod || \"\"));\r",
													"  pm.environment.set(\"TRN_RESEND_OTP_TOKEN\",  String(node.otpToken || \"\"));\r",
													"});\r",
													"\r",
													"// ---------- B) Already confirmed ----------\r",
													"pm.test(\"Scenario B – Already confirmed\", function(){\r",
													"  if (scenario !== \"ALREADY_CONFIRMED\") { this.skip && this.skip(); return; }\r",
													"\r",
													"  var d0 = trim(rs.resDesc), d1 = trim(rs.resDesc1);\r",
													"  var ok = /تم\\s*تأكيد\\s*طلب\\s*التحويل\\s*من\\s*قبل/.test(d0) &&\r",
													"           /تم\\s*تأكيد\\s*طلب\\s*التحويل\\s*من\\s*قبل/.test(d1);\r",
													"  pm.expect(ok, \"Arabic 'already confirmed' message\").to.be.true;\r",
													"\r",
													"  pm.environment.set(\"ROTP_SCENARIO\", \"ALREADY_CONFIRMED\");\r",
													"  pm.environment.set(\"ROTP_DESC\", d0 || d1);\r",
													"  pm.environment.unset(\"TRN_RESEND_OTP_LENGTH\");\r",
													"  pm.environment.unset(\"TRN_RESEND_OTP_EXPIRY\");\r",
													"  pm.environment.unset(\"TRN_RESEND_OTP_RESEND\");\r",
													"  pm.environment.unset(\"TRN_RESEND_OTP_TOKEN\");\r",
													"});\r",
													"\r",
													"// ---------- C) No request ----------\r",
													"pm.test(\"Scenario C – No bank registration request\", function(){\r",
													"  if (scenario !== \"NO_REQUEST\") { this.skip && this.skip(); return; }\r",
													"\r",
													"  var d0 = trim(rs.resDesc), d1 = trim(rs.resDesc1);\r",
													"  var ok = /لا\\s*يوجد\\s*طلب\\s*لتسجيل\\s*الحساب\\s*ال?بنكي\\s*لهذا\\s*العميل/.test(d0) &&\r",
													"           /لا\\s*يوجد\\s*طلب\\s*لتسجيل\\s*الحساب\\s*ال?بنكي\\s*لهذا\\s*العميل/.test(d1);\r",
													"  pm.expect(ok, \"Arabic 'no request' message\").to.be.true;\r",
													"\r",
													"  pm.environment.set(\"ROTP_SCENARIO\", \"NO_REQUEST\");\r",
													"  pm.environment.set(\"ROTP_DESC\", d0 || d1);\r",
													"  pm.environment.unset(\"TRN_RESEND_OTP_LENGTH\");\r",
													"  pm.environment.unset(\"TRN_RESEND_OTP_EXPIRY\");\r",
													"  pm.environment.unset(\"TRN_RESEND_OTP_RESEND\");\r",
													"  pm.environment.unset(\"TRN_RESEND_OTP_TOKEN\");\r",
													"});\r",
													"\r",
													"// ---------- D) Resend too soon ----------\r",
													"pm.test(\"Scenario D – Resend too soon\", function(){\r",
													"  if (scenario !== \"RESEND_TOO_SOON\") { this.skip && this.skip(); return; }\r",
													"\r",
													"  var d0 = trim(rs.resDesc), d1 = trim(rs.resDesc1);\r",
													"  var ok = /لا\\s*يمكن\\s*إعادة\\s*إرسال\\s*رمز\\s*التحقق\\.\\s*الرجاء\\s*الانتظار\\s*لمدة\\s*دقيقة\\s*واحدة\\s*على\\s*الأقل\\s*قبل\\s*إعادة\\s*المحاولة/.test(d0) &&\r",
													"           /لا\\s*يمكن\\s*إعادة\\s*إرسال\\s*رمز\\s*التحقق\\.\\s*الرجاء\\s*الانتظار\\s*لمدة\\s*دقيقة\\s*واحدة\\s*على\\s*الأقل\\s*قبل\\s*إعادة\\s*المحاولة/.test(d1);\r",
													"  pm.expect(ok, \"Arabic 'resend too soon' message\").to.be.true;\r",
													"\r",
													"  pm.environment.set(\"ROTP_SCENARIO\", \"RESEND_TOO_SOON\");\r",
													"  pm.environment.set(\"ROTP_DESC\", d0 || d1);\r",
													"  pm.environment.unset(\"TRN_RESEND_OTP_LENGTH\");\r",
													"  pm.environment.unset(\"TRN_RESEND_OTP_EXPIRY\");\r",
													"  pm.environment.unset(\"TRN_RESEND_OTP_RESEND\");\r",
													"  pm.environment.unset(\"TRN_RESEND_OTP_TOKEN\");\r",
													"});\r",
													"\r",
													"// Minimal schema (tv4)\r",
													"pm.test(\"Schema (minimal) validates\", function(){\r",
													"  var schema = {\r",
													"    type: \"object\",\r",
													"    required: [\"responseStatus\"],\r",
													"    properties: {\r",
													"      responseStatus: {\r",
													"        type: \"object\",\r",
													"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
													"        properties: {\r",
													"          source:  { \"const\": \"TRN_CONFIRMROTP\" },\r",
													"          resCode: { \"enum\": [\"0\",\"190\",\"16100\",\"16137\"] },\r",
													"          resCode1:{ \"enum\": [\"0\",\"190\",\"16100\",\"16137\"] }\r",
													"        }\r",
													"      },\r",
													"      message: { type: \"object\" }\r",
													"    }\r",
													"  };\r",
													"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
													"});\r",
													"\r",
													"// Optional: verify request Srv\r",
													"pm.test(\"Request Srv is TRN_CONFIRMROTP\", function(){\r",
													"  try {\r",
													"    var body = pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {};\r",
													"    pm.expect((body || {}).Srv).to.eql(\"TRN_CONFIRMROTP\");\r",
													"  } catch(e) { console.warn(\"Could not parse request body:\", e.message); }\r",
													"});\r",
													"\r",
													"console.log(\"✅ TRN_CONFIRMROTP scenario=\", pm.environment.get(\"ROTP_SCENARIO\") || \"\",\r",
													"            \"desc=\", pm.environment.get(\"ROTP_DESC\") || \"\",\r",
													"            \"token=\", pm.environment.get(\"TRN_RESEND_OTP_TOKEN\") || \"(none)\");\r",
													""
												],
												"type": "text/javascript",
												"packages": {},
												"requests": {}
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Accept",
												"value": "application/json",
												"type": "text"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "/***\r\nMake sure to wait more than one minute before calling the API\r\n***/\r\n\r\n{\r\n    \"Srv\": \"TRN_CONFIRMROTP\",\r\n    \"Message\": {\r\n        \"ResendConfirmOTPRequest\": {\r\n            \"confirmAmount\": \"555\",\r\n            \"isConfirmed\": \"Y\",\r\n            \"confirmGUID\": \"{{resTrnGUID}}\",\r\n            \"confirmLang\": \"ARB\",\r\n            \"confirmNin\": \"{{NIN}}\",\r\n            \"otpToken\": \"SAVE_TRANSFER\",\r\n            \"confirmClientIP\": \"\",\r\n            \"confirmSource\": \"\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"05-10-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}",
											"options": {
												"raw": {
													"language": "json"
												}
											}
										},
										"url": {
											"raw": "{{BaseURL}}{{Oracle19}}",
											"host": [
												"{{BaseURL}}{{Oracle19}}"
											]
										}
									},
									"response": []
								},
								{
									"name": "5. TRN_CONFIRMCANOTP",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"/**\r",
													" * TRN_CONFIRMCANOTP – Confirm OTP for transfer to group account (Unified)\r",
													" *\r",
													" * Scenarios handled:\r",
													" *  A) Success (Approved):   resCode=\"0\"      -> transferInfoResponse.requestStatus=\"APRV\"\r",
													" *  B) Already confirmed:    resCode=\"190\"    -> تم تأكيد طلب التحويل من قبل\r",
													" *  C) No request:           resCode=\"16100\"  -> لا يوجد طلب لتسجيل الحساب البنكي لهذا العميل\r",
													" *  D) Success (Cancelled):  resCode=\"0\"      -> transferInfoResponse.requestStatus=\"CAN\"\r",
													" *  E) Invalid transfer data:resCode=\"16113\"  -> خطأ في بيانات التحويل\r",
													" *  F) Invalid OTP:          resCode=\"110070\" -> كلمة المرور لمرة واحدة غير صالحة\r",
													" *\r",
													" * Saves (depending on scenario):\r",
													" *  TRN_CONFIRM_SCENARIO ∈ { SUCCESS_APRV, SUCCESS_CAN, ALREADY_CONFIRMED, NO_REQUEST, INVALID_TRANSFER_DATA, INVALID_OTP }\r",
													" *  TRN_CONFIRM_DESC     = responseStatus.resDesc (or resDesc1)\r",
													" *  TRN_NIN, TRN_GUID, TRN_REQ_STATUS, TRN_REQ_STATUS_LABEL (on success)\r",
													" */\r",
													"\r",
													"pm.test(\"HTTP 200\", function () { pm.response.to.have.status(200); });\r",
													"\r",
													"pm.test(\"Content-Type is JSON\", function () {\r",
													"  pm.response.to.have.header(\"Content-Type\");\r",
													"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
													"});\r",
													"\r",
													"// Parse\r",
													"var json;\r",
													"pm.test(\"Body is JSON\", function () {\r",
													"  json = pm.response.json();\r",
													"  pm.expect(json).to.be.an(\"object\");\r",
													"});\r",
													"\r",
													"// Helpers\r",
													"function trim(s){ return String(s == null ? \"\" : s).replace(/^\\s+|\\s+$/g,\"\"); }\r",
													"function getFlag(name, defVal){\r",
													"  var v = pm.environment.get(name) || pm.globals.get(name);\r",
													"  v = (v == null ? \"\" : String(v)).toUpperCase();\r",
													"  if (v !== \"Y\" && v !== \"N\") return defVal;\r",
													"  return v;\r",
													"}\r",
													"function isGuidLike(s){ return /^[A-Za-z0-9_-]{10,40}$/.test(String(s || \"\")); } // backend GUID style\r",
													"\r",
													"// Arabic normalization: remove diacritics/standalone hamza, unify alef forms, collapse spaces\r",
													"function normalizeAr(s){\r",
													"  s = String(s || \"\");\r",
													"  // remove tashkeel & symbols\r",
													"  s = s.replace(/[\\u064B-\\u0652\\u0670\\u0653-\\u0655]/g, \"\");\r",
													"  // unify alef variants and remove standalone hamza\r",
													"  s = s.replace(/[أإآ]/g, \"ا\").replace(/ء/g, \"\");\r",
													"  // collapse spaces\r",
													"  s = s.replace(/\\s+/g, \" \").trim();\r",
													"  return s;\r",
													"}\r",
													"\r",
													"// Envelope\r",
													"var rs = json.responseStatus || {};\r",
													"pm.test(\"Source is TRN_CONFIRMCANOTP\", function(){\r",
													"  pm.expect(rs.source).to.eql(\"TRN_CONFIRMCANOTP\");\r",
													"});\r",
													"\r",
													"// Accept all known res codes\r",
													"pm.test(\"resCode is one of expected\", function(){\r",
													"  var allowed = [\"0\",\"190\",\"16100\",\"16113\",\"110070\"];\r",
													"  pm.expect(allowed).to.include(String(rs.resCode));\r",
													"  pm.expect(allowed).to.include(String(rs.resCode1));\r",
													"});\r",
													"\r",
													"// Branch scenario\r",
													"var scenario =\r",
													"  (rs.resCode === \"0\") ? \"SUCCESS\" :\r",
													"  (rs.resCode === \"190\") ? \"ALREADY_CONFIRMED\" :\r",
													"  (rs.resCode === \"16100\") ? \"NO_REQUEST\" :\r",
													"  (rs.resCode === \"16113\") ? \"INVALID_TRANSFER_DATA\" :\r",
													"  (rs.resCode === \"110070\") ? \"INVALID_OTP\" :\r",
													"  \"UNKNOWN\";\r",
													"\r",
													"// ---------- Scenario A/D: Success (APRV or CAN) ----------\r",
													"pm.test(\"Scenario A/D – Success payload (APRV or CAN)\", function(){\r",
													"  if (scenario !== \"SUCCESS\") { this.skip && this.skip(); return; }\r",
													"\r",
													"  var node = (((json || {}).message || {}).transferInfoResponse) || {};\r",
													"  pm.expect(node, \"transferInfoResponse exists\").to.be.an(\"object\");\r",
													"\r",
													"  [\"nin\",\"guid\",\"requestStatus\"].forEach(function(k){\r",
													"    pm.expect(node, \"Missing key: \" + k).to.have.property(k);\r",
													"    pm.expect(String(node[k]).length, k + \" non-empty\").to.be.greaterThan(0);\r",
													"  });\r",
													"\r",
													"  var status = String(node.requestStatus || \"\").toUpperCase();\r",
													"  pm.expect([\"APRV\",\"CAN\"]).to.include(status);\r",
													"  pm.expect(isGuidLike(node.guid), \"guid token format\").to.be.true;\r",
													"\r",
													"  var assertNin = getFlag(\"ASSERT_NIN\",\"N\") === \"Y\";\r",
													"  var envNin = pm.environment.get(\"NIN\") || pm.globals.get(\"NIN\") || \"\";\r",
													"  if (assertNin && envNin) {\r",
													"    pm.expect(String(node.nin), \"nin matches ENV NIN\").to.eql(String(envNin));\r",
													"  }\r",
													"\r",
													"  var label = (status === \"APRV\") ? \"APPROVED\" : \"CANCELLED\";\r",
													"  var scenarioTag = (status === \"APRV\") ? \"SUCCESS_APRV\" : \"SUCCESS_CAN\";\r",
													"\r",
													"  pm.environment.set(\"TRN_CONFIRM_SCENARIO\", scenarioTag);\r",
													"  pm.environment.set(\"TRN_CONFIRM_DESC\", trim(rs.resDesc || rs.resDesc1 || \"\"));\r",
													"  pm.environment.set(\"TRN_NIN\", String(node.nin || \"\"));\r",
													"  pm.environment.set(\"TRN_GUID\", String(node.guid || \"\"));\r",
													"  pm.environment.set(\"TRN_REQ_STATUS\", status);\r",
													"  pm.environment.set(\"TRN_REQ_STATUS_LABEL\", label);\r",
													"});\r",
													"\r",
													"// ---------- Scenario B: Already confirmed ----------\r",
													"pm.test(\"Scenario B – Already confirmed (if applicable)\", function(){\r",
													"  if (scenario !== \"ALREADY_CONFIRMED\") { this.skip && this.skip(); return; }\r",
													"  var d0 = trim(rs.resDesc), d1 = trim(rs.resDesc1);\r",
													"  var ok = /تم\\s*تأكيد\\s*طلب\\s*التحويل\\s*من\\s*قبل/.test(d0) &&\r",
													"           /تم\\s*تأكيد\\s*طلب\\s*التحويل\\s*من\\s*قبل/.test(d1);\r",
													"  pm.expect(ok, \"Arabic message: 'already confirmed'\").to.be.true;\r",
													"\r",
													"  pm.environment.set(\"TRN_CONFIRM_SCENARIO\",\"ALREADY_CONFIRMED\");\r",
													"  pm.environment.set(\"TRN_CONFIRM_DESC\", d0 || d1);\r",
													"  pm.environment.unset(\"TRN_NIN\");\r",
													"  pm.environment.unset(\"TRN_GUID\");\r",
													"  pm.environment.unset(\"TRN_REQ_STATUS\");\r",
													"  pm.environment.unset(\"TRN_REQ_STATUS_LABEL\");\r",
													"});\r",
													"\r",
													"// ---------- Scenario C: No request ----------\r",
													"pm.test(\"Scenario C – No bank registration request (if applicable)\", function(){\r",
													"  if (scenario !== \"NO_REQUEST\") { this.skip && this.skip(); return; }\r",
													"  var d0 = trim(rs.resDesc), d1 = trim(rs.resDesc1);\r",
													"  var ok = /لا\\s*يوجد\\s*طلب\\s*لتسجيل\\s*الحساب\\s*البنكي\\s*لهذا\\s*العميل/.test(d0) &&\r",
													"           /لا\\s*يوجد\\s*طلب\\s*لتسجيل\\s*الحساب\\s*ال?بنكي\\s*لهذا\\s*العميل/.test(d1);\r",
													"  pm.expect(ok, \"Arabic message: 'no request for bank registration'\").to.be.true;\r",
													"\r",
													"  pm.environment.set(\"TRN_CONFIRM_SCENARIO\",\"NO_REQUEST\");\r",
													"  pm.environment.set(\"TRN_CONFIRM_DESC\", d0 || d1);\r",
													"  pm.environment.unset(\"TRN_NIN\");\r",
													"  pm.environment.unset(\"TRN_GUID\");\r",
													"  pm.environment.unset(\"TRN_REQ_STATUS\");\r",
													"  pm.environment.unset(\"TRN_REQ_STATUS_LABEL\");\r",
													"});\r",
													"\r",
													"// ---------- Scenario E: Invalid transfer data ----------\r",
													"pm.test(\"Scenario E – Invalid transfer data (if applicable)\", function(){\r",
													"  if (scenario !== \"INVALID_TRANSFER_DATA\") { this.skip && this.skip(); return; }\r",
													"\r",
													"  var d0 = trim(rs.resDesc), d1 = trim(rs.resDesc1);\r",
													"  // Normalize Arabic (remove diacritics/hamza variants) and match canonical text\r",
													"  var n0 = normalizeAr(d0), n1 = normalizeAr(d1);\r",
													"  var canon = normalizeAr(\"خطأ في بيانات التحويل\");\r",
													"  var ok = (n0 === canon) && (n1 === canon);\r",
													"  pm.expect(ok, \"Arabic message: 'invalid transfer data'\").to.be.true;\r",
													"\r",
													"  pm.environment.set(\"TRN_CONFIRM_SCENARIO\",\"INVALID_TRANSFER_DATA\");\r",
													"  pm.environment.set(\"TRN_CONFIRM_DESC\", d0 || d1);\r",
													"  pm.environment.unset(\"TRN_NIN\");\r",
													"  pm.environment.unset(\"TRN_GUID\");\r",
													"  pm.environment.unset(\"TRN_REQ_STATUS\");\r",
													"  pm.environment.unset(\"TRN_REQ_STATUS_LABEL\");\r",
													"});\r",
													"\r",
													"// ---------- Scenario F: Invalid OTP ----------\r",
													"pm.test(\"Scenario F – Invalid OTP (if applicable)\", function(){\r",
													"  if (scenario !== \"INVALID_OTP\") { this.skip && this.skip(); return; }\r",
													"  var d0 = trim(rs.resDesc), d1 = trim(rs.resDesc1);\r",
													"  var ok = /كلمة\\s*المرور\\s*لمرة\\s*واحدة\\s*غير\\s*صالحة/.test(d0) &&\r",
													"           /كلمة\\s*المرور\\s*لمرة\\s*واحدة\\s*غير\\s*صالحة/.test(d1);\r",
													"  pm.expect(ok, \"Arabic message: 'invalid one-time password'\").to.be.true;\r",
													"\r",
													"  pm.environment.set(\"TRN_CONFIRM_SCENARIO\",\"INVALID_OTP\");\r",
													"  pm.environment.set(\"TRN_CONFIRM_DESC\", d0 || d1);\r",
													"  pm.environment.unset(\"TRN_NIN\");\r",
													"  pm.environment.unset(\"TRN_GUID\");\r",
													"  pm.environment.unset(\"TRN_REQ_STATUS\");\r",
													"  pm.environment.unset(\"TRN_REQ_STATUS_LABEL\");\r",
													"});\r",
													"\r",
													"// Minimal schema (tv4) – include new codes\r",
													"pm.test(\"Schema (minimal) validates\", function(){\r",
													"  var schema = {\r",
													"    type: \"object\",\r",
													"    required: [\"responseStatus\"],\r",
													"    properties: {\r",
													"      responseStatus: {\r",
													"        type: \"object\",\r",
													"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
													"        properties: {\r",
													"          source:  { \"const\": \"TRN_CONFIRMCANOTP\" },\r",
													"          resCode: { \"enum\": [\"0\",\"190\",\"16100\",\"16113\",\"110070\"] },\r",
													"          resCode1:{ \"enum\": [\"0\",\"190\",\"16100\",\"16113\",\"110070\"] }\r",
													"        }\r",
													"      },\r",
													"      message: { type: \"object\" }\r",
													"    }\r",
													"  };\r",
													"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
													"});\r",
													"\r",
													"// Optional: verify request Srv\r",
													"pm.test(\"Request Srv is TRN_CONFIRMCANOTP\", function(){\r",
													"  try {\r",
													"    var body = pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {};\r",
													"    pm.expect((body || {}).Srv).to.eql(\"TRN_CONFIRMCANOTP\");\r",
													"  } catch(e) { console.warn(\"Could not parse request body:\", e.message); }\r",
													"});\r",
													"\r",
													"console.log(\r",
													"  \"TRN_CONFIRMCANOTP\",\r",
													"  \"scenario=\", pm.environment.get(\"TRN_CONFIRM_SCENARIO\") || \"\",\r",
													"  \"status=\", pm.environment.get(\"TRN_REQ_STATUS\") || \"\",\r",
													"  \"guid=\", pm.environment.get(\"TRN_GUID\") || \"(none)\"\r",
													");\r",
													""
												],
												"type": "text/javascript",
												"packages": {},
												"requests": {}
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Accept",
												"value": "application/json",
												"type": "text"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\r\n    \"Srv\": \"TRN_CONFIRMCANOTP\",\r\n    \"Message\": {\r\n        \"TrnConfirmCanRequest\": {\r\n            \"confirmAmount\": \"555\",\r\n            \"isConfirmed\": \"Y\",\r\n            \"confirmOTP\": \"7796\",\r\n            \"confirmGUID\": \"{{resTrnGUID}}\",\r\n            \"confirmLang\": \"ARB\",\r\n            \"confirmNin\": \"{{NIN}}\",\r\n            \"otpToken\": \"SAVE_TRANSFER\",\r\n            \"confirmClientIP\": \"\",\r\n            \"confirmSource\": \"\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"05-10-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}",
											"options": {
												"raw": {
													"language": "json"
												}
											}
										},
										"url": {
											"raw": "{{BaseURL}}{{Oracle19}}",
											"host": [
												"{{BaseURL}}{{Oracle19}}"
											]
										}
									},
									"response": []
								}
							]
						}
					]
				},
				{
					"name": "Withdraw from the Group",
					"item": [
						{
							"name": "Withdraw from the Group",
							"item": [
								{
									"name": "1. Get Banks info",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"/**\r",
													" * BNKBAL – Bank balances & info (ES5)\r",
													" * Validates:\r",
													" *  - HTTP 200, JSON, envelope codes 0/0, source=\"BNKBAL\"\r",
													" *  - bnkInfoResponse existence and key formats\r",
													" *  - Balance fields are numeric strings; negatives allowed by default (toggle strict)\r",
													" *  - banksInfo.bnkInfoRec / bnkTransfers.bnkTransferRec array shapes\r",
													" *  - financierInfo & fundInfo consistency; creditRatio accepts ratio or percent\r",
													" *  - financierInfo fields accept null/\"null\"/\"\" gracefully\r",
													" * Keeps your extracts:\r",
													" *  - accountSeq_i, bnkCode_i, accountCode_i, transferTimeId_i, bankCount\r",
													" *\r",
													" * Optional toggles (Env/Globals):\r",
													" *  - ENFORCE_NON_NEG_BALANCES = Y|N (default N) -> force balances >= 0\r",
													" */\r",
													"\r",
													"// 1) Status code\r",
													"pm.test(\"Status code is 200\", function () {\r",
													"  pm.response.to.have.status(200);\r",
													"});\r",
													"\r",
													"// 2) Envelope base checks\r",
													"pm.test(\"resCode is 0 and resDesc is Successful Operation\", function () {\r",
													"  var resStatus = (pm.response.json() || {}).responseStatus || {};\r",
													"  pm.expect(resStatus.resCode).to.eql(\"0\");\r",
													"  pm.expect(resStatus.resDesc).to.eql(\"Successful Operation\");\r",
													"});\r",
													"\r",
													"// 3) Extract and set bank info (kept as-is)\r",
													"var __json_for_extract = pm.response.json() || {};\r",
													"var __bnkInfoList = ((((__json_for_extract.message || {}).bnkInfoResponse || {}).banksInfo || {}).bnkInfoRec);\r",
													"\r",
													"if (Array.isArray(__bnkInfoList)) {\r",
													"  // Clear previous values\r",
													"  pm.environment.unset(\"bankCount\");\r",
													"\r",
													"  for (var i = 0; i < __bnkInfoList.length; i++) {\r",
													"    var bnk = __bnkInfoList[i] || {};\r",
													"    pm.environment.set(\"accountSeq_\" + (i + 1), String(bnk.accountSeq || \"\"));\r",
													"    pm.environment.set(\"bnkCode_\" + (i + 1), String(bnk.bnkCode || \"\"));\r",
													"    pm.environment.set(\"accountCode_\" + (i + 1), String(bnk.accountCode || \"\"));\r",
													"    pm.environment.set(\"transferTimeId_\" + (i + 1), String(bnk.transferTimeId || \"\"));\r",
													"  }\r",
													"  pm.environment.set(\"bankCount\", String(__bnkInfoList.length));\r",
													"} else {\r",
													"  console.warn(\"banksInfo.bnkInfoRec not found or invalid\");\r",
													"}\r",
													"\r",
													"// Basic header check\r",
													"pm.test(\"Content-Type is JSON\", function () {\r",
													"  pm.response.to.have.header(\"Content-Type\");\r",
													"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
													"});\r",
													"\r",
													"// Parse once & helpers\r",
													"var json = pm.response.json() || {};\r",
													"var rs   = json.responseStatus || {};\r",
													"var bnr  = (json.message || {}).bnkInfoResponse || {};\r",
													"\r",
													"function isNumericStr(v) {\r",
													"  if (typeof v === \"number\") return isFinite(v);\r",
													"  return typeof v === \"string\" && /^-?\\d+(\\.\\d+)?$/.test(v);\r",
													"}\r",
													"function isIntStr(v) {\r",
													"  if (typeof v === \"number\") return Number.isInteger(v);\r",
													"  return typeof v === \"string\" && /^-?\\d+$/.test(v);\r",
													"}\r",
													"function isYN(v)  { return String(v) === \"Y\" || String(v) === \"N\"; }\r",
													"function isNullish(v) {\r",
													"  return v === null || typeof v === \"undefined\" || String(v).trim().toUpperCase() === \"NULL\" || String(v).trim() === \"\";\r",
													"}\r",
													"\r",
													"// Envelope completeness\r",
													"pm.test(\"Envelope complete (BNKBAL)\", function () {\r",
													"  pm.expect(rs.resCode).to.eql(\"0\");\r",
													"  pm.expect(rs.resDesc).to.eql(\"Successful Operation\");\r",
													"  pm.expect(rs.source).to.eql(\"BNKBAL\");\r",
													"  pm.expect(rs.resCode1).to.eql(\"0\");\r",
													"  pm.expect(rs.resDesc1).to.eql(\"Successful Operation\");\r",
													"});\r",
													"\r",
													"// Core node exists\r",
													"pm.test(\"bnkInfoResponse exists\", function () {\r",
													"  pm.expect(bnr).to.be.an(\"object\");\r",
													"});\r",
													"\r",
													"// Name (if provided)\r",
													"pm.test(\"Customer name (if present) is a non-empty string\", function () {\r",
													"  if (typeof bnr.name !== \"undefined\") {\r",
													"    pm.expect(bnr.name).to.be.a(\"string\").and.to.not.equal(\"\");\r",
													"  }\r",
													"});\r",
													"\r",
													"// Balance fields – allow negatives by default (set ENFORCE_NON_NEG_BALANCES=Y to force >=0)\r",
													"pm.test(\"All balance fields are numeric strings (with optional non-negative enforcement)\", function () {\r",
													"  var keys = [\r",
													"    \"buybal1\",\"currentBal\",\"buyBal\",\"buyBal1\",\"onLineBal1\",\"maxBalance1\",\"unclearedBal\",\r",
													"    \"tradeBal\",\"t3Bal\",\"chqColl\",\"onlineBal\",\"todayDepo\",\"todayDepos\",\"allowedBal\",\r",
													"    \"postponed\",\"reservedFawriBalance\",\"maxbalance\",\"newMaxBalance\"\r",
													"  ];\r",
													"  var enforce = String(pm.environment.get(\"ENFORCE_NON_NEG_BALANCES\") || pm.globals.get(\"ENFORCE_NON_NEG_BALANCES\") || \"N\").toUpperCase() === \"Y\";\r",
													"\r",
													"  for (var i=0;i<keys.length;i++){\r",
													"    var k = keys[i];\r",
													"    if (typeof bnr[k] !== \"undefined\") {\r",
													"      pm.expect(isNumericStr(bnr[k]), k + \" must be numeric\").to.be.true;\r",
													"      if (enforce) {\r",
													"        pm.expect(Number(bnr[k]), k + \" must be >= 0 (strict mode)\").to.be.at.least(0);\r",
													"      }\r",
													"    }\r",
													"  }\r",
													"});\r",
													"\r",
													"// banksInfo array and each record format\r",
													"pm.test(\"banksInfo.bnkInfoRec is array (can be empty)\", function () {\r",
													"  var arr = (((bnr || {}).banksInfo || {}).bnkInfoRec);\r",
													"  pm.expect(arr, \"bnkInfoRec\").to.be.an(\"array\");\r",
													"});\r",
													"\r",
													"(function validateBankRecords(){\r",
													"  var arr = (((bnr || {}).banksInfo || {}).bnkInfoRec) || [];\r",
													"  if (!Array.isArray(arr) || arr.length === 0) return;\r",
													"\r",
													"  for (var i=0;i<arr.length;i++){\r",
													"    var rec = arr[i] || {};\r",
													"\r",
													"    pm.expect(String(rec.accountSeq || \"\"), \"accountSeq\").to.match(/^\\d+$/);\r",
													"\r",
													"    // bankCode: allow alphanumeric 2–10 chars (covers \"QNB\" and \"535\")\r",
													"    if (typeof rec.bankCode !== \"undefined\") {\r",
													"      var bc = String(rec.bankCode || \"\").trim().toUpperCase();\r",
													"      pm.expect(bc, \"bankCode non-empty\").to.not.equal(\"\");\r",
													"      pm.expect(bc, \"bankCode format A–Z/0–9, len 2–10\").to.match(/^[A-Z0-9]{2,10}$/);\r",
													"    }\r",
													"\r",
													"    // SWIFT/BIC strict: 8 or 11 alnum\r",
													"    pm.expect(String(rec.bnkCode || \"\"), \"bnkCode (SWIFT/BIC)\").to.match(/^[A-Z0-9]{8}([A-Z0-9]{3})?$/);\r",
													"\r",
													"    pm.expect(rec.bnkName, \"bnkName\").to.be.a(\"string\").and.not.empty;\r",
													"    pm.expect(rec.accountCode, \"accountCode\").to.be.a(\"string\").and.not.empty;\r",
													"\r",
													"    // accountType: accept BOTH/DEBIT/CREDIT/NO/TOBNK\r",
													"    if (typeof rec.accountType !== \"undefined\") {\r",
													"      pm.expect([\"BOTH\",\"DEBIT\",\"CREDIT\",\"NO\",\"TOBNK\"], \"accountType\")\r",
													"        .to.include(String(rec.accountType).toUpperCase());\r",
													"    }\r",
													"\r",
													"    // status\r",
													"    pm.expect(String(rec.accountStatus || \"\"), \"accountStatus\").to.match(/^\\d+$/);\r",
													"    pm.expect(rec.accountStatusDesc, \"accountStatusDesc\").to.be.a(\"string\").and.not.empty;\r",
													"\r",
													"    if (typeof rec.isSahlPlus !== \"undefined\") {\r",
													"      pm.expect(isYN(String(rec.isSahlPlus)), \"isSahlPlus\").to.be.true;\r",
													"    }\r",
													"\r",
													"    // transferTimeId can be long token; just ensure string & non-empty\r",
													"    pm.expect(rec.transferTimeId, \"transferTimeId\").to.be.a(\"string\").and.not.empty;\r",
													"  }\r",
													"})();\r",
													"\r",
													"// bnkTransfers shape\r",
													"pm.test(\"bnkTransfers.bnkTransferRec is array (may be empty)\", function () {\r",
													"  var tr = (((bnr || {}).bnkTransfers || {}).bnkTransferRec);\r",
													"  pm.expect(tr, \"bnkTransferRec\").to.be.an(\"array\");\r",
													"});\r",
													"\r",
													"// financierInfo (if present) – tolerant of null/\"null\"/\"\"\r",
													"pm.test(\"financierInfo (if present) has valid fields\", function () {\r",
													"  var fi = bnr.financierInfo;\r",
													"  if (fi && typeof fi === \"object\") {\r",
													"    if (!isNullish(fi.financierID)) {\r",
													"      pm.expect(String(fi.financierID)).to.match(/^\\d+$/);\r",
													"    }\r",
													"\r",
													"    if (!isNullish(fi.isActive)) {\r",
													"      pm.expect(isYN(String(fi.isActive))).to.be.true;\r",
													"    }\r",
													"\r",
													"    if (!isNullish(fi.isOrdersEnabled)) {\r",
													"      pm.expect(isYN(String(fi.isOrdersEnabled))).to.be.true;\r",
													"    }\r",
													"\r",
													"    if (!isNullish(fi.riskFeesType)) {\r",
													"      pm.expect([\"0\",\"1\",\"2\",\"3\"]).to.include(String(fi.riskFeesType));\r",
													"    }\r",
													"    // riskFeesValue: validate only when present & not nullish\r",
													"    if (!isNullish(fi.riskFeesValue)) {\r",
													"      pm.expect(isNumericStr(fi.riskFeesValue)).to.be.true;\r",
													"      pm.expect(Number(fi.riskFeesValue)).to.be.at.least(0);\r",
													"    }\r",
													"\r",
													"    if (!isNullish(fi.financierAllowancePeriod)) {\r",
													"      pm.expect(isIntStr(fi.financierAllowancePeriod)).to.be.true;\r",
													"      pm.expect(Number(fi.financierAllowancePeriod)).to.be.at.least(0);\r",
													"    }\r",
													"  }\r",
													"});\r",
													"\r",
													"// fundInfo (margin block; can be N or Y)\r",
													"pm.test(\"fundInfo (if present) is consistent\", function () {\r",
													"  var f = bnr.fundInfo;\r",
													"  if (f && typeof f === \"object\") {\r",
													"    pm.expect(isYN(String(f.isFundClient)), \"isFundClient Y/N\").to.be.true;\r",
													"\r",
													"    if (f.isFundClient === \"Y\") {\r",
													"      var numKeys = [\r",
													"        \"fundDebt\",\"fundAvailableCredit\",\"cashBalanceNotCollected\",\"fundedAmountInMarket\",\r",
													"        \"creditRatio\",\"collectedBalance\",\"actualFunded\",\"shareAvCredit\"\r",
													"      ];\r",
													"      for (var i=0;i<numKeys.length;i++){\r",
													"        var k = numKeys[i];\r",
													"        pm.expect(isNumericStr(String(f[k])), \"fundInfo.\"+k+\" numeric\").to.be.true;\r",
													"        pm.expect(Number(f[k]), \"fundInfo.\"+k+\" >= 0\").to.be.at.least(0);\r",
													"      }\r",
													"\r",
													"      // creditRatio sanity: accept ratio [0..1] OR percent [0..100]\r",
													"      if (!isNullish(f.creditRatio)) {\r",
													"        var cr = Number(f.creditRatio);\r",
													"        if (cr > 1) {\r",
													"          pm.expect(cr, \"creditRatio% in [0, 100]\").to.be.at.least(0).and.at.most(100);\r",
													"          pm.environment.set(\"CREDIT_RATIO\", String(cr / 100));     // normalized 0..1\r",
													"          pm.environment.set(\"CREDIT_RATIO_PCT\", String(cr));       // as percent\r",
													"        } else {\r",
													"          pm.expect(cr, \"creditRatio in [0, 1]\").to.be.at.least(0).and.at.most(1);\r",
													"          pm.environment.set(\"CREDIT_RATIO\", String(cr));           // normalized 0..1\r",
													"          pm.environment.set(\"CREDIT_RATIO_PCT\", String(cr * 100)); // as percent\r",
													"        }\r",
													"      }\r",
													"\r",
													"      if (!isNullish(f.isActiveFundClient)) {\r",
													"        pm.expect(isYN(String(f.isActiveFundClient))).to.be.true;\r",
													"      }\r",
													"    }\r",
													"  }\r",
													"});\r",
													"\r",
													"// resType should reflect request's AccRegisterType (when provided)\r",
													"pm.test(\"resType matches AccRegisterType from request (when provided)\", function () {\r",
													"  var reqBody;\r",
													"  try { reqBody = pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {}; } catch(e){}\r",
													"  var accType = (((reqBody || {}).Message || {}).BalDlsRequest || {}).AccRegisterType;\r",
													"  if (accType) {\r",
													"    pm.expect(bnr.resType, \"resType\").to.eql(String(accType));\r",
													"  }\r",
													"});\r",
													"\r",
													"// Guardrails: request Srv should be BNKBAL\r",
													"pm.test(\"Request Srv is BNKBAL\", function () {\r",
													"  var reqBody;\r",
													"  try { reqBody = pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {}; } catch(e){}\r",
													"  pm.expect((reqBody || {}).Srv).to.eql(\"BNKBAL\");\r",
													"});\r",
													"\r",
													"// Minimal schema (tv4)\r",
													"pm.test(\"Schema (minimal) validates\", function () {\r",
													"  var schema = {\r",
													"    type: \"object\",\r",
													"    required: [\"responseStatus\",\"message\"],\r",
													"    properties: {\r",
													"      responseStatus: {\r",
													"        type: \"object\",\r",
													"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
													"        properties: {\r",
													"          resCode:  { \"const\": \"0\" },\r",
													"          resDesc:  { \"const\": \"Successful Operation\" },\r",
													"          source:   { \"const\": \"BNKBAL\" },\r",
													"          resCode1: { \"const\": \"0\" },\r",
													"          resDesc1: { \"const\": \"Successful Operation\" }\r",
													"        }\r",
													"      },\r",
													"      message: {\r",
													"        type: \"object\",\r",
													"        required: [\"bnkInfoResponse\"],\r",
													"        properties: {\r",
													"          bnkInfoResponse: { type: \"object\" }\r",
													"        }\r",
													"      }\r",
													"    }\r",
													"  };\r",
													"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
													"});\r",
													"\r",
													"// Extra: store a few more env helpers (without touching your extract keys)\r",
													"(function storeExtras(){\r",
													"  var arr = (((bnr || {}).banksInfo || {}).bnkInfoRec) || [];\r",
													"  if (arr.length > 0) {\r",
													"    pm.environment.set(\"firstBankCode\", String(arr[0].bankCode || \"\"));\r",
													"    pm.environment.set(\"firstBankSwift\", String(arr[0].bnkCode || \"\"));\r",
													"    pm.environment.set(\"firstAccountStatus\", String(arr[0].accountStatus || \"\"));\r",
													"  }\r",
													"  pm.environment.set(\"bnkTransfersCount\", String(((((bnr || {}).bnkTransfers || {}).bnkTransferRec) || []).length));\r",
													"})();\r",
													"\r",
													"console.log(\"✅ BNKBAL validated.\",\r",
													"            \"bankCount:\", pm.environment.get(\"bankCount\"),\r",
													"            \"transfers:\", pm.environment.get(\"bnkTransfersCount\"),\r",
													"            \"creditRatio(norm):\", pm.environment.get(\"CREDIT_RATIO\"),\r",
													"            \"creditRatio(%) \", pm.environment.get(\"CREDIT_RATIO_PCT\"));\r",
													""
												],
												"type": "text/javascript",
												"packages": {},
												"requests": {}
											}
										}
									],
									"request": {
										"auth": {
											"type": "noauth"
										},
										"method": "POST",
										"header": [
											{
												"key": "Accept",
												"value": "application/json",
												"type": "text"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\r\n    \"Srv\": \"BNKBAL\",\r\n    \"Message\": {\r\n        \"BalDlsRequest\": {\r\n            \"NIN\": \"{{NIN}}\",\r\n            \"UserId\": \"{{UserID}}\",\r\n            \"UserType\": \"INVESTOR\",\r\n            \"AccRegisterType\": \"ALL\",\r\n            \"Lang\": \"ARB\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"30-04-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}\r\n\r\n\r\n",
											"options": {
												"raw": {
													"language": "json"
												}
											}
										},
										"url": {
											"raw": "{{BaseURL}}{{Oracle19}}",
											"host": [
												"{{BaseURL}}{{Oracle19}}"
											]
										}
									},
									"response": []
								},
								{
									"name": "2. Confirm withdraw Transfer",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"/**\r",
													" * BNKCHKTRANSFERNEW – Confirm Transfer (Popup) validation (ES5)\r",
													" * Validates:\r",
													" *  - Envelope: resCode/resCode1=0, source=\"BNKCHKTRANSFERNEW\"\r",
													" *  - Fields: trnxFees, trnxIsPossible, maximumAmount, hintMessage, urgentFees\r",
													" *  - Numeric strings >= 0 (supports scientific notation); trnxIsPossible is Y/N\r",
													" *  - Optional business rules via env toggles (see header comment)\r",
													" * Saves to env:\r",
													" *  TRX_IS_POSSIBLE, TRX_MAX_AMOUNT, TRX_MAX_AMOUNT_NUM, TRX_FEES, TRX_FEES_NUM,\r",
													" *  TRX_URGENT_FEES, TRX_URGENT_FEES_NUM, TRX_HINT\r",
													" */\r",
													"\r",
													"pm.test(\"HTTP 200\", function () {\r",
													"  pm.response.to.have.status(200);\r",
													"});\r",
													"\r",
													"pm.test(\"Content-Type is JSON\", function () {\r",
													"  pm.response.to.have.header(\"Content-Type\");\r",
													"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
													"});\r",
													"\r",
													"// Parse\r",
													"var json;\r",
													"pm.test(\"Body is valid JSON\", function () {\r",
													"  json = pm.response.json();\r",
													"  pm.expect(json).to.be.an(\"object\");\r",
													"});\r",
													"\r",
													"// Envelope\r",
													"pm.test(\"responseStatus OK (BNKCHKTRANSFERNEW)\", function () {\r",
													"  var rs = json.responseStatus || {};\r",
													"  pm.expect(rs.resCode).to.eql(\"0\");\r",
													"  pm.expect(rs.resDesc).to.eql(\"Successful Operation\");\r",
													"  pm.expect(rs.source).to.eql(\"BNKCHKTRANSFERNEW\");\r",
													"  pm.expect(rs.resCode1).to.eql(\"0\");\r",
													"  pm.expect(rs.resDesc1).to.eql(\"Successful Operation\");\r",
													"});\r",
													"\r",
													"// Node\r",
													"var node = (((json || {}).message || {}).isBankTransferResponse) || {};\r",
													"pm.test(\"isBankTransferResponse exists\", function () {\r",
													"  pm.expect(node).to.be.an(\"object\");\r",
													"  pm.expect(node).to.have.property(\"trnxFees\");\r",
													"  pm.expect(node).to.have.property(\"trnxIsPossible\");\r",
													"  pm.expect(node).to.have.property(\"maximumAmount\");\r",
													"  pm.expect(node).to.have.property(\"hintMessage\");\r",
													"  pm.expect(node).to.have.property(\"urgentFees\");\r",
													"});\r",
													"\r",
													"// Helpers (ES5)\r",
													"// Accepts: integers, decimals, and scientific notation (e.g., 1.23E8, -4e-3)\r",
													"function isNumericStr(v) {\r",
													"  if (typeof v === \"number\") return isFinite(v);\r",
													"  var s = String(v || \"\").trim();\r",
													"  return /^-?(?:\\d+\\.?\\d*|\\d*\\.\\d+)(?:[eE][+\\-]?\\d+)?$/.test(s);\r",
													"}\r",
													"function toNumberSafe(v) { return Number(String(v || \"\").trim()); }\r",
													"function isYN(v) { return v === \"Y\" || v === \"N\"; }\r",
													"function getFlag(name, defVal) {\r",
													"  var v = pm.environment.get(name) || pm.globals.get(name);\r",
													"  v = (v == null ? \"\" : String(v)).toUpperCase();\r",
													"  if (v !== \"Y\" && v !== \"N\") return defVal;\r",
													"  return v;\r",
													"}\r",
													"\r",
													"// Field validations\r",
													"pm.test(\"trnxFees & urgentFees are numeric strings >= 0\", function () {\r",
													"  pm.expect(isNumericStr(node.trnxFees), \"trnxFees must be numeric string\").to.be.true;\r",
													"  pm.expect(isNumericStr(node.urgentFees), \"urgentFees must be numeric string\").to.be.true;\r",
													"  pm.expect(toNumberSafe(node.trnxFees), \"trnxFees >= 0\").to.be.at.least(0);\r",
													"  pm.expect(toNumberSafe(node.urgentFees), \"urgentFees >= 0\").to.be.at.least(0);\r",
													"});\r",
													"\r",
													"pm.test(\"trnxIsPossible is Y/N\", function () {\r",
													"  pm.expect(isYN(node.trnxIsPossible), \"trnxIsPossible must be 'Y' or 'N'\").to.be.true;\r",
													"});\r",
													"\r",
													"pm.test(\"maximumAmount is numeric string >= 0\", function () {\r",
													"  pm.expect(isNumericStr(node.maximumAmount), \"maximumAmount must be numeric string\").to.be.true;\r",
													"  pm.expect(toNumberSafe(node.maximumAmount), \"maximumAmount >= 0\").to.be.at.least(0);\r",
													"});\r",
													"\r",
													"pm.test(\"hintMessage is a string (may be empty on success)\", function () {\r",
													"  pm.expect(typeof node.hintMessage).to.eql(\"string\");\r",
													"});\r",
													"\r",
													"// Business rules (configurable)\r",
													"pm.test(\"Business rules for trnxIsPossible\", function () {\r",
													"  var requireMaxWhenY = getFlag(\"REQUIRE_MAX_GT_ZERO_WHEN_Y\", \"Y\") === \"Y\";\r",
													"  var requireHintOnFail = getFlag(\"REQUIRE_HINT_ON_FAIL\", \"Y\") === \"Y\";\r",
													"  var allowNonZeroWhenN = getFlag(\"ALLOW_NONZERO_MAX_WHEN_N\", \"N\") === \"N\" ? false : true;\r",
													"\r",
													"  var isPossible = node.trnxIsPossible === \"Y\";\r",
													"  var maxNum = toNumberSafe(node.maximumAmount);\r",
													"  var hint = String(node.hintMessage || \"\");\r",
													"\r",
													"  if (isPossible) {\r",
													"    if (requireMaxWhenY) {\r",
													"      pm.expect(maxNum, \"When possible=Y, maximumAmount must be > 0\").to.be.above(0);\r",
													"    }\r",
													"    if (hint && hint.replace(/\\s+/g,\"\").length > 0) {\r",
													"      console.warn(\"Hint provided even though trnxIsPossible=Y:\", hint);\r",
													"    }\r",
													"  } else {\r",
													"    if (requireHintOnFail) {\r",
													"      pm.expect(hint.replace(/\\s+/g,\"\").length, \"When possible=N, hintMessage should be non-empty\").to.be.greaterThan(0);\r",
													"    }\r",
													"    if (!allowNonZeroWhenN) {\r",
													"      pm.expect(maxNum, \"When possible=N, maximumAmount should be 0\").to.eql(0);\r",
													"    }\r",
													"  }\r",
													"});\r",
													"\r",
													"// Save to environment\r",
													"(function saveEnv(){\r",
													"  pm.environment.set(\"TRX_IS_POSSIBLE\", String(node.trnxIsPossible || \"\"));\r",
													"  pm.environment.set(\"TRX_MAX_AMOUNT\", String(node.maximumAmount || \"\"));\r",
													"  pm.environment.set(\"TRX_MAX_AMOUNT_NUM\", String(toNumberSafe(node.maximumAmount)));\r",
													"  pm.environment.set(\"TRX_FEES\", String(node.trnxFees || \"\"));\r",
													"  pm.environment.set(\"TRX_FEES_NUM\", String(toNumberSafe(node.trnxFees)));\r",
													"  pm.environment.set(\"TRX_URGENT_FEES\", String(node.urgentFees || \"\"));\r",
													"  pm.environment.set(\"TRX_URGENT_FEES_NUM\", String(toNumberSafe(node.urgentFees)));\r",
													"  pm.environment.set(\"TRX_HINT\", String(node.hintMessage || \"\"));\r",
													"})();\r",
													"\r",
													"// Minimal schema (tv4)\r",
													"pm.test(\"Schema (minimal) validates\", function () {\r",
													"  var schema = {\r",
													"    type: \"object\",\r",
													"    required: [\"responseStatus\",\"message\"],\r",
													"    properties: {\r",
													"      responseStatus: {\r",
													"        type: \"object\",\r",
													"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
													"        properties: {\r",
													"          resCode:  { \"const\": \"0\" },\r",
													"          resDesc:  { \"const\": \"Successful Operation\" },\r",
													"          source:   { \"const\": \"BNKCHKTRANSFERNEW\" },\r",
													"          resCode1: { \"const\": \"0\" },\r",
													"          resDesc1: { \"const\": \"Successful Operation\" }\r",
													"        }\r",
													"      },\r",
													"      message: {\r",
													"        type: \"object\",\r",
													"        required: [\"isBankTransferResponse\"],\r",
													"        properties: {\r",
													"          isBankTransferResponse: {\r",
													"            type: \"object\",\r",
													"            required: [\"trnxFees\",\"trnxIsPossible\",\"maximumAmount\",\"hintMessage\",\"urgentFees\"],\r",
													"            properties: {\r",
													"              trnxFees:       { type: \"string\" },\r",
													"              trnxIsPossible: { type: \"string\" },\r",
													"              maximumAmount:  { type: \"string\" },\r",
													"              hintMessage:    { type: \"string\" },\r",
													"              urgentFees:     { type: \"string\" }\r",
													"            }\r",
													"          }\r",
													"        }\r",
													"      }\r",
													"    }\r",
													"  };\r",
													"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
													"});\r",
													"\r",
													"// Visualizer (compact)\r",
													"(function render(){\r",
													"  var template =\r",
													"    '<style>.t{font-family:system-ui,Segoe UI,Roboto,Arial;font-size:14px;color:#333;width:100%;border-collapse:collapse}' +\r",
													"    '.t th,.t td{border:1px solid #87ceeb;padding:6px;text-align:left}.t th{background:#87ceeb}' +\r",
													"    '.good{color:#0a8f08}.bad{color:#b00020}</style>' +\r",
													"    '<h3>Confirm Transfer</h3>' +\r",
													"    '<table class=\"t\"><tbody>' +\r",
													"    '<tr><th>trnxIsPossible</th><td class=\"{{possibleCls}}\">{{trnxIsPossible}}</td></tr>' +\r",
													"    '<tr><th>maximumAmount</th><td>{{maximumAmount}}</td></tr>' +\r",
													"    '<tr><th>trnxFees</th><td>{{trnxFees}}</td></tr>' +\r",
													"    '<tr><th>urgentFees</th><td>{{urgentFees}}</td></tr>' +\r",
													"    '<tr><th>hintMessage</th><td>{{hintMessage}}</td></tr>' +\r",
													"    '</tbody></table>';\r",
													"\r",
													"  var possibleCls = (node.trnxIsPossible === \"Y\") ? \"good\" : \"bad\";\r",
													"  pm.visualizer.set(template, {\r",
													"    trnxIsPossible: String(node.trnxIsPossible || \"\"),\r",
													"    maximumAmount: String(node.maximumAmount || \"\"),\r",
													"    trnxFees: String(node.trnxFees || \"\"),\r",
													"    urgentFees: String(node.urgentFees || \"\"),\r",
													"    hintMessage: String(node.hintMessage || \"\"),\r",
													"    possibleCls: possibleCls\r",
													"  });\r",
													"})();\r",
													"\r",
													"console.log(\r",
													"  \"✅ BNKCHKTRANSFERNEW validated.\",\r",
													"  \"possible=\", node.trnxIsPossible,\r",
													"  \"max(raw)=\", node.maximumAmount,\r",
													"  \"max(num)=\", Number(String(node.maximumAmount || \"\").trim())\r",
													");\r",
													""
												],
												"type": "text/javascript",
												"packages": {},
												"requests": {}
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Accept",
												"value": "application/json",
												"type": "text"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\r\n    \"Srv\": \"BNKCHKTRANSFERNEW\",\r\n    \"Message\": {\r\n        \"IsBankTransferRequest\": {\r\n            \"swiftCode\": \"{{bnkCode_1}}\",\r\n            \"accountNO\": \"{{accountSeq_1}}\",\r\n            \"amount\": \"484\",\r\n            \"nin\": \"{{NIN}}\",\r\n            \"userId\": \"{{UserID}}\",\r\n            \"userType\": \"INVESTOR\",\r\n            \"lang\": \"ARB\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"30-04-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}",
											"options": {
												"raw": {
													"language": "json"
												}
											}
										},
										"url": {
											"raw": "{{BaseURL}}{{Oracle19}}",
											"host": [
												"{{BaseURL}}{{Oracle19}}"
											]
										}
									},
									"response": []
								},
								{
									"name": "3. Fire - Withdraw from The Group",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"/**\r",
													" * BNKTRANSFERNEW – Bank transfer from (ES5)\r",
													" * Validates:\r",
													" *  - Envelope: resCode/resCode1=0, source=\"BNKTRANSFERNEW\"\r",
													" *  - Node: getBankTransferResponse with required keys (all strings)\r",
													" *  - showHint in {Y,N} and conditional rules\r",
													" *  - OTP config: otpLength=\"4\", otpExpiryPeriod=\"300\", otpResendPeriod=\"60\"\r",
													" * Saves env:\r",
													" *  BANK_TRANSFER_CODE, BANK_SHOW_HINT, BANK_HINT_MESSAGE,\r",
													" *  BANK_CONFIRM_MSG, BANK_TRN_GUID, BANK_OTP_TOKEN,\r",
													" *  resTrnGUID (direct alias)\r",
													" */\r",
													"\r",
													"pm.test(\"HTTP 200\", function () {\r",
													"  pm.response.to.have.status(200);\r",
													"});\r",
													"\r",
													"pm.test(\"Content-Type is JSON\", function () {\r",
													"  pm.response.to.have.header(\"Content-Type\");\r",
													"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
													"});\r",
													"\r",
													"// Parse\r",
													"var json;\r",
													"pm.test(\"Body is valid JSON\", function () {\r",
													"  json = pm.response.json();\r",
													"  pm.expect(json).to.be.an(\"object\");\r",
													"});\r",
													"\r",
													"// Envelope\r",
													"pm.test(\"responseStatus OK (BNKTRANSFERNEW)\", function () {\r",
													"  var rs = json.responseStatus || {};\r",
													"  pm.expect(rs.resCode).to.eql(\"0\");\r",
													"  pm.expect(rs.resDesc).to.eql(\"Successful Operation\");\r",
													"  pm.expect(rs.source).to.eql(\"BNKTRANSFERNEW\");\r",
													"  pm.expect(rs.resCode1).to.eql(\"0\");\r",
													"  pm.expect(rs.resDesc1).to.eql(\"Successful Operation\");\r",
													"});\r",
													"\r",
													"// Node\r",
													"var node = (((json || {}).message || {}).getBankTransferResponse) || {};\r",
													"pm.test(\"getBankTransferResponse exists & has required keys\", function () {\r",
													"  pm.expect(node).to.be.an(\"object\");\r",
													"  var keys = [\r",
													"    \"transferCode\",\"showHint\",\"hintMessage\",\"resConfirmMessage\",\"resTrnGUID\",\"otpToken\",\r",
													"    \"otpLength\",\"otpExpiryPeriod\",\"otpResendPeriod\"\r",
													"  ];\r",
													"  for (var i=0;i<keys.length;i++){\r",
													"    pm.expect(node, \"Missing key: \" + keys[i]).to.have.property(keys[i]);\r",
													"    pm.expect(typeof node[keys[i]], keys[i] + \" must be string\").to.eql(\"string\");\r",
													"  }\r",
													"});\r",
													"\r",
													"// Helpers\r",
													"function isYN(v){ return v === \"Y\" || v === \"N\"; }\r",
													"function getFlag(name, defVal){\r",
													"  var v = pm.environment.get(name) || pm.globals.get(name);\r",
													"  v = (v == null ? \"\" : String(v)).toUpperCase();\r",
													"  if (v !== \"Y\" && v !== \"N\") return defVal;\r",
													"  return v;\r",
													"}\r",
													"\r",
													"// showHint logic\r",
													"pm.test(\"showHint is Y/N\", function () {\r",
													"  pm.expect(isYN(node.showHint), \"showHint must be 'Y' or 'N'\").to.be.true;\r",
													"});\r",
													"\r",
													"// Confirm message (Arabic success text)\r",
													"pm.test(\"resConfirmMessage (required by policy or optional)\", function () {\r",
													"  var requireMsg = getFlag(\"REQUIRE_CONFIRM_MESSAGE\", \"Y\") === \"Y\";\r",
													"  var msg = String(node.resConfirmMessage || \"\");\r",
													"  if (requireMsg) {\r",
													"    pm.expect(msg.replace(/\\s+/g,\"\").length, \"resConfirmMessage should be non-empty\").to.be.greaterThan(0);\r",
													"    var ok =\r",
													"      /تم\\s*قبول\\s*طلب\\s*التحويل/.test(msg) ||\r",
													"      /تم\\s*قبول/.test(msg);\r",
													"    pm.expect(ok, \"resConfirmMessage should indicate success in Arabic\").to.be.true;\r",
													"  }\r",
													"});\r",
													"\r",
													"// OTP configuration checks (exact values)\r",
													"pm.test(\"OTP config: otpLength='4', otpExpiryPeriod='300', otpResendPeriod='60'\", function () {\r",
													"  pm.expect(String(node.otpLength)).to.eql(\"4\");\r",
													"  pm.expect(String(node.otpExpiryPeriod)).to.eql(\"300\");\r",
													"  pm.expect(String(node.otpResendPeriod)).to.eql(\"60\");\r",
													"});\r",
													"\r",
													"// Conditional rules for hint / otp\r",
													"pm.test(\"Hint & OTP conditional rules\", function () {\r",
													"  var requireHintOnY   = getFlag(\"REQUIRE_HINT_ON_Y\", \"N\") === \"Y\";\r",
													"  var requireOtpOnHint = getFlag(\"REQUIRE_OTP_WHEN_HINT\", \"N\") === \"Y\";\r",
													"  var requireEmptyOtpWhenNoHint = getFlag(\"REQUIRE_EMPTY_OTP_WHEN_NOHINT\", \"N\") === \"Y\";\r",
													"\r",
													"  var showHintY = node.showHint === \"Y\";\r",
													"  var hint = String(node.hintMessage || \"\");\r",
													"  var otp  = String(node.otpToken || \"\");\r",
													"\r",
													"  if (showHintY) {\r",
													"    if (requireHintOnY) {\r",
													"      pm.expect(hint.replace(/\\s+/g,\"\").length, \"showHint=Y -> hintMessage must be non-empty\").to.be.greaterThan(0);\r",
													"    }\r",
													"    if (requireOtpOnHint) {\r",
													"      pm.expect(otp.replace(/\\s+/g,\"\").length, \"showHint=Y -> otpToken must be non-empty\").to.be.greaterThan(0);\r",
													"    }\r",
													"  } else {\r",
													"    if (requireEmptyOtpWhenNoHint) {\r",
													"      pm.expect(otp.replace(/\\s+/g,\"\").length, \"showHint=N -> otpToken should be empty\").to.eql(0);\r",
													"    }\r",
													"  }\r",
													"});\r",
													"\r",
													"// Optional: require GUID when success (config)\r",
													"pm.test(\"Transaction GUID requirement (optional)\", function () {\r",
													"  var requireGuid = getFlag(\"REQUIRE_GUID_ON_SUCCESS\", \"N\") === \"Y\";\r",
													"  if (requireGuid) {\r",
													"    pm.expect(String(node.resTrnGUID || \"\").replace(/\\s+/g,\"\").length, \"resTrnGUID required\").to.be.greaterThan(0);\r",
													"  }\r",
													"});\r",
													"\r",
													"// Save to environment\r",
													"(function saveEnv(){\r",
													"  pm.environment.set(\"BANK_TRANSFER_CODE\", String(node.transferCode || \"\"));\r",
													"  pm.environment.set(\"BANK_SHOW_HINT\", String(node.showHint || \"\"));\r",
													"  pm.environment.set(\"BANK_HINT_MESSAGE\", String(node.hintMessage || \"\"));\r",
													"  pm.environment.set(\"BANK_CONFIRM_MSG\", String(node.resConfirmMessage || \"\"));\r",
													"  pm.environment.set(\"BANK_TRN_GUID\", String(node.resTrnGUID || \"\"));\r",
													"  pm.environment.set(\"BANK_OTP_TOKEN\", String(node.otpToken || \"\"));\r",
													"  // direct alias as requested\r",
													"  pm.environment.set(\"resTrnGUID\", String(node.resTrnGUID || \"\"));\r",
													"})();\r",
													"\r",
													"// Minimal schema (tv4)\r",
													"pm.test(\"Schema (minimal) validates\", function () {\r",
													"  var schema = {\r",
													"    type: \"object\",\r",
													"    required: [\"responseStatus\",\"message\"],\r",
													"    properties: {\r",
													"      responseStatus: {\r",
													"        type: \"object\",\r",
													"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
													"        properties: {\r",
													"          resCode:  { \"const\": \"0\" },\r",
													"          resDesc:  { \"const\": \"Successful Operation\" },\r",
													"          source:   { \"const\": \"BNKTRANSFERNEW\" },\r",
													"          resCode1: { \"const\": \"0\" },\r",
													"          resDesc1: { \"const\": \"Successful Operation\" }\r",
													"        }\r",
													"      },\r",
													"      message: {\r",
													"        type: \"object\",\r",
													"        required: [\"getBankTransferResponse\"],\r",
													"        properties: {\r",
													"          getBankTransferResponse: {\r",
													"            type: \"object\",\r",
													"            required: [\r",
													"              \"transferCode\",\"showHint\",\"hintMessage\",\"resConfirmMessage\",\"resTrnGUID\",\"otpToken\",\r",
													"              \"otpLength\",\"otpExpiryPeriod\",\"otpResendPeriod\"\r",
													"            ],\r",
													"            properties: {\r",
													"              transferCode:      { type: \"string\" },\r",
													"              showHint:          { type: \"string\" },\r",
													"              hintMessage:       { type: \"string\" },\r",
													"              resConfirmMessage: { type: \"string\" },\r",
													"              resTrnGUID:        { type: \"string\" },\r",
													"              otpToken:          { type: \"string\" },\r",
													"              otpLength:         { type: \"string\", \"const\": \"4\" },\r",
													"              otpExpiryPeriod:   { type: \"string\", \"const\": \"300\" },\r",
													"              otpResendPeriod:   { type: \"string\", \"const\": \"60\" }\r",
													"            }\r",
													"          }\r",
													"        }\r",
													"      }\r",
													"    }\r",
													"  };\r",
													"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
													"});\r",
													"\r",
													"// Visualizer (compact)\r",
													"(function render(){\r",
													"  var template =\r",
													"    '<style>.t{font-family:system-ui,Segoe UI,Roboto,Arial;font-size:14px;color:#333;width:100%;border-collapse:collapse}' +\r",
													"    '.t th,.t td{border:1px solid #87ceeb;padding:6px;text-align:left}.t th{background:#87ceeb}' +\r",
													"    '.flagY{color:#0a8f08}.flagN{color:#b00020}</style>' +\r",
													"    '<h3>Bank Transfer – Result</h3>' +\r",
													"    '<table class=\"t\"><tbody>' +\r",
													"    '<tr><th>resConfirmMessage</th><td>{{resConfirmMessage}}</td></tr>' +\r",
													"    '<tr><th>showHint</th><td class=\"{{showHintCls}}\">{{showHint}}</td></tr>' +\r",
													"    '<tr><th>hintMessage</th><td>{{hintMessage}}</td></tr>' +\r",
													"    '<tr><th>transferCode</th><td>{{transferCode}}</td></tr>' +\r",
													"    '<tr><th>resTrnGUID</th><td>{{resTrnGUID}}</td></tr>' +\r",
													"    '<tr><th>otpToken</th><td>{{otpToken}}</td></tr>' +\r",
													"    '<tr><th>otpLength</th><td>{{otpLength}}</td></tr>' +\r",
													"    '<tr><th>otpExpiryPeriod</th><td>{{otpExpiryPeriod}}</td></tr>' +\r",
													"    '<tr><th>otpResendPeriod</th><td>{{otpResendPeriod}}</td></tr>' +\r",
													"    '</tbody></table>';\r",
													"\r",
													"  pm.visualizer.set(template, {\r",
													"    resConfirmMessage: String(node.resConfirmMessage || \"\"),\r",
													"    showHint: String(node.showHint || \"\"),\r",
													"    hintMessage: String(node.hintMessage || \"\"),\r",
													"    transferCode: String(node.transferCode || \"\"),\r",
													"    resTrnGUID: String(node.resTrnGUID || \"\"),\r",
													"    otpToken: String(node.otpToken || \"\"),\r",
													"    otpLength: String(node.otpLength || \"\"),\r",
													"    otpExpiryPeriod: String(node.otpExpiryPeriod || \"\"),\r",
													"    otpResendPeriod: String(node.otpResendPeriod || \"\"),\r",
													"    showHintCls: (node.showHint === \"Y\") ? \"flagY\" : \"flagN\"\r",
													"  });\r",
													"})();\r",
													"\r",
													"console.log(\"✅ BNKTRANSFERNEW validated.\", \"showHint=\", node.showHint, \"resTrnGUID=\", node.resTrnGUID);\r",
													""
												],
												"type": "text/javascript",
												"packages": {},
												"requests": {}
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Accept",
												"value": "application/json",
												"type": "text"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\r\n    \"Srv\": \"BNKTRANSFERNEW\",\r\n    \"Message\": {\r\n        \"BankTransferRequest\": {\r\n            \"nin\": \"{{NIN}}\",\r\n            \"userId\": \"{{UserID}}\",\r\n            \"userType\": \"INVESTOR\",\r\n            \"accountNO\": \"{{accountCode_1}}\",\r\n            \"amount\": 484,\r\n            \"swiftCode\": \"{{bnkCode_1}}\",\r\n            \"transferType\": \"TO\",\r\n            \"accountStatus\": \"4\",\r\n            \"transferTimeId\": \"{{transferTimeId_1}}\",\r\n            \"lang\": \"ARB\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"30-04-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}",
											"options": {
												"raw": {
													"language": "json"
												}
											}
										},
										"url": {
											"raw": "{{BaseURL}}{{Oracle19}}",
											"host": [
												"{{BaseURL}}{{Oracle19}}"
											]
										}
									},
									"response": []
								},
								{
									"name": "4. TRN_CONFIRMCANOTP",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"/**\r",
													" * TRN_CONFIRMCANOTP – Confirm OTP for transfer to group account (Unified)\r",
													" *\r",
													" * Scenarios handled:\r",
													" *  A) Success (Approved):   resCode=\"0\"      -> transferInfoResponse.requestStatus=\"APRV\"\r",
													" *  B) Already confirmed:    resCode=\"190\"    -> تم تأكيد طلب التحويل من قبل\r",
													" *  C) No request:           resCode=\"16100\"  -> لا يوجد طلب لتسجيل الحساب البنكي لهذا العميل\r",
													" *  D) Success (Cancelled):  resCode=\"0\"      -> transferInfoResponse.requestStatus=\"CAN\"\r",
													" *  E) Invalid transfer data:resCode=\"16113\"  -> خطأ في بيانات التحويل\r",
													" *  F) Invalid OTP:          resCode=\"110070\" -> كلمة المرور لمرة واحدة غير صالحة\r",
													" *\r",
													" * Saves (depending on scenario):\r",
													" *  TRN_CONFIRM_SCENARIO ∈ { SUCCESS_APRV, SUCCESS_CAN, ALREADY_CONFIRMED, NO_REQUEST, INVALID_TRANSFER_DATA, INVALID_OTP }\r",
													" *  TRN_CONFIRM_DESC     = responseStatus.resDesc (or resDesc1)\r",
													" *  TRN_NIN, TRN_GUID, TRN_REQ_STATUS, TRN_REQ_STATUS_LABEL (on success)\r",
													" */\r",
													"\r",
													"pm.test(\"HTTP 200\", function () { pm.response.to.have.status(200); });\r",
													"\r",
													"pm.test(\"Content-Type is JSON\", function () {\r",
													"  pm.response.to.have.header(\"Content-Type\");\r",
													"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
													"});\r",
													"\r",
													"// Parse\r",
													"var json;\r",
													"pm.test(\"Body is JSON\", function () {\r",
													"  json = pm.response.json();\r",
													"  pm.expect(json).to.be.an(\"object\");\r",
													"});\r",
													"\r",
													"// Helpers\r",
													"function trim(s){ return String(s == null ? \"\" : s).replace(/^\\s+|\\s+$/g,\"\"); }\r",
													"function getFlag(name, defVal){\r",
													"  var v = pm.environment.get(name) || pm.globals.get(name);\r",
													"  v = (v == null ? \"\" : String(v)).toUpperCase();\r",
													"  if (v !== \"Y\" && v !== \"N\") return defVal;\r",
													"  return v;\r",
													"}\r",
													"function isGuidLike(s){ return /^[A-Za-z0-9_-]{10,40}$/.test(String(s || \"\")); } // backend GUID style\r",
													"\r",
													"// Arabic normalization: remove diacritics/standalone hamza, unify alef forms, collapse spaces\r",
													"function normalizeAr(s){\r",
													"  s = String(s || \"\");\r",
													"  // remove tashkeel & symbols\r",
													"  s = s.replace(/[\\u064B-\\u0652\\u0670\\u0653-\\u0655]/g, \"\");\r",
													"  // unify alef variants and remove standalone hamza\r",
													"  s = s.replace(/[أإآ]/g, \"ا\").replace(/ء/g, \"\");\r",
													"  // collapse spaces\r",
													"  s = s.replace(/\\s+/g, \" \").trim();\r",
													"  return s;\r",
													"}\r",
													"\r",
													"// Envelope\r",
													"var rs = json.responseStatus || {};\r",
													"pm.test(\"Source is TRN_CONFIRMCANOTP\", function(){\r",
													"  pm.expect(rs.source).to.eql(\"TRN_CONFIRMCANOTP\");\r",
													"});\r",
													"\r",
													"// Accept all known res codes\r",
													"pm.test(\"resCode is one of expected\", function(){\r",
													"  var allowed = [\"0\",\"190\",\"16100\",\"16113\",\"110070\"];\r",
													"  pm.expect(allowed).to.include(String(rs.resCode));\r",
													"  pm.expect(allowed).to.include(String(rs.resCode1));\r",
													"});\r",
													"\r",
													"// Branch scenario\r",
													"var scenario =\r",
													"  (rs.resCode === \"0\") ? \"SUCCESS\" :\r",
													"  (rs.resCode === \"190\") ? \"ALREADY_CONFIRMED\" :\r",
													"  (rs.resCode === \"16100\") ? \"NO_REQUEST\" :\r",
													"  (rs.resCode === \"16113\") ? \"INVALID_TRANSFER_DATA\" :\r",
													"  (rs.resCode === \"110070\") ? \"INVALID_OTP\" :\r",
													"  \"UNKNOWN\";\r",
													"\r",
													"// ---------- Scenario A/D: Success (APRV or CAN) ----------\r",
													"pm.test(\"Scenario A/D – Success payload (APRV or CAN)\", function(){\r",
													"  if (scenario !== \"SUCCESS\") { this.skip && this.skip(); return; }\r",
													"\r",
													"  var node = (((json || {}).message || {}).transferInfoResponse) || {};\r",
													"  pm.expect(node, \"transferInfoResponse exists\").to.be.an(\"object\");\r",
													"\r",
													"  [\"nin\",\"guid\",\"requestStatus\"].forEach(function(k){\r",
													"    pm.expect(node, \"Missing key: \" + k).to.have.property(k);\r",
													"    pm.expect(String(node[k]).length, k + \" non-empty\").to.be.greaterThan(0);\r",
													"  });\r",
													"\r",
													"  var status = String(node.requestStatus || \"\").toUpperCase();\r",
													"  pm.expect([\"APRV\",\"CAN\"]).to.include(status);\r",
													"  pm.expect(isGuidLike(node.guid), \"guid token format\").to.be.true;\r",
													"\r",
													"  var assertNin = getFlag(\"ASSERT_NIN\",\"N\") === \"Y\";\r",
													"  var envNin = pm.environment.get(\"NIN\") || pm.globals.get(\"NIN\") || \"\";\r",
													"  if (assertNin && envNin) {\r",
													"    pm.expect(String(node.nin), \"nin matches ENV NIN\").to.eql(String(envNin));\r",
													"  }\r",
													"\r",
													"  var label = (status === \"APRV\") ? \"APPROVED\" : \"CANCELLED\";\r",
													"  var scenarioTag = (status === \"APRV\") ? \"SUCCESS_APRV\" : \"SUCCESS_CAN\";\r",
													"\r",
													"  pm.environment.set(\"TRN_CONFIRM_SCENARIO\", scenarioTag);\r",
													"  pm.environment.set(\"TRN_CONFIRM_DESC\", trim(rs.resDesc || rs.resDesc1 || \"\"));\r",
													"  pm.environment.set(\"TRN_NIN\", String(node.nin || \"\"));\r",
													"  pm.environment.set(\"TRN_GUID\", String(node.guid || \"\"));\r",
													"  pm.environment.set(\"TRN_REQ_STATUS\", status);\r",
													"  pm.environment.set(\"TRN_REQ_STATUS_LABEL\", label);\r",
													"});\r",
													"\r",
													"// ---------- Scenario B: Already confirmed ----------\r",
													"pm.test(\"Scenario B – Already confirmed (if applicable)\", function(){\r",
													"  if (scenario !== \"ALREADY_CONFIRMED\") { this.skip && this.skip(); return; }\r",
													"  var d0 = trim(rs.resDesc), d1 = trim(rs.resDesc1);\r",
													"  var ok = /تم\\s*تأكيد\\s*طلب\\s*التحويل\\s*من\\s*قبل/.test(d0) &&\r",
													"           /تم\\s*تأكيد\\s*طلب\\s*التحويل\\s*من\\s*قبل/.test(d1);\r",
													"  pm.expect(ok, \"Arabic message: 'already confirmed'\").to.be.true;\r",
													"\r",
													"  pm.environment.set(\"TRN_CONFIRM_SCENARIO\",\"ALREADY_CONFIRMED\");\r",
													"  pm.environment.set(\"TRN_CONFIRM_DESC\", d0 || d1);\r",
													"  pm.environment.unset(\"TRN_NIN\");\r",
													"  pm.environment.unset(\"TRN_GUID\");\r",
													"  pm.environment.unset(\"TRN_REQ_STATUS\");\r",
													"  pm.environment.unset(\"TRN_REQ_STATUS_LABEL\");\r",
													"});\r",
													"\r",
													"// ---------- Scenario C: No request ----------\r",
													"pm.test(\"Scenario C – No bank registration request (if applicable)\", function(){\r",
													"  if (scenario !== \"NO_REQUEST\") { this.skip && this.skip(); return; }\r",
													"  var d0 = trim(rs.resDesc), d1 = trim(rs.resDesc1);\r",
													"  var ok = /لا\\s*يوجد\\s*طلب\\s*لتسجيل\\s*الحساب\\s*البنكي\\s*لهذا\\s*العميل/.test(d0) &&\r",
													"           /لا\\s*يوجد\\s*طلب\\s*لتسجيل\\s*الحساب\\s*ال?بنكي\\s*لهذا\\s*العميل/.test(d1);\r",
													"  pm.expect(ok, \"Arabic message: 'no request for bank registration'\").to.be.true;\r",
													"\r",
													"  pm.environment.set(\"TRN_CONFIRM_SCENARIO\",\"NO_REQUEST\");\r",
													"  pm.environment.set(\"TRN_CONFIRM_DESC\", d0 || d1);\r",
													"  pm.environment.unset(\"TRN_NIN\");\r",
													"  pm.environment.unset(\"TRN_GUID\");\r",
													"  pm.environment.unset(\"TRN_REQ_STATUS\");\r",
													"  pm.environment.unset(\"TRN_REQ_STATUS_LABEL\");\r",
													"});\r",
													"\r",
													"// ---------- Scenario E: Invalid transfer data ----------\r",
													"pm.test(\"Scenario E – Invalid transfer data (if applicable)\", function(){\r",
													"  if (scenario !== \"INVALID_TRANSFER_DATA\") { this.skip && this.skip(); return; }\r",
													"\r",
													"  var d0 = trim(rs.resDesc), d1 = trim(rs.resDesc1);\r",
													"  // Normalize Arabic (remove diacritics/hamza variants) and match canonical text\r",
													"  var n0 = normalizeAr(d0), n1 = normalizeAr(d1);\r",
													"  var canon = normalizeAr(\"خطأ في بيانات التحويل\");\r",
													"  var ok = (n0 === canon) && (n1 === canon);\r",
													"  pm.expect(ok, \"Arabic message: 'invalid transfer data'\").to.be.true;\r",
													"\r",
													"  pm.environment.set(\"TRN_CONFIRM_SCENARIO\",\"INVALID_TRANSFER_DATA\");\r",
													"  pm.environment.set(\"TRN_CONFIRM_DESC\", d0 || d1);\r",
													"  pm.environment.unset(\"TRN_NIN\");\r",
													"  pm.environment.unset(\"TRN_GUID\");\r",
													"  pm.environment.unset(\"TRN_REQ_STATUS\");\r",
													"  pm.environment.unset(\"TRN_REQ_STATUS_LABEL\");\r",
													"});\r",
													"\r",
													"// ---------- Scenario F: Invalid OTP ----------\r",
													"pm.test(\"Scenario F – Invalid OTP (if applicable)\", function(){\r",
													"  if (scenario !== \"INVALID_OTP\") { this.skip && this.skip(); return; }\r",
													"  var d0 = trim(rs.resDesc), d1 = trim(rs.resDesc1);\r",
													"  var ok = /كلمة\\s*المرور\\s*لمرة\\s*واحدة\\s*غير\\s*صالحة/.test(d0) &&\r",
													"           /كلمة\\s*المرور\\s*لمرة\\s*واحدة\\s*غير\\s*صالحة/.test(d1);\r",
													"  pm.expect(ok, \"Arabic message: 'invalid one-time password'\").to.be.true;\r",
													"\r",
													"  pm.environment.set(\"TRN_CONFIRM_SCENARIO\",\"INVALID_OTP\");\r",
													"  pm.environment.set(\"TRN_CONFIRM_DESC\", d0 || d1);\r",
													"  pm.environment.unset(\"TRN_NIN\");\r",
													"  pm.environment.unset(\"TRN_GUID\");\r",
													"  pm.environment.unset(\"TRN_REQ_STATUS\");\r",
													"  pm.environment.unset(\"TRN_REQ_STATUS_LABEL\");\r",
													"});\r",
													"\r",
													"// Minimal schema (tv4) – include new codes\r",
													"pm.test(\"Schema (minimal) validates\", function(){\r",
													"  var schema = {\r",
													"    type: \"object\",\r",
													"    required: [\"responseStatus\"],\r",
													"    properties: {\r",
													"      responseStatus: {\r",
													"        type: \"object\",\r",
													"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
													"        properties: {\r",
													"          source:  { \"const\": \"TRN_CONFIRMCANOTP\" },\r",
													"          resCode: { \"enum\": [\"0\",\"190\",\"16100\",\"16113\",\"110070\"] },\r",
													"          resCode1:{ \"enum\": [\"0\",\"190\",\"16100\",\"16113\",\"110070\"] }\r",
													"        }\r",
													"      },\r",
													"      message: { type: \"object\" }\r",
													"    }\r",
													"  };\r",
													"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
													"});\r",
													"\r",
													"// Optional: verify request Srv\r",
													"pm.test(\"Request Srv is TRN_CONFIRMCANOTP\", function(){\r",
													"  try {\r",
													"    var body = pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {};\r",
													"    pm.expect((body || {}).Srv).to.eql(\"TRN_CONFIRMCANOTP\");\r",
													"  } catch(e) { console.warn(\"Could not parse request body:\", e.message); }\r",
													"});\r",
													"\r",
													"console.log(\r",
													"  \"TRN_CONFIRMCANOTP\",\r",
													"  \"scenario=\", pm.environment.get(\"TRN_CONFIRM_SCENARIO\") || \"\",\r",
													"  \"status=\", pm.environment.get(\"TRN_REQ_STATUS\") || \"\",\r",
													"  \"guid=\", pm.environment.get(\"TRN_GUID\") || \"(none)\"\r",
													");\r",
													""
												],
												"type": "text/javascript",
												"packages": {},
												"requests": {}
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Accept",
												"value": "application/json",
												"type": "text"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "/** To GEt the OTP\r\nSELECT * FROM SEC_SMS_OUTBOX WHERE NIN = 'NIN' ORDER BY TIME_STAMP DESC \r\n**/\r\n\r\n{\r\n    \"Srv\": \"TRN_CONFIRMCANOTP\",\r\n    \"Message\": {\r\n        \"TrnConfirmCanRequest\": {\r\n            \"confirmAmount\": \"484\",\r\n            \"isConfirmed\": \"Y\",\r\n            \"confirmOTP\": \"2488\",\r\n            \"confirmGUID\": \"{{resTrnGUID}}\",\r\n            \"confirmLang\": \"ARB\",\r\n            \"confirmNin\": \"{{NIN}}\",\r\n            \"otpToken\": \"SAVE_TRANSFER\",\r\n            \"confirmClientIP\": \"\",\r\n            \"confirmSource\": \"\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"05-10-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}",
											"options": {
												"raw": {
													"language": "json"
												}
											}
										},
										"url": {
											"raw": "{{BaseURL}}{{Oracle19}}",
											"host": [
												"{{BaseURL}}{{Oracle19}}"
											]
										}
									},
									"response": []
								}
							]
						},
						{
							"name": "Withdraw from the Group | Resend OTP",
							"item": [
								{
									"name": "1. Get Banks info",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"/**\r",
													" * BNKBAL – Bank balances & info (ES5)\r",
													" * Validates:\r",
													" *  - HTTP 200, JSON, envelope codes 0/0, source=\"BNKBAL\"\r",
													" *  - bnkInfoResponse existence and key formats\r",
													" *  - Balance fields are numeric strings; negatives allowed by default (toggle strict)\r",
													" *  - banksInfo.bnkInfoRec / bnkTransfers.bnkTransferRec array shapes\r",
													" *  - financierInfo & fundInfo consistency; creditRatio accepts ratio or percent\r",
													" *  - financierInfo fields accept null/\"null\"/\"\" gracefully\r",
													" * Keeps your extracts:\r",
													" *  - accountSeq_i, bnkCode_i, accountCode_i, transferTimeId_i, bankCount\r",
													" *\r",
													" * Optional toggles (Env/Globals):\r",
													" *  - ENFORCE_NON_NEG_BALANCES = Y|N (default N) -> force balances >= 0\r",
													" */\r",
													"\r",
													"// 1) Status code\r",
													"pm.test(\"Status code is 200\", function () {\r",
													"  pm.response.to.have.status(200);\r",
													"});\r",
													"\r",
													"// 2) Envelope base checks\r",
													"pm.test(\"resCode is 0 and resDesc is Successful Operation\", function () {\r",
													"  var resStatus = (pm.response.json() || {}).responseStatus || {};\r",
													"  pm.expect(resStatus.resCode).to.eql(\"0\");\r",
													"  pm.expect(resStatus.resDesc).to.eql(\"Successful Operation\");\r",
													"});\r",
													"\r",
													"// 3) Extract and set bank info (kept as-is)\r",
													"var __json_for_extract = pm.response.json() || {};\r",
													"var __bnkInfoList = ((((__json_for_extract.message || {}).bnkInfoResponse || {}).banksInfo || {}).bnkInfoRec);\r",
													"\r",
													"if (Array.isArray(__bnkInfoList)) {\r",
													"  // Clear previous values\r",
													"  pm.environment.unset(\"bankCount\");\r",
													"\r",
													"  for (var i = 0; i < __bnkInfoList.length; i++) {\r",
													"    var bnk = __bnkInfoList[i] || {};\r",
													"    pm.environment.set(\"accountSeq_\" + (i + 1), String(bnk.accountSeq || \"\"));\r",
													"    pm.environment.set(\"bnkCode_\" + (i + 1), String(bnk.bnkCode || \"\"));\r",
													"    pm.environment.set(\"accountCode_\" + (i + 1), String(bnk.accountCode || \"\"));\r",
													"    pm.environment.set(\"transferTimeId_\" + (i + 1), String(bnk.transferTimeId || \"\"));\r",
													"  }\r",
													"  pm.environment.set(\"bankCount\", String(__bnkInfoList.length));\r",
													"} else {\r",
													"  console.warn(\"banksInfo.bnkInfoRec not found or invalid\");\r",
													"}\r",
													"\r",
													"// Basic header check\r",
													"pm.test(\"Content-Type is JSON\", function () {\r",
													"  pm.response.to.have.header(\"Content-Type\");\r",
													"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
													"});\r",
													"\r",
													"// Parse once & helpers\r",
													"var json = pm.response.json() || {};\r",
													"var rs   = json.responseStatus || {};\r",
													"var bnr  = (json.message || {}).bnkInfoResponse || {};\r",
													"\r",
													"function isNumericStr(v) {\r",
													"  if (typeof v === \"number\") return isFinite(v);\r",
													"  return typeof v === \"string\" && /^-?\\d+(\\.\\d+)?$/.test(v);\r",
													"}\r",
													"function isIntStr(v) {\r",
													"  if (typeof v === \"number\") return Number.isInteger(v);\r",
													"  return typeof v === \"string\" && /^-?\\d+$/.test(v);\r",
													"}\r",
													"function isYN(v)  { return String(v) === \"Y\" || String(v) === \"N\"; }\r",
													"function isNullish(v) {\r",
													"  return v === null || typeof v === \"undefined\" || String(v).trim().toUpperCase() === \"NULL\" || String(v).trim() === \"\";\r",
													"}\r",
													"\r",
													"// Envelope completeness\r",
													"pm.test(\"Envelope complete (BNKBAL)\", function () {\r",
													"  pm.expect(rs.resCode).to.eql(\"0\");\r",
													"  pm.expect(rs.resDesc).to.eql(\"Successful Operation\");\r",
													"  pm.expect(rs.source).to.eql(\"BNKBAL\");\r",
													"  pm.expect(rs.resCode1).to.eql(\"0\");\r",
													"  pm.expect(rs.resDesc1).to.eql(\"Successful Operation\");\r",
													"});\r",
													"\r",
													"// Core node exists\r",
													"pm.test(\"bnkInfoResponse exists\", function () {\r",
													"  pm.expect(bnr).to.be.an(\"object\");\r",
													"});\r",
													"\r",
													"// Name (if provided)\r",
													"pm.test(\"Customer name (if present) is a non-empty string\", function () {\r",
													"  if (typeof bnr.name !== \"undefined\") {\r",
													"    pm.expect(bnr.name).to.be.a(\"string\").and.to.not.equal(\"\");\r",
													"  }\r",
													"});\r",
													"\r",
													"// Balance fields – allow negatives by default (set ENFORCE_NON_NEG_BALANCES=Y to force >=0)\r",
													"pm.test(\"All balance fields are numeric strings (with optional non-negative enforcement)\", function () {\r",
													"  var keys = [\r",
													"    \"buybal1\",\"currentBal\",\"buyBal\",\"buyBal1\",\"onLineBal1\",\"maxBalance1\",\"unclearedBal\",\r",
													"    \"tradeBal\",\"t3Bal\",\"chqColl\",\"onlineBal\",\"todayDepo\",\"todayDepos\",\"allowedBal\",\r",
													"    \"postponed\",\"reservedFawriBalance\",\"maxbalance\",\"newMaxBalance\"\r",
													"  ];\r",
													"  var enforce = String(pm.environment.get(\"ENFORCE_NON_NEG_BALANCES\") || pm.globals.get(\"ENFORCE_NON_NEG_BALANCES\") || \"N\").toUpperCase() === \"Y\";\r",
													"\r",
													"  for (var i=0;i<keys.length;i++){\r",
													"    var k = keys[i];\r",
													"    if (typeof bnr[k] !== \"undefined\") {\r",
													"      pm.expect(isNumericStr(bnr[k]), k + \" must be numeric\").to.be.true;\r",
													"      if (enforce) {\r",
													"        pm.expect(Number(bnr[k]), k + \" must be >= 0 (strict mode)\").to.be.at.least(0);\r",
													"      }\r",
													"    }\r",
													"  }\r",
													"});\r",
													"\r",
													"// banksInfo array and each record format\r",
													"pm.test(\"banksInfo.bnkInfoRec is array (can be empty)\", function () {\r",
													"  var arr = (((bnr || {}).banksInfo || {}).bnkInfoRec);\r",
													"  pm.expect(arr, \"bnkInfoRec\").to.be.an(\"array\");\r",
													"});\r",
													"\r",
													"(function validateBankRecords(){\r",
													"  var arr = (((bnr || {}).banksInfo || {}).bnkInfoRec) || [];\r",
													"  if (!Array.isArray(arr) || arr.length === 0) return;\r",
													"\r",
													"  for (var i=0;i<arr.length;i++){\r",
													"    var rec = arr[i] || {};\r",
													"\r",
													"    pm.expect(String(rec.accountSeq || \"\"), \"accountSeq\").to.match(/^\\d+$/);\r",
													"\r",
													"    // bankCode: allow alphanumeric 2–10 chars (covers \"QNB\" and \"535\")\r",
													"    if (typeof rec.bankCode !== \"undefined\") {\r",
													"      var bc = String(rec.bankCode || \"\").trim().toUpperCase();\r",
													"      pm.expect(bc, \"bankCode non-empty\").to.not.equal(\"\");\r",
													"      pm.expect(bc, \"bankCode format A–Z/0–9, len 2–10\").to.match(/^[A-Z0-9]{2,10}$/);\r",
													"    }\r",
													"\r",
													"    // SWIFT/BIC strict: 8 or 11 alnum\r",
													"    pm.expect(String(rec.bnkCode || \"\"), \"bnkCode (SWIFT/BIC)\").to.match(/^[A-Z0-9]{8}([A-Z0-9]{3})?$/);\r",
													"\r",
													"    pm.expect(rec.bnkName, \"bnkName\").to.be.a(\"string\").and.not.empty;\r",
													"    pm.expect(rec.accountCode, \"accountCode\").to.be.a(\"string\").and.not.empty;\r",
													"\r",
													"    // accountType: accept BOTH/DEBIT/CREDIT/NO/TOBNK\r",
													"    if (typeof rec.accountType !== \"undefined\") {\r",
													"      pm.expect([\"BOTH\",\"DEBIT\",\"CREDIT\",\"NO\",\"TOBNK\"], \"accountType\")\r",
													"        .to.include(String(rec.accountType).toUpperCase());\r",
													"    }\r",
													"\r",
													"    // status\r",
													"    pm.expect(String(rec.accountStatus || \"\"), \"accountStatus\").to.match(/^\\d+$/);\r",
													"    pm.expect(rec.accountStatusDesc, \"accountStatusDesc\").to.be.a(\"string\").and.not.empty;\r",
													"\r",
													"    if (typeof rec.isSahlPlus !== \"undefined\") {\r",
													"      pm.expect(isYN(String(rec.isSahlPlus)), \"isSahlPlus\").to.be.true;\r",
													"    }\r",
													"\r",
													"    // transferTimeId can be long token; just ensure string & non-empty\r",
													"    pm.expect(rec.transferTimeId, \"transferTimeId\").to.be.a(\"string\").and.not.empty;\r",
													"  }\r",
													"})();\r",
													"\r",
													"// bnkTransfers shape\r",
													"pm.test(\"bnkTransfers.bnkTransferRec is array (may be empty)\", function () {\r",
													"  var tr = (((bnr || {}).bnkTransfers || {}).bnkTransferRec);\r",
													"  pm.expect(tr, \"bnkTransferRec\").to.be.an(\"array\");\r",
													"});\r",
													"\r",
													"// financierInfo (if present) – tolerant of null/\"null\"/\"\"\r",
													"pm.test(\"financierInfo (if present) has valid fields\", function () {\r",
													"  var fi = bnr.financierInfo;\r",
													"  if (fi && typeof fi === \"object\") {\r",
													"    if (!isNullish(fi.financierID)) {\r",
													"      pm.expect(String(fi.financierID)).to.match(/^\\d+$/);\r",
													"    }\r",
													"\r",
													"    if (!isNullish(fi.isActive)) {\r",
													"      pm.expect(isYN(String(fi.isActive))).to.be.true;\r",
													"    }\r",
													"\r",
													"    if (!isNullish(fi.isOrdersEnabled)) {\r",
													"      pm.expect(isYN(String(fi.isOrdersEnabled))).to.be.true;\r",
													"    }\r",
													"\r",
													"    if (!isNullish(fi.riskFeesType)) {\r",
													"      pm.expect([\"0\",\"1\",\"2\",\"3\"]).to.include(String(fi.riskFeesType));\r",
													"    }\r",
													"    // riskFeesValue: validate only when present & not nullish\r",
													"    if (!isNullish(fi.riskFeesValue)) {\r",
													"      pm.expect(isNumericStr(fi.riskFeesValue)).to.be.true;\r",
													"      pm.expect(Number(fi.riskFeesValue)).to.be.at.least(0);\r",
													"    }\r",
													"\r",
													"    if (!isNullish(fi.financierAllowancePeriod)) {\r",
													"      pm.expect(isIntStr(fi.financierAllowancePeriod)).to.be.true;\r",
													"      pm.expect(Number(fi.financierAllowancePeriod)).to.be.at.least(0);\r",
													"    }\r",
													"  }\r",
													"});\r",
													"\r",
													"// fundInfo (margin block; can be N or Y)\r",
													"pm.test(\"fundInfo (if present) is consistent\", function () {\r",
													"  var f = bnr.fundInfo;\r",
													"  if (f && typeof f === \"object\") {\r",
													"    pm.expect(isYN(String(f.isFundClient)), \"isFundClient Y/N\").to.be.true;\r",
													"\r",
													"    if (f.isFundClient === \"Y\") {\r",
													"      var numKeys = [\r",
													"        \"fundDebt\",\"fundAvailableCredit\",\"cashBalanceNotCollected\",\"fundedAmountInMarket\",\r",
													"        \"creditRatio\",\"collectedBalance\",\"actualFunded\",\"shareAvCredit\"\r",
													"      ];\r",
													"      for (var i=0;i<numKeys.length;i++){\r",
													"        var k = numKeys[i];\r",
													"        pm.expect(isNumericStr(String(f[k])), \"fundInfo.\"+k+\" numeric\").to.be.true;\r",
													"        pm.expect(Number(f[k]), \"fundInfo.\"+k+\" >= 0\").to.be.at.least(0);\r",
													"      }\r",
													"\r",
													"      // creditRatio sanity: accept ratio [0..1] OR percent [0..100]\r",
													"      if (!isNullish(f.creditRatio)) {\r",
													"        var cr = Number(f.creditRatio);\r",
													"        if (cr > 1) {\r",
													"          pm.expect(cr, \"creditRatio% in [0, 100]\").to.be.at.least(0).and.at.most(100);\r",
													"          pm.environment.set(\"CREDIT_RATIO\", String(cr / 100));     // normalized 0..1\r",
													"          pm.environment.set(\"CREDIT_RATIO_PCT\", String(cr));       // as percent\r",
													"        } else {\r",
													"          pm.expect(cr, \"creditRatio in [0, 1]\").to.be.at.least(0).and.at.most(1);\r",
													"          pm.environment.set(\"CREDIT_RATIO\", String(cr));           // normalized 0..1\r",
													"          pm.environment.set(\"CREDIT_RATIO_PCT\", String(cr * 100)); // as percent\r",
													"        }\r",
													"      }\r",
													"\r",
													"      if (!isNullish(f.isActiveFundClient)) {\r",
													"        pm.expect(isYN(String(f.isActiveFundClient))).to.be.true;\r",
													"      }\r",
													"    }\r",
													"  }\r",
													"});\r",
													"\r",
													"// resType should reflect request's AccRegisterType (when provided)\r",
													"pm.test(\"resType matches AccRegisterType from request (when provided)\", function () {\r",
													"  var reqBody;\r",
													"  try { reqBody = pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {}; } catch(e){}\r",
													"  var accType = (((reqBody || {}).Message || {}).BalDlsRequest || {}).AccRegisterType;\r",
													"  if (accType) {\r",
													"    pm.expect(bnr.resType, \"resType\").to.eql(String(accType));\r",
													"  }\r",
													"});\r",
													"\r",
													"// Guardrails: request Srv should be BNKBAL\r",
													"pm.test(\"Request Srv is BNKBAL\", function () {\r",
													"  var reqBody;\r",
													"  try { reqBody = pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {}; } catch(e){}\r",
													"  pm.expect((reqBody || {}).Srv).to.eql(\"BNKBAL\");\r",
													"});\r",
													"\r",
													"// Minimal schema (tv4)\r",
													"pm.test(\"Schema (minimal) validates\", function () {\r",
													"  var schema = {\r",
													"    type: \"object\",\r",
													"    required: [\"responseStatus\",\"message\"],\r",
													"    properties: {\r",
													"      responseStatus: {\r",
													"        type: \"object\",\r",
													"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
													"        properties: {\r",
													"          resCode:  { \"const\": \"0\" },\r",
													"          resDesc:  { \"const\": \"Successful Operation\" },\r",
													"          source:   { \"const\": \"BNKBAL\" },\r",
													"          resCode1: { \"const\": \"0\" },\r",
													"          resDesc1: { \"const\": \"Successful Operation\" }\r",
													"        }\r",
													"      },\r",
													"      message: {\r",
													"        type: \"object\",\r",
													"        required: [\"bnkInfoResponse\"],\r",
													"        properties: {\r",
													"          bnkInfoResponse: { type: \"object\" }\r",
													"        }\r",
													"      }\r",
													"    }\r",
													"  };\r",
													"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
													"});\r",
													"\r",
													"// Extra: store a few more env helpers (without touching your extract keys)\r",
													"(function storeExtras(){\r",
													"  var arr = (((bnr || {}).banksInfo || {}).bnkInfoRec) || [];\r",
													"  if (arr.length > 0) {\r",
													"    pm.environment.set(\"firstBankCode\", String(arr[0].bankCode || \"\"));\r",
													"    pm.environment.set(\"firstBankSwift\", String(arr[0].bnkCode || \"\"));\r",
													"    pm.environment.set(\"firstAccountStatus\", String(arr[0].accountStatus || \"\"));\r",
													"  }\r",
													"  pm.environment.set(\"bnkTransfersCount\", String(((((bnr || {}).bnkTransfers || {}).bnkTransferRec) || []).length));\r",
													"})();\r",
													"\r",
													"console.log(\"✅ BNKBAL validated.\",\r",
													"            \"bankCount:\", pm.environment.get(\"bankCount\"),\r",
													"            \"transfers:\", pm.environment.get(\"bnkTransfersCount\"),\r",
													"            \"creditRatio(norm):\", pm.environment.get(\"CREDIT_RATIO\"),\r",
													"            \"creditRatio(%) \", pm.environment.get(\"CREDIT_RATIO_PCT\"));\r",
													""
												],
												"type": "text/javascript",
												"packages": {},
												"requests": {}
											}
										}
									],
									"request": {
										"auth": {
											"type": "noauth"
										},
										"method": "POST",
										"header": [
											{
												"key": "Accept",
												"value": "application/json",
												"type": "text"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\r\n    \"Srv\": \"BNKBAL\",\r\n    \"Message\": {\r\n        \"BalDlsRequest\": {\r\n            \"NIN\": \"{{NIN}}\",\r\n            \"UserId\": \"{{UserID}}\",\r\n            \"UserType\": \"INVESTOR\",\r\n            \"AccRegisterType\": \"ALL\",\r\n            \"Lang\": \"ARB\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"30-04-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}\r\n\r\n\r\n",
											"options": {
												"raw": {
													"language": "json"
												}
											}
										},
										"url": {
											"raw": "{{BaseURL}}{{Oracle19}}",
											"host": [
												"{{BaseURL}}{{Oracle19}}"
											]
										}
									},
									"response": []
								},
								{
									"name": "2. Confirm withdraw Transfer",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"/**\r",
													" * BNKCHKTRANSFERNEW – Confirm Transfer (Popup) validation (ES5)\r",
													" * Validates:\r",
													" *  - Envelope: resCode/resCode1=0, source=\"BNKCHKTRANSFERNEW\"\r",
													" *  - Fields: trnxFees, trnxIsPossible, maximumAmount, hintMessage, urgentFees\r",
													" *  - Numeric strings >= 0 (supports scientific notation); trnxIsPossible is Y/N\r",
													" *  - Optional business rules via env toggles (see header comment)\r",
													" * Saves to env:\r",
													" *  TRX_IS_POSSIBLE, TRX_MAX_AMOUNT, TRX_MAX_AMOUNT_NUM, TRX_FEES, TRX_FEES_NUM,\r",
													" *  TRX_URGENT_FEES, TRX_URGENT_FEES_NUM, TRX_HINT\r",
													" */\r",
													"\r",
													"pm.test(\"HTTP 200\", function () {\r",
													"  pm.response.to.have.status(200);\r",
													"});\r",
													"\r",
													"pm.test(\"Content-Type is JSON\", function () {\r",
													"  pm.response.to.have.header(\"Content-Type\");\r",
													"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
													"});\r",
													"\r",
													"// Parse\r",
													"var json;\r",
													"pm.test(\"Body is valid JSON\", function () {\r",
													"  json = pm.response.json();\r",
													"  pm.expect(json).to.be.an(\"object\");\r",
													"});\r",
													"\r",
													"// Envelope\r",
													"pm.test(\"responseStatus OK (BNKCHKTRANSFERNEW)\", function () {\r",
													"  var rs = json.responseStatus || {};\r",
													"  pm.expect(rs.resCode).to.eql(\"0\");\r",
													"  pm.expect(rs.resDesc).to.eql(\"Successful Operation\");\r",
													"  pm.expect(rs.source).to.eql(\"BNKCHKTRANSFERNEW\");\r",
													"  pm.expect(rs.resCode1).to.eql(\"0\");\r",
													"  pm.expect(rs.resDesc1).to.eql(\"Successful Operation\");\r",
													"});\r",
													"\r",
													"// Node\r",
													"var node = (((json || {}).message || {}).isBankTransferResponse) || {};\r",
													"pm.test(\"isBankTransferResponse exists\", function () {\r",
													"  pm.expect(node).to.be.an(\"object\");\r",
													"  pm.expect(node).to.have.property(\"trnxFees\");\r",
													"  pm.expect(node).to.have.property(\"trnxIsPossible\");\r",
													"  pm.expect(node).to.have.property(\"maximumAmount\");\r",
													"  pm.expect(node).to.have.property(\"hintMessage\");\r",
													"  pm.expect(node).to.have.property(\"urgentFees\");\r",
													"});\r",
													"\r",
													"// Helpers (ES5)\r",
													"// Accepts: integers, decimals, and scientific notation (e.g., 1.23E8, -4e-3)\r",
													"function isNumericStr(v) {\r",
													"  if (typeof v === \"number\") return isFinite(v);\r",
													"  var s = String(v || \"\").trim();\r",
													"  return /^-?(?:\\d+\\.?\\d*|\\d*\\.\\d+)(?:[eE][+\\-]?\\d+)?$/.test(s);\r",
													"}\r",
													"function toNumberSafe(v) { return Number(String(v || \"\").trim()); }\r",
													"function isYN(v) { return v === \"Y\" || v === \"N\"; }\r",
													"function getFlag(name, defVal) {\r",
													"  var v = pm.environment.get(name) || pm.globals.get(name);\r",
													"  v = (v == null ? \"\" : String(v)).toUpperCase();\r",
													"  if (v !== \"Y\" && v !== \"N\") return defVal;\r",
													"  return v;\r",
													"}\r",
													"\r",
													"// Field validations\r",
													"pm.test(\"trnxFees & urgentFees are numeric strings >= 0\", function () {\r",
													"  pm.expect(isNumericStr(node.trnxFees), \"trnxFees must be numeric string\").to.be.true;\r",
													"  pm.expect(isNumericStr(node.urgentFees), \"urgentFees must be numeric string\").to.be.true;\r",
													"  pm.expect(toNumberSafe(node.trnxFees), \"trnxFees >= 0\").to.be.at.least(0);\r",
													"  pm.expect(toNumberSafe(node.urgentFees), \"urgentFees >= 0\").to.be.at.least(0);\r",
													"});\r",
													"\r",
													"pm.test(\"trnxIsPossible is Y/N\", function () {\r",
													"  pm.expect(isYN(node.trnxIsPossible), \"trnxIsPossible must be 'Y' or 'N'\").to.be.true;\r",
													"});\r",
													"\r",
													"pm.test(\"maximumAmount is numeric string >= 0\", function () {\r",
													"  pm.expect(isNumericStr(node.maximumAmount), \"maximumAmount must be numeric string\").to.be.true;\r",
													"  pm.expect(toNumberSafe(node.maximumAmount), \"maximumAmount >= 0\").to.be.at.least(0);\r",
													"});\r",
													"\r",
													"pm.test(\"hintMessage is a string (may be empty on success)\", function () {\r",
													"  pm.expect(typeof node.hintMessage).to.eql(\"string\");\r",
													"});\r",
													"\r",
													"// Business rules (configurable)\r",
													"pm.test(\"Business rules for trnxIsPossible\", function () {\r",
													"  var requireMaxWhenY = getFlag(\"REQUIRE_MAX_GT_ZERO_WHEN_Y\", \"Y\") === \"Y\";\r",
													"  var requireHintOnFail = getFlag(\"REQUIRE_HINT_ON_FAIL\", \"Y\") === \"Y\";\r",
													"  var allowNonZeroWhenN = getFlag(\"ALLOW_NONZERO_MAX_WHEN_N\", \"N\") === \"N\" ? false : true;\r",
													"\r",
													"  var isPossible = node.trnxIsPossible === \"Y\";\r",
													"  var maxNum = toNumberSafe(node.maximumAmount);\r",
													"  var hint = String(node.hintMessage || \"\");\r",
													"\r",
													"  if (isPossible) {\r",
													"    if (requireMaxWhenY) {\r",
													"      pm.expect(maxNum, \"When possible=Y, maximumAmount must be > 0\").to.be.above(0);\r",
													"    }\r",
													"    if (hint && hint.replace(/\\s+/g,\"\").length > 0) {\r",
													"      console.warn(\"Hint provided even though trnxIsPossible=Y:\", hint);\r",
													"    }\r",
													"  } else {\r",
													"    if (requireHintOnFail) {\r",
													"      pm.expect(hint.replace(/\\s+/g,\"\").length, \"When possible=N, hintMessage should be non-empty\").to.be.greaterThan(0);\r",
													"    }\r",
													"    if (!allowNonZeroWhenN) {\r",
													"      pm.expect(maxNum, \"When possible=N, maximumAmount should be 0\").to.eql(0);\r",
													"    }\r",
													"  }\r",
													"});\r",
													"\r",
													"// Save to environment\r",
													"(function saveEnv(){\r",
													"  pm.environment.set(\"TRX_IS_POSSIBLE\", String(node.trnxIsPossible || \"\"));\r",
													"  pm.environment.set(\"TRX_MAX_AMOUNT\", String(node.maximumAmount || \"\"));\r",
													"  pm.environment.set(\"TRX_MAX_AMOUNT_NUM\", String(toNumberSafe(node.maximumAmount)));\r",
													"  pm.environment.set(\"TRX_FEES\", String(node.trnxFees || \"\"));\r",
													"  pm.environment.set(\"TRX_FEES_NUM\", String(toNumberSafe(node.trnxFees)));\r",
													"  pm.environment.set(\"TRX_URGENT_FEES\", String(node.urgentFees || \"\"));\r",
													"  pm.environment.set(\"TRX_URGENT_FEES_NUM\", String(toNumberSafe(node.urgentFees)));\r",
													"  pm.environment.set(\"TRX_HINT\", String(node.hintMessage || \"\"));\r",
													"})();\r",
													"\r",
													"// Minimal schema (tv4)\r",
													"pm.test(\"Schema (minimal) validates\", function () {\r",
													"  var schema = {\r",
													"    type: \"object\",\r",
													"    required: [\"responseStatus\",\"message\"],\r",
													"    properties: {\r",
													"      responseStatus: {\r",
													"        type: \"object\",\r",
													"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
													"        properties: {\r",
													"          resCode:  { \"const\": \"0\" },\r",
													"          resDesc:  { \"const\": \"Successful Operation\" },\r",
													"          source:   { \"const\": \"BNKCHKTRANSFERNEW\" },\r",
													"          resCode1: { \"const\": \"0\" },\r",
													"          resDesc1: { \"const\": \"Successful Operation\" }\r",
													"        }\r",
													"      },\r",
													"      message: {\r",
													"        type: \"object\",\r",
													"        required: [\"isBankTransferResponse\"],\r",
													"        properties: {\r",
													"          isBankTransferResponse: {\r",
													"            type: \"object\",\r",
													"            required: [\"trnxFees\",\"trnxIsPossible\",\"maximumAmount\",\"hintMessage\",\"urgentFees\"],\r",
													"            properties: {\r",
													"              trnxFees:       { type: \"string\" },\r",
													"              trnxIsPossible: { type: \"string\" },\r",
													"              maximumAmount:  { type: \"string\" },\r",
													"              hintMessage:    { type: \"string\" },\r",
													"              urgentFees:     { type: \"string\" }\r",
													"            }\r",
													"          }\r",
													"        }\r",
													"      }\r",
													"    }\r",
													"  };\r",
													"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
													"});\r",
													"\r",
													"// Visualizer (compact)\r",
													"(function render(){\r",
													"  var template =\r",
													"    '<style>.t{font-family:system-ui,Segoe UI,Roboto,Arial;font-size:14px;color:#333;width:100%;border-collapse:collapse}' +\r",
													"    '.t th,.t td{border:1px solid #87ceeb;padding:6px;text-align:left}.t th{background:#87ceeb}' +\r",
													"    '.good{color:#0a8f08}.bad{color:#b00020}</style>' +\r",
													"    '<h3>Confirm Transfer</h3>' +\r",
													"    '<table class=\"t\"><tbody>' +\r",
													"    '<tr><th>trnxIsPossible</th><td class=\"{{possibleCls}}\">{{trnxIsPossible}}</td></tr>' +\r",
													"    '<tr><th>maximumAmount</th><td>{{maximumAmount}}</td></tr>' +\r",
													"    '<tr><th>trnxFees</th><td>{{trnxFees}}</td></tr>' +\r",
													"    '<tr><th>urgentFees</th><td>{{urgentFees}}</td></tr>' +\r",
													"    '<tr><th>hintMessage</th><td>{{hintMessage}}</td></tr>' +\r",
													"    '</tbody></table>';\r",
													"\r",
													"  var possibleCls = (node.trnxIsPossible === \"Y\") ? \"good\" : \"bad\";\r",
													"  pm.visualizer.set(template, {\r",
													"    trnxIsPossible: String(node.trnxIsPossible || \"\"),\r",
													"    maximumAmount: String(node.maximumAmount || \"\"),\r",
													"    trnxFees: String(node.trnxFees || \"\"),\r",
													"    urgentFees: String(node.urgentFees || \"\"),\r",
													"    hintMessage: String(node.hintMessage || \"\"),\r",
													"    possibleCls: possibleCls\r",
													"  });\r",
													"})();\r",
													"\r",
													"console.log(\r",
													"  \"✅ BNKCHKTRANSFERNEW validated.\",\r",
													"  \"possible=\", node.trnxIsPossible,\r",
													"  \"max(raw)=\", node.maximumAmount,\r",
													"  \"max(num)=\", Number(String(node.maximumAmount || \"\").trim())\r",
													");\r",
													""
												],
												"type": "text/javascript",
												"packages": {},
												"requests": {}
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Accept",
												"value": "application/json",
												"type": "text"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\r\n    \"Srv\": \"BNKCHKTRANSFERNEW\",\r\n    \"Message\": {\r\n        \"IsBankTransferRequest\": {\r\n            \"swiftCode\": \"{{bnkCode_1}}\",\r\n            \"accountNO\": \"{{accountSeq_1}}\",\r\n            \"amount\": \"9000\",\r\n            \"nin\": \"{{NIN}}\",\r\n            \"userId\": \"{{UserID}}\",\r\n            \"userType\": \"INVESTOR\",\r\n            \"lang\": \"ARB\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"30-04-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}",
											"options": {
												"raw": {
													"language": "json"
												}
											}
										},
										"url": {
											"raw": "{{BaseURL}}{{Oracle19}}",
											"host": [
												"{{BaseURL}}{{Oracle19}}"
											]
										}
									},
									"response": []
								},
								{
									"name": "3. Fire - Withdraw from The Group",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"/**\r",
													" * BNKTRANSFERNEW – Bank transfer from (ES5)\r",
													" * Validates:\r",
													" *  - Envelope: resCode/resCode1=0, source=\"BNKTRANSFERNEW\"\r",
													" *  - Node: getBankTransferResponse with required keys (all strings)\r",
													" *  - showHint in {Y,N} and conditional rules\r",
													" *  - OTP config: otpLength=\"4\", otpExpiryPeriod=\"300\", otpResendPeriod=\"60\"\r",
													" * Saves env:\r",
													" *  BANK_TRANSFER_CODE, BANK_SHOW_HINT, BANK_HINT_MESSAGE,\r",
													" *  BANK_CONFIRM_MSG, BANK_TRN_GUID, BANK_OTP_TOKEN,\r",
													" *  resTrnGUID (direct alias)\r",
													" */\r",
													"\r",
													"pm.test(\"HTTP 200\", function () {\r",
													"  pm.response.to.have.status(200);\r",
													"});\r",
													"\r",
													"pm.test(\"Content-Type is JSON\", function () {\r",
													"  pm.response.to.have.header(\"Content-Type\");\r",
													"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
													"});\r",
													"\r",
													"// Parse\r",
													"var json;\r",
													"pm.test(\"Body is valid JSON\", function () {\r",
													"  json = pm.response.json();\r",
													"  pm.expect(json).to.be.an(\"object\");\r",
													"});\r",
													"\r",
													"// Envelope\r",
													"pm.test(\"responseStatus OK (BNKTRANSFERNEW)\", function () {\r",
													"  var rs = json.responseStatus || {};\r",
													"  pm.expect(rs.resCode).to.eql(\"0\");\r",
													"  pm.expect(rs.resDesc).to.eql(\"Successful Operation\");\r",
													"  pm.expect(rs.source).to.eql(\"BNKTRANSFERNEW\");\r",
													"  pm.expect(rs.resCode1).to.eql(\"0\");\r",
													"  pm.expect(rs.resDesc1).to.eql(\"Successful Operation\");\r",
													"});\r",
													"\r",
													"// Node\r",
													"var node = (((json || {}).message || {}).getBankTransferResponse) || {};\r",
													"pm.test(\"getBankTransferResponse exists & has required keys\", function () {\r",
													"  pm.expect(node).to.be.an(\"object\");\r",
													"  var keys = [\r",
													"    \"transferCode\",\"showHint\",\"hintMessage\",\"resConfirmMessage\",\"resTrnGUID\",\"otpToken\",\r",
													"    \"otpLength\",\"otpExpiryPeriod\",\"otpResendPeriod\"\r",
													"  ];\r",
													"  for (var i=0;i<keys.length;i++){\r",
													"    pm.expect(node, \"Missing key: \" + keys[i]).to.have.property(keys[i]);\r",
													"    pm.expect(typeof node[keys[i]], keys[i] + \" must be string\").to.eql(\"string\");\r",
													"  }\r",
													"});\r",
													"\r",
													"// Helpers\r",
													"function isYN(v){ return v === \"Y\" || v === \"N\"; }\r",
													"function getFlag(name, defVal){\r",
													"  var v = pm.environment.get(name) || pm.globals.get(name);\r",
													"  v = (v == null ? \"\" : String(v)).toUpperCase();\r",
													"  if (v !== \"Y\" && v !== \"N\") return defVal;\r",
													"  return v;\r",
													"}\r",
													"\r",
													"// showHint logic\r",
													"pm.test(\"showHint is Y/N\", function () {\r",
													"  pm.expect(isYN(node.showHint), \"showHint must be 'Y' or 'N'\").to.be.true;\r",
													"});\r",
													"\r",
													"// Confirm message (Arabic success text)\r",
													"pm.test(\"resConfirmMessage (required by policy or optional)\", function () {\r",
													"  var requireMsg = getFlag(\"REQUIRE_CONFIRM_MESSAGE\", \"Y\") === \"Y\";\r",
													"  var msg = String(node.resConfirmMessage || \"\");\r",
													"  if (requireMsg) {\r",
													"    pm.expect(msg.replace(/\\s+/g,\"\").length, \"resConfirmMessage should be non-empty\").to.be.greaterThan(0);\r",
													"    var ok =\r",
													"      /تم\\s*قبول\\s*طلب\\s*التحويل/.test(msg) ||\r",
													"      /تم\\s*قبول/.test(msg);\r",
													"    pm.expect(ok, \"resConfirmMessage should indicate success in Arabic\").to.be.true;\r",
													"  }\r",
													"});\r",
													"\r",
													"// OTP configuration checks (exact values)\r",
													"pm.test(\"OTP config: otpLength='4', otpExpiryPeriod='300', otpResendPeriod='60'\", function () {\r",
													"  pm.expect(String(node.otpLength)).to.eql(\"4\");\r",
													"  pm.expect(String(node.otpExpiryPeriod)).to.eql(\"300\");\r",
													"  pm.expect(String(node.otpResendPeriod)).to.eql(\"60\");\r",
													"});\r",
													"\r",
													"// Conditional rules for hint / otp\r",
													"pm.test(\"Hint & OTP conditional rules\", function () {\r",
													"  var requireHintOnY   = getFlag(\"REQUIRE_HINT_ON_Y\", \"N\") === \"Y\";\r",
													"  var requireOtpOnHint = getFlag(\"REQUIRE_OTP_WHEN_HINT\", \"N\") === \"Y\";\r",
													"  var requireEmptyOtpWhenNoHint = getFlag(\"REQUIRE_EMPTY_OTP_WHEN_NOHINT\", \"N\") === \"Y\";\r",
													"\r",
													"  var showHintY = node.showHint === \"Y\";\r",
													"  var hint = String(node.hintMessage || \"\");\r",
													"  var otp  = String(node.otpToken || \"\");\r",
													"\r",
													"  if (showHintY) {\r",
													"    if (requireHintOnY) {\r",
													"      pm.expect(hint.replace(/\\s+/g,\"\").length, \"showHint=Y -> hintMessage must be non-empty\").to.be.greaterThan(0);\r",
													"    }\r",
													"    if (requireOtpOnHint) {\r",
													"      pm.expect(otp.replace(/\\s+/g,\"\").length, \"showHint=Y -> otpToken must be non-empty\").to.be.greaterThan(0);\r",
													"    }\r",
													"  } else {\r",
													"    if (requireEmptyOtpWhenNoHint) {\r",
													"      pm.expect(otp.replace(/\\s+/g,\"\").length, \"showHint=N -> otpToken should be empty\").to.eql(0);\r",
													"    }\r",
													"  }\r",
													"});\r",
													"\r",
													"// Optional: require GUID when success (config)\r",
													"pm.test(\"Transaction GUID requirement (optional)\", function () {\r",
													"  var requireGuid = getFlag(\"REQUIRE_GUID_ON_SUCCESS\", \"N\") === \"Y\";\r",
													"  if (requireGuid) {\r",
													"    pm.expect(String(node.resTrnGUID || \"\").replace(/\\s+/g,\"\").length, \"resTrnGUID required\").to.be.greaterThan(0);\r",
													"  }\r",
													"});\r",
													"\r",
													"// Save to environment\r",
													"(function saveEnv(){\r",
													"  pm.environment.set(\"BANK_TRANSFER_CODE\", String(node.transferCode || \"\"));\r",
													"  pm.environment.set(\"BANK_SHOW_HINT\", String(node.showHint || \"\"));\r",
													"  pm.environment.set(\"BANK_HINT_MESSAGE\", String(node.hintMessage || \"\"));\r",
													"  pm.environment.set(\"BANK_CONFIRM_MSG\", String(node.resConfirmMessage || \"\"));\r",
													"  pm.environment.set(\"BANK_TRN_GUID\", String(node.resTrnGUID || \"\"));\r",
													"  pm.environment.set(\"BANK_OTP_TOKEN\", String(node.otpToken || \"\"));\r",
													"  // direct alias as requested\r",
													"  pm.environment.set(\"resTrnGUID\", String(node.resTrnGUID || \"\"));\r",
													"})();\r",
													"\r",
													"// Minimal schema (tv4)\r",
													"pm.test(\"Schema (minimal) validates\", function () {\r",
													"  var schema = {\r",
													"    type: \"object\",\r",
													"    required: [\"responseStatus\",\"message\"],\r",
													"    properties: {\r",
													"      responseStatus: {\r",
													"        type: \"object\",\r",
													"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
													"        properties: {\r",
													"          resCode:  { \"const\": \"0\" },\r",
													"          resDesc:  { \"const\": \"Successful Operation\" },\r",
													"          source:   { \"const\": \"BNKTRANSFERNEW\" },\r",
													"          resCode1: { \"const\": \"0\" },\r",
													"          resDesc1: { \"const\": \"Successful Operation\" }\r",
													"        }\r",
													"      },\r",
													"      message: {\r",
													"        type: \"object\",\r",
													"        required: [\"getBankTransferResponse\"],\r",
													"        properties: {\r",
													"          getBankTransferResponse: {\r",
													"            type: \"object\",\r",
													"            required: [\r",
													"              \"transferCode\",\"showHint\",\"hintMessage\",\"resConfirmMessage\",\"resTrnGUID\",\"otpToken\",\r",
													"              \"otpLength\",\"otpExpiryPeriod\",\"otpResendPeriod\"\r",
													"            ],\r",
													"            properties: {\r",
													"              transferCode:      { type: \"string\" },\r",
													"              showHint:          { type: \"string\" },\r",
													"              hintMessage:       { type: \"string\" },\r",
													"              resConfirmMessage: { type: \"string\" },\r",
													"              resTrnGUID:        { type: \"string\" },\r",
													"              otpToken:          { type: \"string\" },\r",
													"              otpLength:         { type: \"string\", \"const\": \"4\" },\r",
													"              otpExpiryPeriod:   { type: \"string\", \"const\": \"300\" },\r",
													"              otpResendPeriod:   { type: \"string\", \"const\": \"60\" }\r",
													"            }\r",
													"          }\r",
													"        }\r",
													"      }\r",
													"    }\r",
													"  };\r",
													"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
													"});\r",
													"\r",
													"// Visualizer (compact)\r",
													"(function render(){\r",
													"  var template =\r",
													"    '<style>.t{font-family:system-ui,Segoe UI,Roboto,Arial;font-size:14px;color:#333;width:100%;border-collapse:collapse}' +\r",
													"    '.t th,.t td{border:1px solid #87ceeb;padding:6px;text-align:left}.t th{background:#87ceeb}' +\r",
													"    '.flagY{color:#0a8f08}.flagN{color:#b00020}</style>' +\r",
													"    '<h3>Bank Transfer – Result</h3>' +\r",
													"    '<table class=\"t\"><tbody>' +\r",
													"    '<tr><th>resConfirmMessage</th><td>{{resConfirmMessage}}</td></tr>' +\r",
													"    '<tr><th>showHint</th><td class=\"{{showHintCls}}\">{{showHint}}</td></tr>' +\r",
													"    '<tr><th>hintMessage</th><td>{{hintMessage}}</td></tr>' +\r",
													"    '<tr><th>transferCode</th><td>{{transferCode}}</td></tr>' +\r",
													"    '<tr><th>resTrnGUID</th><td>{{resTrnGUID}}</td></tr>' +\r",
													"    '<tr><th>otpToken</th><td>{{otpToken}}</td></tr>' +\r",
													"    '<tr><th>otpLength</th><td>{{otpLength}}</td></tr>' +\r",
													"    '<tr><th>otpExpiryPeriod</th><td>{{otpExpiryPeriod}}</td></tr>' +\r",
													"    '<tr><th>otpResendPeriod</th><td>{{otpResendPeriod}}</td></tr>' +\r",
													"    '</tbody></table>';\r",
													"\r",
													"  pm.visualizer.set(template, {\r",
													"    resConfirmMessage: String(node.resConfirmMessage || \"\"),\r",
													"    showHint: String(node.showHint || \"\"),\r",
													"    hintMessage: String(node.hintMessage || \"\"),\r",
													"    transferCode: String(node.transferCode || \"\"),\r",
													"    resTrnGUID: String(node.resTrnGUID || \"\"),\r",
													"    otpToken: String(node.otpToken || \"\"),\r",
													"    otpLength: String(node.otpLength || \"\"),\r",
													"    otpExpiryPeriod: String(node.otpExpiryPeriod || \"\"),\r",
													"    otpResendPeriod: String(node.otpResendPeriod || \"\"),\r",
													"    showHintCls: (node.showHint === \"Y\") ? \"flagY\" : \"flagN\"\r",
													"  });\r",
													"})();\r",
													"\r",
													"console.log(\"✅ BNKTRANSFERNEW validated.\", \"showHint=\", node.showHint, \"resTrnGUID=\", node.resTrnGUID);\r",
													""
												],
												"type": "text/javascript",
												"packages": {},
												"requests": {}
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Accept",
												"value": "application/json",
												"type": "text"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\r\n    \"Srv\": \"BNKTRANSFERNEW\",\r\n    \"Message\": {\r\n        \"BankTransferRequest\": {\r\n            \"nin\": \"{{NIN}}\",\r\n            \"userId\": \"{{UserID}}\",\r\n            \"userType\": \"INVESTOR\",\r\n            \"accountNO\": \"{{accountCode_1}}\",\r\n            \"amount\": 9000,\r\n            \"swiftCode\": \"{{bnkCode_1}}\",\r\n            \"transferType\": \"TO\",\r\n            \"accountStatus\": \"4\",\r\n            \"transferTimeId\": \"{{transferTimeId_1}}\",\r\n            \"lang\": \"ARB\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"30-04-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}",
											"options": {
												"raw": {
													"language": "json"
												}
											}
										},
										"url": {
											"raw": "{{BaseURL}}{{Oracle19}}",
											"host": [
												"{{BaseURL}}{{Oracle19}}"
											]
										}
									},
									"response": []
								},
								{
									"name": "4. TRN_CONFIRMROTP | Resend OTP",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"/**\r",
													" * TRN_CONFIRMROTP – Resend OTP (Unified)\r",
													" *\r",
													" * Scenarios:\r",
													" *  A) Success (resent):      resCode=\"0\"      -> message.resendOtpResponse present\r",
													" *  B) Already confirmed:     resCode=\"190\"    -> Arabic \"تم تأكيد طلب التحويل من قبل\"\r",
													" *  C) No request:            resCode=\"16100\"  -> Arabic \"لا يوجد طلب لتسجيل الحساب البنكي لهذا العميل\"\r",
													" *  D) Resend too soon:       resCode=\"16137\"  -> Arabic \"لا يمكن إعادة إرسال رمز التحقق...\"\r",
													" *\r",
													" * Saves (depending on scenario):\r",
													" *  ROTP_SCENARIO = SUCCESS | ALREADY_CONFIRMED | NO_REQUEST | RESEND_TOO_SOON\r",
													" *  ROTP_DESC     = responseStatus.resDesc (or resDesc1)\r",
													" *  TRN_RESEND_OTP_LENGTH, TRN_RESEND_OTP_EXPIRY, TRN_RESEND_OTP_RESEND, TRN_RESEND_OTP_TOKEN (on success)\r",
													" */\r",
													"\r",
													"pm.test(\"HTTP 200\", function(){ pm.response.to.have.status(200); });\r",
													"\r",
													"pm.test(\"Content-Type is JSON\", function(){\r",
													"  pm.response.to.have.header(\"Content-Type\");\r",
													"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
													"});\r",
													"\r",
													"// Parse\r",
													"var json;\r",
													"pm.test(\"Body is JSON\", function(){\r",
													"  json = pm.response.json();\r",
													"  pm.expect(json).to.be.an(\"object\");\r",
													"});\r",
													"\r",
													"// Helpers\r",
													"function trim(s){ return String(s == null ? \"\" : s).replace(/^\\s+|\\s+$/g,\"\"); }\r",
													"\r",
													"// Envelope\r",
													"var rs = json.responseStatus || {};\r",
													"pm.test(\"Source & codes\", function(){\r",
													"  pm.expect(rs.source).to.eql(\"TRN_CONFIRMROTP\");\r",
													"  pm.expect([\"0\",\"190\",\"16100\",\"16137\"]).to.include(String(rs.resCode));\r",
													"  pm.expect([\"0\",\"190\",\"16100\",\"16137\"]).to.include(String(rs.resCode1));\r",
													"});\r",
													"\r",
													"// Branch scenario\r",
													"var scenario =\r",
													"  rs.resCode === \"0\"      ? \"SUCCESS\" :\r",
													"  rs.resCode === \"190\"    ? \"ALREADY_CONFIRMED\" :\r",
													"  rs.resCode === \"16100\"  ? \"NO_REQUEST\" :\r",
													"                             \"RESEND_TOO_SOON\";\r",
													"\r",
													"// ---------- A) Success (resent) ----------\r",
													"pm.test(\"Scenario A – Success (resent OTP)\", function(){\r",
													"  if (scenario !== \"SUCCESS\") { this.skip && this.skip(); return; }\r",
													"\r",
													"  var node = (((json || {}).message || {}).resendOtpResponse) || {};\r",
													"  pm.expect(node, \"resendOtpResponse exists\").to.be.an(\"object\");\r",
													"\r",
													"  // Required keys & types\r",
													"  var keys = [\"otpExpiryPeriod\",\"otpResendPeriod\",\"otpLength\",\"otpToken\"];\r",
													"  for (var i=0;i<keys.length;i++){\r",
													"    pm.expect(node, \"Missing key: \" + keys[i]).to.have.property(keys[i]);\r",
													"    pm.expect(typeof node[keys[i]], keys[i] + \" must be string\").to.eql(\"string\");\r",
													"  }\r",
													"\r",
													"  // Exact values\r",
													"  pm.expect(String(node.otpLength)).to.eql(\"4\");\r",
													"  pm.expect(String(node.otpExpiryPeriod)).to.eql(\"300\");\r",
													"  pm.expect(String(node.otpResendPeriod)).to.eql(\"60\");\r",
													"  pm.expect(String(node.otpToken)).to.eql(\"SAVE_TRANSFER\");\r",
													"\r",
													"  // Save env\r",
													"  pm.environment.set(\"ROTP_SCENARIO\", \"SUCCESS\");\r",
													"  pm.environment.set(\"ROTP_DESC\", trim(rs.resDesc || rs.resDesc1 || \"\"));\r",
													"  pm.environment.set(\"TRN_RESEND_OTP_LENGTH\", String(node.otpLength || \"\"));\r",
													"  pm.environment.set(\"TRN_RESEND_OTP_EXPIRY\", String(node.otpExpiryPeriod || \"\"));\r",
													"  pm.environment.set(\"TRN_RESEND_OTP_RESEND\", String(node.otpResendPeriod || \"\"));\r",
													"  pm.environment.set(\"TRN_RESEND_OTP_TOKEN\",  String(node.otpToken || \"\"));\r",
													"});\r",
													"\r",
													"// ---------- B) Already confirmed ----------\r",
													"pm.test(\"Scenario B – Already confirmed\", function(){\r",
													"  if (scenario !== \"ALREADY_CONFIRMED\") { this.skip && this.skip(); return; }\r",
													"\r",
													"  var d0 = trim(rs.resDesc), d1 = trim(rs.resDesc1);\r",
													"  var ok = /تم\\s*تأكيد\\s*طلب\\s*التحويل\\s*من\\s*قبل/.test(d0) &&\r",
													"           /تم\\s*تأكيد\\s*طلب\\s*التحويل\\s*من\\s*قبل/.test(d1);\r",
													"  pm.expect(ok, \"Arabic 'already confirmed' message\").to.be.true;\r",
													"\r",
													"  pm.environment.set(\"ROTP_SCENARIO\", \"ALREADY_CONFIRMED\");\r",
													"  pm.environment.set(\"ROTP_DESC\", d0 || d1);\r",
													"  pm.environment.unset(\"TRN_RESEND_OTP_LENGTH\");\r",
													"  pm.environment.unset(\"TRN_RESEND_OTP_EXPIRY\");\r",
													"  pm.environment.unset(\"TRN_RESEND_OTP_RESEND\");\r",
													"  pm.environment.unset(\"TRN_RESEND_OTP_TOKEN\");\r",
													"});\r",
													"\r",
													"// ---------- C) No request ----------\r",
													"pm.test(\"Scenario C – No bank registration request\", function(){\r",
													"  if (scenario !== \"NO_REQUEST\") { this.skip && this.skip(); return; }\r",
													"\r",
													"  var d0 = trim(rs.resDesc), d1 = trim(rs.resDesc1);\r",
													"  var ok = /لا\\s*يوجد\\s*طلب\\s*لتسجيل\\s*الحساب\\s*ال?بنكي\\s*لهذا\\s*العميل/.test(d0) &&\r",
													"           /لا\\s*يوجد\\s*طلب\\s*لتسجيل\\s*الحساب\\s*ال?بنكي\\s*لهذا\\s*العميل/.test(d1);\r",
													"  pm.expect(ok, \"Arabic 'no request' message\").to.be.true;\r",
													"\r",
													"  pm.environment.set(\"ROTP_SCENARIO\", \"NO_REQUEST\");\r",
													"  pm.environment.set(\"ROTP_DESC\", d0 || d1);\r",
													"  pm.environment.unset(\"TRN_RESEND_OTP_LENGTH\");\r",
													"  pm.environment.unset(\"TRN_RESEND_OTP_EXPIRY\");\r",
													"  pm.environment.unset(\"TRN_RESEND_OTP_RESEND\");\r",
													"  pm.environment.unset(\"TRN_RESEND_OTP_TOKEN\");\r",
													"});\r",
													"\r",
													"// ---------- D) Resend too soon ----------\r",
													"pm.test(\"Scenario D – Resend too soon\", function(){\r",
													"  if (scenario !== \"RESEND_TOO_SOON\") { this.skip && this.skip(); return; }\r",
													"\r",
													"  var d0 = trim(rs.resDesc), d1 = trim(rs.resDesc1);\r",
													"  var ok = /لا\\s*يمكن\\s*إعادة\\s*إرسال\\s*رمز\\s*التحقق\\.\\s*الرجاء\\s*الانتظار\\s*لمدة\\s*دقيقة\\s*واحدة\\s*على\\s*الأقل\\s*قبل\\s*إعادة\\s*المحاولة/.test(d0) &&\r",
													"           /لا\\s*يمكن\\s*إعادة\\s*إرسال\\s*رمز\\s*التحقق\\.\\s*الرجاء\\s*الانتظار\\s*لمدة\\s*دقيقة\\s*واحدة\\s*على\\s*الأقل\\s*قبل\\s*إعادة\\s*المحاولة/.test(d1);\r",
													"  pm.expect(ok, \"Arabic 'resend too soon' message\").to.be.true;\r",
													"\r",
													"  pm.environment.set(\"ROTP_SCENARIO\", \"RESEND_TOO_SOON\");\r",
													"  pm.environment.set(\"ROTP_DESC\", d0 || d1);\r",
													"  pm.environment.unset(\"TRN_RESEND_OTP_LENGTH\");\r",
													"  pm.environment.unset(\"TRN_RESEND_OTP_EXPIRY\");\r",
													"  pm.environment.unset(\"TRN_RESEND_OTP_RESEND\");\r",
													"  pm.environment.unset(\"TRN_RESEND_OTP_TOKEN\");\r",
													"});\r",
													"\r",
													"// Minimal schema (tv4)\r",
													"pm.test(\"Schema (minimal) validates\", function(){\r",
													"  var schema = {\r",
													"    type: \"object\",\r",
													"    required: [\"responseStatus\"],\r",
													"    properties: {\r",
													"      responseStatus: {\r",
													"        type: \"object\",\r",
													"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
													"        properties: {\r",
													"          source:  { \"const\": \"TRN_CONFIRMROTP\" },\r",
													"          resCode: { \"enum\": [\"0\",\"190\",\"16100\",\"16137\"] },\r",
													"          resCode1:{ \"enum\": [\"0\",\"190\",\"16100\",\"16137\"] }\r",
													"        }\r",
													"      },\r",
													"      message: { type: \"object\" }\r",
													"    }\r",
													"  };\r",
													"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
													"});\r",
													"\r",
													"// Optional: verify request Srv\r",
													"pm.test(\"Request Srv is TRN_CONFIRMROTP\", function(){\r",
													"  try {\r",
													"    var body = pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {};\r",
													"    pm.expect((body || {}).Srv).to.eql(\"TRN_CONFIRMROTP\");\r",
													"  } catch(e) { console.warn(\"Could not parse request body:\", e.message); }\r",
													"});\r",
													"\r",
													"console.log(\"✅ TRN_CONFIRMROTP scenario=\", pm.environment.get(\"ROTP_SCENARIO\") || \"\",\r",
													"            \"desc=\", pm.environment.get(\"ROTP_DESC\") || \"\",\r",
													"            \"token=\", pm.environment.get(\"TRN_RESEND_OTP_TOKEN\") || \"(none)\");\r",
													""
												],
												"type": "text/javascript",
												"packages": {},
												"requests": {}
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Accept",
												"value": "application/json",
												"type": "text"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\r\n    \"Srv\": \"TRN_CONFIRMROTP\",\r\n    \"Message\": {\r\n        \"ResendConfirmOTPRequest\": {\r\n            \"confirmAmount\": \"9000\",\r\n            \"isConfirmed\": \"Y\",\r\n            \"confirmGUID\": \"{{resTrnGUID}}\",\r\n            \"confirmLang\": \"ARB\",\r\n            \"confirmNin\": \"{{NIN}}\",\r\n            \"otpToken\": \"SAVE_TRANSFER\",\r\n            \"confirmClientIP\": \"\",\r\n            \"confirmSource\": \"\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"05-10-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}",
											"options": {
												"raw": {
													"language": "json"
												}
											}
										},
										"url": {
											"raw": "{{BaseURL}}{{Oracle19}}",
											"host": [
												"{{BaseURL}}{{Oracle19}}"
											]
										}
									},
									"response": []
								},
								{
									"name": "5. TRN_CONFIRMCANOTP",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"/**\r",
													" * TRN_CONFIRMCANOTP – Confirm OTP for transfer to group account (Unified)\r",
													" *\r",
													" * Scenarios handled:\r",
													" *  A) Success (Approved):   resCode=\"0\"      -> transferInfoResponse.requestStatus=\"APRV\"\r",
													" *  B) Already confirmed:    resCode=\"190\"    -> تم تأكيد طلب التحويل من قبل\r",
													" *  C) No request:           resCode=\"16100\"  -> لا يوجد طلب لتسجيل الحساب البنكي لهذا العميل\r",
													" *  D) Success (Cancelled):  resCode=\"0\"      -> transferInfoResponse.requestStatus=\"CAN\"\r",
													" *  E) Invalid transfer data:resCode=\"16113\"  -> خطأ في بيانات التحويل\r",
													" *  F) Invalid OTP:          resCode=\"110070\" -> كلمة المرور لمرة واحدة غير صالحة\r",
													" *\r",
													" * Saves (depending on scenario):\r",
													" *  TRN_CONFIRM_SCENARIO ∈ { SUCCESS_APRV, SUCCESS_CAN, ALREADY_CONFIRMED, NO_REQUEST, INVALID_TRANSFER_DATA, INVALID_OTP }\r",
													" *  TRN_CONFIRM_DESC     = responseStatus.resDesc (or resDesc1)\r",
													" *  TRN_NIN, TRN_GUID, TRN_REQ_STATUS, TRN_REQ_STATUS_LABEL (on success)\r",
													" */\r",
													"\r",
													"pm.test(\"HTTP 200\", function () { pm.response.to.have.status(200); });\r",
													"\r",
													"pm.test(\"Content-Type is JSON\", function () {\r",
													"  pm.response.to.have.header(\"Content-Type\");\r",
													"  pm.expect(pm.response.headers.get(\"Content-Type\").toLowerCase()).to.include(\"application/json\");\r",
													"});\r",
													"\r",
													"// Parse\r",
													"var json;\r",
													"pm.test(\"Body is JSON\", function () {\r",
													"  json = pm.response.json();\r",
													"  pm.expect(json).to.be.an(\"object\");\r",
													"});\r",
													"\r",
													"// Helpers\r",
													"function trim(s){ return String(s == null ? \"\" : s).replace(/^\\s+|\\s+$/g,\"\"); }\r",
													"function getFlag(name, defVal){\r",
													"  var v = pm.environment.get(name) || pm.globals.get(name);\r",
													"  v = (v == null ? \"\" : String(v)).toUpperCase();\r",
													"  if (v !== \"Y\" && v !== \"N\") return defVal;\r",
													"  return v;\r",
													"}\r",
													"function isGuidLike(s){ return /^[A-Za-z0-9_-]{10,40}$/.test(String(s || \"\")); } // backend GUID style\r",
													"\r",
													"// Arabic normalization: remove diacritics/standalone hamza, unify alef forms, collapse spaces\r",
													"function normalizeAr(s){\r",
													"  s = String(s || \"\");\r",
													"  // remove tashkeel & symbols\r",
													"  s = s.replace(/[\\u064B-\\u0652\\u0670\\u0653-\\u0655]/g, \"\");\r",
													"  // unify alef variants and remove standalone hamza\r",
													"  s = s.replace(/[أإآ]/g, \"ا\").replace(/ء/g, \"\");\r",
													"  // collapse spaces\r",
													"  s = s.replace(/\\s+/g, \" \").trim();\r",
													"  return s;\r",
													"}\r",
													"\r",
													"// Envelope\r",
													"var rs = json.responseStatus || {};\r",
													"pm.test(\"Source is TRN_CONFIRMCANOTP\", function(){\r",
													"  pm.expect(rs.source).to.eql(\"TRN_CONFIRMCANOTP\");\r",
													"});\r",
													"\r",
													"// Accept all known res codes\r",
													"pm.test(\"resCode is one of expected\", function(){\r",
													"  var allowed = [\"0\",\"190\",\"16100\",\"16113\",\"110070\"];\r",
													"  pm.expect(allowed).to.include(String(rs.resCode));\r",
													"  pm.expect(allowed).to.include(String(rs.resCode1));\r",
													"});\r",
													"\r",
													"// Branch scenario\r",
													"var scenario =\r",
													"  (rs.resCode === \"0\") ? \"SUCCESS\" :\r",
													"  (rs.resCode === \"190\") ? \"ALREADY_CONFIRMED\" :\r",
													"  (rs.resCode === \"16100\") ? \"NO_REQUEST\" :\r",
													"  (rs.resCode === \"16113\") ? \"INVALID_TRANSFER_DATA\" :\r",
													"  (rs.resCode === \"110070\") ? \"INVALID_OTP\" :\r",
													"  \"UNKNOWN\";\r",
													"\r",
													"// ---------- Scenario A/D: Success (APRV or CAN) ----------\r",
													"pm.test(\"Scenario A/D – Success payload (APRV or CAN)\", function(){\r",
													"  if (scenario !== \"SUCCESS\") { this.skip && this.skip(); return; }\r",
													"\r",
													"  var node = (((json || {}).message || {}).transferInfoResponse) || {};\r",
													"  pm.expect(node, \"transferInfoResponse exists\").to.be.an(\"object\");\r",
													"\r",
													"  [\"nin\",\"guid\",\"requestStatus\"].forEach(function(k){\r",
													"    pm.expect(node, \"Missing key: \" + k).to.have.property(k);\r",
													"    pm.expect(String(node[k]).length, k + \" non-empty\").to.be.greaterThan(0);\r",
													"  });\r",
													"\r",
													"  var status = String(node.requestStatus || \"\").toUpperCase();\r",
													"  pm.expect([\"APRV\",\"CAN\"]).to.include(status);\r",
													"  pm.expect(isGuidLike(node.guid), \"guid token format\").to.be.true;\r",
													"\r",
													"  var assertNin = getFlag(\"ASSERT_NIN\",\"N\") === \"Y\";\r",
													"  var envNin = pm.environment.get(\"NIN\") || pm.globals.get(\"NIN\") || \"\";\r",
													"  if (assertNin && envNin) {\r",
													"    pm.expect(String(node.nin), \"nin matches ENV NIN\").to.eql(String(envNin));\r",
													"  }\r",
													"\r",
													"  var label = (status === \"APRV\") ? \"APPROVED\" : \"CANCELLED\";\r",
													"  var scenarioTag = (status === \"APRV\") ? \"SUCCESS_APRV\" : \"SUCCESS_CAN\";\r",
													"\r",
													"  pm.environment.set(\"TRN_CONFIRM_SCENARIO\", scenarioTag);\r",
													"  pm.environment.set(\"TRN_CONFIRM_DESC\", trim(rs.resDesc || rs.resDesc1 || \"\"));\r",
													"  pm.environment.set(\"TRN_NIN\", String(node.nin || \"\"));\r",
													"  pm.environment.set(\"TRN_GUID\", String(node.guid || \"\"));\r",
													"  pm.environment.set(\"TRN_REQ_STATUS\", status);\r",
													"  pm.environment.set(\"TRN_REQ_STATUS_LABEL\", label);\r",
													"});\r",
													"\r",
													"// ---------- Scenario B: Already confirmed ----------\r",
													"pm.test(\"Scenario B – Already confirmed (if applicable)\", function(){\r",
													"  if (scenario !== \"ALREADY_CONFIRMED\") { this.skip && this.skip(); return; }\r",
													"  var d0 = trim(rs.resDesc), d1 = trim(rs.resDesc1);\r",
													"  var ok = /تم\\s*تأكيد\\s*طلب\\s*التحويل\\s*من\\s*قبل/.test(d0) &&\r",
													"           /تم\\s*تأكيد\\s*طلب\\s*التحويل\\s*من\\s*قبل/.test(d1);\r",
													"  pm.expect(ok, \"Arabic message: 'already confirmed'\").to.be.true;\r",
													"\r",
													"  pm.environment.set(\"TRN_CONFIRM_SCENARIO\",\"ALREADY_CONFIRMED\");\r",
													"  pm.environment.set(\"TRN_CONFIRM_DESC\", d0 || d1);\r",
													"  pm.environment.unset(\"TRN_NIN\");\r",
													"  pm.environment.unset(\"TRN_GUID\");\r",
													"  pm.environment.unset(\"TRN_REQ_STATUS\");\r",
													"  pm.environment.unset(\"TRN_REQ_STATUS_LABEL\");\r",
													"});\r",
													"\r",
													"// ---------- Scenario C: No request ----------\r",
													"pm.test(\"Scenario C – No bank registration request (if applicable)\", function(){\r",
													"  if (scenario !== \"NO_REQUEST\") { this.skip && this.skip(); return; }\r",
													"  var d0 = trim(rs.resDesc), d1 = trim(rs.resDesc1);\r",
													"  var ok = /لا\\s*يوجد\\s*طلب\\s*لتسجيل\\s*الحساب\\s*البنكي\\s*لهذا\\s*العميل/.test(d0) &&\r",
													"           /لا\\s*يوجد\\s*طلب\\s*لتسجيل\\s*الحساب\\s*ال?بنكي\\s*لهذا\\s*العميل/.test(d1);\r",
													"  pm.expect(ok, \"Arabic message: 'no request for bank registration'\").to.be.true;\r",
													"\r",
													"  pm.environment.set(\"TRN_CONFIRM_SCENARIO\",\"NO_REQUEST\");\r",
													"  pm.environment.set(\"TRN_CONFIRM_DESC\", d0 || d1);\r",
													"  pm.environment.unset(\"TRN_NIN\");\r",
													"  pm.environment.unset(\"TRN_GUID\");\r",
													"  pm.environment.unset(\"TRN_REQ_STATUS\");\r",
													"  pm.environment.unset(\"TRN_REQ_STATUS_LABEL\");\r",
													"});\r",
													"\r",
													"// ---------- Scenario E: Invalid transfer data ----------\r",
													"pm.test(\"Scenario E – Invalid transfer data (if applicable)\", function(){\r",
													"  if (scenario !== \"INVALID_TRANSFER_DATA\") { this.skip && this.skip(); return; }\r",
													"\r",
													"  var d0 = trim(rs.resDesc), d1 = trim(rs.resDesc1);\r",
													"  // Normalize Arabic (remove diacritics/hamza variants) and match canonical text\r",
													"  var n0 = normalizeAr(d0), n1 = normalizeAr(d1);\r",
													"  var canon = normalizeAr(\"خطأ في بيانات التحويل\");\r",
													"  var ok = (n0 === canon) && (n1 === canon);\r",
													"  pm.expect(ok, \"Arabic message: 'invalid transfer data'\").to.be.true;\r",
													"\r",
													"  pm.environment.set(\"TRN_CONFIRM_SCENARIO\",\"INVALID_TRANSFER_DATA\");\r",
													"  pm.environment.set(\"TRN_CONFIRM_DESC\", d0 || d1);\r",
													"  pm.environment.unset(\"TRN_NIN\");\r",
													"  pm.environment.unset(\"TRN_GUID\");\r",
													"  pm.environment.unset(\"TRN_REQ_STATUS\");\r",
													"  pm.environment.unset(\"TRN_REQ_STATUS_LABEL\");\r",
													"});\r",
													"\r",
													"// ---------- Scenario F: Invalid OTP ----------\r",
													"pm.test(\"Scenario F – Invalid OTP (if applicable)\", function(){\r",
													"  if (scenario !== \"INVALID_OTP\") { this.skip && this.skip(); return; }\r",
													"  var d0 = trim(rs.resDesc), d1 = trim(rs.resDesc1);\r",
													"  var ok = /كلمة\\s*المرور\\s*لمرة\\s*واحدة\\s*غير\\s*صالحة/.test(d0) &&\r",
													"           /كلمة\\s*المرور\\s*لمرة\\s*واحدة\\s*غير\\s*صالحة/.test(d1);\r",
													"  pm.expect(ok, \"Arabic message: 'invalid one-time password'\").to.be.true;\r",
													"\r",
													"  pm.environment.set(\"TRN_CONFIRM_SCENARIO\",\"INVALID_OTP\");\r",
													"  pm.environment.set(\"TRN_CONFIRM_DESC\", d0 || d1);\r",
													"  pm.environment.unset(\"TRN_NIN\");\r",
													"  pm.environment.unset(\"TRN_GUID\");\r",
													"  pm.environment.unset(\"TRN_REQ_STATUS\");\r",
													"  pm.environment.unset(\"TRN_REQ_STATUS_LABEL\");\r",
													"});\r",
													"\r",
													"// Minimal schema (tv4) – include new codes\r",
													"pm.test(\"Schema (minimal) validates\", function(){\r",
													"  var schema = {\r",
													"    type: \"object\",\r",
													"    required: [\"responseStatus\"],\r",
													"    properties: {\r",
													"      responseStatus: {\r",
													"        type: \"object\",\r",
													"        required: [\"resCode\",\"resDesc\",\"source\",\"resCode1\",\"resDesc1\"],\r",
													"        properties: {\r",
													"          source:  { \"const\": \"TRN_CONFIRMCANOTP\" },\r",
													"          resCode: { \"enum\": [\"0\",\"190\",\"16100\",\"16113\",\"110070\"] },\r",
													"          resCode1:{ \"enum\": [\"0\",\"190\",\"16100\",\"16113\",\"110070\"] }\r",
													"        }\r",
													"      },\r",
													"      message: { type: \"object\" }\r",
													"    }\r",
													"  };\r",
													"  pm.expect(tv4.validate(json, schema), tv4.error && JSON.stringify(tv4.error)).to.be.true;\r",
													"});\r",
													"\r",
													"// Optional: verify request Srv\r",
													"pm.test(\"Request Srv is TRN_CONFIRMCANOTP\", function(){\r",
													"  try {\r",
													"    var body = pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {};\r",
													"    pm.expect((body || {}).Srv).to.eql(\"TRN_CONFIRMCANOTP\");\r",
													"  } catch(e) { console.warn(\"Could not parse request body:\", e.message); }\r",
													"});\r",
													"\r",
													"console.log(\r",
													"  \"TRN_CONFIRMCANOTP\",\r",
													"  \"scenario=\", pm.environment.get(\"TRN_CONFIRM_SCENARIO\") || \"\",\r",
													"  \"status=\", pm.environment.get(\"TRN_REQ_STATUS\") || \"\",\r",
													"  \"guid=\", pm.environment.get(\"TRN_GUID\") || \"(none)\"\r",
													");\r",
													""
												],
												"type": "text/javascript",
												"packages": {},
												"requests": {}
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Accept",
												"value": "application/json",
												"type": "text"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\r\n    \"Srv\": \"TRN_CONFIRMCANOTP\",\r\n    \"Message\": {\r\n        \"TrnConfirmCanRequest\": {\r\n            \"confirmAmount\": \"9000\",\r\n            \"isConfirmed\": \"Y\",\r\n            \"confirmOTP\": \"1812\",\r\n            \"confirmGUID\": \"{{resTrnGUID}}\",\r\n            \"confirmLang\": \"ARB\",\r\n            \"confirmNin\": \"{{NIN}}\",\r\n            \"otpToken\": \"SAVE_TRANSFER\",\r\n            \"confirmClientIP\": \"\",\r\n            \"confirmSource\": \"\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"05-10-2025\",\r\n    \"sessionId\": \"{{SessionID}}\"\r\n}",
											"options": {
												"raw": {
													"language": "json"
												}
											}
										},
										"url": {
											"raw": "{{BaseURL}}{{Oracle19}}",
											"host": [
												"{{BaseURL}}{{Oracle19}}"
											]
										}
									},
									"response": []
								}
							]
						}
					]
				}
			]
		},
		{
			"name": "22. Session Token",
			"item": [
				{
					"name": "VALIDATE_SESSION_TOKEN",
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "POST",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"Srv\": \"VALIDATE_SESSION_TOKEN\",\r\n    \"Message\": {\r\n        \"ValidateSessionTokenRequest\": {\r\n             \"BankCode\": \"QIB\",\r\n            \"TransactionId\": \"cd5d57a5-6256-4658-903a-f07ca08c6f94\",\r\n            \"SessionToken\": \"271bed24-98a0-4f5f-9d5d-67199699ac26\"\r\n        }\r\n    },\r\n    \"Lang\": \"WEB_ORDERS.25\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"08-07-2015\",\r\n    \"Version\": \"1\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{BaseURL}}{{Oracle19}}",
							"host": [
								"{{BaseURL}}{{Oracle19}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "VERIFY_SESSION_TOKEN_OTP",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"Request\": {\r\n    \"Srv\": \"VERIFY_SESSION_TOKEN_OTP\",\r\n    \"Lang\": \"ARB\",\r\n    \"Message\": {\r\n      \"ValidateSessionTokenRequest\": {\r\n        \"BankCode\": \"QIB\",\r\n        \"TransactionId\": \"cd5d57a5-6256-4658-903a-f07ca08c6f94\",\r\n        \"SessionToken\": \"fc92f02c-0865-4cf3-9cc4-7ef2d39c9c51\",\r\n        \"UserIp\": \"\",\r\n        \"OsName\": \"MacOS\",\r\n        \"OsVersion\": \"\",\r\n        \"OtpToken\": \"QIB\",\r\n        \"OtpValue\": \"0000\"\r\n      }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\"\r\n  }\r\n}\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{BaseURL}}{{Oracle19}}",
							"host": [
								"{{BaseURL}}{{Oracle19}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "RESEND_SESSION_TOKEN_OTP",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"Request\": {\r\n    \"Srv\": \"RESEND_SESSION_TOKEN_OTP\",\r\n    \"Lang\": \"ARB\",\r\n    \"Message\": {\r\n      \"ValidateSessionTokenRequest\": {\r\n        \"BankCode\": \"QIB\",\r\n        \"TransactionId\": \"cd5d57a5-6256-4658-903a-f07ca08c6f94\",\r\n        \"SessionToken\": \"fc92f02c-0865-4cf3-9cc4-7ef2d39c9c51\",\r\n        \"OtpToken\": \"QIB\"\r\n      }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"AppId\": \"WEB_ORDERS.25\"\r\n  }\r\n}\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{BaseURL}}{{Oracle19}}",
							"host": [
								"{{BaseURL}}{{Oracle19}}"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "23. Account Statement",
			"item": [
				{
					"name": "ACCOUNT_STATEMENT",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"Srv\": \"ACCOUNT_STATEMENT\",\r\n    \"Message\": {\r\n        \"AccStateRequest\": {\r\n            \"NIN\": \"{{NIN}}\",\r\n            \"dateFrom\": \"2025-08-15\", /* Default: One day erlier*/\r\n            \"dateTo\": \"2025-09-15\",\r\n            \"type\": \"MARGIN\"  /** COMPACT / TRADE / MARGIN / CASH **/\r\n        }\r\n    },\r\n    \"Lang\": \"ARB\",\r\n    \"SessionID\": \"{{SessionID}}\",\r\n    \"AppId\": \"MTX_BO_ETRADE\",\r\n    \"LstLogin\": \"15-10-2025\",\r\n    \"Version\": \"1\",\r\n    \"RandomToken\": \"1004159121\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{BaseURL}}{{Oracle19}}",
							"host": [
								"{{BaseURL}}{{Oracle19}}"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "24. My Calc",
			"item": [
				{
					"name": "My Calc",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Parse response\r",
									"let res = pm.response.json();\r",
									"\r",
									"// 1️⃣ Verify HTTP status\r",
									"pm.test(\"Status code is 200\", function () {\r",
									"    pm.response.to.have.status(200);\r",
									"});\r",
									"\r",
									"// 2️⃣ Basic structure exists\r",
									"pm.test(\"Response has message.myCalcResponse\", function () {\r",
									"    pm.expect(res).to.have.property(\"message\");\r",
									"    pm.expect(res.message).to.have.property(\"myCalcResponse\");\r",
									"});\r",
									"\r",
									"// 3️⃣ Verify responseStatus block\r",
									"pm.test(\"responseStatus is successful for MY_CALC\", function () {\r",
									"    pm.expect(res).to.have.property(\"responseStatus\");\r",
									"    let rs = res.responseStatus;\r",
									"\r",
									"    pm.expect(rs.resCode).to.eql(\"0\");\r",
									"    pm.expect(rs.resDesc).to.eql(\"عمليه ناجحة\");\r",
									"    pm.expect(rs.source).to.eql(\"MY_CALC\");\r",
									"    pm.expect(rs.resCode1).to.eql(\"0\");\r",
									"    pm.expect(rs.resDesc1).to.eql(\"عمليه ناجحة\");\r",
									"});\r",
									"\r",
									"// 4️⃣ Validate transaction records\r",
									"let myCalc = res.message.myCalcResponse;\r",
									"let trnxArr = myCalc.myCalcRecords && myCalc.myCalcRecords.trnx;\r",
									"let firstRow = trnxArr && trnxArr.length > 0 ? trnxArr[0] : null;\r",
									"\r",
									"pm.test(\"myCalcRecords has at least one row\", function () {\r",
									"    pm.expect(firstRow, \"Expected at least one row in myCalcRecords.trnx\").to.not.be.null;\r",
									"});\r",
									"\r",
									"// 🧩 Helper function to convert dd/MM/yyyy → yyyy-MM-dd\r",
									"function toIsoFromDdMmYyyy(ddmmyyyy) {\r",
									"    if (!ddmmyyyy) return \"\";\r",
									"    const parts = ddmmyyyy.split(\"/\");\r",
									"    if (parts.length !== 3) return ddmmyyyy;\r",
									"    const [dd, mm, yyyy] = parts;\r",
									"    return `${yyyy}-${mm.padStart(2, \"0\")}-${dd.padStart(2, \"0\")}`;\r",
									"}\r",
									"\r",
									"// 5️⃣ Store key values in environment for next API\r",
									"if (firstRow) {\r",
									"    pm.environment.set(\"mc_portVal\", firstRow.portVal);\r",
									"    pm.environment.set(\"mc_bal\", firstRow.bal);\r",
									"    pm.environment.set(\"mc_prevBal\", firstRow.prevBal);\r",
									"    pm.environment.set(\"mc_cashDiv\", firstRow.cashDiv);\r",
									"    pm.environment.set(\"mc_assets\", firstRow.assets);\r",
									"    pm.environment.set(\"mc_with\", firstRow.with);\r",
									"    pm.environment.set(\"mc_depo\", firstRow.depo);\r",
									"    pm.environment.set(\"mc_profit\", firstRow.profit);\r",
									"    pm.environment.set(\"mc_stkTransfer\", firstRow.stkTransfer);\r",
									"    pm.environment.set(\"mc_regTransfer\", firstRow.regTransfer);\r",
									"    pm.environment.set(\"mc_fees\", firstRow.fees);\r",
									"}\r",
									"\r",
									"// 6️⃣ Save dateFrom / dateTo in correct yyyy-MM-dd format\r",
									"if (myCalc.myCalcActualRequest) {\r",
									"    const apiDateFrom = myCalc.myCalcActualRequest.dateFrom; // e.g. \"01/08/2025\"\r",
									"    const apiDateTo = myCalc.myCalcActualRequest.dateTo;     // e.g. \"06/11/2025\"\r",
									"\r",
									"    const formattedFrom = toIsoFromDdMmYyyy(apiDateFrom); // → \"2025-08-01\"\r",
									"    const formattedTo = toIsoFromDdMmYyyy(apiDateTo);     // → \"2025-11-06\"\r",
									"\r",
									"    pm.environment.set(\"mc_dateFrom\", formattedFrom);\r",
									"    pm.environment.set(\"mc_dateTo\", formattedTo);\r",
									"}\r",
									"\r",
									"// ✅ Optional log for quick debug\r",
									"console.log(\"Stored values for MY_CALC:\", {\r",
									"    dateFrom: pm.environment.get(\"mc_dateFrom\"),\r",
									"    dateTo: pm.environment.get(\"mc_dateTo\"),\r",
									"    bal: pm.environment.get(\"mc_bal\"),\r",
									"    profit: pm.environment.get(\"mc_profit\")\r",
									"});\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"Srv\": \"MY_CALC\",\r\n    \"Message\": {\r\n        \"MyCalcRequest\": {\r\n            \"NIN\": \"{{NIN}}\", \r\n            \"dateFrom\": \"2025-11-16\",\r\n            \"dateTo\": \"2025-11-17\",\r\n            \"period\": \"ALL\"  /* Period: ALL, DAY, WEEK, MONTH, YEAR */\r\n        }\r\n    },\r\n    \"Lang\": \"ARB\",\r\n    \"SessionID\": \"{{SessionID}}\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"29-09-2025\",\r\n    \"Version\": \"1\"\r\n}\r\n ",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{BaseURL}}{{Oracle19}}",
							"host": [
								"{{BaseURL}}{{Oracle19}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "My Calc Details",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"let res = pm.response.json();\r",
									"\r",
									"// 1️⃣ Verify HTTP status\r",
									"pm.test(\"Status code is 200\", function () {\r",
									"    pm.response.to.have.status(200);\r",
									"});\r",
									"\r",
									"// 2️⃣ Verify responseStatus block (accept AR or EN)\r",
									"pm.test(\"responseStatus is successful for MY_CALC_DETAILS\", function () {\r",
									"    pm.expect(res).to.have.property(\"responseStatus\");\r",
									"    let rs = res.responseStatus;\r",
									"\r",
									"    pm.expect(rs.resCode).to.eql(\"0\");\r",
									"    pm.expect(rs.resCode1).to.eql(\"0\");\r",
									"    pm.expect(rs.source).to.eql(\"MY_CALC_DETAILS\");\r",
									"\r",
									"    // accept both Arabic and English\r",
									"    const okMessages = [\"عمليه ناجحة\", \"Successful Operation\"];\r",
									"\r",
									"    pm.expect(okMessages).to.include(rs.resDesc);\r",
									"    pm.expect(okMessages).to.include(rs.resDesc1);\r",
									"});\r",
									"\r",
									"// 3️⃣ Verify details list exists\r",
									"pm.test(\"myCalcDetailsRecords has records array\", function () {\r",
									"    pm.expect(res).to.have.nested.property(\"message.myCalcDetailsRecords.record\");\r",
									"    let records = res.message.myCalcDetailsRecords.record;\r",
									"    pm.expect(records).to.be.an(\"array\").that.is.not.empty;\r",
									"});\r",
									"\r",
									"// 4️⃣ Optionally store first record for later use\r",
									"let records = res.message.myCalcDetailsRecords.record;\r",
									"if (records && records.length > 0) {\r",
									"    pm.environment.set(\"mcd_firstSymbol\", records[0].symbol || \"\");\r",
									"    pm.environment.set(\"mcd_firstProfit\", records[0].profit || \"\");\r",
									"}\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"Srv\": \"MY_CALC_DETAILS\",\r\n    \"Message\": {\r\n        \"MyCalcDetailsRequest\": {\r\n            \"NIN\": \"{{NIN}}\",\r\n            \"dateFrom\": \"2025-11-03\",\r\n            \"dateTo\": \"2025-11-03\",\r\n            \"period\": \"ALL\", /* Period: ALL, DAY, WEEK, MONTH, YEAR */\r\n            \"bal\": \"{{mc_bal}}\",\r\n            \"prevBal\": \"{{mc_prevBal}}\",\r\n            \"with\": \"{{mc_with}}\",\r\n            \"depo\": \"{{mc_depo}}\",\r\n            \"cashDiv\": \"{{mc_cashDiv}}\",\r\n            \"stkTransfer\": \"{{mc_stkTransfer}}\",\r\n            \"regTransfer\": \"{{mc_regTransfer}}\",\r\n            \"fees\": \"{{mc_fees}}\"\r\n        }\r\n    },\r\n    \"Lang\": \"ARB\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"29-09-2025\",\r\n    \"Version\": \"1\",\r\n    \"SessionID\": \"{{SessionID}}\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{BaseURL}}{{Oracle19}}",
							"host": [
								"{{BaseURL}}{{Oracle19}}"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "25. Apply Cash Distribution",
			"item": [
				{
					"name": "Apply Cash Distribution",
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "POST",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n        \"Srv\": \"APPLY_TODAY_CASH_DISTRIBUTION\",\r\n        \"Message\": {\r\n            \"Request\": {\r\n                \"UserId\": \"{{NIN}}\",\r\n                \"WithCashDistribution\": true\r\n            }\r\n        },\r\n    \"SessionID\": \"{{SessionID}}\"\r\n    }\r\n ",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{BaseURL}}{{Oracle19}}",
							"host": [
								"{{BaseURL}}{{Oracle19}}"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "Remaining APIs",
			"item": [
				{
					"name": "GETORDREMARKS",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"Srv\": \"GETORDREMARKS\",\r\n    \"Message\": {\r\n        \"OrdRemarksRequest\": {\r\n            \"SLNO\": \"98525083\",\r\n            \"UserId\": \"{{NIN}}\",\r\n            \"UserType\": \"\",\r\n            \"Lang\": \"ARB\"\r\n        }\r\n    },\r\n    \"Version\": 1,\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"2025-01-07\",\r\n    \"SessionID\": \"{{SessionID}}\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{BaseURL}}{{Oracle19}}",
							"host": [
								"{{BaseURL}}{{Oracle19}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "CLNTBNKACCSNEW",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"Srv\": \"CLNTBNKACCSNEW\",\r\n    \"Message\": {\r\n        \"BanksAccountsRequest\": {\r\n            \"NIN\": \"{{NIN}}\",\r\n            \"UserId\": \"{{UserID}}\",\r\n            \"UserType\": \"\",\r\n            \"Lang\": \"ARB\",\r\n            \"AccRegisterType\": \"\"\r\n        }\r\n    },\r\n    \"Version\": 1,\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"2025-01-07\",\r\n    \"SessionID\": \"{{SessionID}}\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{BaseURL}}{{Oracle19}}",
							"host": [
								"{{BaseURL}}{{Oracle19}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "UPDTBNKACCNEW",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"Srv\": \"UPDTBNKACCNEW\",\r\n    \"Message\": {\r\n        \"UpdateBankAccountRequest\": {\r\n            \"CurrentAccountNo\": \"\",\r\n            \"SwiftAddress\": \"\",\r\n            \"Status\": \"\",\r\n            \"CurrentCurrencyCode\": \"\",\r\n            \"NewAccountNo\": \"\",\r\n            \"NewCurrencyCode\": \"\",\r\n            \"AccountSeq\": \"\",\r\n            \"NIN\": \"{{NIN}}\",\r\n            \"AccountIBAN\": \"\",\r\n            \"UserId\": \"{{UserID}}\",\r\n            \"UserType\": \"\",\r\n            \"Lang\": \"ARB\",\r\n            \"ClientUserIP\": \"{{ClientAltIP}}\"\r\n        }\r\n    },\r\n    \"Version\": 1,\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"2025-01-07\",\r\n    \"SessionID\": \"{{SessionID}}\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{BaseURL}}{{Oracle19}}",
							"host": [
								"{{BaseURL}}{{Oracle19}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "SL_OTP",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"Srv\": \"SL_OTP\",\r\n    \"Message\": {\r\n        \"OtpERequest\": \"\"\r\n    },\r\n    \"Version\": 1,\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"2025-01-07\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{BaseURL}}{{Oracle19}}",
							"host": [
								"{{BaseURL}}{{Oracle19}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "NINS_LIST",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"Srv\": \"NINS_LIST\",\r\n    \"Message\": {\r\n        \"NinListERequest\": \"\"\r\n    },\r\n    \"Version\": 1,\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"2025-01-07\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{BaseURL}}{{Oracle19}}",
							"host": [
								"{{BaseURL}}{{Oracle19}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "SMART_LOGIN",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"Srv\": \"SMART_LOGIN\",\r\n  \"Message\": {\r\n    \"NinListERequest\": \"\"\r\n  },\r\n  \"Version\": 1,\r\n  \"AppId\": \"WEB_ORDERS.25\",\r\n  \"LstLogin\": \"2025-01-07\"\r\n}\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{BaseURL}}{{Oracle19}}",
							"host": [
								"{{BaseURL}}{{Oracle19}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "HANDLE_CLIENT_DATA",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"Srv\": \"HANDLE_CLIENT_DATA\",\r\n    \"Message\": {\r\n        \"EtradeClientDataRequest\": {\r\n            \"Lang\": \"ARB\",\r\n            \"GUID\": \"\",\r\n            \"NIN\": \"{{NIN}}\",\r\n            \"ResponseFlag\": 1,\r\n            \"ResponseOperation\": \"\",\r\n            \"ClientIP\": \"{{ClientAltIP}}\",\r\n            \"Iban\": \"\",\r\n            \"CltInfoReqId\": \"\",\r\n            \"PersonalIdExpiryDate\": \"\",\r\n            \"WorkPlace\": \"\",\r\n            \"MonthlyIncome\": \"\",\r\n            \"OtherSourcesOfIncome\": \"\",\r\n            \"AddressBldgNo\": \"\",\r\n            \"AddressZoneNo\": \"\",\r\n            \"AddressStreetNo\": \"\",\r\n            \"WorkPosition\": \"\",\r\n            \"PassportExpiryDate\": \"\",\r\n            \"PassportNo\": \"\",\r\n            \"Email\": \"\",\r\n            \"OTP\": \"\",\r\n            \"Attachment\": [\r\n                \"\",\r\n                \"\"\r\n            ],\r\n            \"SmartLogin\": false,\r\n            \"AuthenticatedClient\": false,\r\n            \"MarginActivationRequired\": \"N\"\r\n        }\r\n    },\r\n    \"Version\": 1,\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"2025-01-07\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{BaseURL}}{{Oracle19}}",
							"host": [
								"{{BaseURL}}{{Oracle19}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "PREVIEW_CONTRACT",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"Srv\": \"PREVIEW_CONTRACT\",\r\n    \"Message\": {\r\n        \"PreviewContractRequest\": {\r\n            \"NIN\": \"{{NIN}}\",\r\n            \"ClientInfo\": {\r\n                \"NIN\": \"{{NIN}}\",\r\n                \"GUID\": \"\",\r\n                \"PersonalId\": \"\",\r\n                \"CrNo\": \"\",\r\n                \"Title\": \"\",\r\n                \"NameAr\": \"\",\r\n                \"NameEn\": \"\",\r\n                \"ClType\": \"\",\r\n                \"SMSLanguage\": \"\",\r\n                \"CltInfoReqId\": \"\",\r\n                \"Iban\": \"\",\r\n                \"PersonalIdExpiryDate\": \"\",\r\n                \"WorkPlace\": \"\",\r\n                \"WorkPosition\": \"\",\r\n                \"MonthlyIncome\": \"\",\r\n                \"OtherSourcesOfIncome\": \"\",\r\n                \"AddressBldgNo\": \"\",\r\n                \"AddressZoneNo\": \"\",\r\n                \"AddressStreetNo\": \"\",\r\n                \"PassportExpiryDate\": \"\",\r\n                \"PassportNo\": \"\",\r\n                \"Email\": \"\",\r\n                \"ClientIP\": \"{{ClientAltIP}}\",\r\n                \"Nationality\": \"\",\r\n                \"MarginActivationRequired\": \"N\"\r\n            },\r\n            \"SmartLogin\": false,\r\n            \"AuthenticatedClient\": false,\r\n            \"GenerateContractOnline\": false,\r\n            \"ContractType\": \"\",\r\n            \"GenerationType\": \"\",\r\n            \"Attachment\": [\r\n                \"\",\r\n                \"\"\r\n            ]\r\n        }\r\n    },\r\n    \"Version\": 1,\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"2025-01-07\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{BaseURL}}{{Oracle19}}",
							"host": [
								"{{BaseURL}}{{Oracle19}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "LOG_TRACING_EMAIL",
					"protocolProfileBehavior": {
						"disabledSystemHeaders": {}
					},
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"Srv\": \"LOG_TRACING_EMAIL\",\r\n  \"Message\": {\r\n    \"LogTracingRequest\": {\r\n      \"RequestAppId\": \"\",\r\n      \"OS\": \"\",\r\n      \"Browser\": \"\",\r\n      \"MachineName\": \"\",\r\n      \"Resolution\": \"\",\r\n      \"LogFile\": \"\",\r\n      \"LogFileData\": [\r\n        \"\",\r\n        \"\"\r\n      ]\r\n    }\r\n  },\r\n  \"Version\": 1,\r\n  \"AppId\": \"WEB_ORDERS.25\",\r\n  \"LstLogin\": \"2025-01-07\"\r\n}\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{BaseURL}}{{Oracle19}}",
							"host": [
								"{{BaseURL}}{{Oracle19}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "CLNTABRDTRANSFERSN",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"Request\": {\r\n        \"Srv\": \"CLNTABRDTRANSFERSN\",\r\n        \"Message\": {\r\n            \"AbroadTransfersRequest\": {\r\n                \"NIN\": \"{{NIN}}\",\r\n                \"TransferDays\": \"13\",\r\n                \"UserId\": \"{{UserID}}\",\r\n                \"UserType\": \"INVESTOR\",\r\n                \"Lang\": \"ARB\"\r\n            }\r\n        },\r\n        \"Version\": \"1\",\r\n        \"Lang\": \"ARB\",\r\n        \"AppId\": \"WEB_ORDERS.25\",\r\n        \"LstLogin\": \"2025-01-07\",\r\n        \"SessionID\": \"{{SessionID}}\"\r\n    }\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{BaseURL}}{{Oracle19}}",
							"host": [
								"{{BaseURL}}{{Oracle19}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "CURRCREDIT",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"Srv\": \"CURRCREDIT\",\r\n    \"Message\": {\r\n        \"BRequest\": {\r\n            \"NIN\": \"{{NIN}}\",\r\n            \"UserId\": \"{{UserID}}\",\r\n            \"UserType\": \"INVESTOR\",\r\n            \"Lang\": \"ARB\"\r\n        }\r\n    },\r\n    \"Version\": \"1\",\r\n    \"Lang\": \"ARB\",\r\n    \"AppId\": \"WEB_ORDERS.25\",\r\n    \"LstLogin\": \"2025-01-07\",\r\n    \"SessionID\": \"{{SessionID}}\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{BaseURL}}{{Oracle19}}",
							"host": [
								"{{BaseURL}}{{Oracle19}}"
							]
						}
					},
					"response": []
				}
			]
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"packages": {},
				"requests": {},
				"exec": [
					""
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"packages": {},
				"requests": {},
				"exec": [
					""
				]
			}
		}
	]
}